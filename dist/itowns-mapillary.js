!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("itowns-mapillary",[],t):"object"==typeof exports?exports["itowns-mapillary"]=t():e["itowns-mapillary"]=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=76)}([function(e,t,r){"use strict";function n(){}r.r(t),r.d(t,"WebGLRenderTargetCube",function(){return fr}),r.d(t,"WebGLRenderTarget",function(){return dr}),r.d(t,"WebGLRenderer",function(){return aa}),r.d(t,"ShaderLib",function(){return Cr}),r.d(t,"UniformsLib",function(){return Pr}),r.d(t,"UniformsUtils",function(){return Sr}),r.d(t,"ShaderChunk",function(){return xr}),r.d(t,"FogExp2",function(){return oa}),r.d(t,"Fog",function(){return sa}),r.d(t,"Scene",function(){return la}),r.d(t,"Sprite",function(){return da}),r.d(t,"LOD",function(){return fa}),r.d(t,"SkinnedMesh",function(){return pa}),r.d(t,"Skeleton",function(){return ma}),r.d(t,"Bone",function(){return va}),r.d(t,"Mesh",function(){return Pn}),r.d(t,"LineSegments",function(){return xa}),r.d(t,"LineLoop",function(){return ba}),r.d(t,"Line",function(){return ya}),r.d(t,"Points",function(){return _a}),r.d(t,"Group",function(){return Wi}),r.d(t,"VideoTexture",function(){return Ma}),r.d(t,"DataTexture",function(){return pr}),r.d(t,"DataTexture3D",function(){return On}),r.d(t,"CompressedTexture",function(){return Ea}),r.d(t,"CubeTexture",function(){return Rn}),r.d(t,"CanvasTexture",function(){return Sa}),r.d(t,"DepthTexture",function(){return Ta}),r.d(t,"Texture",function(){return hr}),r.d(t,"AnimationLoader",function(){return gs}),r.d(t,"CompressedTextureLoader",function(){return ys}),r.d(t,"DataTextureLoader",function(){return xs}),r.d(t,"CubeTextureLoader",function(){return ws}),r.d(t,"TextureLoader",function(){return _s}),r.d(t,"ObjectLoader",function(){return sl}),r.d(t,"MaterialLoader",function(){return nl}),r.d(t,"BufferGeometryLoader",function(){return al}),r.d(t,"DefaultLoadingManager",function(){return ps}),r.d(t,"LoadingManager",function(){return fs}),r.d(t,"ImageLoader",function(){return bs}),r.d(t,"ImageBitmapLoader",function(){return vl}),r.d(t,"FontLoader",function(){return bl}),r.d(t,"FileLoader",function(){return vs}),r.d(t,"Loader",function(){return wl}),r.d(t,"LoaderUtils",function(){return il}),r.d(t,"Cache",function(){return ds}),r.d(t,"AudioLoader",function(){return Yl}),r.d(t,"SpotLightShadow",function(){return Zs}),r.d(t,"SpotLight",function(){return Js}),r.d(t,"PointLight",function(){return Ks}),r.d(t,"RectAreaLight",function(){return rl}),r.d(t,"HemisphereLight",function(){return Xs}),r.d(t,"DirectionalLightShadow",function(){return $s}),r.d(t,"DirectionalLight",function(){return el}),r.d(t,"AmbientLight",function(){return tl}),r.d(t,"LightShadow",function(){return Ys}),r.d(t,"Light",function(){return qs}),r.d(t,"StereoCamera",function(){return Zl}),r.d(t,"PerspectiveCamera",function(){return Xi}),r.d(t,"OrthographicCamera",function(){return Qs}),r.d(t,"CubeCamera",function(){return Jl}),r.d(t,"ArrayCamera",function(){return Yi}),r.d(t,"Camera",function(){return qi}),r.d(t,"AudioListener",function(){return Ql}),r.d(t,"PositionalAudio",function(){return eu}),r.d(t,"AudioContext",function(){return Xl}),r.d(t,"AudioAnalyser",function(){return tu}),r.d(t,"Audio",function(){return $l}),r.d(t,"VectorKeyframeTrack",function(){return us}),r.d(t,"StringKeyframeTrack",function(){return ls}),r.d(t,"QuaternionKeyframeTrack",function(){return ss}),r.d(t,"NumberKeyframeTrack",function(){return as}),r.d(t,"ColorKeyframeTrack",function(){return is}),r.d(t,"BooleanKeyframeTrack",function(){return ns}),r.d(t,"PropertyMixer",function(){return ru}),r.d(t,"PropertyBinding",function(){return iu}),r.d(t,"KeyframeTrack",function(){return rs}),r.d(t,"AnimationUtils",function(){return Ko}),r.d(t,"AnimationObjectGroup",function(){return au}),r.d(t,"AnimationMixer",function(){return su}),r.d(t,"AnimationClip",function(){return hs}),r.d(t,"Uniform",function(){return lu}),r.d(t,"InstancedBufferGeometry",function(){return uu}),r.d(t,"BufferGeometry",function(){return on}),r.d(t,"Geometry",function(){return Wr}),r.d(t,"InterleavedBufferAttribute",function(){return ha}),r.d(t,"InstancedInterleavedBuffer",function(){return hu}),r.d(t,"InterleavedBuffer",function(){return ua}),r.d(t,"InstancedBufferAttribute",function(){return cu}),r.d(t,"Face3",function(){return Dr}),r.d(t,"Object3D",function(){return Gr}),r.d(t,"Raycaster",function(){return du}),r.d(t,"Layers",function(){return Nr}),r.d(t,"EventDispatcher",function(){return n}),r.d(t,"Clock",function(){return Kl}),r.d(t,"QuaternionLinearInterpolant",function(){return os}),r.d(t,"LinearInterpolant",function(){return es}),r.d(t,"DiscreteInterpolant",function(){return ts}),r.d(t,"CubicInterpolant",function(){return $o}),r.d(t,"Interpolant",function(){return Qo}),r.d(t,"Triangle",function(){return An}),r.d(t,"Math",function(){return Kt}),r.d(t,"Spherical",function(){return mu}),r.d(t,"Cylindrical",function(){return vu}),r.d(t,"Plane",function(){return gr}),r.d(t,"Frustum",function(){return yr}),r.d(t,"Sphere",function(){return vr}),r.d(t,"Ray",function(){return Tn}),r.d(t,"Matrix4",function(){return $t}),r.d(t,"Matrix3",function(){return rr}),r.d(t,"Box3",function(){return mr}),r.d(t,"Box2",function(){return gu}),r.d(t,"Line3",function(){return yu}),r.d(t,"Euler",function(){return Ir}),r.d(t,"Vector4",function(){return cr}),r.d(t,"Vector3",function(){return tr}),r.d(t,"Vector2",function(){return Qt}),r.d(t,"Quaternion",function(){return er}),r.d(t,"Color",function(){return Ar}),r.d(t,"ImmediateRenderObject",function(){return xu}),r.d(t,"VertexNormalsHelper",function(){return bu}),r.d(t,"SpotLightHelper",function(){return wu}),r.d(t,"SkeletonHelper",function(){return _u}),r.d(t,"PointLightHelper",function(){return Mu}),r.d(t,"RectAreaLightHelper",function(){return Eu}),r.d(t,"HemisphereLightHelper",function(){return Su}),r.d(t,"GridHelper",function(){return Tu}),r.d(t,"PolarGridHelper",function(){return Au}),r.d(t,"FaceNormalsHelper",function(){return Lu}),r.d(t,"DirectionalLightHelper",function(){return Pu}),r.d(t,"CameraHelper",function(){return Cu}),r.d(t,"BoxHelper",function(){return Ru}),r.d(t,"Box3Helper",function(){return Ou}),r.d(t,"PlaneHelper",function(){return Du}),r.d(t,"ArrowHelper",function(){return Iu}),r.d(t,"AxesHelper",function(){return Nu}),r.d(t,"Shape",function(){return Ws}),r.d(t,"Path",function(){return Hs}),r.d(t,"ShapePath",function(){return gl}),r.d(t,"Font",function(){return yl}),r.d(t,"CurvePath",function(){return Vs}),r.d(t,"Curve",function(){return Ms}),r.d(t,"ImageUtils",function(){return lr}),r.d(t,"ShapeUtils",function(){return po}),r.d(t,"WebGLUtils",function(){return Hi}),r.d(t,"WireframeGeometry",function(){return Aa}),r.d(t,"ParametricGeometry",function(){return La}),r.d(t,"ParametricBufferGeometry",function(){return Pa}),r.d(t,"TetrahedronGeometry",function(){return Oa}),r.d(t,"TetrahedronBufferGeometry",function(){return Da}),r.d(t,"OctahedronGeometry",function(){return Ia}),r.d(t,"OctahedronBufferGeometry",function(){return Na}),r.d(t,"IcosahedronGeometry",function(){return Fa}),r.d(t,"IcosahedronBufferGeometry",function(){return Ua}),r.d(t,"DodecahedronGeometry",function(){return ka}),r.d(t,"DodecahedronBufferGeometry",function(){return Ba}),r.d(t,"PolyhedronGeometry",function(){return Ca}),r.d(t,"PolyhedronBufferGeometry",function(){return Ra}),r.d(t,"TubeGeometry",function(){return za}),r.d(t,"TubeBufferGeometry",function(){return Ga}),r.d(t,"TorusKnotGeometry",function(){return ja}),r.d(t,"TorusKnotBufferGeometry",function(){return Va}),r.d(t,"TorusGeometry",function(){return Ha}),r.d(t,"TorusBufferGeometry",function(){return Wa}),r.d(t,"TextGeometry",function(){return wo}),r.d(t,"TextBufferGeometry",function(){return _o}),r.d(t,"SphereGeometry",function(){return Mo}),r.d(t,"SphereBufferGeometry",function(){return Eo}),r.d(t,"RingGeometry",function(){return So}),r.d(t,"RingBufferGeometry",function(){return To}),r.d(t,"PlaneGeometry",function(){return un}),r.d(t,"PlaneBufferGeometry",function(){return hn}),r.d(t,"LatheGeometry",function(){return Ao}),r.d(t,"LatheBufferGeometry",function(){return Lo}),r.d(t,"ShapeGeometry",function(){return Po}),r.d(t,"ShapeBufferGeometry",function(){return Co}),r.d(t,"ExtrudeGeometry",function(){return go}),r.d(t,"ExtrudeBufferGeometry",function(){return yo}),r.d(t,"EdgesGeometry",function(){return Oo}),r.d(t,"ConeGeometry",function(){return No}),r.d(t,"ConeBufferGeometry",function(){return Fo}),r.d(t,"CylinderGeometry",function(){return Do}),r.d(t,"CylinderBufferGeometry",function(){return Io}),r.d(t,"CircleGeometry",function(){return Uo}),r.d(t,"CircleBufferGeometry",function(){return ko}),r.d(t,"BoxGeometry",function(){return sn}),r.d(t,"BoxBufferGeometry",function(){return ln}),r.d(t,"ShadowMaterial",function(){return zo}),r.d(t,"SpriteMaterial",function(){return ca}),r.d(t,"RawShaderMaterial",function(){return Go}),r.d(t,"ShaderMaterial",function(){return Sn}),r.d(t,"PointsMaterial",function(){return wa}),r.d(t,"MeshPhysicalMaterial",function(){return Vo}),r.d(t,"MeshStandardMaterial",function(){return jo}),r.d(t,"MeshPhongMaterial",function(){return Ho}),r.d(t,"MeshToonMaterial",function(){return Wo}),r.d(t,"MeshNormalMaterial",function(){return qo}),r.d(t,"MeshLambertMaterial",function(){return Xo}),r.d(t,"MeshDepthMaterial",function(){return zi}),r.d(t,"MeshDistanceMaterial",function(){return Gi}),r.d(t,"MeshBasicMaterial",function(){return Ln}),r.d(t,"MeshMatcapMaterial",function(){return Yo}),r.d(t,"LineDashedMaterial",function(){return Zo}),r.d(t,"LineBasicMaterial",function(){return ga}),r.d(t,"Material",function(){return En}),r.d(t,"Float64BufferAttribute",function(){return tn}),r.d(t,"Float32BufferAttribute",function(){return en}),r.d(t,"Uint32BufferAttribute",function(){return $r}),r.d(t,"Int32BufferAttribute",function(){return Qr}),r.d(t,"Uint16BufferAttribute",function(){return Kr}),r.d(t,"Int16BufferAttribute",function(){return Jr}),r.d(t,"Uint8ClampedBufferAttribute",function(){return Zr}),r.d(t,"Uint8BufferAttribute",function(){return Yr}),r.d(t,"Int8BufferAttribute",function(){return Xr}),r.d(t,"BufferAttribute",function(){return qr}),r.d(t,"ArcCurve",function(){return Ss}),r.d(t,"CatmullRomCurve3",function(){return Rs}),r.d(t,"CubicBezierCurve",function(){return Ns}),r.d(t,"CubicBezierCurve3",function(){return Fs}),r.d(t,"EllipseCurve",function(){return Es}),r.d(t,"LineCurve",function(){return Us}),r.d(t,"LineCurve3",function(){return ks}),r.d(t,"QuadraticBezierCurve",function(){return Bs}),r.d(t,"QuadraticBezierCurve3",function(){return zs}),r.d(t,"SplineCurve",function(){return Gs}),r.d(t,"REVISION",function(){return v}),r.d(t,"MOUSE",function(){return g}),r.d(t,"CullFaceNone",function(){return y}),r.d(t,"CullFaceBack",function(){return x}),r.d(t,"CullFaceFront",function(){return b}),r.d(t,"CullFaceFrontBack",function(){return w}),r.d(t,"FrontFaceDirectionCW",function(){return _}),r.d(t,"FrontFaceDirectionCCW",function(){return M}),r.d(t,"BasicShadowMap",function(){return E}),r.d(t,"PCFShadowMap",function(){return S}),r.d(t,"PCFSoftShadowMap",function(){return T}),r.d(t,"FrontSide",function(){return A}),r.d(t,"BackSide",function(){return L}),r.d(t,"DoubleSide",function(){return P}),r.d(t,"FlatShading",function(){return C}),r.d(t,"SmoothShading",function(){return R}),r.d(t,"NoColors",function(){return O}),r.d(t,"FaceColors",function(){return D}),r.d(t,"VertexColors",function(){return I}),r.d(t,"NoBlending",function(){return N}),r.d(t,"NormalBlending",function(){return F}),r.d(t,"AdditiveBlending",function(){return U}),r.d(t,"SubtractiveBlending",function(){return k}),r.d(t,"MultiplyBlending",function(){return B}),r.d(t,"CustomBlending",function(){return z}),r.d(t,"AddEquation",function(){return G}),r.d(t,"SubtractEquation",function(){return j}),r.d(t,"ReverseSubtractEquation",function(){return V}),r.d(t,"MinEquation",function(){return H}),r.d(t,"MaxEquation",function(){return W}),r.d(t,"ZeroFactor",function(){return q}),r.d(t,"OneFactor",function(){return X}),r.d(t,"SrcColorFactor",function(){return Y}),r.d(t,"OneMinusSrcColorFactor",function(){return Z}),r.d(t,"SrcAlphaFactor",function(){return J}),r.d(t,"OneMinusSrcAlphaFactor",function(){return K}),r.d(t,"DstAlphaFactor",function(){return Q}),r.d(t,"OneMinusDstAlphaFactor",function(){return $}),r.d(t,"DstColorFactor",function(){return ee}),r.d(t,"OneMinusDstColorFactor",function(){return te}),r.d(t,"SrcAlphaSaturateFactor",function(){return re}),r.d(t,"NeverDepth",function(){return ne}),r.d(t,"AlwaysDepth",function(){return ie}),r.d(t,"LessDepth",function(){return ae}),r.d(t,"LessEqualDepth",function(){return oe}),r.d(t,"EqualDepth",function(){return se}),r.d(t,"GreaterEqualDepth",function(){return le}),r.d(t,"GreaterDepth",function(){return ue}),r.d(t,"NotEqualDepth",function(){return he}),r.d(t,"MultiplyOperation",function(){return ce}),r.d(t,"MixOperation",function(){return de}),r.d(t,"AddOperation",function(){return fe}),r.d(t,"NoToneMapping",function(){return pe}),r.d(t,"LinearToneMapping",function(){return me}),r.d(t,"ReinhardToneMapping",function(){return ve}),r.d(t,"Uncharted2ToneMapping",function(){return ge}),r.d(t,"CineonToneMapping",function(){return ye}),r.d(t,"ACESFilmicToneMapping",function(){return xe}),r.d(t,"UVMapping",function(){return be}),r.d(t,"CubeReflectionMapping",function(){return we}),r.d(t,"CubeRefractionMapping",function(){return _e}),r.d(t,"EquirectangularReflectionMapping",function(){return Me}),r.d(t,"EquirectangularRefractionMapping",function(){return Ee}),r.d(t,"SphericalReflectionMapping",function(){return Se}),r.d(t,"CubeUVReflectionMapping",function(){return Te}),r.d(t,"CubeUVRefractionMapping",function(){return Ae}),r.d(t,"RepeatWrapping",function(){return Le}),r.d(t,"ClampToEdgeWrapping",function(){return Pe}),r.d(t,"MirroredRepeatWrapping",function(){return Ce}),r.d(t,"NearestFilter",function(){return Re}),r.d(t,"NearestMipMapNearestFilter",function(){return Oe}),r.d(t,"NearestMipMapLinearFilter",function(){return De}),r.d(t,"LinearFilter",function(){return Ie}),r.d(t,"LinearMipMapNearestFilter",function(){return Ne}),r.d(t,"LinearMipMapLinearFilter",function(){return Fe}),r.d(t,"UnsignedByteType",function(){return Ue}),r.d(t,"ByteType",function(){return ke}),r.d(t,"ShortType",function(){return Be}),r.d(t,"UnsignedShortType",function(){return ze}),r.d(t,"IntType",function(){return Ge}),r.d(t,"UnsignedIntType",function(){return je}),r.d(t,"FloatType",function(){return Ve}),r.d(t,"HalfFloatType",function(){return He}),r.d(t,"UnsignedShort4444Type",function(){return We}),r.d(t,"UnsignedShort5551Type",function(){return qe}),r.d(t,"UnsignedShort565Type",function(){return Xe}),r.d(t,"UnsignedInt248Type",function(){return Ye}),r.d(t,"AlphaFormat",function(){return Ze}),r.d(t,"RGBFormat",function(){return Je}),r.d(t,"RGBAFormat",function(){return Ke}),r.d(t,"LuminanceFormat",function(){return Qe}),r.d(t,"LuminanceAlphaFormat",function(){return $e}),r.d(t,"RGBEFormat",function(){return et}),r.d(t,"DepthFormat",function(){return tt}),r.d(t,"DepthStencilFormat",function(){return rt}),r.d(t,"RedFormat",function(){return nt}),r.d(t,"RGB_S3TC_DXT1_Format",function(){return it}),r.d(t,"RGBA_S3TC_DXT1_Format",function(){return at}),r.d(t,"RGBA_S3TC_DXT3_Format",function(){return ot}),r.d(t,"RGBA_S3TC_DXT5_Format",function(){return st}),r.d(t,"RGB_PVRTC_4BPPV1_Format",function(){return lt}),r.d(t,"RGB_PVRTC_2BPPV1_Format",function(){return ut}),r.d(t,"RGBA_PVRTC_4BPPV1_Format",function(){return ht}),r.d(t,"RGBA_PVRTC_2BPPV1_Format",function(){return ct}),r.d(t,"RGB_ETC1_Format",function(){return dt}),r.d(t,"RGBA_ASTC_4x4_Format",function(){return ft}),r.d(t,"RGBA_ASTC_5x4_Format",function(){return pt}),r.d(t,"RGBA_ASTC_5x5_Format",function(){return mt}),r.d(t,"RGBA_ASTC_6x5_Format",function(){return vt}),r.d(t,"RGBA_ASTC_6x6_Format",function(){return gt}),r.d(t,"RGBA_ASTC_8x5_Format",function(){return yt}),r.d(t,"RGBA_ASTC_8x6_Format",function(){return xt}),r.d(t,"RGBA_ASTC_8x8_Format",function(){return bt}),r.d(t,"RGBA_ASTC_10x5_Format",function(){return wt}),r.d(t,"RGBA_ASTC_10x6_Format",function(){return _t}),r.d(t,"RGBA_ASTC_10x8_Format",function(){return Mt}),r.d(t,"RGBA_ASTC_10x10_Format",function(){return Et}),r.d(t,"RGBA_ASTC_12x10_Format",function(){return St}),r.d(t,"RGBA_ASTC_12x12_Format",function(){return Tt}),r.d(t,"LoopOnce",function(){return At}),r.d(t,"LoopRepeat",function(){return Lt}),r.d(t,"LoopPingPong",function(){return Pt}),r.d(t,"InterpolateDiscrete",function(){return Ct}),r.d(t,"InterpolateLinear",function(){return Rt}),r.d(t,"InterpolateSmooth",function(){return Ot}),r.d(t,"ZeroCurvatureEnding",function(){return Dt}),r.d(t,"ZeroSlopeEnding",function(){return It}),r.d(t,"WrapAroundEnding",function(){return Nt}),r.d(t,"TrianglesDrawMode",function(){return Ft}),r.d(t,"TriangleStripDrawMode",function(){return Ut}),r.d(t,"TriangleFanDrawMode",function(){return kt}),r.d(t,"LinearEncoding",function(){return Bt}),r.d(t,"sRGBEncoding",function(){return zt}),r.d(t,"GammaEncoding",function(){return Gt}),r.d(t,"RGBEEncoding",function(){return jt}),r.d(t,"LogLuvEncoding",function(){return Vt}),r.d(t,"RGBM7Encoding",function(){return Ht}),r.d(t,"RGBM16Encoding",function(){return Wt}),r.d(t,"RGBDEncoding",function(){return qt}),r.d(t,"BasicDepthPacking",function(){return Xt}),r.d(t,"RGBADepthPacking",function(){return Yt}),r.d(t,"TangentSpaceNormalMap",function(){return Zt}),r.d(t,"ObjectSpaceNormalMap",function(){return Jt}),r.d(t,"CubeGeometry",function(){return sn}),r.d(t,"Face4",function(){return Fu}),r.d(t,"LineStrip",function(){return Uu}),r.d(t,"LinePieces",function(){return ku}),r.d(t,"MeshFaceMaterial",function(){return Bu}),r.d(t,"MultiMaterial",function(){return zu}),r.d(t,"PointCloud",function(){return Gu}),r.d(t,"Particle",function(){return ju}),r.d(t,"ParticleSystem",function(){return Vu}),r.d(t,"PointCloudMaterial",function(){return Hu}),r.d(t,"ParticleBasicMaterial",function(){return Wu}),r.d(t,"ParticleSystemMaterial",function(){return qu}),r.d(t,"Vertex",function(){return Xu}),r.d(t,"DynamicBufferAttribute",function(){return Yu}),r.d(t,"Int8Attribute",function(){return Zu}),r.d(t,"Uint8Attribute",function(){return Ju}),r.d(t,"Uint8ClampedAttribute",function(){return Ku}),r.d(t,"Int16Attribute",function(){return Qu}),r.d(t,"Uint16Attribute",function(){return $u}),r.d(t,"Int32Attribute",function(){return eh}),r.d(t,"Uint32Attribute",function(){return th}),r.d(t,"Float32Attribute",function(){return rh}),r.d(t,"Float64Attribute",function(){return nh}),r.d(t,"ClosedSplineCurve3",function(){return ih}),r.d(t,"SplineCurve3",function(){return ah}),r.d(t,"Spline",function(){return oh}),r.d(t,"AxisHelper",function(){return sh}),r.d(t,"BoundingBoxHelper",function(){return lh}),r.d(t,"EdgesHelper",function(){return uh}),r.d(t,"WireframeHelper",function(){return hh}),r.d(t,"XHRLoader",function(){return ch}),r.d(t,"BinaryTextureLoader",function(){return dh}),r.d(t,"GeometryUtils",function(){return fh}),r.d(t,"Projector",function(){return ph}),r.d(t,"CanvasRenderer",function(){return mh}),r.d(t,"JSONLoader",function(){return vh}),r.d(t,"SceneUtils",function(){return gh}),r.d(t,"LensFlare",function(){return yh}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(n.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}});var i,a,o,s,l,u,h,c,d,f,p,m,v="99",g={LEFT:0,MIDDLE:1,RIGHT:2},y=0,x=1,b=2,w=3,_=0,M=1,E=0,S=1,T=2,A=0,L=1,P=2,C=1,R=2,O=0,D=1,I=2,N=0,F=1,U=2,k=3,B=4,z=5,G=100,j=101,V=102,H=103,W=104,q=200,X=201,Y=202,Z=203,J=204,K=205,Q=206,$=207,ee=208,te=209,re=210,ne=0,ie=1,ae=2,oe=3,se=4,le=5,ue=6,he=7,ce=0,de=1,fe=2,pe=0,me=1,ve=2,ge=3,ye=4,xe=5,be=300,we=301,_e=302,Me=303,Ee=304,Se=305,Te=306,Ae=307,Le=1e3,Pe=1001,Ce=1002,Re=1003,Oe=1004,De=1005,Ie=1006,Ne=1007,Fe=1008,Ue=1009,ke=1010,Be=1011,ze=1012,Ge=1013,je=1014,Ve=1015,He=1016,We=1017,qe=1018,Xe=1019,Ye=1020,Ze=1021,Je=1022,Ke=1023,Qe=1024,$e=1025,et=Ke,tt=1026,rt=1027,nt=1028,it=33776,at=33777,ot=33778,st=33779,lt=35840,ut=35841,ht=35842,ct=35843,dt=36196,ft=37808,pt=37809,mt=37810,vt=37811,gt=37812,yt=37813,xt=37814,bt=37815,wt=37816,_t=37817,Mt=37818,Et=37819,St=37820,Tt=37821,At=2200,Lt=2201,Pt=2202,Ct=2300,Rt=2301,Ot=2302,Dt=2400,It=2401,Nt=2402,Ft=0,Ut=1,kt=2,Bt=3e3,zt=3001,Gt=3007,jt=3002,Vt=3003,Ht=3004,Wt=3005,qt=3006,Xt=3200,Yt=3201,Zt=0,Jt=1,Kt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]).toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Kt.DEG2RAD},radToDeg:function(e){return e*Kt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Qt(e,t){this.x=e||0,this.y=t||0}function $t(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function er(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function tr(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function rr(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Qt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Qt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(i=new Qt,a=new Qt,function(e,t){return i.set(e,e),a.set(t,t),this.clamp(i,a)}),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}}),Object.assign($t.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,a,o,s,l,u,h,c,d,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=h,v[14]=c,v[3]=d,v[7]=f,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new $t).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:(f=new tr,function(e){var t=this.elements,r=e.elements,n=1/f.setFromMatrixColumn(e,0).length(),i=1/f.setFromMatrixColumn(e,1).length(),a=1/f.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),u=Math.cos(i),h=Math.sin(i);if("XYZ"===e.order){var c=a*u,d=a*h,f=o*u,p=o*h;t[0]=s*u,t[4]=-s*h,t[8]=l,t[1]=d+f*l,t[5]=c-p*l,t[9]=-o*s,t[2]=p-c*l,t[6]=f+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,v=s*h,g=l*u,y=l*h;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*h,t[5]=a*u,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order)m=s*u,v=s*h,g=l*u,y=l*h,t[0]=m-y*o,t[4]=-a*h,t[8]=g+v*o,t[1]=v+g*o,t[5]=a*u,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s;else if("ZYX"===e.order)c=a*u,d=a*h,f=o*u,p=o*h,t[0]=s*u,t[4]=f*l-d,t[8]=c*l+p,t[1]=s*h,t[5]=p*l+c,t[9]=d*l-f,t[2]=-l,t[6]=o*s,t[10]=a*s;else if("YZX"===e.order){var x=a*s,b=a*l,w=o*s,_=o*l;t[0]=s*u,t[4]=_-x*h,t[8]=w*h+b,t[1]=h,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=b*h+w,t[10]=x-_*h}else"XZY"===e.order&&(x=a*s,b=a*l,w=o*s,_=o*l,t[0]=s*u,t[4]=-h,t[8]=l*u,t[1]=x*h+_,t[5]=a*u,t[9]=b*h-w,t[2]=w*h-b,t[6]=o*u,t[10]=_*h+x);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(c=new tr(0,0,0),d=new tr(1,1,1),function(e){return this.compose(c,e,d)}),lookAt:(l=new tr,u=new tr,h=new tr,function(e,t,r){var n=this.elements;return h.subVectors(e,t),0===h.lengthSq()&&(h.z=1),h.normalize(),l.crossVectors(r,h),0===l.lengthSq()&&(1===Math.abs(r.z)?h.x+=1e-4:h.z+=1e-4,h.normalize(),l.crossVectors(r,h)),l.normalize(),u.crossVectors(h,l),n[0]=l.x,n[4]=u.x,n[8]=h.x,n[1]=l.y,n[5]=u.y,n[9]=h.y,n[2]=l.z,n[6]=u.z,n[10]=h.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],h=r[5],c=r[9],d=r[13],f=r[2],p=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],M=n[8],E=n[12],S=n[1],T=n[5],A=n[9],L=n[13],P=n[2],C=n[6],R=n[10],O=n[14],D=n[3],I=n[7],N=n[11],F=n[15];return i[0]=a*w+o*S+s*P+l*D,i[4]=a*_+o*T+s*C+l*I,i[8]=a*M+o*A+s*R+l*N,i[12]=a*E+o*L+s*O+l*F,i[1]=u*w+h*S+c*P+d*D,i[5]=u*_+h*T+c*C+d*I,i[9]=u*M+h*A+c*R+d*N,i[13]=u*E+h*L+c*O+d*F,i[2]=f*w+p*S+m*P+v*D,i[6]=f*_+p*T+m*C+v*I,i[10]=f*M+p*A+m*R+v*N,i[14]=f*E+p*L+m*O+v*F,i[3]=g*w+y*S+x*P+b*D,i[7]=g*_+y*T+x*C+b*I,i[11]=g*M+y*A+x*R+b*N,i[15]=g*E+y*L+x*O+b*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new tr;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],h=e[6],c=e[10],d=e[14];return e[3]*(+i*s*h-n*l*h-i*o*c+r*l*c+n*o*d-r*s*d)+e[7]*(+t*s*d-t*l*c+i*a*c-n*a*d+n*l*u-i*s*u)+e[11]*(+t*l*h-t*o*d-i*a*h+r*a*d+i*o*u-r*l*u)+e[15]*(-n*o*u-t*s*h+t*o*c+n*a*h-r*a*c+r*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],h=n[6],c=n[7],d=n[8],f=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=f*y*c-g*p*c+g*h*m-u*y*m-f*h*x+u*p*x,w=v*p*c-d*y*c-v*h*m+l*y*m+d*h*x-l*p*x,_=d*g*c-v*f*c+v*u*m-l*g*m-d*u*x+l*f*x,M=v*f*h-d*g*h-v*u*p+l*g*p+d*u*y-l*f*y,E=i*b+a*w+o*_+s*M;if(0===E){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var T=1/E;return r[0]=b*T,r[1]=(g*p*s-f*y*s-g*o*m+a*y*m+f*o*x-a*p*x)*T,r[2]=(u*y*s-g*h*s+g*o*c-a*y*c-u*o*x+a*h*x)*T,r[3]=(f*h*s-u*p*s-f*o*c+a*p*c+u*o*m-a*h*m)*T,r[4]=w*T,r[5]=(d*y*s-v*p*s+v*o*m-i*y*m-d*o*x+i*p*x)*T,r[6]=(v*h*s-l*y*s-v*o*c+i*y*c+l*o*x-i*h*x)*T,r[7]=(l*p*s-d*h*s+d*o*c-i*p*c-l*o*m+i*h*m)*T,r[8]=_*T,r[9]=(v*f*s-d*g*s-v*a*m+i*g*m+d*a*x-i*f*x)*T,r[10]=(l*g*s-v*u*s+v*a*c-i*g*c-l*a*x+i*u*x)*T,r[11]=(d*u*s-l*f*s-d*a*c+i*f*c+l*a*m-i*u*m)*T,r[12]=M*T,r[13]=(d*g*o-v*f*o+v*a*p-i*g*p-d*a*y+i*f*y)*T,r[14]=(v*u*o-l*g*o-v*a*h+i*g*h+l*a*y-i*u*y)*T,r[15]=(l*f*o-d*u*o+d*a*h-i*f*h-l*a*p+i*u*p)*T,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,u*o+r,u*s-n*a,0,l*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,u=a+a,h=o+o,c=i*l,d=i*u,f=i*h,p=a*u,m=a*h,v=o*h,g=s*l,y=s*u,x=s*h,b=r.x,w=r.y,_=r.z;return n[0]=(1-(p+v))*b,n[1]=(d+x)*b,n[2]=(f-y)*b,n[3]=0,n[4]=(d-x)*w,n[5]=(1-(c+v))*w,n[6]=(m+g)*w,n[7]=0,n[8]=(f+y)*_,n[9]=(m-g)*_,n[10]=(1-(c+p))*_,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:(o=new tr,s=new $t,function(e,t,r){var n=this.elements,i=o.set(n[0],n[1],n[2]).length(),a=o.set(n[4],n[5],n[6]).length(),l=o.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],s.copy(this);var u=1/i,h=1/a,c=1/l;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=h,s.elements[5]*=h,s.elements[6]*=h,s.elements[8]*=c,s.elements[9]*=c,s.elements[10]*=c,t.setFromRotationMatrix(s),r.x=i,r.y=a,r.z=l,this}),makePerspective:function(e,t,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(r-n),u=(t+e)/(t-e),h=(r+n)/(r-n),c=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),u=1/(a-i),h=(t+e)*s,c=(r+n)*l,d=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(er,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,a,o){var s=r[n+0],l=r[n+1],u=r[n+2],h=r[n+3],c=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(h!==p||s!==c||l!==d||u!==f){var m=1-o,v=s*c+l*d+u*f+h*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,o=Math.sin(o*b)/x}var w=o*g;if(s=s*m+c*w,l=l*m+d*w,u=u*m+f*w,h=h*m+p*w,m===1-o){var _=1/Math.sqrt(s*s+l*l+u*u+h*h);s*=_,l*=_,u*=_,h*=_}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=h}}),Object.defineProperties(er.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(er.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(n/2),h=o(i/2),c=s(r/2),d=s(n/2),f=s(i/2);return"XYZ"===a?(this._x=c*u*h+l*d*f,this._y=l*d*h-c*u*f,this._z=l*u*f+c*d*h,this._w=l*u*h-c*d*f):"YXZ"===a?(this._x=c*u*h+l*d*f,this._y=l*d*h-c*u*f,this._z=l*u*f-c*d*h,this._w=l*u*h+c*d*f):"ZXY"===a?(this._x=c*u*h-l*d*f,this._y=l*d*h+c*u*f,this._z=l*u*f+c*d*h,this._w=l*u*h-c*d*f):"ZYX"===a?(this._x=c*u*h-l*d*f,this._y=l*d*h+c*u*f,this._z=l*u*f-c*d*h,this._w=l*u*h+c*d*f):"YZX"===a?(this._x=c*u*h+l*d*f,this._y=l*d*h+c*u*f,this._z=l*u*f-c*d*h,this._w=l*u*h-c*d*f):"XZY"===a&&(this._x=c*u*h-l*d*f,this._y=l*d*h-c*u*f,this._z=l*u*f+c*d*h,this._w=l*u*h+c*d*f),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],u=r[2],h=r[6],c=r[10],d=n+s+c;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(h-l)*t,this._y=(a-u)*t,this._z=(o-i)*t):n>s&&n>c?(t=2*Math.sqrt(1+n-s-c),this._w=(h-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+u)/t):s>c?(t=2*Math.sqrt(1+s-n-c),this._w=(a-u)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+c-n-s),this._w=(o-i)/t,this._x=(a+u)/t,this._y=(l+h)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new tr;return function(r,n){return void 0===t&&(t=new tr),(e=r.dot(n)+1)<1e-6?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(Kt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=r*u+a*o+n*l-i*s,this._y=n*u+a*s+i*o-r*l,this._z=i*u+a*l+r*s-n*o,this._w=a*u-r*o-n*s-i*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*r+t*this._x,this._y=l*n+t*this._y,this._z=l*i+t*this._z,this.normalize()}var u=Math.sqrt(s),h=Math.atan2(u,o),c=Math.sin((1-t)*h)/u,d=Math.sin(t*h)/u;return this._w=a*c+this._w*d,this._x=r*c+this._x*d,this._y=n*c+this._y*d,this._z=i*c+this._z*d,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(tr.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(p=new er,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(p.setFromEuler(e))}),applyAxisAngle:function(){var e=new er;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,u=s*r+o*t-i*n,h=s*n+i*r-a*t,c=-i*t-a*r-o*n;return this.x=l*s+c*-i+u*-o-h*-a,this.y=u*s+c*-a+h*-i-l*-o,this.z=h*s+c*-o+l*-a-u*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new $t;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new tr,t=new tr;return function(r,n){return e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new tr;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new tr;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Kt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(rr.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=n,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new tr;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],h=r[7],c=r[2],d=r[5],f=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=a*p+o*g+s*b,i[3]=a*m+o*y+s*w,i[6]=a*v+o*x+s*_,i[1]=l*p+u*g+h*b,i[4]=l*m+u*y+h*w,i[7]=l*v+u*x+h*_,i[2]=c*p+d*g+f*b,i[5]=c*m+d*y+f*w,i[8]=c*v+d*x+f*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-r*i*u+r*o*s+n*i*l-n*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],u=r[5],h=r[6],c=r[7],d=r[8],f=d*l-u*c,p=u*h-d*s,m=c*s-l*h,v=i*f+a*p+o*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=f*y,n[1]=(o*c-d*a)*y,n[2]=(u*a-o*l)*y,n[3]=p*y,n[4]=(d*i-o*h)*y,n[5]=(o*s-u*i)*y,n[6]=m*y,n[7]=(a*h-c*i)*y,n[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*a+l*o)+a+e,-n*l,n*s,-n*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],u=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*u,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*u,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var nr,ir,ar,or,sr,lr={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===m&&(m=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),m.width=e.width,m.height=e.height;var r=m.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=m}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},ur=0;function hr(e,t,r,n,i,a,o,s,l,u){Object.defineProperty(this,"id",{value:ur++}),this.uuid=Kt.generateUUID(),this.name="",this.image=void 0!==e?e:hr.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:hr.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:Pe,this.wrapT=void 0!==n?n:Pe,this.magFilter=void 0!==i?i:Ie,this.minFilter=void 0!==a?a:Fe,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Ke,this.type=void 0!==s?s:Ue,this.offset=new Qt(0,0),this.repeat=new Qt(1,1),this.center=new Qt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:Bt,this.version=0,this.onUpdate=null}function cr(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function dr(e,t,r){this.width=e,this.height=t,this.scissor=new cr(0,0,e,t),this.scissorTest=!1,this.viewport=new cr(0,0,e,t),r=r||{},this.texture=new hr(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:Ie,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function fr(e,t,r){dr.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function pr(e,t,r,n,i,a,o,s,l,u,h,c){hr.call(this,null,a,o,s,l,u,n,i,h,c),this.image={data:e,width:t,height:r},this.magFilter=void 0!==l?l:Re,this.minFilter=void 0!==u?u:Re,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function mr(e,t){this.min=void 0!==e?e:new tr(1/0,1/0,1/0),this.max=void 0!==t?t:new tr(-1/0,-1/0,-1/0)}function vr(e,t){this.center=void 0!==e?e:new tr,this.radius=void 0!==t?t:0}function gr(e,t){this.normal=void 0!==e?e:new tr(1,0,0),this.constant=void 0!==t?t:0}function yr(e,t,r,n,i,a){this.planes=[void 0!==e?e:new gr,void 0!==t?t:new gr,void 0!==r?r:new gr,void 0!==n?n:new gr,void 0!==i?i:new gr,void 0!==a?a:new gr]}hr.DEFAULT_IMAGE=void 0,hr.DEFAULT_MAPPING=be,hr.prototype=Object.assign(Object.create(n.prototype),{constructor:hr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=Kt.generateUUID()),!t&&void 0===e.images[n.uuid]){var i;if(Array.isArray(n)){i=[];for(var a=0,o=n.length;a<o;a++)i.push(lr.getDataURL(n[a]))}else i=lr.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==be)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Le:e.x=e.x-Math.floor(e.x);break;case Pe:e.x=e.x<0?0:1;break;case Ce:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Le:e.y=e.y-Math.floor(e.y);break;case Pe:e.y=e.y<0?0:1;break;case Ce:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(hr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(cr.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=e.elements,o=a[0],s=a[4],l=a[8],u=a[1],h=a[5],c=a[9],d=a[2],f=a[6],p=a[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(c-f)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(c+f)<.1&&Math.abs(o+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,v=(h+1)/2,g=(p+1)/2,y=(s+u)/4,x=(l+d)/4,b=(c+f)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,t),this}var w=Math.sqrt((f-c)*(f-c)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(w)<.001&&(w=1),this.x=(f-c)/w,this.y=(l-d)/w,this.z=(u-s)/w,this.w=Math.acos((o+h+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new cr,t=new cr),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),dr.prototype=Object.assign(Object.create(n.prototype),{constructor:dr,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),fr.prototype=Object.create(dr.prototype),fr.prototype.constructor=fr,fr.prototype.isWebGLRenderTargetCube=!0,pr.prototype=Object.create(hr.prototype),pr.prototype.constructor=pr,pr.prototype.isDataTexture=!0,Object.assign(mr.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],h=e[s+1],c=e[s+2];u<t&&(t=u),h<r&&(r=h),c<n&&(n=c),u>i&&(i=u),h>a&&(a=h),c>o&&(o=c)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),h=e.getY(s),c=e.getZ(s);u<t&&(t=u),h<r&&(r=h),c<n&&(n=c),u>i&&(i=u),h>a&&(a=h),c>o&&(o=c)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new tr;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new tr),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new tr),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,n=new tr;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.expandByPoint(n)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t).applyMatrix4(i.matrixWorld),e.expandByPoint(n)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(i),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new tr),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(ir=new tr,function(e){return this.clampPoint(e.center,ir),ir.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){var e=new tr,t=new tr,r=new tr,n=new tr,i=new tr,a=new tr,o=new tr,s=new tr,l=new tr,u=new tr;function h(n){var i,a;for(i=0,a=n.length-3;i<=a;i+=3){o.fromArray(n,i);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),u=e.dot(o),h=t.dot(o),c=r.dot(o);if(Math.max(-Math.max(u,h,c),Math.min(u,h,c))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(o.a,s),t.subVectors(o.b,s),r.subVectors(o.c,s),n.subVectors(t,e),i.subVectors(r,t),a.subVectors(e,r);var c=[0,-n.z,n.y,0,-i.z,i.y,0,-a.z,a.y,n.z,0,-n.x,i.z,0,-i.x,a.z,0,-a.x,-n.y,n.x,0,-i.y,i.x,0,-a.y,a.x,0];return!!h(c)&&!!h(c=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(n,i),h(c=[u.x,u.y,u.z]))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new tr),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new tr;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new tr;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new vr),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(nr=[new tr,new tr,new tr,new tr,new tr,new tr,new tr,new tr],function(e){return this.isEmpty()?this:(nr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),nr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),nr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),nr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),nr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),nr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),nr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),nr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(nr),this)}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(vr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(ar=new mr,function(e,t){var r=this.center;void 0!==t?r.copy(t):ar.setFromPoints(e).getCenter(r);for(var n=0,i=0,a=e.length;i<a;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new tr),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new mr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(gr.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new tr,t=new tr;return function(r,n,i){var a=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new tr),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new tr;return function(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new tr);var n=t.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/i;return a<0||a>1?void 0:r.copy(n).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new tr),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new tr,t=new rr;return function(r,n){var i=n||t.getNormalMatrix(r),a=this.coplanarPoint(e).applyMatrix4(r),o=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(yr.prototype,{set:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],h=r[7],c=r[8],d=r[9],f=r[10],p=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,h-s,p-c,y-m).normalize(),t[1].setComponents(o+n,h+s,p+c,y+m).normalize(),t[2].setComponents(o+i,h+l,p+d,y+v).normalize(),t[3].setComponents(o-i,h-l,p-d,y-v).normalize(),t[4].setComponents(o-a,h-u,p-f,y-g).normalize(),t[5].setComponents(o+a,h+u,p+f,y+g).normalize(),this},intersectsObject:(sr=new vr,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),sr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(sr)}),intersectsSprite:function(){var e=new vr;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:(or=new tr,function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(or.x=n.normal.x>0?e.max.x:e.min.x,or.y=n.normal.y>0?e.max.y:e.min.y,or.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(or)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var xr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function br(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function wr(e){for(var t={},r=0;r<e.length;r++){var n=br(e[r]);for(var i in n)t[i]=n[i]}return t}var _r,Mr,Er,Sr={clone:br,merge:wr},Tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ar(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}Object.assign(Ar.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(t,r,n){if(t=Kt.euclideanModulo(t,1),r=Kt.clamp(r,0,1),n=Kt.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,a=2*n-i;this.r=e(a,i,t+1/3),this.g=e(a,i,t),this.b=e(a,i,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u,h=(u=r[1]).length;if(3===h)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0&&(void 0!==(u=Tr[e])?this.setHex(u):console.warn("THREE.Color: Unknown color "+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=(s+o)/2;if(s===o)t=0,r=0;else{var u=o-s;switch(r=l<=.5?u/(o+s):u/(2-o-s),o){case n:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-n)/u+2;break;case a:t=(n-i)/u+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(Er={},function(e,t,r){return this.getHSL(Er),Er.h+=e,Er.s+=t,Er.l+=r,this.setHSL(Er.h,Er.s,Er.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(_r={h:0,s:0,l:0},Mr={h:0,s:0,l:0},function(e,t){this.getHSL(_r),e.getHSL(Mr);var r=Kt.lerp(_r.h,Mr.h,t),n=Kt.lerp(_r.s,Mr.s,t),i=Kt.lerp(_r.l,Mr.l,t);return this.setHSL(r,n,i),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var Lr,Pr={common:{diffuse:{value:new Ar(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new rr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Qt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ar(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ar(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new rr}},sprite:{diffuse:{value:new Ar(15658734)},opacity:{value:1},center:{value:new Qt(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new rr}}},Cr={basic:{uniforms:wr([Pr.common,Pr.specularmap,Pr.envmap,Pr.aomap,Pr.lightmap,Pr.fog]),vertexShader:xr.meshbasic_vert,fragmentShader:xr.meshbasic_frag},lambert:{uniforms:wr([Pr.common,Pr.specularmap,Pr.envmap,Pr.aomap,Pr.lightmap,Pr.emissivemap,Pr.fog,Pr.lights,{emissive:{value:new Ar(0)}}]),vertexShader:xr.meshlambert_vert,fragmentShader:xr.meshlambert_frag},phong:{uniforms:wr([Pr.common,Pr.specularmap,Pr.envmap,Pr.aomap,Pr.lightmap,Pr.emissivemap,Pr.bumpmap,Pr.normalmap,Pr.displacementmap,Pr.gradientmap,Pr.fog,Pr.lights,{emissive:{value:new Ar(0)},specular:{value:new Ar(1118481)},shininess:{value:30}}]),vertexShader:xr.meshphong_vert,fragmentShader:xr.meshphong_frag},standard:{uniforms:wr([Pr.common,Pr.envmap,Pr.aomap,Pr.lightmap,Pr.emissivemap,Pr.bumpmap,Pr.normalmap,Pr.displacementmap,Pr.roughnessmap,Pr.metalnessmap,Pr.fog,Pr.lights,{emissive:{value:new Ar(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:xr.meshphysical_vert,fragmentShader:xr.meshphysical_frag},matcap:{uniforms:wr([Pr.common,Pr.bumpmap,Pr.normalmap,Pr.displacementmap,Pr.fog,{matcap:{value:null}}]),vertexShader:xr.meshmatcap_vert,fragmentShader:xr.meshmatcap_frag},points:{uniforms:wr([Pr.points,Pr.fog]),vertexShader:xr.points_vert,fragmentShader:xr.points_frag},dashed:{uniforms:wr([Pr.common,Pr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xr.linedashed_vert,fragmentShader:xr.linedashed_frag},depth:{uniforms:wr([Pr.common,Pr.displacementmap]),vertexShader:xr.depth_vert,fragmentShader:xr.depth_frag},normal:{uniforms:wr([Pr.common,Pr.bumpmap,Pr.normalmap,Pr.displacementmap,{opacity:{value:1}}]),vertexShader:xr.normal_vert,fragmentShader:xr.normal_frag},sprite:{uniforms:wr([Pr.sprite,Pr.fog]),vertexShader:xr.sprite_vert,fragmentShader:xr.sprite_frag},background:{uniforms:{uvTransform:{value:new rr},t2D:{value:null}},vertexShader:xr.background_vert,fragmentShader:xr.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xr.cube_vert,fragmentShader:xr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xr.equirect_vert,fragmentShader:xr.equirect_frag},distanceRGBA:{uniforms:wr([Pr.common,Pr.displacementmap,{referencePosition:{value:new tr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xr.distanceRGBA_vert,fragmentShader:xr.distanceRGBA_frag},shadow:{uniforms:wr([Pr.lights,Pr.fog,{color:{value:new Ar(0)},opacity:{value:1}}]),vertexShader:xr.shadow_vert,fragmentShader:xr.shadow_frag}};function Rr(){var e=null,t=!1,r=null;function n(i,a){!1!==t&&(r(i,a),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function Or(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);n&&(e.deleteBuffer(n.buffer),t.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);void 0===i?t.set(r,function(t,r){var n=t.array,i=t.dynamic?35048:35044,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,n,i),t.onUploadCallback();var o=5126;return n instanceof Float32Array?o=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?o=5123:n instanceof Int16Array?o=5122:n instanceof Uint32Array?o=5125:n instanceof Int32Array?o=5124:n instanceof Int8Array?o=5120:n instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(r,n)):i.version<r.version&&(function(t,r,n){var i=r.array,a=r.updateRange;e.bindBuffer(n,t),!1===r.dynamic?e.bufferData(n,i,35044):-1===a.count?e.bufferSubData(n,0,i):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,a.offset*i.BYTES_PER_ELEMENT,i.subarray(a.offset,a.offset+a.count)),a.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function Dr(e,t,r,n,i,a){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new tr,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Ar,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}function Ir(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Ir.DefaultOrder}function Nr(){this.mask=1}Cr.physical={uniforms:wr([Cr.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:xr.meshphysical_vert,fragmentShader:xr.meshphysical_frag},Object.assign(Dr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Ir.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ir.DefaultOrder="XYZ",Object.defineProperties(Ir.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Ir.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=Kt.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],u=i[5],h=i[9],c=i[2],d=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-c,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new $t;return function(t,r,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(Lr=new er,function(e){return Lr.setFromEuler(this),this.setFromQuaternion(Lr,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new tr(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Nr.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var Fr,Ur,kr,Br,zr=0;function Gr(){Object.defineProperty(this,"id",{value:zr++}),this.uuid=Kt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gr.DefaultUp.clone();var e=new tr,t=new Ir,r=new er,n=new tr(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new $t},normalMatrix:{value:new rr}}),this.matrix=new $t,this.matrixWorld=new $t,this.matrixAutoUpdate=Gr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Nr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Gr.DefaultUp=new tr(0,1,0),Gr.DefaultMatrixAutoUpdate=!0,Gr.prototype=Object.assign(Object.create(n.prototype),{constructor:Gr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(Br=new er,function(e,t){return Br.setFromAxisAngle(e,t),this.quaternion.multiply(Br),this}),rotateOnWorldAxis:function(){var e=new er;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new tr(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new tr(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new tr(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new tr;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new tr(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new tr(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new tr(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(kr=new $t,function(e){return e.applyMatrix4(kr.getInverse(this.matrixWorld))}),lookAt:function(){var e=new er,t=new $t,r=new tr,n=new tr;return function(i,a,o){i.isVector3?r.copy(i):r.set(i,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(n,r,this.up):t.lookAt(r,n,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new tr),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Fr=new tr,Ur=new tr,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new er),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Fr,e,Ur),e}),getWorldScale:function(){var e=new tr,t=new er;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new tr),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new tr),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];i(e.shapes,u)}else i(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(s=0,l=this.material.length;s<l;s++)h.push(i(e.materials,this.material[s]));n.material=h}else n.material=i(e.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object);if(t){var c=m(e.geometries),d=m(e.materials),f=m(e.textures),p=m(e.images);o=m(e.shapes),c.length>0&&(r.geometries=c),d.length>0&&(r.materials=d),f.length>0&&(r.textures=f),p.length>0&&(r.images=p),o.length>0&&(r.shapes=o)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}});var jr,Vr,Hr=0;function Wr(){Object.defineProperty(this,"id",{value:Hr+=2}),this.uuid=Kt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function qr(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Xr(e,t,r){qr.call(this,new Int8Array(e),t,r)}function Yr(e,t,r){qr.call(this,new Uint8Array(e),t,r)}function Zr(e,t,r){qr.call(this,new Uint8ClampedArray(e),t,r)}function Jr(e,t,r){qr.call(this,new Int16Array(e),t,r)}function Kr(e,t,r){qr.call(this,new Uint16Array(e),t,r)}function Qr(e,t,r){qr.call(this,new Int32Array(e),t,r)}function $r(e,t,r){qr.call(this,new Uint32Array(e),t,r)}function en(e,t,r){qr.call(this,new Float32Array(e),t,r)}function tn(e,t,r){qr.call(this,new Float64Array(e),t,r)}function rn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function nn(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Wr.prototype=Object.assign(Object.create(n.prototype),{constructor:Wr,isGeometry:!0,applyMatrix:function(e){for(var t=(new rr).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(e);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new $t;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new $t;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new $t;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new $t;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new $t;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:(Vr=new Gr,function(e){Vr.lookAt(e),Vr.updateMatrix(),this.applyMatrix(Vr.matrix)}),fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,o=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0,h=0;u<i.length;u+=3,h+=2)t.vertices.push((new tr).fromArray(i,u)),void 0!==o&&t.colors.push((new Ar).fromArray(o,u));function c(e,r,n,i){var u=void 0===o?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],h=new Dr(e,r,n,void 0===a?[]:[(new tr).fromArray(a,3*e),(new tr).fromArray(a,3*r),(new tr).fromArray(a,3*n)],u,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Qt).fromArray(s,2*e),(new Qt).fromArray(s,2*r),(new Qt).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new Qt).fromArray(l,2*e),(new Qt).fromArray(l,2*r),(new Qt).fromArray(l,2*n)])}var d=e.groups;if(d.length>0)for(u=0;u<d.length;u++)for(var f=d[u],p=f.start,m=(h=p,p+f.count);h<m;h+=3)void 0!==r?c(r[h],r[h+1],r[h+2],f.materialIndex):c(h,h+1,h+2,f.materialIndex);else if(void 0!==r)for(u=0;u<r.length;u+=3)c(r[u],r[u+1],r[u+2]);else for(u=0;u<i.length/3;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:(jr=new tr,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(jr).negate(),this.translate(jr.x,jr.y,jr.z),this}),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new $t;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new tr,t=new tr,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)o[t]=new tr;if(e){var s,l,u,h=new tr,c=new tr;for(n=0,i=this.faces.length;n<i;n++)a=this.faces[n],s=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],h.subVectors(u,l),c.subVectors(s,l),h.cross(c),o[a.a].add(h),o[a.b].add(h),o[a.c].add(h)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)o[(a=this.faces[n]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)o[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(a=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var a=new Wr;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new tr,u={a:new tr,b:new tr,c:new tr},o.push(l),s.push(u)}var l,u,h=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=h.faceNormals[r],u=h.vertexNormals[r],l.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new mr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new vr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,u=this.faceVertexUvs[0],h=e.faceVertexUvs[0],c=this.colors,d=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new rr).getNormalMatrix(t));for(var f=0,p=o.length;f<p;f++){var m=o[f].clone();void 0!==t&&m.applyMatrix4(t),a.push(m)}for(f=0,p=d.length;f<p;f++)c.push(d[f].clone());for(f=0,p=l.length;f<p;f++){var v,g,y,x=l[f],b=x.vertexNormals,w=x.vertexColors;(v=new Dr(x.a+i,x.b+i,x.c+i)).normal.copy(x.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var _=0,M=b.length;_<M;_++)g=b[_].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);for(v.color.copy(x.color),_=0,M=w.length;_<M;_++)y=w[_],v.vertexColors.push(y.clone());v.materialIndex=x.materialIndex+r,s.push(v)}for(f=0,p=h.length;f<p;f++){var E=h[f],S=[];if(void 0!==E){for(_=0,M=E.length;_<M;_++)S.push(E[_].clone());u.push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,a,o,s,l={},u=[],h=[],c=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*c)+"_"+Math.round(e.y*c)+"_"+Math.round(e.z*c)]?(l[t]=r,u.push(this.vertices[r]),h[r]=u.length-1):h[r]=h[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=h[i.a],i.b=h[i.b],i.c=h[i.c],a=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var p=d[r];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new tr(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(a&&a.length===t&&(n=[]),o&&o.length===t&&(i=[]),r=0;r<t;r++){var s=e[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}var o=[],s=[],l={},u=[],h={},c=[],d={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,v=f.vertexNormals.length>0,g=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,x=0;if(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x,0,0),1,!0),2,!1),3,p),4,m),5,v),6,g),7,y),o.push(x),o.push(f.a,f.b,f.c),o.push(f.materialIndex),p){var b=this.faceVertexUvs[0][i];o.push(T(b[0]),T(b[1]),T(b[2]))}if(m&&o.push(E(f.normal)),v){var w=f.vertexNormals;o.push(E(w[0]),E(w[1]),E(w[2]))}if(g&&o.push(S(f.color)),y){var _=f.vertexColors;o.push(S(_[0]),S(_[1]),S(_[2]))}}function M(e,t,r){return r?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function S(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]?h[t]:(h[t]=u.length,u.push(e.getHex()),h[t])}function T(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=c.length/2,c.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=n,e.data.normals=s,u.length>0&&(e.data.colors=u),c.length>0&&(e.data.uvs=[c]),e.data.faces=o,e},clone:function(){return(new Wr).copy(this)},copy:function(e){var t,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,r=u.length;t<r;t++)this.faces.push(u[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var h=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=h.length;n<i;n++){var c=h[n],d=[];for(a=0,o=c.length;a<o;a++){var f=c[a];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,r=p.length;t<r;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],n=0,i=p[t].vertices.length;n<i;n++)m.vertices.push(p[t].vertices[n].clone());if(void 0!==p[t].normals)for(m.normals=[],n=0,i=p[t].normals.length;n<i;n++)m.normals.push(p[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,r=v.length;t<r;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,i=v[t].vertexNormals.length;n<i;n++){var y=v[t].vertexNormals[n],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),g.vertexNormals.push(x)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,i=v[t].faceNormals.length;n<i;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var w=e.skinIndices;for(t=0,r=w.length;t<r;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,r=_.length;t<r;t++)this.lineDistances.push(_[t]);var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(qr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(qr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new Ar),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new Qt),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new tr),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new cr),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Xr.prototype=Object.create(qr.prototype),Xr.prototype.constructor=Xr,Yr.prototype=Object.create(qr.prototype),Yr.prototype.constructor=Yr,Zr.prototype=Object.create(qr.prototype),Zr.prototype.constructor=Zr,Jr.prototype=Object.create(qr.prototype),Jr.prototype.constructor=Jr,Kr.prototype=Object.create(qr.prototype),Kr.prototype.constructor=Kr,Qr.prototype=Object.create(qr.prototype),Qr.prototype.constructor=Qr,$r.prototype=Object.create(qr.prototype),$r.prototype.constructor=$r,en.prototype=Object.create(qr.prototype),en.prototype.constructor=en,tn.prototype=Object.create(qr.prototype),tn.prototype.constructor=tn,Object.assign(rn.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:n})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var h,c=e.morphNormals,d=c.length;if(d>0){for(h=[],u=0;u<d;u++)h[u]={name:c[u].name,data:[]};this.morphTargets.normal=h}var f=e.skinIndices,p=e.skinWeights,m=f.length===n.length,v=p.length===n.length;for(n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),u=0;u<r.length;u++){var g=r[u];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===a&&(void 0!==(b=i[0][u])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Qt,new Qt,new Qt))),!0===o&&(void 0!==(b=i[1][u])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Qt,new Qt,new Qt)));for(var M=0;M<l;M++){var E=s[M].vertices;t[M].data.push(E[g.a],E[g.b],E[g.c])}for(M=0;M<d;M++){var S=c[M].vertexNormals[u];h[M].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var an=1;function on(){Object.defineProperty(this,"id",{value:an+=2}),this.uuid=Kt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function sn(e,t,r,n,i,a){Wr.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new ln(e,t,r,n,i,a)),this.mergeVertices()}function ln(e,t,r,n,i,a){on.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};var o=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var s=[],l=[],u=[],h=[],c=0,d=0;function f(e,t,r,n,i,a,f,p,m,v,g){var y,x,b=a/m,w=f/v,_=a/2,M=f/2,E=p/2,S=m+1,T=v+1,A=0,L=0,P=new tr;for(x=0;x<T;x++){var C=x*w-M;for(y=0;y<S;y++){var R=y*b-_;P[e]=R*n,P[t]=C*i,P[r]=E,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=p>0?1:-1,u.push(P.x,P.y,P.z),h.push(y/m),h.push(1-x/v),A+=1}}for(x=0;x<v;x++)for(y=0;y<m;y++){var O=c+y+S*x,D=c+y+S*(x+1),I=c+(y+1)+S*(x+1),N=c+(y+1)+S*x;s.push(O,D,N),s.push(D,I,N),L+=6}o.addGroup(d,L,g),d+=L,c+=A}f("z","y","x",-1,-1,r,t,e,a=Math.floor(a)||1,i,0),f("z","y","x",1,-1,r,t,-e,a,i,1),f("x","z","y",1,1,e,r,t,n,a,2),f("x","z","y",1,-1,e,r,-t,n,a,3),f("x","y","z",1,-1,e,t,r,n,i,4),f("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(s),this.addAttribute("position",new en(l,3)),this.addAttribute("normal",new en(u,3)),this.addAttribute("uv",new en(h,2))}function un(e,t,r,n){Wr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new hn(e,t,r,n)),this.mergeVertices()}function hn(e,t,r,n){on.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,u=Math.floor(n)||1,h=l+1,c=u+1,d=e/l,f=t/u,p=[],m=[],v=[],g=[];for(a=0;a<c;a++){var y=a*f-s;for(i=0;i<h;i++){var x=i*d-o;m.push(x,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-a/u)}}for(a=0;a<u;a++)for(i=0;i<l;i++){var b=i+h*a,w=i+h*(a+1),_=i+1+h*(a+1),M=i+1+h*a;p.push(b,w,M),p.push(w,_,M)}this.setIndex(p),this.addAttribute("position",new en(m,3)),this.addAttribute("normal",new en(v,3)),this.addAttribute("uv",new en(g,2))}on.prototype=Object.assign(Object.create(n.prototype),{constructor:on,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(nn(e)>65535?$r:Kr)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new qr(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;return void 0!==r&&((new rr).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new $t;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new $t;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new $t;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new $t;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new $t;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Gr;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new tr;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new en(3*t.vertices.length,3),n=new en(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new en(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new en(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new rn).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new qr(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new qr(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new qr(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new qr(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new qr(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],u=0,h=l.length;u<h;u++){var c=l[u],d=new en(3*c.data.length,3);d.name=c.name,s.push(d.copyVector3sArray(c.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var f=new en(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new en(4*e.skinWeights.length,4);this.addAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new mr);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new mr,t=new tr;return function(){null===this.boundingSphere&&(this.boundingSphere=new vr);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(n);for(var i=0,a=0,o=r.count;a<o;a++)t.x=r.getX(a),t.y=r.getY(a),t.z=r.getZ(a),i=Math.max(i,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new qr(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,l,u=t.normal.array,h=new tr,c=new tr,d=new tr,f=new tr,p=new tr;if(e){var m=e.array;for(i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],h.fromArray(r,o),c.fromArray(r,s),d.fromArray(r,l),f.subVectors(d,c),p.subVectors(h,c),f.cross(p),u[o]+=f.x,u[o+1]+=f.y,u[o+2]+=f.z,u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z}else for(i=0,a=r.length;i<a;i+=9)h.fromArray(r,i),c.fromArray(r,i+3),d.fromArray(r,i+6),f.subVectors(d,c),p.subVectors(h,c),f.cross(p),u[i]=f.x,u[i+1]=f.y,u[i+2]=f.z,u[i+3]=f.x,u[i+4]=f.y,u[i+5]=f.z,u[i+6]=f.x,u[i+7]=f.y,u[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,a=e.attributes[n],o=a.array,s=0,l=a.itemSize*t;s<o.length;s++,l++)i[l]=o[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new tr;return function(){for(var t=this.attributes.normal,r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new on,t=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],a=i.array,o=i.itemSize,s=new a.constructor(t.length*o),l=0,u=0,h=0,c=t.length;h<c;h++){l=t[h]*o;for(var d=0;d<o;d++)s[u++]=a[l++]}e.addAttribute(n,new qr(s,o))}var f=this.groups;for(h=0,c=f.length;h<c;h++){var p=f[h];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:i}}var a=this.attributes;for(var r in a){var o=a[r];i=Array.prototype.slice.call(o.array),e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:i,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new on).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],u=s[t];for(r=0,n=u.length;r<n;r++)l.push(u[r].clone());this.morphAttributes[t]=l}var h=e.groups;for(r=0,n=h.length;r<n;r++){var c=h[r];this.addGroup(c.start,c.count,c.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),sn.prototype=Object.create(Wr.prototype),sn.prototype.constructor=sn,ln.prototype=Object.create(on.prototype),ln.prototype.constructor=ln,un.prototype=Object.create(Wr.prototype),un.prototype.constructor=un,hn.prototype=Object.create(on.prototype),hn.prototype.constructor=hn;var cn,dn,fn,pn,mn,vn,gn,yn,xn,bn,wn,_n,Mn=0;function En(){Object.defineProperty(this,"id",{value:Mn++}),this.uuid=Kt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=F,this.side=A,this.flatShading=!1,this.vertexColors=O,this.opacity=1,this.transparent=!1,this.blendSrc=J,this.blendDst=K,this.blendEquation=G,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=oe,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function Sn(e){En.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Tn(e,t){this.origin=void 0!==e?e:new tr,this.direction=void 0!==t?t:new tr}function An(e,t,r){this.a=void 0!==e?e:new tr,this.b=void 0!==t?t:new tr,this.c=void 0!==r?r:new tr}function Ln(e){En.call(this),this.type="MeshBasicMaterial",this.color=new Ar(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Pn(e,t){Gr.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new on,this.material=void 0!==t?t:new Ln({color:16777215*Math.random()}),this.drawMode=Ft,this.updateMorphTargets()}function Cn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Rn(e,t,r,n,i,a,o,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:we,hr.call(this,e,t,r,n,i,a,o,s,l,u),this.flipY=!1}function On(e,t,r,n){hr.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=Re,this.minFilter=Re,this.generateMipmaps=!1,this.flipY=!1}En.prototype=Object.assign(Object.create(n.prototype),{constructor:En,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===C;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==F&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==A&&(r.side=this.side),this.vertexColors!==O&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),a=n(e.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Sn.prototype=Object.create(En.prototype),Sn.prototype.constructor=Sn,Sn.prototype.isShaderMaterial=!0,Sn.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=br(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Sn.prototype.toJSON=function(e){var t=En.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var n=this.uniforms[r].value;n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}return Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Tn.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new tr),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new tr;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new tr),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new tr;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(dn=new tr,fn=new tr,pn=new tr,function(e,t,r,n){dn.copy(e).add(t).multiplyScalar(.5),fn.copy(t).sub(e).normalize(),pn.copy(this.origin).sub(dn);var i,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(fn),h=pn.dot(this.direction),c=-pn.dot(fn),d=pn.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(a=u*h-c,s=l*f,(i=u*c-h)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(i*=p)*(i+u*(a*=p)+2*h)+a*(u*i+a+2*c)+d}else a=l,o=-(i=Math.max(0,-(u*a+h)))*i+a*(a+2*c)+d;else a=-l,o=-(i=Math.max(0,-(u*a+h)))*i+a*(a+2*c)+d;else a<=-s?o=-(i=Math.max(0,-(-u*l+h)))*i+(a=i>0?-l:Math.min(Math.max(-l,-c),l))*(a+2*c)+d:a<=s?(i=0,o=(a=Math.min(Math.max(-l,-c),l))*(a+2*c)+d):o=-(i=Math.max(0,-(u*l+h)))*i+(a=i>0?l:Math.min(Math.max(-l,-c),l))*(a+2*c)+d;else a=u>0?-l:l,o=-(i=Math.max(0,-(u*a+h)))*i+a*(a+2*c)+d;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(fn).multiplyScalar(a).add(dn),o}),intersectSphere:function(){var e=new tr;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i),s=n-o,l=n+o;return s<0&&l<0?null:s<0?this.at(l,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,n,i,a,o,s,l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(r=(e.min.x-c.x)*l,n=(e.max.x-c.x)*l):(r=(e.max.x-c.x)*l,n=(e.min.x-c.x)*l),u>=0?(i=(e.min.y-c.y)*u,a=(e.max.y-c.y)*u):(i=(e.max.y-c.y)*u,a=(e.min.y-c.y)*u),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),h>=0?(o=(e.min.z-c.z)*h,s=(e.max.z-c.z)*h):(o=(e.max.z-c.z)*h,s=(e.min.z-c.z)*h),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:(cn=new tr,function(e){return null!==this.intersectBox(e,cn)}),intersectTriangle:function(){var e=new tr,t=new tr,r=new tr,n=new tr;return function(i,a,o,s,l){t.subVectors(a,i),r.subVectors(o,i),n.crossVectors(t,r);var u,h=this.direction.dot(n);if(h>0){if(s)return null;u=1}else{if(!(h<0))return null;u=-1,h=-h}e.subVectors(this.origin,i);var c=u*this.direction.dot(r.crossVectors(e,r));if(c<0)return null;var d=u*this.direction.dot(t.cross(e));if(d<0)return null;if(c+d>h)return null;var f=-u*e.dot(n);return f<0?null:this.at(f/h,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(An,{getNormal:(vn=new tr,function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new tr),n.subVectors(r,t),vn.subVectors(e,t),n.cross(vn);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}),getBarycoord:function(){var e=new tr,t=new tr,r=new tr;return function(n,i,a,o,s){e.subVectors(o,i),t.subVectors(a,i),r.subVectors(n,i);var l=e.dot(e),u=e.dot(t),h=e.dot(r),c=t.dot(t),d=t.dot(r),f=l*c-u*u;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new tr),0===f)return s.set(-2,-1,-1);var p=1/f,m=(c*h-u*d)*p,v=(l*d-u*h)*p;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var e=new tr;return function(t,r,n,i){return An.getBarycoord(t,r,n,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(mn=new tr,function(e,t,r,n,i,a,o,s){return this.getBarycoord(e,t,r,n,mn),s.set(0,0),s.addScaledVector(i,mn.x),s.addScaledVector(a,mn.y),s.addScaledVector(o,mn.z),s})}),Object.assign(An.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new tr,t=new tr;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new tr),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return An.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new tr),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return An.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return An.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,r,n,i){return An.getUV(e,this.a,this.b,this.c,t,r,n,i)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(gn=new tr,yn=new tr,xn=new tr,bn=new tr,wn=new tr,_n=new tr,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new tr);var r,n,i=this.a,a=this.b,o=this.c;gn.subVectors(a,i),yn.subVectors(o,i),bn.subVectors(e,i);var s=gn.dot(bn),l=yn.dot(bn);if(s<=0&&l<=0)return t.copy(i);wn.subVectors(e,a);var u=gn.dot(wn),h=yn.dot(wn);if(u>=0&&h<=u)return t.copy(a);var c=s*h-u*l;if(c<=0&&s>=0&&u<=0)return r=s/(s-u),t.copy(i).addScaledVector(gn,r);_n.subVectors(e,o);var d=gn.dot(_n),f=yn.dot(_n);if(f>=0&&d<=f)return t.copy(o);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return n=l/(l-f),t.copy(i).addScaledVector(yn,n);var m=u*f-d*h;if(m<=0&&h-u>=0&&d-f>=0)return xn.subVectors(o,a),n=(h-u)/(h-u+(d-f)),t.copy(a).addScaledVector(xn,n);var v=1/(m+p+c);return r=p*v,n=c*v,t.copy(i).addScaledVector(gn,r).addScaledVector(yn,n)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Ln.prototype=Object.create(En.prototype),Ln.prototype.constructor=Ln,Ln.prototype.isMeshBasicMaterial=!0,Ln.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Pn.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Pn,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Gr.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)r=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},raycast:function(){var e=new $t,t=new Tn,r=new vr,n=new tr,i=new tr,a=new tr,o=new tr,s=new tr,l=new tr,u=new Qt,h=new Qt,c=new Qt,d=new tr,f=new tr;function p(e,t,r,n,i,a,o,s){if(null===(t.side===L?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,t.side!==P,s)))return null;f.copy(s),f.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:e}}function m(e,t,r,o,s,l,f,m,v){n.fromBufferAttribute(s,f),i.fromBufferAttribute(s,m),a.fromBufferAttribute(s,v);var g=p(e,t,r,o,n,i,a,d);if(g){l&&(u.fromBufferAttribute(l,f),h.fromBufferAttribute(l,m),c.fromBufferAttribute(l,v),g.uv=An.getUV(d,n,i,a,u,h,c,new Qt));var y=new Dr(f,m,v);An.getNormal(n,i,a,y.normal),g.face=y}return g}return function(f,v){var g,y=this.geometry,x=this.material,b=this.matrixWorld;if(void 0!==x&&(null===y.boundingSphere&&y.computeBoundingSphere(),r.copy(y.boundingSphere),r.applyMatrix4(b),!1!==f.ray.intersectsSphere(r)&&(e.getInverse(b),t.copy(f.ray).applyMatrix4(e),null===y.boundingBox||!1!==t.intersectsBox(y.boundingBox))))if(y.isBufferGeometry){var w,_,M,E,S,T,A,L,P,C=y.index,R=y.attributes.position,O=y.attributes.uv,D=y.groups,I=y.drawRange;if(null!==C)if(Array.isArray(x))for(E=0,T=D.length;E<T;E++)for(P=x[(L=D[E]).materialIndex],S=Math.max(L.start,I.start),A=Math.min(L.start+L.count,I.start+I.count);S<A;S+=3)w=C.getX(S),_=C.getX(S+1),M=C.getX(S+2),(g=m(this,P,f,t,R,O,w,_,M))&&(g.faceIndex=Math.floor(S/3),v.push(g));else for(E=Math.max(0,I.start),T=Math.min(C.count,I.start+I.count);E<T;E+=3)w=C.getX(E),_=C.getX(E+1),M=C.getX(E+2),(g=m(this,x,f,t,R,O,w,_,M))&&(g.faceIndex=Math.floor(E/3),v.push(g));else if(void 0!==R)if(Array.isArray(x))for(E=0,T=D.length;E<T;E++)for(P=x[(L=D[E]).materialIndex],S=Math.max(L.start,I.start),A=Math.min(L.start+L.count,I.start+I.count);S<A;S+=3)(g=m(this,P,f,t,R,O,w=S,_=S+1,M=S+2))&&(g.faceIndex=Math.floor(S/3),v.push(g));else for(E=Math.max(0,I.start),T=Math.min(R.count,I.start+I.count);E<T;E+=3)(g=m(this,x,f,t,R,O,w=E,_=E+1,M=E+2))&&(g.faceIndex=Math.floor(E/3),v.push(g))}else if(y.isGeometry){var N,F,U,k,B=Array.isArray(x),z=y.vertices,G=y.faces,j=y.faceVertexUvs[0];j.length>0&&(k=j);for(var V=0,H=G.length;V<H;V++){var W=G[V],q=B?x[W.materialIndex]:x;if(void 0!==q){if(N=z[W.a],F=z[W.b],U=z[W.c],!0===q.morphTargets){var X=y.morphTargets,Y=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),a.set(0,0,0);for(var Z=0,J=X.length;Z<J;Z++){var K=Y[Z];if(0!==K){var Q=X[Z].vertices;n.addScaledVector(o.subVectors(Q[W.a],N),K),i.addScaledVector(s.subVectors(Q[W.b],F),K),a.addScaledVector(l.subVectors(Q[W.c],U),K)}}n.add(N),i.add(F),a.add(U),N=n,F=i,U=a}if(g=p(this,q,f,t,N,F,U,d)){if(k&&k[V]){var $=k[V];u.copy($[0]),h.copy($[1]),c.copy($[2]),g.uv=An.getUV(d,N,F,U,u,h,c,new Qt)}g.face=W,g.faceIndex=V,v.push(g)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Rn.prototype=Object.create(hr.prototype),Rn.prototype.constructor=Rn,Rn.prototype.isCubeTexture=!0,Object.defineProperty(Rn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),On.prototype=Object.create(hr.prototype),On.prototype.constructor=On,On.prototype.isDataTexture3D=!0;var Dn=new hr,In=new On,Nn=new Rn;function Fn(){this.seq=[],this.map={}}var Un=[],kn=[],Bn=new Float32Array(16),zn=new Float32Array(9),Gn=new Float32Array(4);function jn(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,a=Un[i];if(void 0===a&&(a=new Float32Array(i),Un[i]=a),0!==t){n.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function Vn(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Hn(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function Wn(e,t){var r=kn[t];void 0===r&&(r=new Int32Array(t),kn[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocTextureUnit();return r}function qn(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function Xn(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Yn(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Vn(r,t))return;e.uniform2fv(this.addr,t),Hn(r,t)}}function Zn(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Vn(r,t))return;e.uniform3fv(this.addr,t),Hn(r,t)}}function Jn(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Vn(r,t))return;e.uniform4fv(this.addr,t),Hn(r,t)}}function Kn(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Vn(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Hn(r,t)}else{if(Vn(r,n))return;Gn.set(n),e.uniformMatrix2fv(this.addr,!1,Gn),Hn(r,n)}}function Qn(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Vn(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Hn(r,t)}else{if(Vn(r,n))return;zn.set(n),e.uniformMatrix3fv(this.addr,!1,zn),Hn(r,n)}}function $n(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Vn(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Hn(r,t)}else{if(Vn(r,n))return;Bn.set(n),e.uniformMatrix4fv(this.addr,!1,Bn),Hn(r,n)}}function ei(e,t,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2D(t||Dn,i)}function ti(e,t,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||In,i)}function ri(e,t,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTextureCube(t||Nn,i)}function ni(e,t){var r=this.cache;Vn(r,t)||(e.uniform2iv(this.addr,t),Hn(r,t))}function ii(e,t){var r=this.cache;Vn(r,t)||(e.uniform3iv(this.addr,t),Hn(r,t))}function ai(e,t){var r=this.cache;Vn(r,t)||(e.uniform4iv(this.addr,t),Hn(r,t))}function oi(e,t){var r=this.cache;Vn(r,t)||(e.uniform1fv(this.addr,t),Hn(r,t))}function si(e,t){var r=this.cache;Vn(r,t)||(e.uniform1iv(this.addr,t),Hn(r,t))}function li(e,t){var r=this.cache,n=jn(t,this.size,2);Vn(r,n)||(e.uniform2fv(this.addr,n),this.updateCache(n))}function ui(e,t){var r=this.cache,n=jn(t,this.size,3);Vn(r,n)||(e.uniform3fv(this.addr,n),this.updateCache(n))}function hi(e,t){var r=this.cache,n=jn(t,this.size,4);Vn(r,n)||(e.uniform4fv(this.addr,n),this.updateCache(n))}function ci(e,t){var r=this.cache,n=jn(t,this.size,4);Vn(r,n)||(e.uniformMatrix2fv(this.addr,!1,n),this.updateCache(n))}function di(e,t){var r=this.cache,n=jn(t,this.size,9);Vn(r,n)||(e.uniformMatrix3fv(this.addr,!1,n),this.updateCache(n))}function fi(e,t){var r=this.cache,n=jn(t,this.size,16);Vn(r,n)||(e.uniformMatrix4fv(this.addr,!1,n),this.updateCache(n))}function pi(e,t,r){var n=this.cache,i=t.length,a=Wn(r,i);!1===Vn(n,a)&&(e.uniform1iv(this.addr,a),Hn(n,a));for(var o=0;o!==i;++o)r.setTexture2D(t[o]||Dn,a[o])}function mi(e,t,r){var n=this.cache,i=t.length,a=Wn(r,i);!1===Vn(n,a)&&(e.uniform1iv(this.addr,a),Hn(n,a));for(var o=0;o!==i;++o)r.setTextureCube(t[o]||Nn,a[o])}function vi(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(t.type){case 5126:return qn;case 35664:return Yn;case 35665:return Zn;case 35666:return Jn;case 35674:return Kn;case 35675:return Qn;case 35676:return $n;case 35678:case 36198:return ei;case 35679:return ti;case 35680:return ri;case 5124:case 35670:return Xn;case 35667:case 35671:return ni;case 35668:case 35672:return ii;case 35669:case 35673:return ai}}()}function gi(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(t.type){case 5126:return oi;case 35664:return li;case 35665:return ui;case 35666:return hi;case 35674:return ci;case 35675:return di;case 35676:return fi;case 35678:return pi;case 35680:return mi;case 5124:case 35670:return si;case 35667:case 35671:return ni;case 35668:case 35672:return ii;case 35669:case 35673:return ai}}()}function yi(e){this.id=e,Fn.call(this)}gi.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Hn(t,e)},yi.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(e,t[o.id],r)}};var xi=/([\w\d_]+)(\])?(\[|\.)?/g;function bi(e,t){e.seq.push(t),e.map[t.id]=t}function wi(e,t,r){var n=e.name,i=n.length;for(xi.lastIndex=0;;){var a=xi.exec(n),o=xi.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===i){bi(r,void 0===u?new vi(s,e,t):new gi(s,e,t));break}var h=r.map[s];void 0===h&&bi(r,h=new yi(s)),r=h}}function _i(e,t,r){Fn.call(this),this.renderer=r;for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var a=e.getActiveUniform(t,i);wi(a,e.getUniformLocation(t,a.name),this)}}function Mi(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),!1===e.getShaderParameter(n,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===t?"vertex":"fragment",e.getShaderInfoLog(n),function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r)),n}_i.prototype.setValue=function(e,t,r){var n=this.map[t];void 0!==n&&n.setValue(e,r,this.renderer)},_i.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},_i.upload=function(e,t,r,n){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,n)}},_i.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var a=e[n];a.id in t&&r.push(a)}return r};var Ei=0;function Si(e){switch(e){case Bt:return["Linear","( value )"];case zt:return["sRGB","( value )"];case jt:return["RGBE","( value )"];case Ht:return["RGBM","( value, 7.0 )"];case Wt:return["RGBM","( value, 16.0 )"];case qt:return["RGBD","( value, 256.0 )"];case Gt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ti(e,t){var r=Si(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Ai(e){return""!==e}function Li(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Pi(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Ci(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){var r=xr[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Ci(r)})}function Ri(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,n){for(var i="",a=parseInt(t);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]");return i})}function Oi(e,t,r,n,i,a,o){var s=e.context,l=n.defines,u=i.vertexShader,h=i.fragmentShader,c="SHADOWMAP_TYPE_BASIC";a.shadowMapType===S?c="SHADOWMAP_TYPE_PCF":a.shadowMapType===T&&(c="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(n.envMap.mapping){case we:case _e:d="ENVMAP_TYPE_CUBE";break;case Te:case Ae:d="ENVMAP_TYPE_CUBE_UV";break;case Me:case Ee:d="ENVMAP_TYPE_EQUIREC";break;case Se:d="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case _e:case Ee:f="ENVMAP_MODE_REFRACTION"}switch(n.combine){case ce:p="ENVMAP_BLENDING_MULTIPLY";break;case de:p="ENVMAP_BLENDING_MIX";break;case fe:p="ENVMAP_BLENDING_ADD"}}var m,v,g,y,x=e.gammaFactor>0?e.gammaFactor:1,b=o.isWebGL2?"":function(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ai).join("\n")}(n.extensions,a,t),w=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(l),_=s.createProgram();if(n.isRawShaderMaterial?((m=[w].filter(Ai).join("\n")).length>0&&(m+="\n"),(v=[b,w].filter(Ai).join("\n")).length>0&&(v+="\n")):(m=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,w,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+c:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ai).join("\n"),v=[b,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,w,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+x,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+f:"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+c:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==pe?"#define TONE_MAPPING":"",a.toneMapping!==pe?xr.tonemapping_pars_fragment:"",a.toneMapping!==pe?function(e,t){var r;switch(t){case me:r="Linear";break;case ve:r="Reinhard";break;case ge:r="Uncharted2";break;case ye:r="OptimizedCineon";break;case xe:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 toneMapping( vec3 color ) { return "+r+"ToneMapping( color ); }"}(0,a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?xr.encodings_pars_fragment:"",a.mapEncoding?Ti("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Ti("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Ti("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Ti("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?("linearToOutputTexel",g=a.outputEncoding,y=Si(g),"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+y[0]+y[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ai).join("\n")),u=Pi(u=Li(u=Ci(u),a),a),h=Pi(h=Li(h=Ci(h),a),a),u=Ri(u),h=Ri(h),o.isWebGL2&&!n.isRawShaderMaterial){var M=!1,E=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==u.match(E)&&null!==h.match(E)&&(M=!0,u=u.replace(E,""),h=h.replace(E,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,v=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}var A=v+h,L=Mi(s,35633,m+u),P=Mi(s,35632,A);s.attachShader(_,L),s.attachShader(_,P),void 0!==n.index0AttributeName?s.bindAttribLocation(_,0,n.index0AttributeName):!0===a.morphTargets&&s.bindAttribLocation(_,0,"position"),s.linkProgram(_);var C,R,O=s.getProgramInfoLog(_).trim(),D=s.getShaderInfoLog(L).trim(),I=s.getShaderInfoLog(P).trim(),N=!0,F=!0;return!1===s.getProgramParameter(_,35714)?(N=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(_,35715),"gl.getProgramInfoLog",O,D,I)):""!==O?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",O):""!==D&&""!==I||(F=!1),F&&(this.diagnostics={runnable:N,material:n,programLog:O,vertexShader:{log:D,prefix:m},fragmentShader:{log:I,prefix:v}}),s.deleteShader(L),s.deleteShader(P),this.getUniforms=function(){return void 0===C&&(C=new _i(s,_,e)),C},this.getAttributes=function(){return void 0===R&&(R=function(e,t){for(var r={},n=e.getProgramParameter(t,35721),i=0;i<n;i++){var a=e.getActiveAttrib(t,i).name;r[a]=e.getAttribLocation(t,a)}return r}(s,_)),R},this.destroy=function(){s.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=i.name,this.id=Ei++,this.code=r,this.usedTimes=1,this.program=_,this.vertexShader=L,this.fragmentShader=P,this}function Di(e,t,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function o(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=Bt,r===Bt&&t&&(r=Gt),r}this.getParameters=function(t,n,a,s,l,u,h){var c=i[t.type],d=h.isSkinnedMesh?function(e){var t=h.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=r.maxVertexUniforms,i=Math.floor((n-20)/4),a=Math.min(i,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}():0,f=r.precision;null!==t.precision&&(f=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead.");var p=e.getRenderTarget();return{shaderID:c,precision:f,supportsVertexTextures:r.vertexTextures,outputEncoding:o(p?p.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:o(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:o(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:o(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===Te||t.envMap.mapping===Ae),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:o(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===Jt,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:u,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===P,flipSided:t.side===L,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var o=0;o<a.length;o++)n.push(r[a[o]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.push(e.gammaFactor),n.join()},this.acquireProgram=function(i,a,o,s){for(var l,u=0,h=n.length;u<h;u++){var c=n[u];if(c.code===s){++(l=c).usedTimes;break}}return void 0===l&&(l=new Oi(e,t,s,i,a,o,r),n.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function Ii(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ni(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Fi(){var e=[],t=0,r=[],n=[];function i(r,n,i,a,o){var s=e[t];return void 0===s?(s={id:r.id,object:r,geometry:n,material:i,program:i.program,renderOrder:r.renderOrder,z:a,group:o},e[t]=s):(s.id=r.id,s.object=r,s.geometry=n,s.material=i,s.program=i.program,s.renderOrder=r.renderOrder,s.z=a,s.group=o),t++,s}return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(e,t,a,o,s){var l=i(e,t,a,o,s);(!0===a.transparent?n:r).push(l)},unshift:function(e,t,a,o,s){var l=i(e,t,a,o,s);(!0===a.transparent?n:r).unshift(l)},sort:function(){r.length>1&&r.sort(Ii),n.length>1&&n.sort(Ni)}}}var Ui=0;function ki(){var e=new function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new tr,color:new Ar,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Qt};break;case"SpotLight":r={position:new tr,direction:new tr,color:new Ar,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Qt};break;case"PointLight":r={position:new tr,color:new Ar,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Qt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new tr,skyColor:new Ar,groundColor:new Ar};break;case"RectAreaLight":r={color:new Ar,position:new tr,halfWidth:new tr,halfHeight:new tr}}return e[t.id]=r,r}}},t={id:Ui++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new tr,n=new $t,i=new $t;return{setup:function(a,o,s){for(var l=0,u=0,h=0,c=0,d=0,f=0,p=0,m=0,v=s.matrixWorldInverse,g=0,y=a.length;g<y;g++){var x=a[g],b=x.color,w=x.intensity,_=x.distance,M=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)l+=b.r*w,u+=b.g*w,h+=b.b*w;else if(x.isDirectionalLight){if((S=e.get(x)).color.copy(x.color).multiplyScalar(x.intensity),S.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),S.direction.sub(r),S.direction.transformDirection(v),S.shadow=x.castShadow,x.castShadow){var E=x.shadow;S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize}t.directionalShadowMap[c]=M,t.directionalShadowMatrix[c]=x.shadow.matrix,t.directional[c]=S,c++}else if(x.isSpotLight)(S=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),S.position.applyMatrix4(v),S.color.copy(b).multiplyScalar(w),S.distance=_,S.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),S.direction.sub(r),S.direction.transformDirection(v),S.coneCos=Math.cos(x.angle),S.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),S.decay=x.decay,S.shadow=x.castShadow,x.castShadow&&(E=x.shadow,S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize),t.spotShadowMap[f]=M,t.spotShadowMatrix[f]=x.shadow.matrix,t.spot[f]=S,f++;else if(x.isRectAreaLight)(S=e.get(x)).color.copy(b).multiplyScalar(w),S.position.setFromMatrixPosition(x.matrixWorld),S.position.applyMatrix4(v),i.identity(),n.copy(x.matrixWorld),n.premultiply(v),i.extractRotation(n),S.halfWidth.set(.5*x.width,0,0),S.halfHeight.set(0,.5*x.height,0),S.halfWidth.applyMatrix4(i),S.halfHeight.applyMatrix4(i),t.rectArea[p]=S,p++;else if(x.isPointLight)(S=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),S.position.applyMatrix4(v),S.color.copy(x.color).multiplyScalar(x.intensity),S.distance=x.distance,S.decay=x.decay,S.shadow=x.castShadow,x.castShadow&&(E=x.shadow,S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize,S.shadowCameraNear=E.camera.near,S.shadowCameraFar=E.camera.far),t.pointShadowMap[d]=M,t.pointShadowMatrix[d]=x.shadow.matrix,t.point[d]=S,d++;else if(x.isHemisphereLight){var S;(S=e.get(x)).direction.setFromMatrixPosition(x.matrixWorld),S.direction.transformDirection(v),S.direction.normalize(),S.skyColor.copy(x.color).multiplyScalar(w),S.groundColor.copy(x.groundColor).multiplyScalar(w),t.hemi[m]=S,m++}}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=h,t.directional.length=c,t.spot.length=f,t.rectArea.length=p,t.point.length=d,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=c,t.hash.pointLength=d,t.hash.spotLength=f,t.hash.rectAreaLength=p,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}function Bi(){var e=new ki,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function zi(e){En.call(this),this.type="MeshDepthMaterial",this.depthPacking=Xt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Gi(e){En.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new tr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function ji(e,t,r){for(var n=new yr,i=new $t,a=new Qt,o=new Qt(r,r),s=new tr,l=new tr,u=1,h=2,c=1+(u|h),d=new Array(c),f=new Array(c),p={},m={0:L,1:A,2:P},v=[new tr(1,0,0),new tr(-1,0,0),new tr(0,0,1),new tr(0,0,-1),new tr(0,1,0),new tr(0,-1,0)],g=[new tr(0,1,0),new tr(0,1,0),new tr(0,1,0),new tr(0,1,0),new tr(0,0,1),new tr(0,0,-1)],y=[new cr,new cr,new cr,new cr,new cr,new cr],x=0;x!==c;++x){var b=0!=(x&u),w=0!=(x&h),_=new zi({depthPacking:Yt,morphTargets:b,skinning:w});d[x]=_;var M=new Gi({morphTargets:b,skinning:w});f[x]=M}var E=this;function T(t,r,n,i,a,o){var s=t.geometry,l=null,c=d,v=t.customDepthMaterial;if(n&&(c=f,v=t.customDistanceMaterial),v)l=v;else{var g=!1;r.morphTargets&&(s&&s.isBufferGeometry?g=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(g=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var y=t.isSkinnedMesh&&r.skinning,x=0;g&&(x|=u),y&&(x|=h),l=c[x]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var b=l.uuid,w=r.uuid,_=p[b];void 0===_&&(_={},p[b]=_);var M=_[w];void 0===M&&(M=l.clone(),_[w]=M),l=M}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:m[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=a,l.farDistance=o),l}function C(r,i,a,o){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var s=t.update(r),u=r.material;if(Array.isArray(u))for(var h=s.groups,c=0,d=h.length;c<d;c++){var f=h[c],p=u[f.materialIndex];if(p&&p.visible){var m=T(r,p,o,l,a.near,a.far);e.renderBufferDirect(a,null,s,m,r,f)}}else u.visible&&(m=T(r,u,o,l,a.near,a.far),e.renderBufferDirect(a,null,s,m,r,null))}for(var v=r.children,g=0,y=v.length;g<y;g++)C(v[g],i,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=S,this.render=function(t,r,u){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==t.length){e.context;var h,c=e.state;c.disable(3042),c.buffers.color.setClear(1,1,1,1),c.buffers.depth.setTest(!0),c.setScissorTest(!1);for(var d=0,f=t.length;d<f;d++){var p=t[d],m=p.shadow,x=p&&p.isPointLight;if(void 0!==m){var b=m.camera;if(a.copy(m.mapSize),a.min(o),x){var w=a.x,_=a.y;y[0].set(2*w,_,w,_),y[1].set(0,_,w,_),y[2].set(3*w,_,w,_),y[3].set(w,_,w,_),y[4].set(3*w,0,w,_),y[5].set(w,0,w,_),a.x*=4,a.y*=2}if(null===m.map){var M={minFilter:Re,magFilter:Re,format:Ke};m.map=new dr(a.x,a.y,M),m.map.texture.name=p.name+".shadowMap",b.updateProjectionMatrix()}m.isSpotLightShadow&&m.update(p);var S=m.map,T=m.matrix;l.setFromMatrixPosition(p.matrixWorld),b.position.copy(l),x?(h=6,T.makeTranslation(-l.x,-l.y,-l.z)):(h=1,s.setFromMatrixPosition(p.target.matrixWorld),b.lookAt(s),b.updateMatrixWorld(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(b.projectionMatrix),T.multiply(b.matrixWorldInverse)),e.setRenderTarget(S),e.clear();for(var A=0;A<h;A++){if(x){s.copy(b.position),s.add(v[A]),b.up.copy(g[A]),b.lookAt(s),b.updateMatrixWorld();var L=y[A];c.viewport(L)}i.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),n.setFromMatrix(i),C(r,u,b,x)}}else console.warn("THREE.WebGLShadowMap:",p,"has no shadow.")}E.needsUpdate=!1}}}function Vi(e,t,r,n,i,a,o){var s,l={};function u(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var r=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height),n}return e}function h(e){return Kt.isPowerOfTwo(e.width)&&Kt.isPowerOfTwo(e.height)}function c(e,t){return e.generateMipmaps&&t&&e.minFilter!==Re&&e.minFilter!==Ie}function d(t,r,i,a){e.generateMipmap(t),n.get(r).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function f(e,t){if(!i.isWebGL2)return e;if(6403===e){if(5126===t)return 33326;if(5131===t)return 33325;if(5121===t)return 33321}if(6407===e){if(5126===t)return 34837;if(5131===t)return 34843;if(5121===t)return 32849}if(6408===e){if(5126===t)return 34836;if(5131===t)return 34842;if(5121===t)return 32856}return e}function p(e){return e===Re||e===Oe||e===De?9728:9729}function m(t){var r=t.target;r.removeEventListener("dispose",m),function(t){var r=n.get(t);if(t.image&&r.__image__webglTextureCube)e.deleteTexture(r.__image__webglTextureCube);else{if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture)}n.remove(t)}(r),r.isVideoTexture&&delete l[r.id],o.memory.textures--}function v(t){var r=t.target;r.removeEventListener("dispose",v),function(t){var r=n.get(t),i=n.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[a]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}}(r),o.memory.textures--}function g(e,t){var i=n.get(e);if(e.isVideoTexture&&function(e){var t=e.id,r=o.render.frame;l[t]!==r&&(l[t]=r,e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void x(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,i.__webglTexture)}function y(r,o,s){var l;if(s?(e.texParameteri(r,10242,a.convert(o.wrapS)),e.texParameteri(r,10243,a.convert(o.wrapT)),e.texParameteri(r,10240,a.convert(o.magFilter)),e.texParameteri(r,10241,a.convert(o.minFilter))):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),o.wrapS===Pe&&o.wrapT===Pe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,p(o.magFilter)),e.texParameteri(r,10241,p(o.minFilter)),o.minFilter!==Re&&o.minFilter!==Ie&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(o.type===Ve&&null===t.get("OES_texture_float_linear"))return;if(o.type===He&&null===(i.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function x(t,n,l){var p;p=n.isDataTexture3D?32879:3553,void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",m),t.__webglTexture=e.createTexture(),o.memory.textures++),r.activeTexture(33984+l),r.bindTexture(p,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);var v=u(n.image,i.maxTextureSize);(function(e){return!i.isWebGL2&&(e.wrapS!==Pe||e.wrapT!==Pe||e.minFilter!==Re&&e.minFilter!==Ie)})(n)&&!1===h(v)&&(v=function(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=Kt.floorPowerOfTwo(e.width),s.height=Kt.floorPowerOfTwo(e.height),s.getContext("2d").drawImage(e,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+s.width+"x"+s.height),s):e}(v));var g=h(v),x=a.convert(n.format),b=a.convert(n.type),w=f(x,b);y(p,n,g);var _,M=n.mipmaps;if(n.isDepthTexture){if(w=6402,n.type===Ve){if(!i.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");w=36012}else i.isWebGL2&&(w=33189);n.format===tt&&6402===w&&n.type!==ze&&n.type!==je&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=ze,b=a.convert(n.type)),n.format===rt&&(w=34041,n.type!==Ye&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Ye,b=a.convert(n.type))),r.texImage2D(3553,0,w,v.width,v.height,0,x,b,null)}else if(n.isDataTexture)if(M.length>0&&g){for(var E=0,S=M.length;E<S;E++)_=M[E],r.texImage2D(3553,E,w,_.width,_.height,0,x,b,_.data);n.generateMipmaps=!1,t.__maxMipLevel=M.length-1}else r.texImage2D(3553,0,w,v.width,v.height,0,x,b,v.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(E=0,S=M.length;E<S;E++)_=M[E],n.format!==Ke&&n.format!==Je?r.getCompressedTextureFormats().indexOf(x)>-1?r.compressedTexImage2D(3553,E,w,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,E,w,_.width,_.height,0,x,b,_.data);t.__maxMipLevel=M.length-1}else if(n.isDataTexture3D)r.texImage3D(32879,0,w,v.width,v.height,v.depth,0,x,b,v.data),t.__maxMipLevel=0;else if(M.length>0&&g){for(E=0,S=M.length;E<S;E++)_=M[E],r.texImage2D(3553,E,w,x,b,_);n.generateMipmaps=!1,t.__maxMipLevel=M.length-1}else r.texImage2D(3553,0,w,x,b,v),t.__maxMipLevel=0;c(n,g)&&d(3553,n,v.width,v.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function b(t,i,o,s){var l=a.convert(i.texture.format),u=a.convert(i.texture.type),h=f(l,u);r.texImage2D(s,0,h,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function w(t,r){e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer?(e.renderbufferStorage(36161,33189,r.width,r.height),e.framebufferRenderbuffer(36160,36096,36161,t)):r.depthBuffer&&r.stencilBuffer?(e.renderbufferStorage(36161,34041,r.width,r.height),e.framebufferRenderbuffer(36160,33306,36161,t)):e.renderbufferStorage(36161,32854,r.width,r.height),e.bindRenderbuffer(36161,null)}this.setTexture2D=g,this.setTexture3D=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?x(i,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=function(t,s){var l=n.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",m),l.__image__webglTextureCube=e.createTexture(),o.memory.textures++),r.activeTexture(33984+s),r.bindTexture(34067,l.__image__webglTextureCube),e.pixelStorei(37440,t.flipY);for(var p=t&&t.isCompressedTexture,v=t.image[0]&&t.image[0].isDataTexture,g=[],x=0;x<6;x++)g[x]=p||v?v?t.image[x].image:t.image[x]:u(t.image[x],i.maxCubemapSize);var b=g[0],w=h(b),_=a.convert(t.format),M=a.convert(t.type),E=f(_,M);for(y(34067,t,w),x=0;x<6;x++)if(p)for(var S,T=g[x].mipmaps,A=0,L=T.length;A<L;A++)S=T[A],t.format!==Ke&&t.format!==Je?r.getCompressedTextureFormats().indexOf(_)>-1?r.compressedTexImage2D(34069+x,A,E,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+x,A,E,S.width,S.height,0,_,M,S.data);else v?r.texImage2D(34069+x,0,E,g[x].width,g[x].height,0,_,M,g[x].data):r.texImage2D(34069+x,0,E,_,M,g[x]);l.__maxMipLevel=p?T.length-1:0,c(t,w)&&d(34067,t,b.width,b.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+s),r.bindTexture(34067,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){r.activeTexture(33984+t),r.bindTexture(34067,n.get(e).__webglTexture)},this.setupRenderTarget=function(t){var i=n.get(t),a=n.get(t.texture);t.addEventListener("dispose",v),a.__webglTexture=e.createTexture(),o.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,l=h(t);if(s){i.__webglFramebuffer=[];for(var u=0;u<6;u++)i.__webglFramebuffer[u]=e.createFramebuffer()}else i.__webglFramebuffer=e.createFramebuffer();if(s){for(r.bindTexture(34067,a.__webglTexture),y(34067,t.texture,l),u=0;u<6;u++)b(i.__webglFramebuffer[u],t,36064,34069+u);c(t.texture,l)&&d(34067,t.texture,t.width,t.height),r.bindTexture(34067,null)}else r.bindTexture(3553,a.__webglTexture),y(3553,t.texture,l),b(i.__webglFramebuffer,t,36064,3553),c(t.texture,l)&&d(3553,t.texture,t.width,t.height),r.bindTexture(3553,null);t.depthBuffer&&function(t){var r=n.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),g(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===tt)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(r.depthTexture.format!==rt)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=e.createRenderbuffer(),w(r.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),w(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(c(t,h(e))){var i=e.isWebGLRenderTargetCube?34067:3553,a=n.get(t).__webglTexture;r.bindTexture(i,a),d(i,t,e.width,e.height),r.bindTexture(i,null)}}}function Hi(e,t,r){return{convert:function(e){var n;if(e===Le)return 10497;if(e===Pe)return 33071;if(e===Ce)return 33648;if(e===Re)return 9728;if(e===Oe)return 9984;if(e===De)return 9986;if(e===Ie)return 9729;if(e===Ne)return 9985;if(e===Fe)return 9987;if(e===Ue)return 5121;if(e===We)return 32819;if(e===qe)return 32820;if(e===Xe)return 33635;if(e===ke)return 5120;if(e===Be)return 5122;if(e===ze)return 5123;if(e===Ge)return 5124;if(e===je)return 5125;if(e===Ve)return 5126;if(e===He){if(r.isWebGL2)return 5131;if(null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES}if(e===Ze)return 6406;if(e===Je)return 6407;if(e===Ke)return 6408;if(e===Qe)return 6409;if(e===$e)return 6410;if(e===tt)return 6402;if(e===rt)return 34041;if(e===nt)return 6403;if(e===G)return 32774;if(e===j)return 32778;if(e===V)return 32779;if(e===q)return 0;if(e===X)return 1;if(e===Y)return 768;if(e===Z)return 769;if(e===J)return 770;if(e===K)return 771;if(e===Q)return 772;if(e===$)return 773;if(e===ee)return 774;if(e===te)return 775;if(e===re)return 776;if((e===it||e===at||e===ot||e===st)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(e===it)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===at)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ot)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===st)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===lt||e===ut||e===ht||e===ct)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===lt)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===ut)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===ht)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ct)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===dt&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((e===ft||e===pt||e===mt||e===vt||e===gt||e===yt||e===xt||e===bt||e===wt||e===_t||e===Mt||e===Et||e===St||e===Tt)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return e;if(e===H||e===W){if(r.isWebGL2){if(e===H)return 32775;if(e===W)return 32776}if(null!==(n=t.get("EXT_blend_minmax"))){if(e===H)return n.MIN_EXT;if(e===W)return n.MAX_EXT}}if(e===Ye){if(r.isWebGL2)return 34042;if(null!==(n=t.get("WEBGL_depth_texture")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}function Wi(){Gr.call(this),this.type="Group"}function qi(){Gr.call(this),this.type="Camera",this.matrixWorldInverse=new $t,this.projectionMatrix=new $t,this.projectionMatrixInverse=new $t}function Xi(e,t,r,n){qi.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Yi(e){Xi.call(this),this.cameras=e||[]}zi.prototype=Object.create(En.prototype),zi.prototype.constructor=zi,zi.prototype.isMeshDepthMaterial=!0,zi.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Gi.prototype=Object.create(En.prototype),Gi.prototype.constructor=Gi,Gi.prototype.isMeshDistanceMaterial=!0,Gi.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Wi.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Wi,isGroup:!0}),qi.prototype=Object.assign(Object.create(Gr.prototype),{constructor:qi,isCamera:!0,copy:function(e,t){return Gr.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new tr),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Gr.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Xi.prototype=Object.assign(Object.create(qi.prototype),{constructor:Xi,isPerspectiveCamera:!0,copy:function(e,t){return qi.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Kt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Kt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Kt.RAD2DEG*Math.atan(Math.tan(.5*Kt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Kt.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*n/o,t-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Gr.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Yi.prototype=Object.assign(Object.create(Xi.prototype),{constructor:Yi,isArrayCamera:!0});var Zi,Ji,Ki,Qi,$i,ea,ta=new tr,ra=new tr;function na(e,t,r){ta.setFromMatrixPosition(t.matrixWorld),ra.setFromMatrixPosition(r.matrixWorld);var n=ta.distanceTo(ra),i=t.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],h=(i[8]-1)/i[0],c=(a[8]+1)/a[0],d=o*h,f=o*c,p=n/(-h+c),m=p*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=o+p,g=s+p,y=d-m,x=f+(n-m),b=l*s/g*v,w=u*s/g*v;e.projectionMatrix.makePerspective(y,x,b,w,v,g)}function ia(e){var t=this,r=null,n=null,i=null,a=[],o=new $t,s=new $t,l=1,u="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",x,!1));var h=new $t,c=new er,d=new tr,f=new Xi;f.bounds=new cr(0,0,.5,1),f.layers.enable(1);var p=new Xi;p.bounds=new cr(.5,0,.5,1),p.layers.enable(2);var m,v,g=new Yi([f,p]);function y(){return null!==r&&!0===r.isPresenting}function x(){if(y()){var n=r.getEyeParameters("left"),i=n.renderWidth*l,a=n.renderHeight*l;v=e.getPixelRatio(),m=e.getSize(),e.setDrawingBufferSize(2*i,a,1),_.start()}else t.enabled&&e.setDrawingBufferSize(m.width,m.height,v),_.stop()}g.layers.enable(1),g.layers.enable(2);var b=[];function w(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0,i=t.length;r<i;r++){var a=t[r];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(n===e)return a;n++}}}this.enabled=!1,this.getController=function(e){var t=a[e];return void 0===t&&((t=new Wi).matrixAutoUpdate=!1,t.visible=!1,a[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),_.setContext(e)},this.setFramebufferScaleFactor=function(e){l=e},this.setFrameOfReferenceType=function(e){u=e},this.setPoseTarget=function(e){void 0!==e&&(i=e)},this.getCamera=function(e){var t="stage"===u?1.6:0;if(null===r)return e.position.set(0,t,0),e;if(r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(n),"stage"===u){var l=r.stageParameters;l?o.fromArray(l.sittingToStandingTransform):o.makeTranslation(0,t,0)}var m=n.pose,v=null!==i?i:e;if(v.matrix.copy(o),v.matrix.decompose(v.position,v.quaternion,v.scale),null!==m.orientation&&(c.fromArray(m.orientation),v.quaternion.multiply(c)),null!==m.position&&(c.setFromRotationMatrix(o),d.fromArray(m.position),d.applyQuaternion(c),v.position.add(d)),v.updateMatrixWorld(),!1===r.isPresenting)return e;f.near=e.near,p.near=e.near,f.far=e.far,p.far=e.far,f.matrixWorldInverse.fromArray(n.leftViewMatrix),p.matrixWorldInverse.fromArray(n.rightViewMatrix),s.getInverse(o),"stage"===u&&(f.matrixWorldInverse.multiply(s),p.matrixWorldInverse.multiply(s));var y=v.parent;null!==y&&(h.getInverse(y.matrixWorld),f.matrixWorldInverse.multiply(h),p.matrixWorldInverse.multiply(h)),f.matrixWorld.getInverse(f.matrixWorldInverse),p.matrixWorld.getInverse(p.matrixWorldInverse),f.projectionMatrix.fromArray(n.leftProjectionMatrix),p.projectionMatrix.fromArray(n.rightProjectionMatrix),na(g,f,p);var x=r.getLayers();if(x.length){var _=x[0];null!==_.leftBounds&&4===_.leftBounds.length&&f.bounds.fromArray(_.leftBounds),null!==_.rightBounds&&4===_.rightBounds.length&&p.bounds.fromArray(_.rightBounds)}return function(){for(var e=0;e<a.length;e++){var t=a[e],r=w(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var n=r.pose;!1===n.hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(o),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var i="Daydream Controller"===r.id?0:1;b[e]!==r.buttons[i].pressed&&(b[e]=r.buttons[i].pressed,!0===b[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return o},this.isPresenting=y;var _=new Rr;this.setAnimationLoop=function(e){_.setAnimationLoop(e)},this.submitFrame=function(){y()&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",x)}}function aa(e){console.log("THREE.WebGLRenderer",v);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",h=null,c=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=me,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,f,p,m,g,w,_,M,E,S,T,C,R,O,D,I,j,V,H=this,W=!1,q=null,X=null,Y=null,Z=-1,J={geometry:null,program:null,wireframe:!1},K=null,Q=null,$=new cr,ee=new cr,te=null,re=0,ce=t.width,de=t.height,fe=1,pe=new cr(0,0,ce,de),ve=new cr(0,0,ce,de),ge=!1,ye=new yr,xe=new function(){var e=this,t=null,r=0,n=!1,i=!1,a=new gr,o=new rr,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,r,n,i){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=s.value,!0!==i||null===u){var h=n+4*l,c=r.matrixWorldInverse;o.getNormalMatrix(c),(null===u||u.length<h)&&(u=new Float32Array(h));for(var d=0,f=n;d!==l;++d,f+=4)a.copy(t[d]).applyMatrix4(c,o),a.normal.toArray(u,f),u[f+3]=a.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||0!==r||n;return n=i,t=u(e,a,0),r=e.length,o},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,a,o,h,c,d){if(!n||null===e||0===e.length||i&&!o)i?u(null):l();else{var f=i?0:r,p=4*f,m=c.clippingState||null;s.value=m,m=u(e,h,p,d);for(var v=0;v!==p;++v)m[v]=t[v];c.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}},be=!1,we=!1,_e=new $t,Me=new tr;function Ee(){return null===X?fe:1}try{var Se={alpha:n,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u};if(t.addEventListener("webglcontextlost",Pe,!1),t.addEventListener("webglcontextrestored",Ce,!1),null===(d=r||t.getContext("webgl",Se)||t.getContext("experimental-webgl",Se)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function Te(){f=new function(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}(d),(p=new function(e,t,r){var n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),c=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=h>0,y=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:h,maxTextureSize:c,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y}}(d,f,e)).isWebGL2||(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),V=new Hi(d,f,p),(m=new function(e,t,r,n){var i=new function(){var t=!1,r=new cr,n=null,i=new cr(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,o,s){!0===s&&(t*=o,n*=o,a*=o),r.set(t,n,a,o),!1===i.equals(r)&&(e.clearColor(t,n,a,o),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},a=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(e){e?K(2929):Q(2929)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case ne:e.depthFunc(512);break;case ie:e.depthFunc(519);break;case ae:e.depthFunc(513);break;case oe:e.depthFunc(515);break;case se:e.depthFunc(514);break;case le:e.depthFunc(518);break;case ue:e.depthFunc(516);break;case he:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},o=new function(){var t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){e?K(2960):Q(2960)},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,o){n===t&&i===r&&a===o||(e.stencilFunc(t,r,o),n=t,i=r,a=o)},setOp:function(t,r,n){o===t&&s===r&&l===n||(e.stencilOp(t,r,n),o=t,s=r,l=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null}}},s=e.getParameter(34921),l=new Uint8Array(s),u=new Uint8Array(s),h=new Uint8Array(s),c={},d=null,f=null,p=null,m=null,v=null,g=null,w=null,_=null,M=null,E=null,S=!1,T=null,A=null,C=null,R=null,O=null,D=e.getParameter(35661),I=!1,j=0,V=e.getParameter(7938);-1!==V.indexOf("WebGL")?(j=parseFloat(/^WebGL\ ([0-9])/.exec(V)[1]),I=j>=1):-1!==V.indexOf("OpenGL ES")&&(j=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(V)[1]),I=j>=2);var H=null,W={},q=new cr,X=new cr;function Y(t,r,n){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<n;o++)e.texImage2D(r+o,0,6408,1,1,0,6408,5121,i);return a}var Z={};function J(r,i){l[r]=1,0===u[r]&&(e.enableVertexAttribArray(r),u[r]=1),h[r]!==i&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),h[r]=i)}function K(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function Q(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}function $(t,n,i,a,o,s,l,u){if(t!==N){if(p||(K(3042),p=!0),t===z)o=o||n,s=s||i,l=l||a,n===v&&o===_||(e.blendEquationSeparate(r.convert(n),r.convert(o)),v=n,_=o),i===g&&a===w&&s===M&&l===E||(e.blendFuncSeparate(r.convert(i),r.convert(a),r.convert(s),r.convert(l)),g=i,w=a,M=s,E=l),m=t,S=null;else if(t!==m||u!==S){if(v===G&&_===G||(e.blendEquation(32774),v=G,_=G),u)switch(t){case F:e.blendFuncSeparate(1,771,1,771);break;case U:e.blendFunc(1,1);break;case k:e.blendFuncSeparate(0,0,769,771);break;case B:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case F:e.blendFuncSeparate(770,771,1,771);break;case U:e.blendFunc(770,1);break;case k:e.blendFunc(0,769);break;case B:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=null,w=null,M=null,E=null,m=t,S=u}}else p&&(Q(3042),p=!1)}function ee(t){T!==t&&(t?e.frontFace(2304):e.frontFace(2305),T=t)}function te(t){t!==y?(K(2884),t!==A&&(t===x?e.cullFace(1029):t===b?e.cullFace(1028):e.cullFace(1032))):Q(2884),A=t}function re(t,r,n){t?(K(32823),R===r&&O===n||(e.polygonOffset(r,n),R=r,O=n)):Q(32823)}function ce(t){void 0===t&&(t=33984+D-1),H!==t&&(e.activeTexture(t),H=t)}return Z[3553]=Y(3553,3553,1),Z[34067]=Y(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),K(2929),a.setFunc(oe),ee(!1),te(x),K(2884),$(N),{buffers:{color:i,depth:a,stencil:o},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){J(e,0)},enableAttributeAndDivisor:J,disableUnusedAttributes:function(){for(var t=0,r=u.length;t!==r;++t)u[t]!==l[t]&&(e.disableVertexAttribArray(t),u[t]=0)},enable:K,disable:Q,getCompressedTextureFormats:function(){if(null===d&&(d=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(34467),n=0;n<r.length;n++)d.push(r[n]);return d},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:$,setMaterial:function(e,t){e.side===P?Q(2884):K(2884);var r=e.side===L;t&&(r=!r),ee(r),e.blending===F&&!1===e.transparent?$(N):$(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite),re(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:ee,setCullFace:te,setLineWidth:function(t){t!==C&&(I&&e.lineWidth(t),C=t)},setPolygonOffset:re,setScissorTest:function(e){e?K(3089):Q(3089)},activeTexture:ce,bindTexture:function(t,r){null===H&&ce();var n=W[H];void 0===n&&(n={type:void 0,texture:void 0},W[H]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||Z[t]),n.type=t,n.texture=r)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===q.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),q.copy(t))},viewport:function(t){!1===X.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),X.copy(t))},reset:function(){for(var t=0;t<u.length;t++)1===u[t]&&(e.disableVertexAttribArray(t),u[t]=0);c={},d=null,H=null,W={},f=null,m=null,T=null,A=null,i.reset(),a.reset(),o.reset()}}}(d,f,V,p)).scissor(ee.copy(ve).multiplyScalar(fe)),m.viewport($.copy(pe).multiplyScalar(fe)),g=new function(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,n){switch(n=n||1,t.calls++,r){case 4:t.triangles+=n*(e/3);break;case 5:case 6:t.triangles+=n*(e-2);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}(d),w=new function(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}},_=new Vi(d,f,m,w,p,V,g),M=new Or(d),E=new function(e,t,r){var n={},i={};function a(e){var o=e.target,s=n[o.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete n[o.id];var u=i[s.id];u&&(t.remove(u),delete i[s.id]),r.memory.geometries--}return{get:function(e,t){var i=n[t.id];return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new on).setFromObject(e)),i=t._bufferGeometry),n[t.id]=i,r.memory.geometries++,i)},update:function(e){var r=e.index,n=e.attributes;for(var i in null!==r&&t.update(r,34963),n)t.update(n[i],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var r=i[e.id];if(r)return r;var n,a=[],o=e.index,s=e.attributes;if(null!==o)for(var l=0,u=(n=o.array).length;l<u;l+=3){var h=n[l+0],c=n[l+1],d=n[l+2];a.push(h,c,c,d,d,h)}else for(l=0,u=(n=s.position.array).length/3-1;l<u;l+=3)h=l+0,c=l+1,d=l+2,a.push(h,c,c,d,d,h);return r=new(nn(a)>65535?$r:Kr)(a,1),t.update(r,34963),i[e.id]=r,r}}}(d,M,g),S=new function(e,t){var r={};return{update:function(n){var i=t.render.frame,a=n.geometry,o=e.get(n,a);return r[o.id]!==i&&(a.isGeometry&&o.updateFromObject(n),e.update(o),r[o.id]=i),o},dispose:function(){r={}}}}(E,g),D=new function(e){var t={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,l=s.length,u=t[i.id];if(void 0===u){u=[];for(var h=0;h<l;h++)u[h]=[h,0];t[i.id]=u}var c=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal;for(h=0;h<l;h++)0!==(f=u[h])[1]&&(c&&i.removeAttribute("morphTarget"+h),d&&i.removeAttribute("morphNormal"+h));for(h=0;h<l;h++)(f=u[h])[0]=h,f[1]=s[h];for(u.sort(Cn),h=0;h<8;h++){var f;if(f=u[h]){var p=f[0],m=f[1];if(m){c&&i.addAttribute("morphTarget"+h,c[p]),d&&i.addAttribute("morphNormal"+h,d[p]),r[h]=m;continue}}r[h]=0}o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}(d),T=new Di(H,f,p),C=new function(){var e={};return{get:function(t,r){var n,i=e[t.id];return void 0===i?(n=new Fi,e[t.id]={},e[t.id][r.id]=n):void 0===(n=i[r.id])&&(n=new Fi,i[r.id]=n),n},dispose:function(){e={}}}},R=new function(){var e={};return{get:function(t,r){var n;return void 0===e[t.id]?(n=new Bi,e[t.id]={},e[t.id][r.id]=n):void 0===e[t.id][r.id]?(n=new Bi,e[t.id][r.id]=n):n=e[t.id][r.id],n},dispose:function(){e={}}}},O=new function(e,t,r,n){var i,a,o=new Ar(0),s=0,l=null,u=0;function h(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),h(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){h(o,s=e)},render:function(t,n,c,d){var f=n.background;if(null===f?(h(o,s),l=null,u=0):f&&f.isColor&&(h(f,1),d=!0,l=null,u=0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.isWebGLRenderTargetCube)){void 0===a&&((a=new Pn(new ln(1,1,1),new Sn({type:"BackgroundCubeMaterial",uniforms:br(Cr.cube.uniforms),vertexShader:Cr.cube.vertexShader,fragmentShader:Cr.cube.fragmentShader,side:L,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(a));var p=f.isWebGLRenderTargetCube?f.texture:f;a.material.uniforms.tCube.value=p,a.material.uniforms.tFlip.value=f.isWebGLRenderTargetCube?1:-1,l===f&&u===p.version||(a.material.needsUpdate=!0,l=f,u=p.version),t.unshift(a,a.geometry,a.material,0,null)}else f&&f.isTexture&&(void 0===i&&((i=new Pn(new hn(2,2),new Sn({type:"BackgroundMaterial",uniforms:br(Cr.background.uniforms),vertexShader:Cr.background.vertexShader,fragmentShader:Cr.background.fragmentShader,side:A,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),i.material.uniforms.uvTransform.value.copy(f.matrix),l===f&&u===f.version||(i.material.needsUpdate=!0,l=f,u=f.version),t.unshift(i,i.geometry,i.material,0,null))}}}(H,m,S,s),I=new function(e,t,r,n){var i;this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i)},this.renderInstances=function(a,o,s){var l;if(n.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[n.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](i,o,s,a.maxInstancedCount),r.update(s,i,a.maxInstancedCount)}}(d,f,g,p),j=new function(e,t,r,n){var i,a,o;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,n){e.drawElements(i,n,a,t*o),r.update(n,i)},this.renderInstances=function(s,l,u){var h;if(n.isWebGL2)h=e;else if(null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[n.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](i,u,a,l*o,s.maxInstancedCount),r.update(u,i,s.maxInstancedCount)}}(d,f,g,p),g.programs=T.programs,H.context=d,H.capabilities=p,H.extensions=f,H.properties=w,H.renderLists=C,H.state=m,H.info=g}Te();var Ae=null;"undefined"!=typeof navigator&&(Ae="xr"in navigator?new function(e){var t=e.context,r=null,n=null,i=1,a=null,o="stage",s=null,l=[],u=[];function h(){return null!==n&&null!==a}var c=new Xi;c.layers.enable(1),c.viewport=new cr;var d=new Xi;d.layers.enable(2),d.viewport=new cr;var f=new Yi([c,d]);function p(e){var t=l[u.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function m(){e.setFramebuffer(null),y.stop()}function v(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}f.layers.enable(1),f.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=l[e];return void 0===t&&((t=new Wi).matrixAutoUpdate=!1,t.visible=!1,l[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),e instanceof XRDevice&&t.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){i=e},this.setFrameOfReferenceType=function(e){o=e},this.setSession=function(r){null!==(n=r)&&(n.addEventListener("select",p),n.addEventListener("selectstart",p),n.addEventListener("selectend",p),n.addEventListener("end",m),n.baseLayer=new XRWebGLLayer(n,t,{framebufferScaleFactor:i}),n.requestFrameOfReference(o).then(function(t){a=t,e.setFramebuffer(n.baseLayer.framebuffer),y.setContext(n),y.start()}),u=n.getInputSources(),n.addEventListener("inputsourceschange",function(){u=n.getInputSources(),console.log(u);for(var e=0;e<l.length;e++)l[e].userData.inputSource=u[e]}))},this.getCamera=function(e){if(h()){var t=e.parent,r=f.cameras;v(f,t);for(var n=0;n<r.length;n++)v(r[n],t);e.matrixWorld.copy(f.matrixWorld);for(var i=e.children,a=(n=0,i.length);n<a;n++)i[n].updateMatrixWorld(!0);return na(f,c,d),f}return e},this.isPresenting=h;var g=null,y=new Rr;y.setAnimationLoop(function(e,t){if(null!==(s=t.getDevicePose(a)))for(var r=n.baseLayer,i=t.views,o=0;o<i.length;o++){var h=i[o],c=r.getViewport(h),d=s.getViewMatrix(h),p=f.cameras[o];p.matrix.fromArray(d).getInverse(p.matrix),p.projectionMatrix.fromArray(h.projectionMatrix),p.viewport.set(c.x,c.y,c.width,c.height),0===o&&f.matrix.copy(p.matrix)}for(o=0;o<l.length;o++){var m=l[o],v=u[o];if(v){var y=t.getInputPose(v,a);if(null!==y){"targetRay"in y?m.matrix.elements=y.targetRay.transformMatrix:"pointerMatrix"in y&&(m.matrix.elements=y.pointerMatrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}g&&g(e)}),this.setAnimationLoop=function(e){g=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}(H):new ia(H)),this.vr=Ae;var Le=new ji(H,S,p.maxTextureSize);function Pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),W=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),W=!1,Te()}function Re(e){var t=e.target;t.removeEventListener("dispose",Re),function(e){Oe(e),w.remove(e)}(t)}function Oe(e){var t=w.get(e).program;e.program=void 0,void 0!==t&&T.releaseProgram(t)}this.shadowMap=Le,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return fe},this.setPixelRatio=function(e){void 0!==e&&(fe=e,this.setSize(ce,de,!1))},this.getSize=function(){return{width:ce,height:de}},this.setSize=function(e,r,n){Ae.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ce=e,de=r,t.width=e*fe,t.height=r*fe,!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(){return{width:ce*fe,height:de*fe}},this.setDrawingBufferSize=function(e,r,n){ce=e,de=r,fe=n,t.width=e*n,t.height=r*n,this.setViewport(0,0,e,r)},this.getCurrentViewport=function(){return $},this.setViewport=function(e,t,r,n){pe.set(e,de-t-n,r,n),m.viewport($.copy(pe).multiplyScalar(fe))},this.setScissor=function(e,t,r,n){ve.set(e,de-t-n,r,n),m.scissor(ee.copy(ve).multiplyScalar(fe))},this.setScissorTest=function(e){m.setScissorTest(ge=e)},this.getClearColor=function(){return O.getClearColor()},this.setClearColor=function(){O.setClearColor.apply(O,arguments)},this.getClearAlpha=function(){return O.getClearAlpha()},this.setClearAlpha=function(){O.setClearAlpha.apply(O,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===r||r)&&(n|=1024),d.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Pe,!1),t.removeEventListener("webglcontextrestored",Ce,!1),C.dispose(),R.dispose(),w.dispose(),S.dispose(),Ae.dispose(),Ne.stop()},this.renderBufferImmediate=function(e,t){m.initAttributes();var r=w.get(e);e.hasPositions&&!r.position&&(r.position=d.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),e.hasColors&&!r.color&&(r.color=d.createBuffer());var n=t.getAttributes();e.hasPositions&&(d.bindBuffer(34962,r.position),d.bufferData(34962,e.positionArray,35048),m.enableAttribute(n.position),d.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(d.bindBuffer(34962,r.normal),d.bufferData(34962,e.normalArray,35048),m.enableAttribute(n.normal),d.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(d.bindBuffer(34962,r.uv),d.bufferData(34962,e.uvArray,35048),m.enableAttribute(n.uv),d.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(d.bindBuffer(34962,r.color),d.bufferData(34962,e.colorArray,35048),m.enableAttribute(n.color),d.vertexAttribPointer(n.color,3,5126,!1,0,0)),m.disableUnusedAttributes(),d.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,a){var o=i.isMesh&&i.normalMatrix.determinant()<0;m.setMaterial(n,o);var s=ze(e,t,n,i),l=!1;J.geometry===r.id&&J.program===s.id&&J.wireframe===(!0===n.wireframe)||(J.geometry=r.id,J.program=s.id,J.wireframe=!0===n.wireframe,l=!0),i.morphTargetInfluences&&(D.update(i,r,n,s),l=!0);var u,h=r.index,c=r.attributes.position,v=1;!0===n.wireframe&&(h=E.getWireframeAttribute(r),v=2);var g=I;null!==h&&(u=M.get(h),(g=j).setIndex(u)),l&&(function(e,t,r){if(r&&r.isInstancedBufferGeometry&!p.isWebGL2&&null===f.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{m.initAttributes();var n=r.attributes,i=t.getAttributes(),a=e.defaultAttributeValues;for(var o in i){var s=i[o];if(s>=0){var l=n[o];if(void 0!==l){var u=l.normalized,h=l.itemSize,c=M.get(l);if(void 0===c)continue;var v=c.buffer,g=c.type,y=c.bytesPerElement;if(l.isInterleavedBufferAttribute){var x=l.data,b=x.stride,w=l.offset;x&&x.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(s,x.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=x.meshPerAttribute*x.count)):m.enableAttribute(s),d.bindBuffer(34962,v),d.vertexAttribPointer(s,h,g,u,b*y,w*y)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(s),d.bindBuffer(34962,v),d.vertexAttribPointer(s,h,g,u,0,0)}else if(void 0!==a){var _=a[o];if(void 0!==_)switch(_.length){case 2:d.vertexAttrib2fv(s,_);break;case 3:d.vertexAttrib3fv(s,_);break;case 4:d.vertexAttrib4fv(s,_);break;default:d.vertexAttrib1fv(s,_)}}}}m.disableUnusedAttributes()}}(n,s,r),null!==h&&d.bindBuffer(34963,u.buffer));var y=1/0;null!==h?y=h.count:void 0!==c&&(y=c.count);var x=r.drawRange.start*v,b=r.drawRange.count*v,w=null!==a?a.start*v:0,_=null!==a?a.count*v:1/0,S=Math.max(x,w),T=Math.min(y,x+b,w+_)-1,A=Math.max(0,T-S+1);if(0!==A){if(i.isMesh)if(!0===n.wireframe)m.setLineWidth(n.wireframeLinewidth*Ee()),g.setMode(1);else switch(i.drawMode){case Ft:g.setMode(4);break;case Ut:g.setMode(5);break;case kt:g.setMode(6)}else if(i.isLine){var L=n.linewidth;void 0===L&&(L=1),m.setLineWidth(L*Ee()),i.isLineSegments?g.setMode(1):i.isLineLoop?g.setMode(2):g.setMode(3)}else i.isPoints?g.setMode(0):i.isSprite&&g.setMode(4);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&g.renderInstances(r,S,A):g.render(S,A)}},this.compile=function(e,t){(c=R.get(e,t)).init(),e.traverse(function(e){e.isLight&&(c.pushLight(e),e.castShadow&&c.pushShadow(e))}),c.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)Be(t.material[r],e.fog,t);else Be(t.material,e.fog,t)})};var De,Ie=null,Ne=new Rr;function Fe(e,t,r,n){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,u=void 0===n?o.material:n,h=o.group;if(r.isArrayCamera){Q=r;for(var d=r.cameras,f=0,p=d.length;f<p;f++){var v=d[f];if(s.layers.test(v.layers)){if("viewport"in v)m.viewport($.copy(v.viewport));else{var g=v.bounds,y=g.x*ce,x=g.y*de,b=g.z*ce,w=g.w*de;m.viewport($.set(y,x,b,w).multiplyScalar(fe))}c.setupLights(v),ke(s,t,v,l,u,h)}}}else Q=null,ke(s,t,r,l,u,h)}}function ke(e,t,r,n,i,a){if(e.onBeforeRender(H,t,r,n,i,a),c=R.get(t,Q||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){m.setMaterial(i);var o=ze(r,t.fog,i,e);J.geometry=null,J.program=null,J.wireframe=!1,function(e,t){e.render(function(e){H.renderBufferImmediate(e,t)})}(e,o)}else H.renderBufferDirect(r,t.fog,n,i,e,a);e.onAfterRender(H,t,r,n,i,a),c=R.get(t,Q||r)}function Be(e,t,r){var n=w.get(e),i=c.state.lights,a=c.state.shadowsArray,o=n.lightsHash,s=i.state.hash,l=T.getParameters(e,i.state,a,t,xe.numPlanes,xe.numIntersection,r),u=T.getProgramCode(e,l),h=n.program,d=!0;if(void 0===h)e.addEventListener("dispose",Re);else if(h.code!==u)Oe(e);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,d=!1;else{if(void 0!==l.shaderID)return;d=!1}if(d){if(l.shaderID){var f=Cr[l.shaderID];n.shader={name:e.type,uniforms:br(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,H),u=T.getProgramCode(e,l),h=T.acquireProgram(e,n.shader,l,u),n.program=h,e.program=h}var p=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<H.maxMorphTargets;m++)p["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,m=0;m<H.maxMorphNormals;m++)p["morphNormal"+m]>=0&&e.numSupportedMorphNormals++;var v=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=xe.numPlanes,n.numIntersection=xe.numIntersection,v.clippingPlanes=xe.uniform),n.fog=t,void 0===o&&(n.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(v.ambientLightColor.value=i.state.ambient,v.directionalLights.value=i.state.directional,v.spotLights.value=i.state.spot,v.rectAreaLights.value=i.state.rectArea,v.pointLights.value=i.state.point,v.hemisphereLights.value=i.state.hemi,v.directionalShadowMap.value=i.state.directionalShadowMap,v.directionalShadowMatrix.value=i.state.directionalShadowMatrix,v.spotShadowMap.value=i.state.spotShadowMap,v.spotShadowMatrix.value=i.state.spotShadowMatrix,v.pointShadowMap.value=i.state.pointShadowMap,v.pointShadowMatrix.value=i.state.pointShadowMatrix);var g=n.program.getUniforms(),y=_i.seqWithValue(g.seq,v);n.uniformsList=y}function ze(e,t,r,n){re=0;var i=w.get(r),a=c.state.lights,o=i.lightsHash,s=a.state.hash;if(be&&(we||e!==K)){var l=e===K&&r.id===Z;xe.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,l)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:(!r.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===i.numClippingPlanes||i.numClippingPlanes===xe.numPlanes&&i.numIntersection===xe.numIntersection)||(r.needsUpdate=!0)),r.needsUpdate&&(Be(r,t,n),r.needsUpdate=!1);var u,h,f=!1,v=!1,g=!1,y=i.program,x=y.getUniforms(),b=i.shader.uniforms;if(m.useProgram(y.program)&&(f=!0,v=!0,g=!0),r.id!==Z&&(Z=r.id,v=!0),f||K!==e){if(x.setValue(d,"projectionMatrix",e.projectionMatrix),p.logarithmicDepthBuffer&&x.setValue(d,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),K!==e&&(K=e,v=!0,g=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var _=x.map.cameraPosition;void 0!==_&&_.setValue(d,Me.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&x.setValue(d,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){x.setOptional(d,n,"bindMatrix"),x.setOptional(d,n,"bindMatrixInverse");var M=n.skeleton;if(M){var E=M.bones;if(p.floatVertexTextures){if(void 0===M.boneTexture){var S=Math.sqrt(4*E.length);S=Kt.ceilPowerOfTwo(S),S=Math.max(S,4);var T=new Float32Array(S*S*4);T.set(M.boneMatrices);var A=new pr(T,S,S,Ke,Ve);A.needsUpdate=!0,M.boneMatrices=T,M.boneTexture=A,M.boneTextureSize=S}x.setValue(d,"boneTexture",M.boneTexture),x.setValue(d,"boneTextureSize",M.boneTextureSize)}else x.setOptional(d,M,"boneMatrices")}}return v&&(x.setValue(d,"toneMappingExposure",H.toneMappingExposure),x.setValue(d,"toneMappingWhitePoint",H.toneMappingWhitePoint),r.lights&&(h=g,(u=b).ambientLightColor.needsUpdate=h,u.directionalLights.needsUpdate=h,u.pointLights.needsUpdate=h,u.spotLights.needsUpdate=h,u.rectAreaLights.needsUpdate=h,u.hemisphereLights.needsUpdate=h),t&&r.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(b,t),r.isMeshBasicMaterial?Ge(b,r):r.isMeshLambertMaterial?(Ge(b,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(b,r)):r.isMeshPhongMaterial?(Ge(b,r),r.isMeshToonMaterial?function(e,t){je(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(b,r):je(b,r)):r.isMeshStandardMaterial?(Ge(b,r),r.isMeshPhysicalMaterial?function(e,t){We(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(b,r):We(b,r)):r.isMeshMatcapMaterial?(Ge(b,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===L&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===L&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(b,r)):r.isMeshDepthMaterial?(Ge(b,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(b,r)):r.isMeshDistanceMaterial?(Ge(b,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(b,r)):r.isMeshNormalMaterial?(Ge(b,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===L&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===L&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(b,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(b,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(b,r)):r.isPointsMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*fe,e.scale.value=.5*de,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(b,r):r.isSpriteMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(b,r):r.isShadowMaterial&&(b.color.value=r.color,b.opacity.value=r.opacity),void 0!==b.ltc_1&&(b.ltc_1.value=Pr.LTC_1),void 0!==b.ltc_2&&(b.ltc_2.value=Pr.LTC_2),_i.upload(d,i.uniformsList,b,H)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(_i.upload(d,i.uniformsList,b,H),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&x.setValue(d,"center",n.center),x.setValue(d,"modelViewMatrix",n.modelViewMatrix),x.setValue(d,"normalMatrix",n.normalMatrix),x.setValue(d,"modelMatrix",n.matrixWorld),y}function Ge(e,t){var r;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=w.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function je(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===L&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===L&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function We(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===L&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===L&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}Ne.setAnimationLoop(function(e){Ae.isPresenting()||Ie&&Ie(e)}),"undefined"!=typeof window&&Ne.setContext(window),this.setAnimationLoop=function(e){Ie=e,Ae.setAnimationLoop(e),Ne.start()},this.render=function(e,t,r,n){if(t&&t.isCamera){if(!W){J.geometry=null,J.program=null,J.wireframe=!1,Z=-1,K=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Ae.enabled&&(t=Ae.getCamera(t)),(c=R.get(e,t)).init(),e.onBeforeRender(H,e,t,r),_e.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ye.setFromMatrix(_e),we=this.localClippingEnabled,be=xe.init(this.clippingPlanes,we,t),(h=C.get(e,t)).init(),function e(t,r,n){if(!1!==t.visible){if(t.layers.test(r.layers))if(t.isLight)c.pushLight(t),t.castShadow&&c.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||ye.intersectsSprite(t)){n&&Me.setFromMatrixPosition(t.matrixWorld).applyMatrix4(_e);var i=S.update(t),a=t.material;h.push(t,i,a,Me.z,null)}}else if(t.isImmediateRenderObject)n&&Me.setFromMatrixPosition(t.matrixWorld).applyMatrix4(_e),h.push(t,null,t.material,Me.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||ye.intersectsObject(t))){n&&Me.setFromMatrixPosition(t.matrixWorld).applyMatrix4(_e);i=S.update(t),a=t.material;if(Array.isArray(a))for(var o=i.groups,s=0,l=o.length;s<l;s++){var u=o[s],d=a[u.materialIndex];d&&d.visible&&h.push(t,i,d,Me.z,u)}else a.visible&&h.push(t,i,a,Me.z,null)}var f=t.children;for(s=0,l=f.length;s<l;s++)e(f[s],r,n)}}(e,t,H.sortObjects),!0===H.sortObjects&&h.sort(),be&&xe.beginShadows();var i=c.state.shadowsArray;Le.render(i,e,t),c.setupLights(t),be&&xe.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),O.render(h,e,t,n);var a=h.opaque,o=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&Fe(a,e,t,s),o.length&&Fe(o,e,t,s)}else a.length&&Fe(a,e,t),o.length&&Fe(o,e,t);r&&_.updateRenderTargetMipmap(r),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),e.onAfterRender(H,e,t),Ae.enabled&&Ae.submitFrame(),h=null,c=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=re;return e>=p.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+p.maxTextures),re+=1,e},this.setTexture2D=(De=!1,function(e,t){e&&e.isWebGLRenderTarget&&(De||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),De=!0),e=e.texture),_.setTexture2D(e,t)}),this.setTexture3D=function(e,t){_.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),_.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?_.setTextureCube(t,r):_.setTextureCubeDynamic(t,r)}}(),this.setFramebuffer=function(e){q=e},this.getRenderTarget=function(){return X},this.setRenderTarget=function(e){X=e,e&&void 0===w.get(e).__webglFramebuffer&&_.setupRenderTarget(e);var t=q,r=!1;if(e){var n=w.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=n[e.activeCubeFace],r=!0):t=n,$.copy(e.viewport),ee.copy(e.scissor),te=e.scissorTest}else $.copy(pe).multiplyScalar(fe),ee.copy(ve).multiplyScalar(fe),te=ge;if(Y!==t&&(d.bindFramebuffer(36160,t),Y=t),m.viewport($),m.scissor(ee),m.setScissorTest(te),r){var i=w.get(e.texture);d.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,n,i,a){if(e&&e.isWebGLRenderTarget){var o=w.get(e).__webglFramebuffer;if(o){var s=!1;o!==Y&&(d.bindFramebuffer(36160,o),s=!0);try{var l=e.texture,u=l.format,h=l.type;if(u!==Ke&&V.convert(u)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===Ue||V.convert(h)===d.getParameter(35738)||h===Ve&&(p.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||h===He&&(p.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===d.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&d.readPixels(t,r,n,i,V.convert(u),V.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&d.bindFramebuffer(36160,Y)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,a=V.convert(t.format);this.setTexture2D(t,0),d.copyTexImage2D(3553,r||0,a,e.x,e.y,n,i,0)},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,a=t.image.height,o=V.convert(r.format),s=V.convert(r.type);this.setTexture2D(r,0),t.isDataTexture?d.texSubImage2D(3553,n||0,e.x,e.y,i,a,o,s,t.image.data):d.texSubImage2D(3553,n||0,e.x,e.y,o,s,t.image)}}function oa(e,t){this.name="",this.color=new Ar(e),this.density=void 0!==t?t:25e-5}function sa(e,t,r){this.name="",this.color=new Ar(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function la(){Gr.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function ua(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ha(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function ca(e){En.call(this),this.type="SpriteMaterial",this.color=new Ar(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function da(e){if(Gr.call(this),this.type="Sprite",void 0===Zi){Zi=new on;var t=new ua(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Zi.setIndex([0,1,2,0,2,3]),Zi.addAttribute("position",new ha(t,3,0,!1)),Zi.addAttribute("uv",new ha(t,2,3,!1))}this.geometry=Zi,this.material=void 0!==e?e:new ca,this.center=new Qt(.5,.5)}function fa(){Gr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function pa(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Pn.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new $t,this.bindMatrixInverse=new $t}function ma(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new $t)}}function va(){Gr.call(this),this.type="Bone"}function ga(e){En.call(this),this.type="LineBasicMaterial",this.color=new Ar(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function ya(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Gr.call(this),this.type="Line",this.geometry=void 0!==e?e:new on,this.material=void 0!==t?t:new ga({color:16777215*Math.random()})}function xa(e,t){ya.call(this,e,t),this.type="LineSegments"}function ba(e,t){ya.call(this,e,t),this.type="LineLoop"}function wa(e){En.call(this),this.type="PointsMaterial",this.color=new Ar(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function _a(e,t){Gr.call(this),this.type="Points",this.geometry=void 0!==e?e:new on,this.material=void 0!==t?t:new wa({color:16777215*Math.random()})}function Ma(e,t,r,n,i,a,o,s,l){hr.call(this,e,t,r,n,i,a,o,s,l),this.format=void 0!==o?o:Je,this.minFilter=void 0!==a?a:Ie,this.magFilter=void 0!==i?i:Ie,this.generateMipmaps=!1}function Ea(e,t,r,n,i,a,o,s,l,u,h,c){hr.call(this,null,a,o,s,l,u,n,i,h,c),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Sa(e,t,r,n,i,a,o,s,l){hr.call(this,e,t,r,n,i,a,o,s,l),this.needsUpdate=!0}function Ta(e,t,r,n,i,a,o,s,l,u){if((u=void 0!==u?u:tt)!==tt&&u!==rt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===tt&&(r=ze),void 0===r&&u===rt&&(r=Ye),hr.call(this,null,n,i,a,o,s,u,r,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:Re,this.minFilter=void 0!==s?s:Re,this.flipY=!1,this.generateMipmaps=!1}function Aa(e){on.call(this),this.type="WireframeGeometry";var t,r,n,i,a,o,s,l,u,h,c=[],d=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(r=0;r<3;r++)s=v[p[r]],l=v[p[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]})}for(u in f)o=f[u],h=e.vertices[o.index1],c.push(h.x,h.y,h.z),h=e.vertices[o.index2],c.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var g,y,x,b,w,_,M;if(h=new tr,null!==e.index){for(g=e.attributes.position,y=e.index,0===(x=e.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,a=x.length;i<a;++i)for(t=w=(b=x[i]).start,n=w+b.count;t<n;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),l=y.getX(t+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]});for(u in f)o=f[u],h.fromBufferAttribute(g,o.index1),c.push(h.x,h.y,h.z),h.fromBufferAttribute(g,o.index2),c.push(h.x,h.y,h.z)}else for(t=0,n=(g=e.attributes.position).count/3;t<n;t++)for(r=0;r<3;r++)_=3*t+r,h.fromBufferAttribute(g,_),c.push(h.x,h.y,h.z),M=3*t+(r+1)%3,h.fromBufferAttribute(g,M),c.push(h.x,h.y,h.z)}this.addAttribute("position",new en(c,3))}function La(e,t,r){Wr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Pa(e,t,r)),this.mergeVertices()}function Pa(e,t,r){on.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,a=[],o=[],s=[],l=[],u=new tr,h=new tr,c=new tr,d=new tr,f=new tr;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var v=i/t;e(v,m,h),o.push(h.x,h.y,h.z),v-1e-5>=0?(e(v-1e-5,m,c),d.subVectors(h,c)):(e(v+1e-5,m,c),d.subVectors(c,h)),m-1e-5>=0?(e(v,m-1e-5,c),f.subVectors(h,c)):(e(v,m+1e-5,c),f.subVectors(c,h)),u.crossVectors(d,f).normalize(),s.push(u.x,u.y,u.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var g=n*p+i,y=n*p+i+1,x=(n+1)*p+i+1,b=(n+1)*p+i;a.push(g,y,b),a.push(y,x,b)}this.setIndex(a),this.addAttribute("position",new en(o,3)),this.addAttribute("normal",new en(s,3)),this.addAttribute("uv",new en(l,2))}function Ca(e,t,r,n){Wr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new Ra(e,t,r,n)),this.mergeVertices()}function Ra(e,t,r,n){on.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],a=[];function o(e,t,r,n){var i,a,o=Math.pow(2,n),l=[];for(i=0;i<=o;i++){l[i]=[];var u=e.clone().lerp(r,i/o),h=t.clone().lerp(r,i/o),c=o-i;for(a=0;a<=c;a++)l[i][a]=0===a&&i===o?u:u.clone().lerp(h,a/c)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var d=Math.floor(a/2);a%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function u(e,t,r,n){n<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){for(var r=new tr,n=new tr,i=new tr,a=0;a<t.length;a+=3)l(t[a+0],r),l(t[a+1],n),l(t[a+2],i),o(r,n,i,e)}(n=n||0),function(e){for(var t=new tr,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new tr,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=h(e)/2/Math.PI+.5,n=(o=e,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-n)}var o;(function(){for(var e=new tr,t=new tr,r=new tr,n=new tr,o=new Qt,s=new Qt,l=new Qt,c=0,d=0;c<i.length;c+=9,d+=6){e.set(i[c+0],i[c+1],i[c+2]),t.set(i[c+3],i[c+4],i[c+5]),r.set(i[c+6],i[c+7],i[c+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),n.copy(e).add(t).add(r).divideScalar(3);var f=h(n);u(o,d+0,e,f),u(s,d+2,t,f),u(l,d+4,r,f)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],r=a[e+2],n=a[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.addAttribute("position",new en(i,3)),this.addAttribute("normal",new en(i.slice(),3)),this.addAttribute("uv",new en(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Oa(e,t){Wr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Da(e,t)),this.mergeVertices()}function Da(e,t){Ra.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ia(e,t){Wr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Na(e,t)),this.mergeVertices()}function Na(e,t){Ra.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Fa(e,t){Wr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ua(e,t)),this.mergeVertices()}function Ua(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Ra.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ka(e,t){Wr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ba(e,t)),this.mergeVertices()}function Ba(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];Ra.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function za(e,t,r,n,i,a){Wr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new Ga(e,t,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function Ga(e,t,r,n,i){on.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new tr,u=new tr,h=new Qt,c=new tr,d=[],f=[],p=[],m=[];function v(i){c=e.getPointAt(i/t,c);var o=a.normals[i],h=a.binormals[i];for(s=0;s<=n;s++){var p=s/n*Math.PI*2,m=Math.sin(p),v=-Math.cos(p);u.x=v*o.x+m*h.x,u.y=v*o.y+m*h.y,u.z=v*o.z+m*h.z,u.normalize(),f.push(u.x,u.y,u.z),l.x=c.x+r*u.x,l.y=c.y+r*u.y,l.z=c.z+r*u.z,d.push(l.x,l.y,l.z)}}!function(){for(o=0;o<t;o++)v(o);v(!1===i?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=n;s++)h.x=o/t,h.y=s/n,p.push(h.x,h.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=n;o++){var e=(n+1)*(s-1)+(o-1),r=(n+1)*s+(o-1),i=(n+1)*s+o,a=(n+1)*(s-1)+o;m.push(e,r,a),m.push(r,i,a)}}()}(),this.setIndex(m),this.addAttribute("position",new en(d,3)),this.addAttribute("normal",new en(f,3)),this.addAttribute("uv",new en(p,2))}function ja(e,t,r,n,i,a,o){Wr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Va(e,t,r,n,i,a)),this.mergeVertices()}function Va(e,t,r,n,i,a){on.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,l=[],u=[],h=[],c=[],d=new tr,f=new tr,p=new tr,m=new tr,v=new tr,g=new tr,y=new tr;for(o=0;o<=r;++o){var x=o/r*i*Math.PI*2;for(A(x,i,a,e,p),A(x+.01,i,a,e,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,w=-t*Math.cos(b),_=t*Math.sin(b);d.x=p.x+(w*y.x+_*v.x),d.y=p.y+(w*y.y+_*v.y),d.z=p.z+(w*y.z+_*v.z),u.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),h.push(f.x,f.y,f.z),c.push(o/r),c.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var M=(n+1)*(s-1)+(o-1),E=(n+1)*s+(o-1),S=(n+1)*s+o,T=(n+1)*(s-1)+o;l.push(M,E,T),l.push(E,S,T)}function A(e,t,r,n,i){var a=Math.cos(e),o=Math.sin(e),s=r/t*e,l=Math.cos(s);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new en(u,3)),this.addAttribute("normal",new en(h,3)),this.addAttribute("uv",new en(c,2))}function Ha(e,t,r,n,i){Wr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Wa(e,t,r,n,i)),this.mergeVertices()}function Wa(e,t,r,n,i){on.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],l=[],u=[],h=[],c=new tr,d=new tr,f=new tr;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var p=o/n*i,m=a/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(p),d.y=(e+t*Math.cos(m))*Math.sin(p),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),f.subVectors(d,c).normalize(),u.push(f.x,f.y,f.z),h.push(o/n),h.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var v=(n+1)*a+o-1,g=(n+1)*(a-1)+o-1,y=(n+1)*(a-1)+o,x=(n+1)*a+o;s.push(v,g,x),s.push(g,y,x)}this.setIndex(s),this.addAttribute("position",new en(l,3)),this.addAttribute("normal",new en(u,3)),this.addAttribute("uv",new en(h,2))}oa.prototype.isFogExp2=!0,oa.prototype.clone=function(){return new oa(this.color,this.density)},oa.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},sa.prototype.isFog=!0,sa.prototype.clone=function(){return new sa(this.color,this.near,this.far)},sa.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},la.prototype=Object.assign(Object.create(Gr.prototype),{constructor:la,copy:function(e,t){return Gr.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Gr.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(ua.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ua.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(ha.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(ha.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),ca.prototype=Object.create(En.prototype),ca.prototype.constructor=ca,ca.prototype.isSpriteMaterial=!0,ca.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},da.prototype=Object.assign(Object.create(Gr.prototype),{constructor:da,isSprite:!0,raycast:function(){var e=new tr,t=new tr,r=new tr,n=new Qt,i=new Qt,a=new $t,o=new tr,s=new tr,l=new tr,u=new Qt,h=new Qt,c=new Qt;function d(e,t,r,o,s,l){n.subVectors(e,r).addScalar(.5).multiply(o),void 0!==s?(i.x=l*n.x-s*n.y,i.y=s*n.x+l*n.y):i.copy(n),e.copy(t),e.x+=i.x,e.y+=i.y,e.applyMatrix4(a)}return function(n,i){t.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix);var f,p,m=this.material.rotation;0!==m&&(p=Math.cos(m),f=Math.sin(m));var v=this.center;d(o.set(-.5,-.5,0),r,v,t,f,p),d(s.set(.5,-.5,0),r,v,t,f,p),d(l.set(.5,.5,0),r,v,t,f,p),u.set(0,0),h.set(1,0),c.set(1,1);var g=n.ray.intersectTriangle(o,s,l,!1,e);if(null!==g||(d(s.set(-.5,.5,0),r,v,t,f,p),h.set(0,1),null!==(g=n.ray.intersectTriangle(o,l,s,!1,e)))){var y=n.ray.origin.distanceTo(e);y<n.near||y>n.far||i.push({distance:y,point:e.clone(),uv:An.getUV(e,o,s,l,u,h,c,new Qt),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Gr.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),fa.prototype=Object.assign(Object.create(Gr.prototype),{constructor:fa,copy:function(e){Gr.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);r.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:(Ji=new tr,function(e,t){Ji.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(Ji);this.getObjectForDistance(r).raycast(e,t)}),update:function(){var e=new tr,t=new tr;return function(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);n[0].object.visible=!0;for(var a=1,o=n.length;a<o&&i>=n[a].distance;a++)n[a-1].object.visible=!1,n[a].object.visible=!0;for(;a<o;a++)n[a].object.visible=!1}}}(),toJSON:function(e){var t=Gr.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),pa.prototype=Object.assign(Object.create(Pn.prototype),{constructor:pa,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new cr,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Pn.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(ma.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new $t;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(Ki=new $t,Qi=new $t,function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:Qi;Ki.multiplyMatrices(o,t[i]),Ki.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new ma(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),va.prototype=Object.assign(Object.create(Gr.prototype),{constructor:va,isBone:!0}),ga.prototype=Object.create(En.prototype),ga.prototype.constructor=ga,ga.prototype.isLineBasicMaterial=!0,ga.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},ya.prototype=Object.assign(Object.create(Gr.prototype),{constructor:ya,isLine:!0,computeLineDistances:($i=new tr,ea=new tr,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)$i.fromBufferAttribute(t,n-1),ea.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=$i.distanceTo(ea);e.addAttribute("lineDistance",new en(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;for((r=e.lineDistances)[0]=0,n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this}),raycast:function(){var e=new $t,t=new Tn,r=new vr;return function(n,i){var a=n.linePrecision,o=this.geometry,s=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=a,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,h=new tr,c=new tr,d=new tr,f=new tr,p=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,v=o.attributes.position.array;if(null!==m)for(var g=m.array,y=0,x=g.length-1;y<x;y+=p){var b=g[y],w=g[y+1];h.fromArray(v,3*b),c.fromArray(v,3*w),t.distanceSqToSegment(h,c,f,d)>u||(f.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(f))<n.near||E>n.far||i.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this}))}else for(y=0,x=v.length/3-1;y<x;y+=p)h.fromArray(v,3*y),c.fromArray(v,3*y+3),t.distanceSqToSegment(h,c,f,d)>u||(f.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(f))<n.near||E>n.far||i.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this}))}else if(o.isGeometry){var _=o.vertices,M=_.length;for(y=0;y<M-1;y+=p){var E;t.distanceSqToSegment(_[y],_[y+1],f,d)>u||(f.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(f))<n.near||E>n.far||i.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this}))}}}}}(),copy:function(e){return Gr.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),xa.prototype=Object.assign(Object.create(ya.prototype),{constructor:xa,isLineSegments:!0,computeLineDistances:function(){var e=new tr,t=new tr;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],a=0,o=n.count;a<o;a+=2)e.fromBufferAttribute(n,a),t.fromBufferAttribute(n,a+1),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t);r.addAttribute("lineDistance",new en(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(i=r.lineDistances,a=0,o=s.length;a<o;a+=2)e.copy(s[a]),t.copy(s[a+1]),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t)}return this}}()}),ba.prototype=Object.assign(Object.create(ya.prototype),{constructor:ba,isLineLoop:!0}),wa.prototype=Object.create(En.prototype),wa.prototype.constructor=wa,wa.prototype.isPointsMaterial=!0,wa.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},_a.prototype=Object.assign(Object.create(Gr.prototype),{constructor:_a,isPoints:!0,raycast:function(){var e=new $t,t=new Tn,r=new vr;return function(n,i){var a=this,o=this.geometry,s=this.matrixWorld,l=n.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var u=l/((this.scale.x+this.scale.y+this.scale.z)/3),h=u*u,c=new tr,d=new tr;if(o.isBufferGeometry){var f=o.index,p=o.attributes.position.array;if(null!==f)for(var m=f.array,v=0,g=m.length;v<g;v++){var y=m[v];c.fromArray(p,3*y),w(c,y)}else{v=0;for(var x=p.length/3;v<x;v++)c.fromArray(p,3*v),w(c,v)}}else{var b=o.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(e,r){var o=t.distanceSqToPoint(e);if(o<h){t.closestPointToPoint(e,d),d.applyMatrix4(s);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(o),point:d.clone(),index:r,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ma.prototype=Object.assign(Object.create(hr.prototype),{constructor:Ma,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ea.prototype=Object.create(hr.prototype),Ea.prototype.constructor=Ea,Ea.prototype.isCompressedTexture=!0,Sa.prototype=Object.create(hr.prototype),Sa.prototype.constructor=Sa,Sa.prototype.isCanvasTexture=!0,Ta.prototype=Object.create(hr.prototype),Ta.prototype.constructor=Ta,Ta.prototype.isDepthTexture=!0,Aa.prototype=Object.create(on.prototype),Aa.prototype.constructor=Aa,La.prototype=Object.create(Wr.prototype),La.prototype.constructor=La,Pa.prototype=Object.create(on.prototype),Pa.prototype.constructor=Pa,Ca.prototype=Object.create(Wr.prototype),Ca.prototype.constructor=Ca,Ra.prototype=Object.create(on.prototype),Ra.prototype.constructor=Ra,Oa.prototype=Object.create(Wr.prototype),Oa.prototype.constructor=Oa,Da.prototype=Object.create(Ra.prototype),Da.prototype.constructor=Da,Ia.prototype=Object.create(Wr.prototype),Ia.prototype.constructor=Ia,Na.prototype=Object.create(Ra.prototype),Na.prototype.constructor=Na,Fa.prototype=Object.create(Wr.prototype),Fa.prototype.constructor=Fa,Ua.prototype=Object.create(Ra.prototype),Ua.prototype.constructor=Ua,ka.prototype=Object.create(Wr.prototype),ka.prototype.constructor=ka,Ba.prototype=Object.create(Ra.prototype),Ba.prototype.constructor=Ba,za.prototype=Object.create(Wr.prototype),za.prototype.constructor=za,Ga.prototype=Object.create(on.prototype),Ga.prototype.constructor=Ga,ja.prototype=Object.create(Wr.prototype),ja.prototype.constructor=ja,Va.prototype=Object.create(on.prototype),Va.prototype.constructor=Va,Ha.prototype=Object.create(Wr.prototype),Ha.prototype.constructor=Ha,Wa.prototype=Object.create(on.prototype),Wa.prototype.constructor=Wa;function qa(e,t,r,n,i){var a,o;if(i===function(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)o=ho(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=ho(a,e[a],e[a+1],o);return o&&oo(o,o.next)&&(co(o),o=o.next),o}function Xa(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!oo(n,n.next)&&0!==ao(n.prev,n,n.next))n=n.next;else{if(co(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function Ya(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=to(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(e,n,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?Ja(e,n,i,a):Za(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),co(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?Ya(e=Ka(e,t,r),t,r,n,i,a,2):2===o&&Qa(e,t,r,n,i,a):Ya(Xa(e),t,r,n,i,a,1);break}}}function Za(e){var t=e.prev,r=e,n=e.next;if(ao(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(no(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&ao(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ja(e,t,r,n){var i=e.prev,a=e,o=e.next;if(ao(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,h=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=to(s,l,t,r,n),d=to(u,h,t,r,n),f=e.nextZ;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&no(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&ao(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=c;){if(f!==e.prev&&f!==e.next&&no(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&ao(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function Ka(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!oo(i,a)&&so(i,n,n.next,a)&&lo(i,a)&&lo(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),co(n),co(n.next),n=e=a),n=n.next}while(n!==e);return n}function Qa(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&io(o,s)){var l=uo(o,s);return o=Xa(o,o.next),l=Xa(l,l.next),Ya(o,t,r,n,i,a),void Ya(l,t,r,n,i,a)}s=s.next}o=o.next}while(o!==e)}function $a(e,t){return e.x-t.x}function eo(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,u=r,h=r.x,c=r.y,d=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=h&&i!==n.x&&no(a<c?i:o,a,h,c,a<c?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&lo(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=uo(t,e);Xa(r,r.next)}}function to(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ro(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function no(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function io(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&so(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&lo(e,t)&&lo(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function ao(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function oo(e,t){return e.x===t.x&&e.y===t.y}function so(e,t,r,n){return!!(oo(e,t)&&oo(r,n)||oo(e,n)&&oo(r,t))||ao(e,t,r)>0!=ao(e,t,n)>0&&ao(r,n,e)>0!=ao(r,n,t)>0}function lo(e,t){return ao(e.prev,e,e.next)<0?ao(e,t,e.next)>=0&&ao(e,e.prev,t)>=0:ao(e,t,e.prev)<0||ao(e,e.next,t)<0}function uo(e,t){var r=new fo(e.i,e.x,e.y),n=new fo(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function ho(e,t,r,n){var i=new fo(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function co(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fo(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var po={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return po.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];mo(e),vo(r,e);var a=e.length;t.forEach(mo);for(var o=0;o<t.length;o++)n.push(a),a+=t[o].length,vo(r,t[o]);var s=function(e,t,r){r=r||2;var n,i,a,o,s,l,u,h=t&&t.length,c=h?t[0]*r:e.length,d=qa(e,0,c,r,!0),f=[];if(!d)return f;if(h&&(d=function(e,t,r,n){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=qa(e,t[i]*n,i<a-1?t[i+1]*n:e.length,n,!1))===o.next&&(o.steiner=!0),s.push(ro(o));for(s.sort($a),i=0;i<s.length;i++)eo(s[i],r),r=Xa(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var p=r;p<c;p+=r)(s=e[p])<n&&(n=s),(l=e[p+1])<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-n,o-i))?1/u:0}return Ya(d,f,r,n,i,u),f}(r,n);for(o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function mo(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function vo(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function go(e,t){Wr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new yo(e,t)),this.mergeVertices()}function yo(e,t){on.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var r=this,n=[],i=[],a=0,o=(e=Array.isArray(e)?e:[e]).length;a<o;a++)s(e[a]);function s(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,c=void 0!==t.bevelSize?t.bevelSize:h-2,d=void 0!==t.bevelSegments?t.bevelSegments:3,f=t.extrudePath,p=void 0!==t.UVGenerator?t.UVGenerator:xo;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var m,v,g,y,x,b,w,_,M=!1;f&&(m=f.getSpacedPoints(s),M=!0,u=!1,v=f.computeFrenetFrames(s,!1),g=new tr,y=new tr,x=new tr),u||(d=0,h=0,c=0);var E=e.extractPoints(o),S=E.shape,T=E.holes;if(!po.isClockWise(S))for(S=S.reverse(),w=0,_=T.length;w<_;w++)b=T[w],po.isClockWise(b)&&(T[w]=b.reverse());var A=po.triangulateShape(S,T),L=S;for(w=0,_=T.length;w<_;w++)b=T[w],S=S.concat(b);function P(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var C,R,O,D,I,N,F=S.length,U=A.length;function k(e,t,r){var n,i,a,o=e.x-t.x,s=e.y-t.y,l=r.x-e.x,u=r.y-e.y,h=o*o+s*s,c=o*u-s*l;if(Math.abs(c)>Number.EPSILON){var d=Math.sqrt(h),f=Math.sqrt(l*l+u*u),p=t.x-s/d,m=t.y+o/d,v=((r.x-u/f-p)*u-(r.y+l/f-m)*l)/(o*u-s*l),g=(n=p+o*v-e.x)*n+(i=m+s*v-e.y)*i;if(g<=2)return new Qt(n,i);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?l>Number.EPSILON&&(y=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(n=-s,i=o,a=Math.sqrt(h)):(n=o,i=s,a=Math.sqrt(h/2))}return new Qt(n/a,i/a)}for(var B=[],z=0,G=L.length,j=G-1,V=z+1;z<G;z++,j++,V++)j===G&&(j=0),V===G&&(V=0),B[z]=k(L[z],L[j],L[V]);var H,W,q=[],X=B.concat();for(w=0,_=T.length;w<_;w++){for(b=T[w],H=[],z=0,j=(G=b.length)-1,V=z+1;z<G;z++,j++,V++)j===G&&(j=0),V===G&&(V=0),H[z]=k(b[z],b[j],b[V]);q.push(H),X=X.concat(H)}for(C=0;C<d;C++){for(O=C/d,D=h*Math.cos(O*Math.PI/2),R=c*Math.sin(O*Math.PI/2),z=0,G=L.length;z<G;z++)Z((I=P(L[z],B[z],R)).x,I.y,-D);for(w=0,_=T.length;w<_;w++)for(b=T[w],H=q[w],z=0,G=b.length;z<G;z++)Z((I=P(b[z],H[z],R)).x,I.y,-D)}for(R=c,z=0;z<F;z++)I=u?P(S[z],X[z],R):S[z],M?(y.copy(v.normals[0]).multiplyScalar(I.x),g.copy(v.binormals[0]).multiplyScalar(I.y),x.copy(m[0]).add(y).add(g),Z(x.x,x.y,x.z)):Z(I.x,I.y,0);for(W=1;W<=s;W++)for(z=0;z<F;z++)I=u?P(S[z],X[z],R):S[z],M?(y.copy(v.normals[W]).multiplyScalar(I.x),g.copy(v.binormals[W]).multiplyScalar(I.y),x.copy(m[W]).add(y).add(g),Z(x.x,x.y,x.z)):Z(I.x,I.y,l/s*W);for(C=d-1;C>=0;C--){for(O=C/d,D=h*Math.cos(O*Math.PI/2),R=c*Math.sin(O*Math.PI/2),z=0,G=L.length;z<G;z++)Z((I=P(L[z],B[z],R)).x,I.y,l+D);for(w=0,_=T.length;w<_;w++)for(b=T[w],H=q[w],z=0,G=b.length;z<G;z++)I=P(b[z],H[z],R),M?Z(I.x,I.y+m[s-1].y,m[s-1].x+D):Z(I.x,I.y,l+D)}function Y(e,t){var r,n;for(z=e.length;--z>=0;){r=z,(n=z-1)<0&&(n=e.length-1);var i=0,a=s+2*d;for(i=0;i<a;i++){var o=F*i,l=F*(i+1);K(t+r+o,t+n+o,t+n+l,t+r+l)}}}function Z(e,t,r){a.push(e),a.push(t),a.push(r)}function J(e,t,i){Q(e),Q(t),Q(i);var a=n.length/3,o=p.generateTopUV(r,n,a-3,a-2,a-1);$(o[0]),$(o[1]),$(o[2])}function K(e,t,i,a){Q(e),Q(t),Q(a),Q(t),Q(i),Q(a);var o=n.length/3,s=p.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);$(s[0]),$(s[1]),$(s[3]),$(s[1]),$(s[2]),$(s[3])}function Q(e){n.push(a[3*e+0]),n.push(a[3*e+1]),n.push(a[3*e+2])}function $(e){i.push(e.x),i.push(e.y)}!function(){var e=n.length/3;if(u){var t=0,i=F*t;for(z=0;z<U;z++)J((N=A[z])[2]+i,N[1]+i,N[0]+i);for(i=F*(t=s+2*d),z=0;z<U;z++)J((N=A[z])[0]+i,N[1]+i,N[2]+i)}else{for(z=0;z<U;z++)J((N=A[z])[2],N[1],N[0]);for(z=0;z<U;z++)J((N=A[z])[0]+F*s,N[1]+F*s,N[2]+F*s)}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(Y(L,t),t+=L.length,w=0,_=T.length;w<_;w++)Y(b=T[w],t),t+=b.length;r.addGroup(e,n.length/3-e,1)}()}this.addAttribute("position",new en(n,3)),this.addAttribute("uv",new en(i,2)),this.computeVertexNormals()}go.prototype=Object.create(Wr.prototype),go.prototype.constructor=go,go.prototype.toJSON=function(){var e=Wr.prototype.toJSON.call(this);return bo(this.parameters.shapes,this.parameters.options,e)},yo.prototype=Object.create(on.prototype),yo.prototype.constructor=yo,yo.prototype.toJSON=function(){var e=on.prototype.toJSON.call(this);return bo(this.parameters.shapes,this.parameters.options,e)};var xo={generateTopUV:function(e,t,r,n,i){var a=t[3*r],o=t[3*r+1],s=t[3*n],l=t[3*n+1],u=t[3*i],h=t[3*i+1];return[new Qt(a,o),new Qt(s,l),new Qt(u,h)]},generateSideWallUV:function(e,t,r,n,i,a){var o=t[3*r],s=t[3*r+1],l=t[3*r+2],u=t[3*n],h=t[3*n+1],c=t[3*n+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-h)<.01?[new Qt(o,1-l),new Qt(u,1-c),new Qt(d,1-p),new Qt(m,1-g)]:[new Qt(s,1-l),new Qt(h,1-c),new Qt(f,1-p),new Qt(v,1-g)]}};function bo(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var a=e[n];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function wo(e,t){Wr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new _o(e,t)),this.mergeVertices()}function _o(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Wr;var n=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),yo.call(this,n,t),this.type="TextBufferGeometry"}function Mo(e,t,r,n,i,a,o){Wr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Eo(e,t,r,n,i,a,o)),this.mergeVertices()}function Eo(e,t,r,n,i,a,o){on.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var s,l,u=(a=void 0!==a?a:0)+(o=void 0!==o?o:Math.PI),h=0,c=[],d=new tr,f=new tr,p=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(s=0;s<=t;s++){var b=s/t;d.x=-e*Math.cos(n+b*i)*Math.sin(a+x*o),d.y=e*Math.cos(a+x*o),d.z=e*Math.sin(n+b*i)*Math.sin(a+x*o),m.push(d.x,d.y,d.z),f.set(d.x,d.y,d.z).normalize(),v.push(f.x,f.y,f.z),g.push(b,1-x),y.push(h++)}c.push(y)}for(l=0;l<r;l++)for(s=0;s<t;s++){var w=c[l][s+1],_=c[l][s],M=c[l+1][s],E=c[l+1][s+1];(0!==l||a>0)&&p.push(w,_,E),(l!==r-1||u<Math.PI)&&p.push(_,M,E)}this.setIndex(p),this.addAttribute("position",new en(m,3)),this.addAttribute("normal",new en(v,3)),this.addAttribute("uv",new en(g,2))}function So(e,t,r,n,i,a){Wr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new To(e,t,r,n,i,a)),this.mergeVertices()}function To(e,t,r,n,i,a){on.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l,u=[],h=[],c=[],d=[],f=e,p=(t-e)/(n=void 0!==n?Math.max(1,n):1),m=new tr,v=new Qt;for(s=0;s<=n;s++){for(l=0;l<=r;l++)o=i+l/r*a,m.x=f*Math.cos(o),m.y=f*Math.sin(o),h.push(m.x,m.y,m.z),c.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);f+=p}for(s=0;s<n;s++){var g=s*(r+1);for(l=0;l<r;l++){var y=o=l+g,x=o+r+1,b=o+r+2,w=o+1;u.push(y,x,w),u.push(x,b,w)}}this.setIndex(u),this.addAttribute("position",new en(h,3)),this.addAttribute("normal",new en(c,3)),this.addAttribute("uv",new en(d,2))}function Ao(e,t,r,n){Wr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new Lo(e,t,r,n)),this.mergeVertices()}function Lo(e,t,r,n){on.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=Kt.clamp(n,0,2*Math.PI);var i,a,o,s=[],l=[],u=[],h=1/t,c=new tr,d=new Qt;for(a=0;a<=t;a++){var f=r+a*h*n,p=Math.sin(f),m=Math.cos(f);for(o=0;o<=e.length-1;o++)c.x=e[o].x*p,c.y=e[o].y,c.z=e[o].x*m,l.push(c.x,c.y,c.z),d.x=a/t,d.y=o/(e.length-1),u.push(d.x,d.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var v=i=o+a*e.length,g=i+e.length,y=i+e.length+1,x=i+1;s.push(v,g,x),s.push(g,y,x)}if(this.setIndex(s),this.addAttribute("position",new en(l,3)),this.addAttribute("uv",new en(u,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,w=new tr,_=new tr,M=new tr;for(i=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)w.x=b[o+0],w.y=b[o+1],w.z=b[o+2],_.x=b[i+o+0],_.y=b[i+o+1],_.z=b[i+o+2],M.addVectors(w,_).normalize(),b[o+0]=b[i+o+0]=M.x,b[o+1]=b[i+o+1]=M.y,b[o+2]=b[i+o+2]=M.z}}function Po(e,t){Wr.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Co(e,t)),this.mergeVertices()}function Co(e,t){on.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(o,s,l),o+=s,s=0;function u(e){var o,l,u,h=n.length/3,c=e.extractPoints(t),d=c.shape,f=c.holes;if(!1===po.isClockWise(d))for(d=d.reverse(),o=0,l=f.length;o<l;o++)u=f[o],!0===po.isClockWise(u)&&(f[o]=u.reverse());var p=po.triangulateShape(d,f);for(o=0,l=f.length;o<l;o++)u=f[o],d=d.concat(u);for(o=0,l=d.length;o<l;o++){var m=d[o];n.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=p.length;o<l;o++){var v=p[o],g=v[0]+h,y=v[1]+h,x=v[2]+h;r.push(g,y,x),s+=3}}this.setIndex(r),this.addAttribute("position",new en(n,3)),this.addAttribute("normal",new en(i,3)),this.addAttribute("uv",new en(a,2))}function Ro(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function Oo(e,t){on.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,a,o=[],s=Math.cos(Kt.DEG2RAD*t),l=[0,0],u={},h=["a","b","c"];e.isBufferGeometry?(a=new Wr).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var c=a.vertices,d=a.faces,f=0,p=d.length;f<p;f++)for(var m=d[f],v=0;v<3;v++)r=m[h[v]],n=m[h[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===u[i=l[0]+","+l[1]]?u[i]={index1:l[0],index2:l[1],face1:f,face2:void 0}:u[i].face2=f;for(i in u){var g=u[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=c[g.index1];o.push(y.x,y.y,y.z),y=c[g.index2],o.push(y.x,y.y,y.z)}}this.addAttribute("position",new en(o,3))}function Do(e,t,r,n,i,a,o,s){Wr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Io(e,t,r,n,i,a,o,s)),this.mergeVertices()}function Io(e,t,r,n,i,a,o,s){on.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var u=[],h=[],c=[],d=[],f=0,p=[],m=r/2,v=0;function g(r){var i,a,p,g=new Qt,y=new tr,x=0,b=!0===r?e:t,w=!0===r?1:-1;for(a=f,i=1;i<=n;i++)h.push(0,m*w,0),c.push(0,w,0),d.push(.5,.5),f++;for(p=f,i=0;i<=n;i++){var _=i/n*s+o,M=Math.cos(_),E=Math.sin(_);y.x=b*E,y.y=m*w,y.z=b*M,h.push(y.x,y.y,y.z),c.push(0,w,0),g.x=.5*M+.5,g.y=.5*E*w+.5,d.push(g.x,g.y),f++}for(i=0;i<n;i++){var S=a+i,T=p+i;!0===r?u.push(T,T+1,S):u.push(T+1,T,S),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var a,g,y=new tr,x=new tr,b=0,w=(t-e)/r;for(g=0;g<=i;g++){var _=[],M=g/i,E=M*(t-e)+e;for(a=0;a<=n;a++){var S=a/n,T=S*s+o,A=Math.sin(T),L=Math.cos(T);x.x=E*A,x.y=-M*r+m,x.z=E*L,h.push(x.x,x.y,x.z),y.set(A,w,L).normalize(),c.push(y.x,y.y,y.z),d.push(S,1-M),_.push(f++)}p.push(_)}for(a=0;a<n;a++)for(g=0;g<i;g++){var P=p[g][a],C=p[g+1][a],R=p[g+1][a+1],O=p[g][a+1];u.push(P,C,O),u.push(C,R,O),b+=6}l.addGroup(v,b,0),v+=b}(),!1===a&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(u),this.addAttribute("position",new en(h,3)),this.addAttribute("normal",new en(c,3)),this.addAttribute("uv",new en(d,2))}function No(e,t,r,n,i,a,o){Do.call(this,0,e,t,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function Fo(e,t,r,n,i,a,o){Io.call(this,0,e,t,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function Uo(e,t,r,n){Wr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new ko(e,t,r,n)),this.mergeVertices()}function ko(e,t,r,n){on.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,a,o=[],s=[],l=[],u=[],h=new tr,c=new Qt;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var d=r+a/t*n;h.x=e*Math.cos(d),h.y=e*Math.sin(d),s.push(h.x,h.y,h.z),l.push(0,0,1),c.x=(s[i]/e+1)/2,c.y=(s[i+1]/e+1)/2,u.push(c.x,c.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.addAttribute("position",new en(s,3)),this.addAttribute("normal",new en(l,3)),this.addAttribute("uv",new en(u,2))}wo.prototype=Object.create(Wr.prototype),wo.prototype.constructor=wo,_o.prototype=Object.create(yo.prototype),_o.prototype.constructor=_o,Mo.prototype=Object.create(Wr.prototype),Mo.prototype.constructor=Mo,Eo.prototype=Object.create(on.prototype),Eo.prototype.constructor=Eo,So.prototype=Object.create(Wr.prototype),So.prototype.constructor=So,To.prototype=Object.create(on.prototype),To.prototype.constructor=To,Ao.prototype=Object.create(Wr.prototype),Ao.prototype.constructor=Ao,Lo.prototype=Object.create(on.prototype),Lo.prototype.constructor=Lo,Po.prototype=Object.create(Wr.prototype),Po.prototype.constructor=Po,Po.prototype.toJSON=function(){var e=Wr.prototype.toJSON.call(this);return Ro(this.parameters.shapes,e)},Co.prototype=Object.create(on.prototype),Co.prototype.constructor=Co,Co.prototype.toJSON=function(){var e=on.prototype.toJSON.call(this);return Ro(this.parameters.shapes,e)},Oo.prototype=Object.create(on.prototype),Oo.prototype.constructor=Oo,Do.prototype=Object.create(Wr.prototype),Do.prototype.constructor=Do,Io.prototype=Object.create(on.prototype),Io.prototype.constructor=Io,No.prototype=Object.create(Do.prototype),No.prototype.constructor=No,Fo.prototype=Object.create(Io.prototype),Fo.prototype.constructor=Fo,Uo.prototype=Object.create(Wr.prototype),Uo.prototype.constructor=Uo,ko.prototype=Object.create(on.prototype),ko.prototype.constructor=ko;var Bo=Object.freeze({WireframeGeometry:Aa,ParametricGeometry:La,ParametricBufferGeometry:Pa,TetrahedronGeometry:Oa,TetrahedronBufferGeometry:Da,OctahedronGeometry:Ia,OctahedronBufferGeometry:Na,IcosahedronGeometry:Fa,IcosahedronBufferGeometry:Ua,DodecahedronGeometry:ka,DodecahedronBufferGeometry:Ba,PolyhedronGeometry:Ca,PolyhedronBufferGeometry:Ra,TubeGeometry:za,TubeBufferGeometry:Ga,TorusKnotGeometry:ja,TorusKnotBufferGeometry:Va,TorusGeometry:Ha,TorusBufferGeometry:Wa,TextGeometry:wo,TextBufferGeometry:_o,SphereGeometry:Mo,SphereBufferGeometry:Eo,RingGeometry:So,RingBufferGeometry:To,PlaneGeometry:un,PlaneBufferGeometry:hn,LatheGeometry:Ao,LatheBufferGeometry:Lo,ShapeGeometry:Po,ShapeBufferGeometry:Co,ExtrudeGeometry:go,ExtrudeBufferGeometry:yo,EdgesGeometry:Oo,ConeGeometry:No,ConeBufferGeometry:Fo,CylinderGeometry:Do,CylinderBufferGeometry:Io,CircleGeometry:Uo,CircleBufferGeometry:ko,BoxGeometry:sn,BoxBufferGeometry:ln});function zo(e){En.call(this),this.type="ShadowMaterial",this.color=new Ar(0),this.transparent=!0,this.setValues(e)}function Go(e){Sn.call(this,e),this.type="RawShaderMaterial"}function jo(e){En.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ar(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zt,this.normalScale=new Qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Vo(e){jo.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Ho(e){En.call(this),this.type="MeshPhongMaterial",this.color=new Ar(16777215),this.specular=new Ar(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zt,this.normalScale=new Qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Wo(e){Ho.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function qo(e){En.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zt,this.normalScale=new Qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Xo(e){En.call(this),this.type="MeshLambertMaterial",this.color=new Ar(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Yo(e){En.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ar(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zt,this.normalScale=new Qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function Zo(e){ga.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}zo.prototype=Object.create(En.prototype),zo.prototype.constructor=zo,zo.prototype.isShadowMaterial=!0,zo.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this},Go.prototype=Object.create(Sn.prototype),Go.prototype.constructor=Go,Go.prototype.isRawShaderMaterial=!0,jo.prototype=Object.create(En.prototype),jo.prototype.constructor=jo,jo.prototype.isMeshStandardMaterial=!0,jo.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Vo.prototype=Object.create(jo.prototype),Vo.prototype.constructor=Vo,Vo.prototype.isMeshPhysicalMaterial=!0,Vo.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Ho.prototype=Object.create(En.prototype),Ho.prototype.constructor=Ho,Ho.prototype.isMeshPhongMaterial=!0,Ho.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Wo.prototype=Object.create(Ho.prototype),Wo.prototype.constructor=Wo,Wo.prototype.isMeshToonMaterial=!0,Wo.prototype.copy=function(e){return Ho.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},qo.prototype=Object.create(En.prototype),qo.prototype.constructor=qo,qo.prototype.isMeshNormalMaterial=!0,qo.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Xo.prototype=Object.create(En.prototype),Xo.prototype.constructor=Xo,Xo.prototype.isMeshLambertMaterial=!0,Xo.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Yo.prototype=Object.create(En.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isMeshMatcapMaterial=!0,Yo.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Zo.prototype=Object.create(ga.prototype),Zo.prototype.constructor=Zo,Zo.prototype.isLineDashedMaterial=!0,Zo.prototype.copy=function(e){return ga.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Jo=Object.freeze({ShadowMaterial:zo,SpriteMaterial:ca,RawShaderMaterial:Go,ShaderMaterial:Sn,PointsMaterial:wa,MeshPhysicalMaterial:Vo,MeshStandardMaterial:jo,MeshPhongMaterial:Ho,MeshToonMaterial:Wo,MeshNormalMaterial:qo,MeshLambertMaterial:Xo,MeshDepthMaterial:zi,MeshDistanceMaterial:Gi,MeshBasicMaterial:Ln,MeshMatcapMaterial:Yo,LineDashedMaterial:Zo,LineBasicMaterial:ga,Material:En}),Ko={arraySlice:function(e,t,r){return Ko.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,a=e[0];void 0!==a&&void 0===a[n];)a=e[i++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[n])&&(t.push(a.time),r.push.apply(r,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[n])&&(t.push(a.time),o.toArray(r,r.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[n])&&(t.push(a.time),r.push(o)),a=e[i++]}while(void 0!==a)}}};function Qo(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function $o(e,t,r,n){Qo.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function es(e,t,r,n){Qo.call(this,e,t,r,n)}function ts(e,t,r,n){Qo.call(this,e,t,r,n)}function rs(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ko.convertArray(t,this.TimeBufferType),this.values=Ko.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function ns(e,t,r){rs.call(this,e,t,r)}function is(e,t,r,n){rs.call(this,e,t,r,n)}function as(e,t,r,n){rs.call(this,e,t,r,n)}function os(e,t,r,n){Qo.call(this,e,t,r,n)}function ss(e,t,r,n){rs.call(this,e,t,r,n)}function ls(e,t,r,n){rs.call(this,e,t,r,n)}function us(e,t,r,n){rs.call(this,e,t,r,n)}function hs(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=Kt.generateUUID(),this.duration<0&&this.resetDuration()}function cs(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return as;case"vector":case"vector2":case"vector3":case"vector4":return us;case"color":return is;case"quaternion":return ss;case"bool":case"boolean":return ns;case"string":return ls}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],n=[];Ko.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Qo.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var a;r:{n:if(!(e<n)){for(var o=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===o)break;if(i=n,e<(n=t[++r]))break t}a=t.length;break r}if(e>=i)break e;var s=t[1];for(e<s&&(r=2,i=s),o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===o)break;if(n=i,e>=(i=t[--r-1]))break t}a=r,r=0}for(;r<a;){var l=r+a>>>1;e<t[l]?a=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,a=0;a!==n;++a)t[a]=r[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Qo.prototype,{beforeStart_:Qo.prototype.copySampleValue_,afterEnd_:Qo.prototype.copySampleValue_}),$o.prototype=Object.assign(Object.create(Qo.prototype),{constructor:$o,DefaultSettings_:{endingStart:Dt,endingEnd:Dt},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,a=e+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case It:i=e,o=2*t-r;break;case Nt:o=t+n[i=n.length-2]-n[i+1];break;default:i=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case It:a=e,s=2*r-t;break;case Nt:a=1,s=r+n[1]-n[0];break;default:a=e-1,s=t}var l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=i*u,this._offsetNext=a*u},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,h=this._offsetNext,c=this._weightPrev,d=this._weightNext,f=(r-t)/(n-t),p=f*f,m=p*f,v=-c*m+2*c*p-c*f,g=(1+c)*m+(-1.5-2*c)*p+(-.5+c)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,x=d*m-d*p,b=0;b!==o;++b)i[b]=v*a[u+b]+g*a[l+b]+y*a[s+b]+x*a[h+b];return i}}),es.prototype=Object.assign(Object.create(Qo.prototype),{constructor:es,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(r-t)/(n-t),h=1-u,c=0;c!==o;++c)i[c]=a[l+c]*h+a[s+c]*u;return i}}),ts.prototype=Object.assign(Object.create(Qo.prototype),{constructor:ts,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(rs,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:Ko.convertArray(e.times,Array),values:Ko.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(rs.prototype,{constructor:rs,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Rt,InterpolantFactoryMethodDiscrete:function(e){return new ts(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new es(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new $o(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Ct:t=this.InterpolantFactoryMethodDiscrete;break;case Rt:t=this.InterpolantFactoryMethodLinear;break;case Ot:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ct;case this.InterpolantFactoryMethodLinear:return Rt;case this.InterpolantFactoryMethodSmooth:return Ot}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<e;)++i;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==i||a!==n){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Ko.arraySlice(r,i,a),this.values=Ko.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==n&&Ko.isTypedArray(n)){o=0;for(var l=n.length;o!==l;++o){var u=n[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=this.getInterpolation()===Ot,i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(n)s=!0;else for(var u=o*r,h=u-r,c=u+r,d=0;d!==r;++d){var f=t[u+d];if(f!==t[h+d]||f!==t[c+d]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];var p=o*r,m=i*r;for(d=0;d!==r;++d)t[m+d]=t[p+d]}++i}}if(a>0){for(e[i]=e[a],p=a*r,m=i*r,d=0;d!==r;++d)t[m+d]=t[p+d];++i}return i!==e.length&&(this.times=Ko.arraySlice(e,0,i),this.values=Ko.arraySlice(t,0,i*r)),this}}),ns.prototype=Object.assign(Object.create(rs.prototype),{constructor:ns,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ct,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),is.prototype=Object.assign(Object.create(rs.prototype),{constructor:is,ValueTypeName:"color"}),as.prototype=Object.assign(Object.create(rs.prototype),{constructor:as,ValueTypeName:"number"}),os.prototype=Object.assign(Object.create(Qo.prototype),{constructor:os,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(r-t)/(n-t),u=s+o;s!==u;s+=4)er.slerpFlat(i,0,a,s-o,a,s,l);return i}}),ss.prototype=Object.assign(Object.create(rs.prototype),{constructor:ss,ValueTypeName:"quaternion",DefaultInterpolation:Rt,InterpolantFactoryMethodLinear:function(e){return new os(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),ls.prototype=Object.assign(Object.create(rs.prototype),{constructor:ls,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ct,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),us.prototype=Object.assign(Object.create(rs.prototype),{constructor:us,ValueTypeName:"vector"}),Object.assign(hs,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,a=r.length;i!==a;++i)t.push(cs(r[i]).scale(n));return new hs(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=r.length;i!==a;++i)t.push(rs.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var u=Ko.getKeyframeOrder(s);s=Ko.sortedArray(s,1,u),l=Ko.sortedArray(l,1,u),n||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new as(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/r))}return new hs(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var u=n[c=l[1]];u||(n[c]=u=[]),u.push(s)}}var h=[];for(var c in n)h.push(hs.CreateFromMorphTargetSequence(c,n[c],t,r));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var a=[],o=[];Ko.flattenJSON(r,a,o,n),0!==a.length&&i.push(new e(t,a,o))}},n=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var h={},c=0;c<u.length;c++)if(u[c].morphTargets)for(var d=0;d<u[c].morphTargets.length;d++)h[u[c].morphTargets[d]]=-1;for(var f in h){var p=[],m=[];for(d=0;d!==u[c].morphTargets.length;++d){var v=u[c];p.push(v.time),m.push(v.morphTarget===f?1:0)}n.push(new as(".morphTargetInfluence["+f+"]",p,m))}a=h.length*(o||1)}else{var g=".bones["+t[l].name+"]";r(us,g+".position",u,"pos",n),r(ss,g+".quaternion",u,"rot",n),r(us,g+".scale",u,"scl",n)}}return 0===n.length?null:new hs(i,a,n)}}),Object.assign(hs.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}});var ds={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function fs(e,t,r){var n=this,i=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===i&&void 0!==n.onStart&&n.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var ps=new fs,ms={};function vs(e){this.manager=void 0!==e?e:ps}function gs(e){this.manager=void 0!==e?e:ps}function ys(e){this.manager=void 0!==e?e:ps,this._parser=null}function xs(e){this.manager=void 0!==e?e:ps,this._parser=null}function bs(e){this.manager=void 0!==e?e:ps}function ws(e){this.manager=void 0!==e?e:ps}function _s(e){this.manager=void 0!==e?e:ps}function Ms(){this.type="Curve",this.arcLengthDivisions=200}function Es(e,t,r,n,i,a,o,s){Ms.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Ss(e,t,r,n,i,a){Es.call(this,e,t,r,r,n,i,a),this.type="ArcCurve"}function Ts(){var e=0,t=0,r=0,n=0;function i(i,a,o,s){e=i,t=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(e,t,r,n,a){i(t,r,a*(r-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,a,o,s){var l=(t-e)/a-(r-e)/(a+o)+(r-t)/o,u=(r-t)/o-(n-t)/(o+s)+(n-r)/s;i(t,r,l*=o,u*=o)},calc:function(i){var a=i*i;return e+t*i+r*a+n*(a*i)}}}Object.assign(vs.prototype,{load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ds.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;if(void 0===ms[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],u=o[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var h,c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),f=0;f<u.length;f++)d[f]=u.charCodeAt(f);h="blob"===c?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var p=new DOMParser;h=p.parseFromString(u,s);break;case"json":h=JSON.parse(u);break;default:h=u}setTimeout(function(){t&&t(h),i.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{ms[e]=[],ms[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;ds.add(e,r);var n=ms[e];if(delete ms[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=n.length;a<o;a++)(s=n[a]).onLoad&&s.onLoad(r);i.manager.itemEnd(e)}else{for(a=0,o=n.length;a<o;a++){var s;(s=n[a]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var r=ms[e],n=0,i=r.length;n<i;n++){var a=r[n];a.onProgress&&a.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=ms[e];delete ms[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var r=ms[e];delete ms[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}ms[e].push({onLoad:t,onProgress:r,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(gs.prototype,{load:function(e,t,r,n){var i=this,a=new vs(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e,t){for(var r=[],n=0;n<e.length;n++){var i=hs.parse(e[n]);r.push(i)}t(r)},setPath:function(e){return this.path=e,this}}),Object.assign(ys.prototype,{load:function(e,t,r,n){var i=this,a=[],o=new Ea;o.image=a;var s=new vs(this.manager);function l(l){s.load(e[l],function(e){var r=i._parser(e,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(u+=1)&&(1===r.mipmapCount&&(o.minFilter=Ie),o.format=r.format,o.needsUpdate=!0,t&&t(o))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,h=0,c=e.length;h<c;++h)l(h);else s.load(e,function(e){var r=i._parser(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=Ie),o.format=r.format,o.needsUpdate=!0,t&&t(o)},r,n);return o},setPath:function(e){return this.path=e,this}}),Object.assign(xs.prototype,{load:function(e,t,r,n){var i=this,a=new pr,o=new vs(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var r=i._parser(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:Pe,a.wrapT=void 0!==r.wrapT?r.wrapT:Pe,a.magFilter=void 0!==r.magFilter?r.magFilter:Ie,a.minFilter=void 0!==r.minFilter?r.minFilter:Fe,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=Ie),a.needsUpdate=!0,t&&t(a,r))},r,n),a},setPath:function(e){return this.path=e,this}}),Object.assign(bs.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ds.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),ds.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(ws.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=new Rn,a=new bs(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(e[r],function(e){i.images[r]=e,6==++o&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var l=0;l<e.length;++l)s(l);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(_s.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=new hr,a=new bs(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(r){i.image=r;var n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?Je:Ke,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ms.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=e;r++)a+=(t=this.getPoint(r/e)).distanceTo(i),n.push(a),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,a=n.length;r=t||e*n[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=n[i=Math.floor(s+(l-s)/2)]-r)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(a-1);var u=n[i];return(i+(r-u)/(n[i+1]-u))/(a-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,a=new tr,o=[],s=[],l=[],u=new tr,h=new $t;for(r=0;r<=e;r++)n=r/e,o[r]=this.getTangentAt(n),o[r].normalize();s[0]=new tr,l[0]=new tr;var c=Number.MAX_VALUE,d=Math.abs(o[0].x),f=Math.abs(o[0].y),p=Math.abs(o[0].z);for(d<=c&&(c=d,a.set(1,0,0)),f<=c&&(c=f,a.set(0,1,0)),p<=c&&a.set(0,0,1),u.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],u),l[0].crossVectors(o[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),u.crossVectors(o[r-1],o[r]),u.length()>Number.EPSILON&&(u.normalize(),i=Math.acos(Kt.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(h.makeRotationAxis(u,i))),l[r].crossVectors(o[r],s[r]);if(!0===t)for(i=Math.acos(Kt.clamp(s[0].dot(s[e]),-1,1)),i/=e,o[0].dot(u.crossVectors(s[0],s[e]))>0&&(i=-i),r=1;r<=e;r++)s[r].applyMatrix4(h.makeRotationAxis(o[r],i*r)),l[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Es.prototype=Object.create(Ms.prototype),Es.prototype.constructor=Es,Es.prototype.isEllipseCurve=!0,Es.prototype.getPoint=function(e,t){for(var r=t||new Qt,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),c=s-this.aX,d=l-this.aY;s=c*u-d*h+this.aX,l=c*h+d*u+this.aY}return r.set(s,l)},Es.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Es.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Es.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ss.prototype=Object.create(Es.prototype),Ss.prototype.constructor=Ss,Ss.prototype.isArcCurve=!0;var As=new tr,Ls=new Ts,Ps=new Ts,Cs=new Ts;function Rs(e,t,r,n){Ms.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function Os(e,t,r,n,i){var a=.5*(n-t),o=.5*(i-r),s=e*e;return(2*r-2*n+a+o)*(e*s)+(-3*r+3*n-2*a-o)*s+a*e+r}function Ds(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*r}(e)+function(e,t){return e*e*n}(e)}function Is(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*n}(e)+function(e,t){return e*e*e*i}(e)}function Ns(e,t,r,n){Ms.call(this),this.type="CubicBezierCurve",this.v0=e||new Qt,this.v1=t||new Qt,this.v2=r||new Qt,this.v3=n||new Qt}function Fs(e,t,r,n){Ms.call(this),this.type="CubicBezierCurve3",this.v0=e||new tr,this.v1=t||new tr,this.v2=r||new tr,this.v3=n||new tr}function Us(e,t){Ms.call(this),this.type="LineCurve",this.v1=e||new Qt,this.v2=t||new Qt}function ks(e,t){Ms.call(this),this.type="LineCurve3",this.v1=e||new tr,this.v2=t||new tr}function Bs(e,t,r){Ms.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Qt,this.v1=t||new Qt,this.v2=r||new Qt}function zs(e,t,r){Ms.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new tr,this.v1=t||new tr,this.v2=r||new tr}function Gs(e){Ms.call(this),this.type="SplineCurve",this.points=e||[]}Rs.prototype=Object.create(Ms.prototype),Rs.prototype.constructor=Rs,Rs.prototype.isCatmullRomCurve3=!0,Rs.prototype.getPoint=function(e,t){var r,n,i,a,o=t||new tr,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e,h=Math.floor(u),c=u-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/l)+1)*l:0===c&&h===l-1&&(h=l-2,c=1),this.closed||h>0?r=s[(h-1)%l]:(As.subVectors(s[0],s[1]).add(s[0]),r=As),n=s[h%l],i=s[(h+1)%l],this.closed||h+2<l?a=s[(h+2)%l]:(As.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=As),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(r.distanceToSquared(n),d),p=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(a),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),Ls.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,f,p,m),Ps.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,f,p,m),Cs.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,f,p,m)}else"catmullrom"===this.curveType&&(Ls.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),Ps.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),Cs.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(Ls.calc(c),Ps.calc(c),Cs.calc(c)),o},Rs.prototype.copy=function(e){Ms.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Rs.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Rs.prototype.fromJSON=function(e){Ms.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new tr).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ns.prototype=Object.create(Ms.prototype),Ns.prototype.constructor=Ns,Ns.prototype.isCubicBezierCurve=!0,Ns.prototype.getPoint=function(e,t){var r=t||new Qt,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Is(e,n.x,i.x,a.x,o.x),Is(e,n.y,i.y,a.y,o.y)),r},Ns.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ns.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ns.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Fs.prototype=Object.create(Ms.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isCubicBezierCurve3=!0,Fs.prototype.getPoint=function(e,t){var r=t||new tr,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Is(e,n.x,i.x,a.x,o.x),Is(e,n.y,i.y,a.y,o.y),Is(e,n.z,i.z,a.z,o.z)),r},Fs.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Fs.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Fs.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Us.prototype=Object.create(Ms.prototype),Us.prototype.constructor=Us,Us.prototype.isLineCurve=!0,Us.prototype.getPoint=function(e,t){var r=t||new Qt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},Us.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Us.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Us.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Us.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Us.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ks.prototype=Object.create(Ms.prototype),ks.prototype.constructor=ks,ks.prototype.isLineCurve3=!0,ks.prototype.getPoint=function(e,t){var r=t||new tr;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ks.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ks.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ks.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ks.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Bs.prototype=Object.create(Ms.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isQuadraticBezierCurve=!0,Bs.prototype.getPoint=function(e,t){var r=t||new Qt,n=this.v0,i=this.v1,a=this.v2;return r.set(Ds(e,n.x,i.x,a.x),Ds(e,n.y,i.y,a.y)),r},Bs.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Bs.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Bs.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},zs.prototype=Object.create(Ms.prototype),zs.prototype.constructor=zs,zs.prototype.isQuadraticBezierCurve3=!0,zs.prototype.getPoint=function(e,t){var r=t||new tr,n=this.v0,i=this.v1,a=this.v2;return r.set(Ds(e,n.x,i.x,a.x),Ds(e,n.y,i.y,a.y),Ds(e,n.z,i.z,a.z)),r},zs.prototype.copy=function(e){return Ms.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zs.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zs.prototype.fromJSON=function(e){return Ms.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Gs.prototype=Object.create(Ms.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isSplineCurve=!0,Gs.prototype.getPoint=function(e,t){var r=t||new Qt,n=this.points,i=(n.length-1)*e,a=Math.floor(i),o=i-a,s=n[0===a?a:a-1],l=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(Os(o,s.x,l.x,u.x,h.x),Os(o,s.y,l.y,u.y,h.y)),r},Gs.prototype.copy=function(e){Ms.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},Gs.prototype.toJSON=function(){var e=Ms.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},Gs.prototype.fromJSON=function(e){Ms.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Qt).fromArray(n))}return this};var js=Object.freeze({ArcCurve:Ss,CatmullRomCurve3:Rs,CubicBezierCurve:Ns,CubicBezierCurve3:Fs,EllipseCurve:Es,LineCurve:Us,LineCurve3:ks,QuadraticBezierCurve:Bs,QuadraticBezierCurve3:zs,SplineCurve:Gs});function Vs(){Ms.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Hs(e){Vs.call(this),this.type="Path",this.currentPoint=new Qt,e&&this.setFromPoints(e)}function Ws(e){Hs.call(this,e),this.uuid=Kt.generateUUID(),this.type="Shape",this.holes=[]}function qs(e,t){Gr.call(this),this.type="Light",this.color=new Ar(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Xs(e,t,r){qs.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Gr.DefaultUp),this.updateMatrix(),this.groundColor=new Ar(t)}function Ys(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Qt(512,512),this.map=null,this.matrix=new $t}function Zs(){Ys.call(this,new Xi(50,1,.5,500))}function Js(e,t,r,n,i,a){qs.call(this,e,t),this.type="SpotLight",this.position.copy(Gr.DefaultUp),this.updateMatrix(),this.target=new Gr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new Zs}function Ks(e,t,r,n){qs.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new Ys(new Xi(90,1,.5,500))}function Qs(e,t,r,n,i,a){qi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function $s(){Ys.call(this,new Qs(-5,5,5,-5,.5,500))}function el(e,t){qs.call(this,e,t),this.type="DirectionalLight",this.position.copy(Gr.DefaultUp),this.updateMatrix(),this.target=new Gr,this.shadow=new $s}function tl(e,t){qs.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function rl(e,t,r,n){qs.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function nl(e){this.manager=void 0!==e?e:ps,this.textures={}}Vs.prototype=Object.assign(Object.create(Ms.prototype),{constructor:Vs,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Us(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,a=this.curves[n],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(r.push(u),t=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Ms.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ms.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Ms.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new js[n.type]).fromJSON(n))}return this}}),Hs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Hs,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new Us(this.currentPoint.clone(),new Qt(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){var i=new Bs(this.currentPoint.clone(),new Qt(e,t),new Qt(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,a){var o=new Ns(this.currentPoint.clone(),new Qt(e,t),new Qt(r,n),new Qt(i,a));this.curves.push(o),this.currentPoint.set(i,a)},splineThru:function(e){var t=new Gs([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,r,n,i,a)},absarc:function(e,t,r,n,i,a){this.absellipse(e,t,r,r,n,i,a)},ellipse:function(e,t,r,n,i,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(e+l,t+u,r,n,i,a,o,s)},absellipse:function(e,t,r,n,i,a,o,s){var l=new Es(e,t,r,n,i,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var h=l.getPoint(1);this.currentPoint.copy(h)},copy:function(e){return Vs.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Vs.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Vs.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Ws.prototype=Object.assign(Object.create(Hs.prototype),{constructor:Ws,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Hs.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=Hs.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){Hs.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new Hs).fromJSON(n))}return this}}),qs.prototype=Object.assign(Object.create(Gr.prototype),{constructor:qs,isLight:!0,copy:function(e){return Gr.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Gr.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Xs.prototype=Object.assign(Object.create(qs.prototype),{constructor:Xs,isHemisphereLight:!0,copy:function(e){return qs.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Ys.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Zs.prototype=Object.assign(Object.create(Ys.prototype),{constructor:Zs,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*Kt.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix())}}),Js.prototype=Object.assign(Object.create(qs.prototype),{constructor:Js,isSpotLight:!0,copy:function(e){return qs.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ks.prototype=Object.assign(Object.create(qs.prototype),{constructor:Ks,isPointLight:!0,copy:function(e){return qs.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Qs.prototype=Object.assign(Object.create(qi.prototype),{constructor:Qs,isOrthographicCamera:!0,copy:function(e,t){return qi.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,a=r+e,o=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,c=(this.top-this.bottom)/this.view.height;a=(i+=h*(this.view.offsetX/l))+h*(this.view.width/l),s=(o-=c*(this.view.offsetY/u))-c*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Gr.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),$s.prototype=Object.assign(Object.create(Ys.prototype),{constructor:$s}),el.prototype=Object.assign(Object.create(qs.prototype),{constructor:el,isDirectionalLight:!0,copy:function(e){return qs.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),tl.prototype=Object.assign(Object.create(qs.prototype),{constructor:tl,isAmbientLight:!0}),rl.prototype=Object.assign(Object.create(qs.prototype),{constructor:rl,isRectAreaLight:!0,copy:function(e){return qs.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=qs.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(nl.prototype,{load:function(e,t,r,n){var i=this,a=new vs(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new Jo[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=(new Ar).setHex(a.value);break;case"v2":n.uniforms[i].value=(new Qt).fromArray(a.value);break;case"v3":n.uniforms[i].value=(new tr).fromArray(a.value);break;case"v4":n.uniforms[i].value=(new cr).fromArray(a.value);break;case"m4":n.uniforms[i].value=(new $t).fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var o=e.normalScale;!1===Array.isArray(o)&&(o=[o,o]),n.normalScale=(new Qt).fromArray(o)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),n},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var il={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function al(e){this.manager=void 0!==e?e:ps}Object.assign(al.prototype,{load:function(e,t,r,n){var i=this,a=new vs(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=new on,r=e.data.index;if(void 0!==r){var n=new ol[r.type](r.array);t.setIndex(new qr(n,1))}var i=e.data.attributes;for(var a in i){var o=i[a];n=new ol[o.type](o.array),t.addAttribute(a,new qr(n,o.itemSize,o.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var l=0,u=s.length;l!==u;++l){var h=s[l];t.addGroup(h.start,h.count,h.materialIndex)}var c=e.data.boundingSphere;if(void 0!==c){var d=new tr;void 0!==c.center&&d.fromArray(c.center),t.boundingSphere=new vr(d,c.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var ol={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function sl(e){this.manager=void 0!==e?e:ps,this.resourcePath=""}Object.assign(sl.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?il.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new vs(i.manager);o.setPath(this.path),o.load(e,function(r){var a=null;try{a=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,n,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new Ws).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new al,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Bo[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Bo[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Bo[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Bo[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Bo[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Bo[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Bo[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Bo[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Bo[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Bo[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Bo[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Bo[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,h=s.shapes.length;u<h;u++){var c=t[s.shapes[u]];l.push(c)}o=new Bo[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,h=s.shapes.length;u<h;u++)c=t[s.shapes[u]],l.push(c);var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new js[d.type]).fromJSON(d)),o=new Bo[s.type](l,s.options);break;case"BufferGeometry":o=n.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var i=new nl;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var h=s.materials[u];void 0===r[h.uuid]&&(r[h.uuid]=i.parse(h)),l.push(r[h.uuid])}n[s.uuid]=l}else n[s.uuid]=i.parse(s),r[s.uuid]=n[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=hs.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),t.push(i)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),a.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var a=new bs(new fs(t));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=e.length;o<s;o++){var l=e[o],u=l.url;if(Array.isArray(u)){n[l.uuid]=[];for(var h=0,c=u.length;h<c;h++){var d=u[h],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.resourcePath+d;n[l.uuid].push(i(f))}}else f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.resourcePath+l.url,n[l.uuid]=i(f)}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new Rn(t[s.image]):new hr(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,fl)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],pl),o.wrapT=r(s.wrap[1],pl)),void 0!==s.format&&(o.format=s.format),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,ml)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,ml)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),n[s.uuid]=o}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(r[a])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new la,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new Ar(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new sa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new oa(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new Xi(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new Qs(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new tl(e.color,e.intensity);break;case"DirectionalLight":n=new el(e.color,e.intensity);break;case"PointLight":n=new Ks(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new rl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new Js(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new Xs(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(e.geometry),s=a(e.material);n=o.bones&&o.bones.length>0?new pa(o,s):new Pn(o,s);break;case"LOD":n=new fa;break;case"Line":n=new ya(i(e.geometry),a(e.material),e.mode);break;case"LineLoop":n=new ba(i(e.geometry),a(e.material));break;case"LineSegments":n=new xa(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":n=new _a(i(e.geometry),a(e.material));break;case"Sprite":n=new da(a(e.material));break;case"Group":n=new Wi;break;default:n=new Gr}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,u=0;u<l.length;u++)n.add(this.parseObject(l[u],t,r));if("LOD"===e.type)for(var h=e.levels,c=0;c<h.length;c++){var d=h[c],f=n.getObjectByProperty("uuid",d.object);void 0!==f&&n.addLevel(f,d.distance)}return n}});var ll,ul,hl,cl,dl,fl={UVMapping:be,CubeReflectionMapping:we,CubeRefractionMapping:_e,EquirectangularReflectionMapping:Me,EquirectangularRefractionMapping:Ee,SphericalReflectionMapping:Se,CubeUVReflectionMapping:Te,CubeUVRefractionMapping:Ae},pl={RepeatWrapping:Le,ClampToEdgeWrapping:Pe,MirroredRepeatWrapping:Ce},ml={NearestFilter:Re,NearestMipMapNearestFilter:Oe,NearestMipMapLinearFilter:De,LinearFilter:Ie,LinearMipMapNearestFilter:Ne,LinearMipMapLinearFilter:Fe};function vl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:ps,this.options=void 0}function gl(){this.type="ShapePath",this.color=new Ar,this.subPaths=[],this.currentPath=null}function yl(e){this.type="Font",this.data=e}function xl(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,u,h,c,d,f,p=new gl;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;)switch(m[v++]){case"m":o=m[v++]*t+r,s=m[v++]*t+n,p.moveTo(o,s);break;case"l":o=m[v++]*t+r,s=m[v++]*t+n,p.lineTo(o,s);break;case"q":l=m[v++]*t+r,u=m[v++]*t+n,h=m[v++]*t+r,c=m[v++]*t+n,p.quadraticCurveTo(h,c,l,u);break;case"b":l=m[v++]*t+r,u=m[v++]*t+n,h=m[v++]*t+r,c=m[v++]*t+n,d=m[v++]*t+r,f=m[v++]*t+n,p.bezierCurveTo(h,c,d,f,l,u)}return{offsetX:a.ha*t,path:p}}}function bl(e){this.manager=void 0!==e?e:ps}function wl(){}vl.prototype={constructor:vl,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ds.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(r){ds.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(gl.prototype,{moveTo:function(e,t){this.currentPath=new Hs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,a){this.currentPath.bezierCurveTo(e,t,r,n,i,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=new Ws;a.curves=i.curves,t.push(a)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,a=0;a<r;i=a++){var o=t[i],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[i],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var h=u*(e.x-o.x)-l*(e.y-o.y);if(0===h)return!0;if(h<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return n}var i=po.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return r(a);var o,s,l,u=[];if(1===a.length)return s=a[0],(l=new Ws).curves=s.curves,u.push(l),u;var h=!i(a[0].getPoints());h=e?!h:h;var c,d,f=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var g=0,y=a.length;g<y;g++)o=i(c=(s=a[g]).getPoints()),(o=e?!o:o)?(!h&&p[v]&&v++,p[v]={s:new Ws,p:c},p[v].s.curves=s.curves,h&&v++,m[v]=[]):m[v].push({h:s,p:c[0]});if(!p[0])return r(a);if(p.length>1){for(var x=!1,b=[],w=0,_=p.length;w<_;w++)f[w]=[];for(w=0,_=p.length;w<_;w++)for(var M=m[w],E=0;E<M.length;E++){for(var S=M[E],T=!0,A=0;A<p.length;A++)n(S.p,p[A].p)&&(w!==A&&b.push({froms:w,tos:A,hole:E}),T?(T=!1,f[A].push(S)):x=!0);T&&f[w].push(S)}b.length>0&&(x||(m=f))}g=0;for(var L=p.length;g<L;g++){l=p[g].s,u.push(l);for(var P=0,C=(d=m[g]).length;P<C;P++)l.holes.push(d[P].h)}return u}}),Object.assign(yl.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],n=function(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,l=0,u=0;u<n.length;u++){var h=n[u];if("\n"===h)s=0,l-=a;else{var c=xl(h,i,s,l,r);s+=c.offsetX,o.push(c.path)}}return o}(e,t,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),Object.assign(bl.prototype,{load:function(e,t,r,n){var i=this,a=new vs(this.manager);a.setPath(this.path),a.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function(e){return new yl(e)},setPath:function(e){return this.path=e,this}}),wl.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],a=t[r+1];if(i.test(e))return a}return null}},Object.assign(wl.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:(ll={NoBlending:N,NormalBlending:F,AdditiveBlending:U,SubtractiveBlending:k,MultiplyBlending:B,CustomBlending:z},ul=new Ar,hl=new _s,cl=new nl,function(e,t,r){var n={};function i(e,i,a,o,s){var l,u=t+e,h=wl.Handlers.get(u);null!==h?l=h.load(u):(hl.setCrossOrigin(r),l=hl.load(u)),void 0!==i&&(l.repeat.fromArray(i),1!==i[0]&&(l.wrapS=Le),1!==i[1]&&(l.wrapT=Le)),void 0!==a&&l.offset.fromArray(a),void 0!==o&&("repeat"===o[0]&&(l.wrapS=Le),"mirror"===o[0]&&(l.wrapS=Ce),"repeat"===o[1]&&(l.wrapT=Le),"mirror"===o[1]&&(l.wrapT=Ce)),void 0!==s&&(l.anisotropy=s);var c=Kt.generateUUID();return n[c]=l,c}var a={uuid:Kt.generateUUID(),type:"MeshLambertMaterial"};for(var o in e){var s=e[o];switch(o){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=s;break;case"blending":a.blending=ll[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",o,"is no longer supported.");break;case"colorDiffuse":a.color=ul.fromArray(s).getHex();break;case"colorSpecular":a.specular=ul.fromArray(s).getHex();break;case"colorEmissive":a.emissive=ul.fromArray(s).getHex();break;case"specularCoef":a.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=i(s,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=i(s,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=i(s,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=i(s,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=i(s,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=i(s,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=i(s,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=i(s,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=i(s,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=i(s,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=L;break;case"doubleSided":a.side=P;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),a.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[o]=s;break;case"vertexColors":!0===s&&(a.vertexColors=I),"face"===s&&(a.vertexColors=D);break;default:console.error("THREE.Loader.createMaterial: Unsupported",o,s)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),cl.setTextures(n),cl.parse(a)})});var _l,Ml,El,Sl,Tl,Al,Ll,Pl,Cl,Rl,Ol,Dl,Il,Nl,Fl,Ul,kl,Bl,zl,Gl,jl,Vl,Hl,Wl,ql,Xl={getContext:function(){return void 0===dl&&(dl=new(window.AudioContext||window.webkitAudioContext)),dl},setContext:function(e){dl=e}};function Yl(e){this.manager=void 0!==e?e:ps}function Zl(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Xi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Xi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Jl(e,t,r,n){Gr.call(this),this.type="CubeCamera";var i=new Xi(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new tr(1,0,0)),this.add(i);var a=new Xi(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new tr(-1,0,0)),this.add(a);var o=new Xi(90,1,e,t);o.up.set(0,0,1),o.lookAt(new tr(0,1,0)),this.add(o);var s=new Xi(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new tr(0,-1,0)),this.add(s);var l=new Xi(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new tr(0,0,1)),this.add(l);var u=new Xi(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new tr(0,0,-1)),this.add(u),n=n||{format:Je,magFilter:Ie,minFilter:Ie},this.renderTarget=new fr(r,r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,n=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,i,r),r.activeCubeFace=1,e.render(t,a,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,s,r),r.activeCubeFace=4,e.render(t,l,r),r.texture.generateMipmaps=n,r.activeCubeFace=5,e.render(t,u,r),e.setRenderTarget(null)},this.clear=function(e,t,r,n){for(var i=this.renderTarget,a=0;a<6;a++)i.activeCubeFace=a,e.setRenderTarget(i),e.clear(t,r,n);e.setRenderTarget(null)}}function Kl(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ql(){Gr.call(this),this.type="AudioListener",this.context=Xl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function $l(e){Gr.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function eu(e){$l.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function tu(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function ru(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function nu(e,t,r){var n=r||iu.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function iu(e,t,r){this.path=t,this.parsedPath=r||iu.parseTrackName(t),this.node=iu.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function au(){this.uuid=Kt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function ou(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,a=new Array(i),o={endingStart:Dt,endingEnd:Dt},s=0;s!==i;++s){var l=n[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Lt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function su(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function lu(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function uu(){on.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function hu(e,t,r){ua.call(this,e,t),this.meshPerAttribute=r||1}function cu(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),qr.call(this,e,t,r),this.meshPerAttribute=n||1}function du(e,t,r,n){this.ray=new Tn(e,t),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function fu(e,t){return e.distance-t.distance}function pu(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,a=0,o=i.length;a<o;a++)pu(i[a],t,r,!0)}function mu(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function vu(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function gu(e,t){this.min=void 0!==e?e:new Qt(1/0,1/0),this.max=void 0!==t?t:new Qt(-1/0,-1/0)}function yu(e,t){this.start=void 0!==e?e:new tr,this.end=void 0!==t?t:new tr}function xu(e){Gr.call(this),this.material=e,this.render=function(){}}function bu(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,a=void 0!==n?n:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var l=new on,u=new en(2*o*3,3);l.addAttribute("position",u),xa.call(this,l,new ga({color:i,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function wu(e,t){Gr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new on,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new en(n,3));var l=new ga({fog:!1});this.cone=new xa(r,l),this.add(this.cone),this.update()}function _u(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new on,n=[],i=[],a=new Ar(0,0,1),o=new Ar(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.addAttribute("position",new en(n,3)),r.addAttribute("color",new en(i,3));var u=new ga({vertexColors:I,depthTest:!1,depthWrite:!1,transparent:!0});xa.call(this,r,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Mu(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new Eo(t,4,2),i=new Ln({wireframe:!0,fog:!1});Pn.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Eu(e,t){Gr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new ga({fog:!1}),n=new on;n.addAttribute("position",new qr(new Float32Array(15),3)),this.line=new ya(n,r),this.add(this.line),this.update()}function Su(e,t,r){Gr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Na(t);n.rotateY(.5*Math.PI),this.material=new Ln({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=I);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.addAttribute("color",new qr(a,3)),this.add(new Pn(n,this.material)),this.update()}function Tu(e,t,r,n){e=e||10,t=t||10,r=new Ar(void 0!==r?r:4473924),n=new Ar(void 0!==n?n:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],u=0,h=0,c=-o;u<=t;u++,c+=a){s.push(-o,0,c,o,0,c),s.push(c,0,-o,c,0,o);var d=u===i?r:n;d.toArray(l,h),h+=3,d.toArray(l,h),h+=3,d.toArray(l,h),h+=3,d.toArray(l,h),h+=3}var f=new on;f.addAttribute("position",new en(s,3)),f.addAttribute("color",new en(l,3));var p=new ga({vertexColors:I});xa.call(this,f,p)}function Au(e,t,r,n,i,a){e=e||10,t=t||16,r=r||8,n=n||64,i=new Ar(void 0!==i?i:4473924),a=new Ar(void 0!==a?a:8947848);var o,s,l,u,h,c,d,f=[],p=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(o,0,s),d=1&u?i:a,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(u=0;u<=r;u++)for(d=1&u?i:a,c=e-e/r*u,h=0;h<n;h++)l=h/n*(2*Math.PI),o=Math.sin(l)*c,s=Math.cos(l)*c,f.push(o,0,s),p.push(d.r,d.g,d.b),l=(h+1)/n*(2*Math.PI),o=Math.sin(l)*c,s=Math.cos(l)*c,f.push(o,0,s),p.push(d.r,d.g,d.b);var m=new on;m.addAttribute("position",new en(f,3)),m.addAttribute("color",new en(p,3));var v=new ga({vertexColors:I});xa.call(this,m,v)}function Lu(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,a=void 0!==n?n:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new on,u=new en(2*o*3,3);l.addAttribute("position",u),xa.call(this,l,new ga({color:i,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Pu(e,t,r){Gr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new on;n.addAttribute("position",new en([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new ga({fog:!1});this.lightPlane=new ya(n,i),this.add(this.lightPlane),(n=new on).addAttribute("position",new en([0,0,0,0,0,1],3)),this.targetLine=new ya(n,i),this.add(this.targetLine),this.update()}function Cu(e){var t=new on,r=new ga({color:16777215,vertexColors:D}),n=[],i=[],a={},o=new Ar(16755200),s=new Ar(16711680),l=new Ar(43775),u=new Ar(16777215),h=new Ar(3355443);function c(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}c("n1","n2",o),c("n2","n4",o),c("n4","n3",o),c("n3","n1",o),c("f1","f2",o),c("f2","f4",o),c("f4","f3",o),c("f3","f1",o),c("n1","f1",o),c("n2","f2",o),c("n3","f3",o),c("n4","f4",o),c("p","n1",s),c("p","n2",s),c("p","n3",s),c("p","n4",s),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),c("c","t",u),c("p","c",h),c("cn1","cn2",h),c("cn3","cn4",h),c("cf1","cf2",h),c("cf3","cf4",h),t.addAttribute("position",new en(n,3)),t.addAttribute("color",new en(i,3)),xa.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Ru(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new on;i.setIndex(new qr(r,1)),i.addAttribute("position",new qr(n,3)),xa.call(this,i,new ga({color:t})),this.matrixAutoUpdate=!1,this.update()}function Ou(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new on;i.setIndex(new qr(n,1)),i.addAttribute("position",new en([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),xa.call(this,i,new ga({color:r})),this.geometry.computeBoundingSphere()}function Du(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new on;i.addAttribute("position",new en([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),ya.call(this,i,new ga({color:n}));var a=new on;a.addAttribute("position",new en([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Pn(a,new Ln({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Iu(e,t,r,n,i,a){Gr.call(this),void 0===e&&(e=new THREE.Vector3(0,0,1)),void 0===t&&(t=new THREE.Vector3(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===a&&(a=.2*i),void 0===Vl&&((Vl=new on).addAttribute("position",new en([0,0,0,0,1,0],3)),(Hl=new Io(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new ya(Vl,new ga({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Pn(Hl,new Ln({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,a)}function Nu(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new on;r.addAttribute("position",new en(t,3)),r.addAttribute("color",new en([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new ga({vertexColors:I});xa.call(this,r,n)}function Fu(e,t,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Dr(e,t,r,i,a,o)}Object.assign(Yl.prototype,{load:function(e,t,r,n){var i=new vs(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){var r=e.slice(0);Xl.getContext().decodeAudioData(r,function(e){t(e)})},r,n)},setPath:function(e){return this.path=e,this}}),Object.assign(Zl.prototype,{update:(Cl=new $t,Rl=new $t,function(e){if(_l!==this||Ml!==e.focus||El!==e.fov||Sl!==e.aspect*this.aspect||Tl!==e.near||Al!==e.far||Ll!==e.zoom||Pl!==this.eyeSep){_l=this,Ml=e.focus,El=e.fov,Sl=e.aspect*this.aspect,Tl=e.near,Al=e.far,Ll=e.zoom;var t,r,n=e.projectionMatrix.clone(),i=(Pl=this.eyeSep/2)*Tl/Ml,a=Tl*Math.tan(Kt.DEG2RAD*El*.5)/Ll;Rl.elements[12]=-Pl,Cl.elements[12]=Pl,t=-a*Sl+i,r=a*Sl+i,n.elements[0]=2*Tl/(r-t),n.elements[8]=(r+t)/(r-t),this.cameraL.projectionMatrix.copy(n),t=-a*Sl-i,r=a*Sl-i,n.elements[0]=2*Tl/(r-t),n.elements[8]=(r+t)/(r-t),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Rl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Cl)})}),Jl.prototype=Object.create(Gr.prototype),Jl.prototype.constructor=Jl,Object.assign(Kl.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Ql.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Ql,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new tr,t=new er,r=new tr,n=new tr,i=new Kl;return function(a){Gr.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;if(this.timeDelta=i.getDelta(),this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(e.x,l),o.positionY.linearRampToValueAtTime(e.y,l),o.positionZ.linearRampToValueAtTime(e.z,l),o.forwardX.linearRampToValueAtTime(n.x,l),o.forwardY.linearRampToValueAtTime(n.y,l),o.forwardZ.linearRampToValueAtTime(n.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z)}}()}),$l.prototype=Object.assign(Object.create(Gr.prototype),{constructor:$l,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.detune.value=this.detune,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){return this.detune=e,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),eu.prototype=Object.assign(Object.create($l.prototype),{constructor:eu,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var e=new tr,t=new er,r=new tr,n=new tr;return function(i){Gr.prototype.updateMatrixWorld.call(this,i);var a=this.panner;if(this.matrixWorld.decompose(e,t,r),n.set(0,0,1).applyQuaternion(t),a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(e.x,o),a.positionY.linearRampToValueAtTime(e.y,o),a.positionZ.linearRampToValueAtTime(e.z,o),a.orientationX.linearRampToValueAtTime(n.x,o),a.orientationY.linearRampToValueAtTime(n.y,o),a.orientationZ.linearRampToValueAtTime(n.z,o)}else a.setPosition(e.x,e.y,e.z),a.setOrientation(n.x,n.y,n.z)}}()}),Object.assign(tu.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(ru.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==n;++o)r[i+o]=r[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*t;this._mixBufferRegion(r,n,o,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){a.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,a=n;i!==a;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,n){er.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*n}}}),Object.assign(nu.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(iu,{Composite:nu,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new iu.Composite(e,t,r):new iu(e,t,r)},sanitizeNodeName:(zl=new RegExp("[\\[\\]\\.:\\/]","g"),function(e){return e.replace(/\s/g,"_").replace(zl,"")}),parseTrackName:(Ol="[^\\[\\]\\.:\\/]",Dl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Il=/((?:WC+[\/:])*)/.source.replace("WC",Ol),Nl=/(WCOD+)?/.source.replace("WCOD",Dl),Fl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ol),Ul=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ol),kl=new RegExp("^"+Il+Nl+Fl+Ul+"$"),Bl=["material","materials","bones"],function(e){var t=kl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==Bl.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var a=n(i.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(iu.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=iu.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var h=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(iu.prototype,{_getValue_unbound:iu.prototype.getValue,_setValue_unbound:iu.prototype.setValue}),Object.assign(au.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,u=0,h=arguments.length;u!==h;++u){var c=arguments[u],d=c.uuid,f=n[d];if(void 0===f){f=t++,n[d]=f,e.push(c);for(var p=0,m=s;p!==m;++p)o[p].push(new iu(c,i[p],a[p]))}else if(f<r){l=e[f];var v=--r,g=e[v];for(n[g.uuid]=f,e[f]=g,n[d]=v,e[v]=c,p=0,m=s;p!==m;++p){var y=o[p],x=y[v],b=y[f];y[f]=x,void 0===b&&(b=new iu(c,i[p],a[p])),y[v]=b}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=r[l];if(void 0!==u&&u>=t){var h=t++,c=e[h];r[c.uuid]=u,e[u]=c,r[l]=h,e[h]=s;for(var d=0,f=i;d!==f;++d){var p=n[d],m=p[h],v=p[u];p[u]=m,p[h]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,u=n[l];if(void 0!==u)if(delete n[l],u<r){var h=--r,c=e[h],d=e[g=--t];n[c.uuid]=u,e[u]=c,n[d.uuid]=h,e[h]=d,e.pop();for(var f=0,p=a;f!==p;++f){var m=(y=i[f])[h],v=y[g];y[u]=m,y[h]=v,y.pop()}}else{var g;for(n[(d=e[g=--t]).uuid]=u,e[u]=d,e.pop(),f=0,p=a;f!==p;++f){var y;(y=i[f])[u]=y[g],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,h=new Array(l);n=i.length,r[e]=n,a.push(e),o.push(t),i.push(h);for(var c=u,d=s.length;c!==d;++c){var f=s[c];h[c]=new iu(f,e,t)}return h},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(ou.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,a=i/n,o=n/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+r,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*r;if(a<0||0===r)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,h=0,c=l.length;h!==c;++h)l[h].evaluate(o),u[h].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,a=n===Pt;if(0===e)return-1===i?t:a&&1==(1&i)?r-t:t;if(n===At){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=r||t<0){var o=Math.floor(t/r);t-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&1==(1&i))return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=It,n.endingEnd=It):(n.endingStart=e?this.zeroSlopeAtStart?It:Dt:Nt,n.endingEnd=t?this.zeroSlopeAtEnd?It:Dt:Nt)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=r,this}}),su.prototype=Object.assign(Object.create(n.prototype),{constructor:su,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var h=0;h!==i;++h){var c=n[h],d=c.name,f=u[d];if(void 0!==f)a[h]=f;else{if(void 0!==(f=a[h])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[h].binding.parsedPath;++(f=new ru(iu.create(r,d,p),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[h]=f}o[h].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],a=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i];e:{for(var u in o)break e;delete a[n]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new es(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?hs.findByName(r,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[n];if(void 0!==l)return l;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new ou(this,i,t);return this._bindAction(u,s),this._addInactiveAction(u,a,n),u},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?hs.findByName(r,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o)t[o]._update(n,e,i,a);var s=this._bindings,l=this._nActiveBindings;for(o=0;o!==l;++o)s[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),lu.prototype.clone=function(){return new lu(void 0===this.value.clone?this.value:this.value.clone())},uu.prototype=Object.assign(Object.create(on.prototype),{constructor:uu,isInstancedBufferGeometry:!0,copy:function(e){return on.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),hu.prototype=Object.assign(Object.create(ua.prototype),{constructor:hu,isInstancedInterleavedBuffer:!0,copy:function(e){return ua.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),cu.prototype=Object.assign(Object.create(qr.prototype),{constructor:cu,isInstancedBufferAttribute:!0,copy:function(e){return qr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(du.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return pu(e,this,n,t),n.sort(fu),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=e.length;i<a;i++)pu(e[i],this,n,t);return n.sort(fu),n}}),Object.assign(mu.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Kt.clamp(t/this.radius,-1,1))),this}}),Object.assign(vu.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(gu.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Qt;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Qt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Qt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Qt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Qt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Qt;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(yu.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new tr),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new tr),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new tr),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(Gl=new tr,jl=new tr,function(e,t){Gl.subVectors(e,this.start),jl.subVectors(this.end,this.start);var r=jl.dot(jl),n=jl.dot(Gl)/r;return t&&(n=Kt.clamp(n,0,1)),n}),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new tr),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),xu.prototype=Object.create(Gr.prototype),xu.prototype.constructor=xu,xu.prototype.isImmediateRenderObject=!0,bu.prototype=Object.create(xa.prototype),bu.prototype.constructor=bu,bu.prototype.update=function(){var e=new tr,t=new tr,r=new rr;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,u=0,h=0,c=l.length;h<c;h++)for(var d=l[h],f=0,p=d.vertexNormals.length;f<p;f++){var m=s[d[n[f]]],v=d.vertexNormals[f];e.copy(m).applyMatrix4(i),t.copy(v).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(u,e.x,e.y,e.z),u+=1,a.setXYZ(u,t.x,t.y,t.z),u+=1}else if(o&&o.isBufferGeometry){var g=o.attributes.position,y=o.attributes.normal;for(u=0,f=0,p=g.count;f<p;f++)e.set(g.getX(f),g.getY(f),g.getZ(f)).applyMatrix4(i),t.set(y.getX(f),y.getY(f),y.getZ(f)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(u,e.x,e.y,e.z),u+=1,a.setXYZ(u,t.x,t.y,t.z),u+=1}a.needsUpdate=!0}}(),wu.prototype=Object.create(Gr.prototype),wu.prototype.constructor=wu,wu.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},wu.prototype.update=function(){var e=new tr;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),_u.prototype=Object.create(xa.prototype),_u.prototype.constructor=_u,_u.prototype.updateMatrixWorld=function(){var e=new tr,t=new $t,r=new $t;return function(n){var i=this.bones,a=this.geometry,o=a.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<i.length;s++){var u=i[s];u.parent&&u.parent.isBone&&(t.multiplyMatrices(r,u.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(r,u.parent.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l+1,e.x,e.y,e.z),l+=2)}a.getAttribute("position").needsUpdate=!0,Gr.prototype.updateMatrixWorld.call(this,n)}}(),Mu.prototype=Object.create(Pn.prototype),Mu.prototype.constructor=Mu,Mu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Mu.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Eu.prototype=Object.create(Gr.prototype),Eu.prototype.constructor=Eu,Eu.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Eu.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=e,n[1]=-t,n[2]=0,n[3]=e,n[4]=t,n[5]=0,n[6]=-e,n[7]=t,n[8]=0,n[9]=-e,n[10]=-t,n[11]=0,n[12]=e,n[13]=-t,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},Su.prototype=Object.create(Gr.prototype),Su.prototype.constructor=Su,Su.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Su.prototype.update=function(){var e=new tr,t=new Ar,r=new Ar;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var a=0,o=i.count;a<o;a++){var s=a<o/2?t:r;i.setXYZ(a,s.r,s.g,s.b)}i.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Tu.prototype=Object.create(xa.prototype),Tu.prototype.constructor=Tu,Au.prototype=Object.create(xa.prototype),Au.prototype.constructor=Au,Lu.prototype=Object.create(xa.prototype),Lu.prototype.constructor=Lu,Lu.prototype.update=function(){var e=new tr,t=new tr,r=new rr;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,u=0,h=s.length;u<h;u++){var c=s[u],d=c.normal;e.copy(o[c.a]).add(o[c.b]).add(o[c.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),Pu.prototype=Object.create(Gr.prototype),Pu.prototype.constructor=Pu,Pu.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Pu.prototype.update=function(){var e=new tr,t=new tr,r=new tr;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=r.length()}}(),Cu.prototype=Object.create(xa.prototype),Cu.prototype.constructor=Cu,Cu.prototype.update=function(){var e,t,r=new tr,n=new qi;function i(i,a,o,s){r.set(a,o,s).unproject(n);var l=t[i];if(void 0!==l)for(var u=e.getAttribute("position"),h=0,c=l.length;h<c;h++)u.setXYZ(l[h],r.x,r.y,r.z)}return function(){e=this.geometry,t=this.pointMap,n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),Ru.prototype=Object.create(xa.prototype),Ru.prototype.constructor=Ru,Ru.prototype.update=function(){var e=new mr;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,n=e.max,i=this.geometry.attributes.position,a=i.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=r.x,a[4]=n.y,a[5]=n.z,a[6]=r.x,a[7]=r.y,a[8]=n.z,a[9]=n.x,a[10]=r.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=r.z,a[15]=r.x,a[16]=n.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=n.x,a[22]=r.y,a[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ru.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ru.prototype.copy=function(e){return xa.prototype.copy.call(this,e),this.object=e.object,this},Ru.prototype.clone=function(){return(new this.constructor).copy(this)},Ou.prototype=Object.create(xa.prototype),Ou.prototype.constructor=Ou,Ou.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Gr.prototype.updateMatrixWorld.call(this,e))},Du.prototype=Object.create(ya.prototype),Du.prototype.constructor=Du,Du.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?L:A,this.lookAt(this.plane.normal),Gr.prototype.updateMatrixWorld.call(this,e)},Iu.prototype=Object.create(Gr.prototype),Iu.prototype.constructor=Iu,Iu.prototype.setDirection=(ql=new tr,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(ql.set(e.z,0,-e.x).normalize(),Wl=Math.acos(e.y),this.quaternion.setFromAxisAngle(ql,Wl))}),Iu.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Iu.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Iu.prototype.copy=function(e){return Gr.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Iu.prototype.clone=function(){return(new this.constructor).copy(this)},Nu.prototype=Object.create(xa.prototype),Nu.prototype.constructor=Nu;var Uu=0,ku=1;function Bu(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function zu(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Gu(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new _a(e,t)}function ju(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new da(e)}function Vu(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new _a(e,t)}function Hu(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new wa(e)}function Wu(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new wa(e)}function qu(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new wa(e)}function Xu(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new tr(e,t,r)}function Yu(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new qr(e,t).setDynamic(!0)}function Zu(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Xr(e,t)}function Ju(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Yr(e,t)}function Ku(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Zr(e,t)}function Qu(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Jr(e,t)}function $u(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Kr(e,t)}function eh(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Qr(e,t)}function th(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new $r(e,t)}function rh(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new en(e,t)}function nh(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new tn(e,t)}function ih(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Rs.call(this,e),this.type="catmullrom",this.closed=!0}function ah(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Rs.call(this,e),this.type="catmullrom"}function oh(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Rs.call(this,e),this.type="catmullrom"}function sh(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Nu(e)}function lh(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ru(e,t)}function uh(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new xa(new Oo(e.geometry),new ga({color:void 0!==t?t:16777215}))}function hh(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new xa(new Aa(e.geometry),new ga({color:void 0!==t?t:16777215}))}function ch(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new vs(e)}function dh(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new xs(e)}Ms.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ms.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Vs.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Wr,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new tr(i.x,i.y,i.z||0))}return t}}),Object.assign(Hs.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),ih.prototype=Object.create(Rs.prototype),ah.prototype=Object.create(Rs.prototype),oh.prototype=Object.create(Rs.prototype),Object.assign(oh.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Tu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},_u.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(wl.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),il.extractUrlBase(e)}}),Object.assign(sl.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(gu.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(mr.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),yu.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Kt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Kt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Kt.ceilPowerOfTwo(e)}}),Object.assign(rr.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign($t.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new tr),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,a)}}),gr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},er.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Tn.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(An.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(An,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),An.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),An.getNormal(e,t,r,n)}}),Object.assign(Ws.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new go(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Po(this,e)}}),Object.assign(Qt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(tr.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(cr.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Gr.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Gr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(fa.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ma.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),pa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ms.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Xi.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(qs.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(qr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(on.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(on.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(yo.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(lu.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(En.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ar}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===C}}}),Object.defineProperties(Ho.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Sn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(aa.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(aa.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ji.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(dr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(ia.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),$l.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Yl).load(e,function(e){t.setBuffer(e)}),this},tu.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Jl.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var fh={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function ph(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function mh(){console.error("THREE.CanvasRenderer has been removed")}function vh(){console.error("THREE.JSONLoader has been removed.")}lr.crossOrigin=void 0,lr.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new _s;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},lr.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new ws;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},lr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},lr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var gh={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function yh(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(t)}e.exports=r},function(e,t,r){var n=r(19),i=r(11);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?i(e):t}},function(e,t,r){var n=r(41);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.crsToUnit=p,t.reasonnableEpsilonForCRS=function(e){return w(e)?.01:.001},t.assertCrsIsValid=function(e){m(e)},t.crsIsGeographic=v,t.crsIsGeocentric=g,t.is4326=w,t.default=t.C=t.UNIT=t.ellipsoidSizes=void 0;var a=i(r(20)),o=i(r(12)),s=n(r(0)),l=i(r(145)),u=i(r(32));l.default.defs("EPSG:4978","+proj=geocent +datum=WGS84 +units=m +no_defs");var h={},c={x:6378137,y:6378137,z:6356752.314245179};t.ellipsoidSizes=c;var d=new u.default(c),f={DEGREE:1,METER:2};function p(e){switch(e){case"EPSG:4326":return f.DEGREE;case"EPSG:4978":return f.METER;default:var t=l.default.defs(e);if(!t)return;return"degrees"===(r=t.units)?f.DEGREE:"m"===r?f.METER:void 0}var r}function m(e){var t=p(e);if(void 0===e||void 0===t)throw new Error("Invalid crs paramater value '".concat(e,"'"));return t}function v(e){return m(e)!=f.METER}function g(e){return m(e)==f.METER}function y(e){if(!v(e))throw new Error("Can't query crs ".concat(e," long/lat"))}function x(e){if(!g(e))throw new Error("Can't query crs ".concat(e," x/y/z"))}function b(e,t){if(h[e]){var r=h[e];if(r[t])return r[t]}else h[e]={};var n=(0,l.default)(e,t);return h[e][t]=n,n}function w(e){return 0==e.indexOf("EPSG:4326")}t.UNIT=f;var _=new s.Vector3;function M(e){var t=this;this._values=new Float64Array(3);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.set.apply(this,[e].concat(n)),this._normalNeedsUpdate=!0,this._normal=new s.Vector3,Object.defineProperty(this,"geodesicNormal",{configurable:!0,get:function(){return t._normalNeedsUpdate?((e=t)._normalNeedsUpdate=!1,w(e.crs)?d.geodeticSurfaceNormalCartographic(e,e._normal):"EPSG:4978"==e.crs?d.geodeticSurfaceNormal(e,e._normal):(e._normal.copy(E),E)):t._normal;var e}})}var E=new s.Vector3(0,0,1);M.prototype.set=function(e){m(e),this.crs=e;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(1==r.length&&r[0]instanceof s.Vector3)this._values[0]=r[0].x,this._values[1]=r[0].y,this._values[2]=r[0].z;else{for(var i=0;i<r.length&&i<3;i++)this._values[i]=r[i];for(var a=r.length;a<3;a++)this._values[a]=0}return this._normalNeedsUpdate=!0,this},M.prototype.clone=function(e){var t;return e?(M.call.apply(M,[e,this.crs].concat((0,o.default)(this._values))),t=e):t=(0,a.default)(M,[this.crs].concat((0,o.default)(this._values))),this._normal&&t._normal.copy(this._normal),t},M.prototype.copy=function(e){return this.set.apply(this,[e.crs].concat((0,o.default)(e._values))),this},M.prototype.longitude=function(){return y(this.crs),this._values[0]},M.prototype.latitude=function(){return this._values[1]},M.prototype.altitude=function(){return y(this.crs),this._values[2]},M.prototype.setAltitude=function(e){y(this.crs),this._values[2]=e},M.prototype.x=function(){return x(this.crs),this._values[0]},M.prototype.y=function(){return x(this.crs),this._values[1]},M.prototype.z=function(){return x(this.crs),this._values[2]},M.prototype.xyz=function(e){x(this.crs);var t=e||new s.Vector3;return t.fromArray(this._values),t},M.prototype.as=function(e,t){if(void 0===e||void 0===p(e))throw new Error("Invalid crs paramater value '".concat(e,"'"));return function(e,t,r){if(r=r||new M(t,0,0),t===e.crs)return r.copy(e);if(w(e.crs)&&"EPSG:4978"===t)return d.cartographicToCartesian(e,_),r.set(t,_),r._normal=e._normal,r._normalNeedsUpdate=!1,r;if("EPSG:4978"===e.crs&&w(t))return d.cartesianToCartographic({x:e._values[0],y:e._values[1],z:e._values[2]},r),r;if(e.crs in l.default.defs&&t in l.default.defs){var n=e._values[0],i=e._values[1],a=e.crs;if("EPSG:4978"==t){var o=b(a,"EPSG:4326").forward([n,i]);return r.set("EPSG:4326",o[0],o[1],e._values[2]),r.as("EPSG:4978",r)}if("EPSG:4978"===e.crs){e.as("EPSG:4326",r);var u=b(r.crs,t).forward([r._values[0],r._values[1]]);return r.set(t,u[0],u[1],r._values[2]),r}if(w(a)&&"EPSG:3857"==t){i=s.Math.clamp(i,-89.999999,89.999999);var h=b(a,t).forward([n,i]);return r.set(t,h[0],h[1],e._values[2])}var c=b(a,t).forward([n,i]);return r.set(t,c[0],c[1],e._values[2])}throw new Error("Cannot convert from crs ".concat(e.crs," to ").concat(t))}(this,e,t)},M.prototype.offsetInExtent=function(e,t){if(this.crs!=e.crs())throw new Error("unsupported mix");var r=Math.abs(e.east()-e.west()),n=Math.abs(e.north()-e.south()),i=g(this.crs)?this.x():this.longitude(),a=g(this.crs)?this.y():this.latitude(),o=(i-e.west())/r,l=(e.north()-a)/n;return(t=t||new s.Vector2).set(o,l),t};var S={EPSG_4326:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.default)(M,["EPSG:4326"].concat(t))}};t.C=S;var T=M;t.default=T},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(20)),o=i(r(12)),s=n(r(0)),l=n(r(8)),u=i(r(33)),h={WEST:0,EAST:1,SOUTH:2,NORTH:3};function c(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if(this._crs=e,this.isTiledCrs()){if(3!=n.length)throw new Error("Unsupported constructor args '".concat(n,"'"));if(this.zoom=n[0],this.row=n[1],this.col=n[2],this.zoom<0)throw new Error("invlid WTMS values ".concat(n))}else if(2===n.length&&n[0]instanceof l.default&&n[1]instanceof l.default)this._values=new Float64Array(4),this._values[h.WEST]=n[0]._values[0],this._values[h.EAST]=n[1]._values[0],this._values[h.SOUTH]=n[0]._values[1],this._values[h.NORTH]=n[1]._values[1];else if(1==n.length&&null!=n[0].west)this._values=new Float64Array(4),this._values[h.WEST]=n[0].west,this._values[h.EAST]=n[0].east,this._values[h.SOUTH]=n[0].south,this._values[h.NORTH]=n[0].north;else{if(4!=n.length)throw new Error("Unsupported constructor args '".concat(n,"'"));this._values=new Float64Array(4),Object.keys(h).forEach(function(e){var r=h[e];t._values[r]=n[r]})}}c.prototype.clone=function(){return this.isTiledCrs()?new c(this._crs,this.zoom,this.row,this.col):(0,a.default)(c,[this._crs].concat((0,o.default)(this._values)))},c.prototype.isTiledCrs=function(){return 0==this._crs.indexOf("WMTS:")||"TMS"==this._crs};var d=new l.default("EPSG:4326",180,85.06);d.as("EPSG:3857",d);var f=2*d._values[0],p=2*d._values[1];c.prototype.as=function(e){if((0,l.assertCrsIsValid)(e),this.isTiledCrs()){if("WMTS:PM"==this._crs||"TMS"==this._crs){var t=Math.pow(2,this.zoom),r=1/t,n=1-r*(t-this.row),i=n+r;if("EPSG:3857"==e){var a=(.5-r*(t-this.col))*f;return new c("EPSG:3857",{west:a,east:a+r*f,south:(.5-i)*p,north:(.5-n)*p}).as(e)}var o=360/t,s=u.default.YToWGS84(n),h=u.default.YToWGS84(i),d=180-o*(t-this.col),m=c("EPSG:4326",{west:d,east:d+o,south:h,north:s});return"EPSG:4326"==e?m:m.as(e)}if("WMTS:WGS84G"==this._crs&&"EPSG:4326"==e){var v=Math.pow(2,this.zoom),g=180/v,y=g*(v-this.row)-90,x=g*(v-(this.row+1))-90;return new c(e,{west:180-g*(2*v-this.col),east:180-g*(2*v-(this.col+1)),south:x,north:y})}throw new Error("Unsupported yet")}if(!(this._crs==e||(0,l.is4326)(this._crs)&&(0,l.is4326)(e))){var b=[],w=this.center();b.push(new l.default(this._crs,this.west(),this.north())),b.push(new l.default(this._crs,w._values[0],this.north())),b.push(new l.default(this._crs,this.east(),this.north())),b.push(new l.default(this._crs,this.east(),w._values[1])),b.push(new l.default(this._crs,this.east(),this.south())),b.push(new l.default(this._crs,w._values[0],this.south())),b.push(new l.default(this._crs,this.west(),this.south())),b.push(new l.default(this._crs,this.west(),w._values[1]));for(var _=-1/0,M=1/0,E=-1/0,S=1/0,T=0;T<b.length;T++)b[T]=b[T].as(e),_=Math.max(_,b[T]._values[1]),M=Math.min(M,b[T]._values[1]),E=Math.max(E,b[T]._values[0]),S=Math.min(S,b[T]._values[0]);return new c(e,{north:_,south:M,east:E,west:S})}return new c(e,{west:this.west(),east:this.east(),north:this.north(),south:this.south()})},c.prototype.offsetToParent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector4;if(this.crs()!=e.crs())throw new Error("unsupported mix");if(this.isTiledCrs()){var r=this.zoom-e.zoom,n=Math.pow(2,r),i=1/n,a=(this.row-this.row%n)*i,o=(this.col-this.col%n)*i;return t.set(this.col*i-o,this.row*i-a,i,i)}var l=Math.abs(e.east()-e.west()),u=Math.abs(e.north()-e.south()),h=(this.west()-e.west())/l,c=(e.north()-this.north())/u,d=Math.abs(this.east()-this.west())/l,f=Math.abs(this.north()-this.south())/u;return t.set(h,c,d,f)},c.prototype.west=function(){return this._values[h.WEST]},c.prototype.east=function(){return this._values[h.EAST]},c.prototype.north=function(){return this._values[h.NORTH]},c.prototype.south=function(){return this._values[h.SOUTH]},c.prototype.crs=function(){return this._crs},c.prototype.center=function(e){if(this.isTiledCrs())throw new Error("Invalid operation for WMTS bbox");var t;e?(l.default.call(e,this._crs,this._values[0],this._values[2]),t=e):t=new l.default(this._crs,this._values[0],this._values[2]);var r=this.dimensions();return t._values[0]+=.5*r.x,t._values[1]+=.5*r.y,t},c.prototype.dimensions=function(e){return(e=e||{x:0,y:0}).x=Math.abs(this.east()-this.west()),e.y=Math.abs(this.north()-this.south()),e},c.prototype.isPointInside=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.crs()==e.crs?e:e.as(this.crs());return(0,l.crsIsGeographic)(this.crs())?r.longitude()<=this.east()+t&&r.longitude()>=this.west()-t&&r.latitude()<=this.north()+t&&r.latitude()>=this.south()-t:r.x()<=this.east()+t&&r.x()>=this.west()-t&&r.y()<=this.north()+t&&r.y()>=this.south()-t},c.prototype.isInside=function(e,t){if(this.isTiledCrs()){if(this.zoom==e.zoom)return this.row==e.row&&this.col==e.col;if(this.zoom<e.zoom)return!1;var r=this.zoom-e.zoom,n=Math.pow(2,r),i=1/n,a=(this.row-this.row%n)*i,o=(this.col-this.col%n)*i;return a==e.row&&o==e.col}var s=e.as(this._crs);return t=null==t?(0,l.reasonnableEpsilonForCRS)(this._crs):t,this.east()-s.east()<=t&&s.west()-this.west()<=t&&this.north()-s.north()<=t&&s.south()-this.south()<=t},c.prototype.offsetScale=function(e){if(e.crs()!=this.crs())throw new Error("unsupported offscale between 2 diff crs");var t=Math.abs(this.east()-this.west()),r=Math.abs(this.north()-this.south()),n=(e.west()-this.west())/t,i=(e.north()-this.north())/r,a=Math.abs(e.east()-e.west())/t,o=Math.abs(e.north()-e.south())/r;return new s.Vector4(n,i,a,o)},c.prototype.intersectsExtent=function(e){var t=e.crs()==this.crs()?e:e.as(this.crs());return!(this.west()>=t.east()||this.east()<=t.west()||this.south()>=t.north()||this.north()<=t.south())},c.prototype.intersect=function(e){return this.intersectsExtent(e)?(e.crs()!=this.crs()&&(e=e.as(this.crs())),new c(this.crs(),Math.max(this.west(),e.west()),Math.min(this.east(),e.east()),Math.max(this.south(),e.south()),Math.min(this.north(),e.north()))):new c(this.crs(),0,0,0,0)},c.prototype.set=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.isTiledCrs()?(this.zoom=r[0],this.row=r[1],this.col=r[2]):Object.keys(h).forEach(function(t){var n=h[t];e._values[n]=r[n]}),this},c.prototype.union=function(e){if(e.crs()!=this.crs())throw new Error("unsupported union between 2 diff crs");var t=e.west();t<this.west()&&(this._values[h.WEST]=t);var r=e.east();r>this.east()&&(this._values[h.EAST]=r);var n=e.south();n<this.south()&&(this._values[h.SOUTH]=n);var i=e.north();i>this.north()&&(this._values[h.NORTH]=i)};var m=new l.default("EPSG:4326",0,0,0);c.prototype.expandByPoint=function(e){var t=e.crs==this.crs()?e:e.as(this.crs(),m),r=t._values[0];r<this.west()&&(this._values[h.WEST]=r),r>this.east()&&(this._values[h.EAST]=r);var n=t._values[1];n<this.south()&&(this._values[h.SOUTH]=n),n>this.north()&&(this._values[h.NORTH]=n)},c.fromBox3=function(e,t){return new c(e,{west:t.min.x,east:t.max.x,south:t.min.y,north:t.max.y})},c.prototype.extentParent=function(e){if(this.isTiledCrs()){if(e&&e<this.zoom){var t=this.zoom-e,r=Math.pow(2,t),n=1/r,i=(this.row-this.row%r)*n,a=(this.col-this.col%r)*n;return new c(this.crs(),e,i,a)}return this}},c.prototype.toString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.isTiledCrs()?"".concat(this.zoom).concat(e).concat(this.row).concat(e).concat(this.col):"".concat(this.east()).concat(e).concat(this.north()).concat(e).concat(this.west()).concat(e).concat(this.south())};var v=new l.default("EPSG:4326",0,0,0);c.prototype.subdivision=function(){return this.center(v),[new c(this.crs(),this.west(),v._values[0],v._values[1],this.north()),new c(this.crs(),v._values[0],this.east(),v._values[1],this.north()),new c(this.crs(),this.west(),v._values[0],this.south(),v._values[1]),new c(this.crs(),v._values[0],this.east(),this.south(),v._values[1])]};var g=c;t.default=g},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Coordinates",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"UNIT",{enumerable:!0,get:function(){return a.UNIT}}),Object.defineProperty(t,"ellipsoidSizes",{enumerable:!0,get:function(){return a.ellipsoidSizes}}),Object.defineProperty(t,"Extent",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"Ellipsoid",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"GlobeView",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"GLOBE_VIEW_EVENTS",{enumerable:!0,get:function(){return l.GLOBE_VIEW_EVENTS}}),Object.defineProperty(t,"createGlobeLayer",{enumerable:!0,get:function(){return l.createGlobeLayer}}),Object.defineProperty(t,"PlanarView",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"createPlanarLayer",{enumerable:!0,get:function(){return u.createPlanarLayer}}),Object.defineProperty(t,"PanoramaView",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"createPanoramaLayer",{enumerable:!0,get:function(){return h.createPanoramaLayer}}),Object.defineProperty(t,"Panorama",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"Fetcher",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"MAIN_LOOP_EVENTS",{enumerable:!0,get:function(){return f.MAIN_LOOP_EVENTS}}),Object.defineProperty(t,"View",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"VIEW_EVENTS",{enumerable:!0,get:function(){return p.VIEW_EVENTS}}),Object.defineProperty(t,"GpxParser",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"GeoJsonParser",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"CameraCalibrationParser",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"process3dTilesNode",{enumerable:!0,get:function(){return y.process3dTilesNode}}),Object.defineProperty(t,"init3dTilesLayer",{enumerable:!0,get:function(){return y.init3dTilesLayer}}),Object.defineProperty(t,"$3dTilesCulling",{enumerable:!0,get:function(){return y.$3dTilesCulling}}),Object.defineProperty(t,"$3dTilesSubdivisionControl",{enumerable:!0,get:function(){return y.$3dTilesSubdivisionControl}}),Object.defineProperty(t,"pre3dTilesUpdate",{enumerable:!0,get:function(){return y.pre3dTilesUpdate}}),Object.defineProperty(t,"FeatureProcessing",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(t,"updateLayeredMaterialNodeImagery",{enumerable:!0,get:function(){return b.updateLayeredMaterialNodeImagery}}),Object.defineProperty(t,"updateLayeredMaterialNodeElevation",{enumerable:!0,get:function(){return b.updateLayeredMaterialNodeElevation}}),Object.defineProperty(t,"OrientedImageCamera",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"PointsMaterial",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"PointCloudProcessing",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(t,"FlyControls",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"FirstPersonControls",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"PlanarControls",{enumerable:!0,get:function(){return T.default}}),Object.defineProperty(t,"CONTROL_EVENTS",{enumerable:!0,get:function(){return A.CONTROL_EVENTS}}),Object.defineProperty(t,"Feature2Mesh",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(t,"FeaturesUtils",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(t,"DEMUtils",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"CameraUtils",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"OrientationUtils",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(t,"ShaderChunk",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(t,"getMaxColorSamplerUnitsCount",{enumerable:!0,get:function(){return I.getMaxColorSamplerUnitsCount}}),Object.defineProperty(t,"Layer",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"ImageryLayers",{enumerable:!0,get:function(){return N.ImageryLayers}}),Object.defineProperty(t,"ColorLayer",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(t,"ElevationLayer",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(t,"GeometryLayer",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(t,"TiledGeometryLayer",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(t,"STRATEGY_MIN_NETWORK_TRAFFIC",{enumerable:!0,get:function(){return z.STRATEGY_MIN_NETWORK_TRAFFIC}}),Object.defineProperty(t,"STRATEGY_GROUP",{enumerable:!0,get:function(){return z.STRATEGY_GROUP}}),Object.defineProperty(t,"STRATEGY_PROGRESSIVE",{enumerable:!0,get:function(){return z.STRATEGY_PROGRESSIVE}}),Object.defineProperty(t,"STRATEGY_DICHOTOMY",{enumerable:!0,get:function(){return z.STRATEGY_DICHOTOMY}}),Object.defineProperty(t,"ColorLayersOrdering",{enumerable:!0,get:function(){return G.default}}),Object.defineProperty(t,"GlobeLayer",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(t,"PlanarLayer",{enumerable:!0,get:function(){return V.default}}),Object.defineProperty(t,"Source",{enumerable:!0,get:function(){return H.default}}),Object.defineProperty(t,"FileSource",{enumerable:!0,get:function(){return W.default}}),Object.defineProperty(t,"StaticSource",{enumerable:!0,get:function(){return q.default}}),Object.defineProperty(t,"TMSSource",{enumerable:!0,get:function(){return X.default}}),Object.defineProperty(t,"WFSSource",{enumerable:!0,get:function(){return Y.default}}),Object.defineProperty(t,"WMSSource",{enumerable:!0,get:function(){return Z.default}}),Object.defineProperty(t,"WMTSSource",{enumerable:!0,get:function(){return J.default}});var a=i(r(8)),o=n(r(9)),s=n(r(32)),l=i(r(80)),u=i(r(120)),h=i(r(122)),c=n(r(40)),d=n(r(18)),f=r(13),p=i(r(21)),m=n(r(125)),v=n(r(27)),g=n(r(127)),y=r(58),x=n(r(128)),b=r(23),w=n(r(73)),_=n(r(60)),M=n(r(59)),E=n(r(129)),S=n(r(130)),T=n(r(131)),A=r(69),L=n(r(132)),P=n(r(134)),C=n(r(34)),R=n(r(39)),O=n(r(135)),D=n(r(136)),I=r(17),N=i(r(14)),F=n(r(47)),U=n(r(50)),k=n(r(38)),B=n(r(31)),z=r(37),G=n(r(68)),j=n(r(70)),V=n(r(72)),H=n(r(16)),W=n(r(66)),q=n(r(65)),X=n(r(64)),Y=n(r(63)),Z=n(r(62)),J=n(r(61))},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,r){var n=r(77),i=r(78),a=r(79);e.exports=function(e){return n(e)||i(e)||a()}},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MAIN_LOOP_EVENTS=t.RENDERING_SCHEDULED=t.RENDERING_PAUSED=void 0;var i=r(0),a=n(r(35)),o=0;t.RENDERING_PAUSED=o,t.RENDERING_SCHEDULED=1;var s={UPDATE_START:"update_start",BEFORE_CAMERA_UPDATE:"before_camera_update",AFTER_CAMERA_UPDATE:"after_camera_update",BEFORE_LAYER_UPDATE:"before_layer_update",AFTER_LAYER_UPDATE:"after_layer_update",BEFORE_RENDER:"before_render",AFTER_RENDER:"after_render",UPDATE_END:"update_end"};function l(e,t){this.renderingState=o,this.needsRedraw=!1,this.scheduler=e,this.gfxEngine=t,this._updateLoopRestarted=!0}function u(e,t,r){if(r){var n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,h=t.update(e,t,l),c=t.getObjectToUpdateForAttachedLayers(l);if(c)if(c.element){var d=!0,f=!1,p=void 0;try{for(var m,v=t.attachedLayers[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var g=m.value;g.ready&&g.update(e,g,c.element,c.parent)}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}}else if(c.elements)for(var y=0;y<c.elements.length;y++){if(!c.elements[y].isObject3D)throw new Error("\n                            Invalid object for attached layer to update.\n                            Must be a THREE.Object and have a THREE.Material");var x=!0,b=!1,w=void 0;try{for(var _,M=t.attachedLayers[Symbol.iterator]();!(x=(_=M.next()).done);x=!0){var E=_.value;E.ready&&E.update(e,E,c.elements[y],c.parent)}}catch(e){b=!0,w=e}finally{try{x||null==M.return||M.return()}finally{if(b)throw w}}}u(e,t,h)}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}}function h(e,t){var r=!1,n=new Set;return e.forEach(function(e){e===t||e.isCamera?(t.info.clear(),r=!0):e.layer===t&&n.add(e)}),r?new Set([t]):n}t.MAIN_LOOP_EVENTS=s,l.prototype=Object.create(i.EventDispatcher.prototype),l.prototype.constructor=l,l.prototype.scheduleViewUpdate=function(e,t){var r=this;this.needsRedraw|=t,1!==this.renderingState&&(this.renderingState=1,requestAnimationFrame(function(t){r._step(e,t)}))},l.prototype._update=function(e,t,r){var n={camera:e.camera,engine:this.gfxEngine,scheduler:this.scheduler,view:e};t.forEach(function(r){var n=r.layer||r;if(n.isLayer){var i=e.getParentLayer(n);i&&t.add(i)}});var i=!0,a=!1,o=void 0;try{for(var l,c=e.getLayers(function(e,t){return!t})[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var d=l.value;if(n.geometryLayer=d,d.ready&&d.visible&&!d.frozen){e.execFrameRequesters(s.BEFORE_LAYER_UPDATE,r,this._updateLoopRestarted,d);var f=h(t,d);f.size>0&&(u(n,d,d.preUpdate(n,f)),d.postUpdate(n,d,t)),e.execFrameRequesters(s.AFTER_LAYER_UPDATE,r,this._updateLoopRestarted,d)}}}catch(e){a=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}},l.prototype._step=function(e,t){var r=t-this._lastTimestamp;e._executeFrameRequestersRemovals(),e.execFrameRequesters(s.UPDATE_START,r,this._updateLoopRestarted);var n=this.needsRedraw;this._lastTimestamp=t,this.needsRedraw=!1,this.renderingState=o;var i=new Set(e._changeSources);e._changeSources.clear();var l=this.gfxEngine.getWindowSize();e.execFrameRequesters(s.BEFORE_CAMERA_UPDATE,r,this._updateLoopRestarted),e.camera.update(l.x,l.y),e.execFrameRequesters(s.AFTER_CAMERA_UPDATE,r,this._updateLoopRestarted);var u=e.camera.camera3D.matrixAutoUpdate;e.camera.camera3D.matrixAutoUpdate=!1,this._update(e,i,r),0==this.scheduler.commandsWaitingExecutionCount()&&this.dispatchEvent({type:"command-queue-empty"}),n&&this._renderView(e,r),this._updateLoopRestarted=this.renderingState===o,e.camera.camera3D.matrixAutoUpdate=u,a.default.flush(),e.execFrameRequesters(s.UPDATE_END,r,this._updateLoopRestarted)},l.prototype._renderView=function(e,t){e.execFrameRequesters(s.BEFORE_RENDER,t,this._updateLoopRestarted),e.render?e.render():this.gfxEngine.renderView(e),e.execFrameRequesters(s.AFTER_RENDER,t,this._updateLoopRestarted)};var c=l;t.default=c},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageryLayers=t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=i(r(11)),c=n(r(0)),d=r(37),f=i(r(46)),p=function(e){function t(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,a.default)(this,t),(n=(0,s.default)(this,(0,l.default)(t).call(this))).isLayer=!0,Object.assign((0,h.default)((0,h.default)(n)),i),Object.defineProperty((0,h.default)((0,h.default)(n)),"id",{value:e,writable:!1}),Object.defineProperty((0,h.default)((0,h.default)(n)),"type",{value:r,writable:!1}),n.options=i.options||{},n.updateStrategy||(n.updateStrategy={type:d.STRATEGY_MIN_NETWORK_TRAFFIC,options:{}}),n.defineLayerProperty("frozen",!1),n.info=new f.default((0,h.default)((0,h.default)(n))),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"defineLayerProperty",value:function(e,t,r){var n=this,i=Object.getOwnPropertyDescriptor(this,e);if(!i||!i.set){var a=null==this[e]?t:this[e];Object.defineProperty(this,e,{get:function(){return a},set:function(t){if(a!==t){var i={type:"".concat(e,"-property-changed"),previous:{},new:{}};i.previous[e]=a,i.new[e]=t,a=t,r&&r(n,e),n.dispatchEvent(i)}}})}}},{key:"convert",value:function(e){return e}}]),t}(c.EventDispatcher);t.default=p;var m={moveLayerToIndex:function(e,t,r){t=Math.min(t,r.length-1),t=Math.max(t,0);var n=e.sequence,i=!0,a=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;u.id===e.id?u.sequence=t:u.sequence>n&&u.sequence<=t?u.sequence--:u.sequence>=t&&u.sequence<n&&u.sequence++}}catch(e){a=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}},moveLayerDown:function(e,t){e.sequence>0&&this.moveLayerToIndex(e,e.sequence-1,t)},moveLayerUp:function(e,t){var r=t.length-1;e.sequence<r&&this.moveLayerToIndex(e,e.sequence+1,t)},getColorLayersIdOrderedBySequence:function(e){var t=Array.from(e);return t.sort(function(e,t){return e.sequence-t.sequence}),t.map(function(e){return e.id})}};t.ImageryLayers=m},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=function(){function e(t){(0,i.default)(this,e),this.command=t}return(0,a.default)(e,[{key:"toString",value:function(){return"Cancelled command ".concat(this.command.requester.id,"/").concat(this.command.layer.id)}}]),e}();t.default=o},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(20)),a=n(r(12)),o=n(r(3)),s=n(r(4)),l=n(r(9)),u=function(){function e(t){if((0,o.default)(this,e),this.isSource=!0,!t.url)throw new Error("New Source: url is required");this.url=t.url,this.format=t.format,this.fetcher=t.fetcher,this.networkOptions=t.networkOptions||{crossOrigin:"anonymous"},this.projection=t.projection,this.attribution=t.attribution,!t.extent||t.extent instanceof l.default?this.extent=t.extent:Array.isArray(t.extent)?this.extent=(0,i.default)(l.default,[this.projection].concat((0,a.default)(t.extent))):this.extent=new l.default(this.projection,t.extent)}return(0,s.default)(e,[{key:"handlingError",value:function(e){console.warn("err ".concat(this),e)}},{key:"urlFromExtent",value:function(){throw new Error("In extented Source, you have to implement the method urlFromExtent!")}},{key:"extentInsideLimit",value:function(){throw new Error("In extented Source, you have to implement the method extentInsideLimit!")}},{key:"extentsInsideLimit",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(!this.extentInsideLimit(o))return!1}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return!0}}]),e}();t.default=u},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.unpack1K=function(e,t){return t?x.dot(e)*t:x.dot(e)},t.getMaxColorSamplerUnitsCount=M,t.default=t.ELEVATION_MODES=t.CRS_DEFINES=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=i(r(11)),c=n(r(0)),d=i(r(43)),f=i(r(22)),p=i(r(36)),m=i(r(44)),v="#include <itowns/precision_qualifier>\n#include <itowns/project_pars_vertex>\n#include <itowns/elevation_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nattribute float     uv_pm;\nattribute vec2      uv_wgs84;\nattribute vec3      normal;\n\nuniform mat4 modelMatrix;\nuniform bool lightingEnabled;\n\n#if MODE == MODE_FINAL\n#include <fog_pars_vertex>\nvarying vec3        vUv;\nvarying vec3        vNormal;\n#endif\nvoid main() {\n        vec2 uv = vec2(uv_wgs84.x, 1.0 - uv_wgs84.y);\n\n        #include <begin_vertex>\n        #include <itowns/elevation_vertex>\n        #include <project_vertex>\n        #include <logdepthbuf_vertex>\n#if MODE == MODE_FINAL\n        #include <fog_vertex>\n        vUv = vec3(uv_wgs84, (uv_pm > 0.) ? uv_pm : uv_wgs84.y); // set pm=wgs84 if pm=0 (not computed)\n        vNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n#endif\n}\n",g="#include <itowns/precision_qualifier>\n#include <logdepthbuf_pars_fragment>\n#include <itowns/pitUV>\n#include <itowns/color_layers_pars_fragment>\n#if MODE == MODE_FINAL\n#include <itowns/fog_pars_fragment>\n#include <itowns/overlay_pars_fragment>\n#include <itowns/lighting_pars_fragment>\n#endif\n#include <itowns/mode_pars_fragment>\n\nuniform vec3        diffuse;\nuniform float       opacity;\nvarying vec3        vUv; // WGS84.x/PM.x, WGS84.y, PM.y\n\nvoid main() {\n    #include <logdepthbuf_fragment>\n\n#if MODE == MODE_ID\n\n    #include <itowns/mode_id_fragment>\n\n#elif MODE == MODE_DEPTH\n\n    #include <itowns/mode_depth_fragment>\n\n#else\n\n    gl_FragColor = vec4(diffuse, opacity);\n\n    uvs[CRS_WGS84] = vec3(vUv.xy, 0.);\n    uvs[CRS_PM]    = vec3(vUv.x, fract(vUv.z), floor(vUv.z));\n\n    vec4 color;\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_FS_TEXTURES; i ++ ) {\n        color = getLayerColor( i , colorTextures[ i ], colorOffsetScales[ i ], colorLayers[ i ]);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, color.rgb, color.a);\n    }\n\n  #if defined(DEBUG)\n    if (showOutline) {\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_CRS; i ++) {\n            color = getOutlineColor( outlineColors[ i ], uvs[ i ].xy);\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, color.rgb, color.a);\n        }\n    }\n  #endif\n\n    #include <itowns/fog_fragment>\n    #include <itowns/lighting_fragment>\n    #include <itowns/overlay_fragment>\n\n#endif\n}\n",y=new c.Vector4(0,0,1,1),x=new c.Vector4(255/256/16777216,255/256/65536,255/256/256,255/256),b=[["WGS84","WGS84G","TMS","EPSG:3946","EPSG:4326","WMTS:WGS84G"],["PM","WMTS:PM"]];t.CRS_DEFINES=b;var w=15,_=1;function M(){var e=f.default.getMaxTextureUnitsCount();return Math.min(e-_,w)}function E(e,t,r){var n=e.layers.value,i=e.textures.value,a=e.offsetScales.value,o=e.textureCount,s=0,l=!0,u=!1,h=void 0;try{for(var c,d=t[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;f.textureOffset=s;for(var p=0,m=f.textures.length;p<m;++p,++s)s<r&&(a[s]=f.offsetScales[p],i[s]=f.textures[p],n[s]=f)}}catch(e){u=!0,h=e}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}s>r&&console.warn("LayeredMaterial: Not enough texture units (".concat(r," < ").concat(s,"), excess textures have been discarded.")),o.value=s}function S(e,t,r){Object.keys(r).forEach(function(n){e.defines["".concat(t,"_").concat(n)]=r[n]})}function T(e,t,r){e.uniforms[t]=new c.Uniform(r),Object.defineProperty(e,t,{get:function(){return e.uniforms[t].value},set:function(r){e.uniforms[t].value!=r&&(e.uniforms[t].value=r)}})}var A,L,P={RGBA:0,COLOR:1,DATA:2};t.ELEVATION_MODES=P;var C=function(e){function t(){var e,r,n,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.default)(this,t),e=(0,s.default)(this,(0,l.default)(t).call(this,o)),A=A||[_,M()],e.defines.NUM_VS_TEXTURES=A[0],e.defines.NUM_FS_TEXTURES=A[1],e.defines.USE_FOG=1,e.defines.EPSILON=1e-6;for(var u=0,m=b.length;u<m;++u)e.defines["CRS_".concat(b[u][0])]=u;return e.defines.NUM_CRS=b.length,S((0,h.default)((0,h.default)(e)),"ELEVATION",P),S((0,h.default)((0,h.default)(e)),"MODE",p.default.MODES),r=(0,h.default)((0,h.default)(e)),"mode",n="MODE",i=p.default.MODES.FINAL,r.defines[n]=i,Object.defineProperty(r,"mode",{get:function(){return r.defines[n]},set:function(e){r.defines[n]!=e&&(r.defines[n]=e,r.needsUpdate=!0)}}),f.default.isLogDepthBufferSupported()&&(e.defines.USE_LOGDEPTHBUF=1,e.defines.USE_LOGDEPTHBUF_EXT=1),e.vertexShader=v,L=L||d.default.unrollLoops(g,e.defines),e.fragmentShader=L,T((0,h.default)((0,h.default)(e)),"diffuse",new c.Color(.04,.23,.35)),T((0,h.default)((0,h.default)(e)),"opacity",e.opacity),T((0,h.default)((0,h.default)(e)),"lightingEnabled",!1),T((0,h.default)((0,h.default)(e)),"lightPosition",new c.Vector3(-.5,0,1)),T((0,h.default)((0,h.default)(e)),"fogDistance",1e9),T((0,h.default)((0,h.default)(e)),"fogColor",new c.Color(.76,.85,1)),T((0,h.default)((0,h.default)(e)),"overlayAlpha",0),T((0,h.default)((0,h.default)(e)),"overlayColor",new c.Color(1,.3,0)),T((0,h.default)((0,h.default)(e)),"objectId",0),T((0,h.default)((0,h.default)(e)),"minBorderDistance",-.01),e.layers=[],e.elevationLayerIds=[],e.colorLayerIds=[],e.uniforms.elevationLayers=new c.Uniform(new Array(A[0]).fill({})),e.uniforms.elevationTextures=new c.Uniform(new Array(A[0]).fill(null)),e.uniforms.elevationOffsetScales=new c.Uniform(new Array(A[0]).fill(y)),e.uniforms.elevationTextureCount=new c.Uniform(0),e.uniforms.colorLayers=new c.Uniform(new Array(A[1]).fill({})),e.uniforms.colorTextures=new c.Uniform(new Array(A[1]).fill(null)),e.uniforms.colorOffsetScales=new c.Uniform(new Array(A[1]).fill(y)),e.uniforms.colorTextureCount=new c.Uniform(0),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getUniformByType",value:function(e){return{layers:this.uniforms["".concat(e,"Layers")],textures:this.uniforms["".concat(e,"Textures")],offsetScales:this.uniforms["".concat(e,"OffsetScales")],textureCount:this.uniforms["".concat(e,"TextureCount")]}}},{key:"updateLayersUniforms",value:function(){var e=this,t=this.layers.filter(function(t){return e.colorLayerIds.includes(t.id)&&t.visible&&t.opacity>0});t.sort(function(t,r){return e.colorLayerIds.indexOf(t.id)-e.colorLayerIds.indexOf(r.id)}),E(this.getUniformByType("color"),t,this.defines.NUM_FS_TEXTURES),this.elevationLayerIds.some(function(t){return e.getLayer(t)})&&E(this.getUniformByType("elevation"),[this.getElevationLayer()],this.defines.NUM_VS_TEXTURES),this.layersNeedUpdate=!1}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"}),this.layers.forEach(function(e){return e.dispose(!1)}),this.layers.length=0,this.layersNeedUpdate=!0}},{key:"setSequence",value:function(e){this.colorLayerIds=e,this.layersNeedUpdate=!0}},{key:"setSequenceElevation",value:function(e){this.elevationLayerIds[0]=e,this.layersNeedUpdate=!0}},{key:"removeLayer",value:function(e){var t=this.layers.findIndex(function(t){return t.id===e});t>-1&&(this.layers[t].dispose(),this.layers.splice(t,1))}},{key:"addLayer",value:function(e,t){e.id in this.layers&&console.warn('The "{layer.id}" layer was already present in the material, overwritting.');var r=new m.default(this,e,t);return this.layers.push(r),r}},{key:"getLayer",value:function(e){return this.layers.find(function(t){return t.id===e})}},{key:"getElevationLayer",value:function(){var e=this;return this.layers.find(function(t){return t.id===e.elevationLayerIds[0]})}}]),t}(c.RawShaderMaterial);t.default=C},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(0),i=new n.TextureLoader;function a(e){if(!e.ok){var t=new Error("Error loading ".concat(e.url,": status ").concat(e.status));throw t.response=e,t}}var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,t).then(function(e){return a(e),e.arrayBuffer()})},s={text:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,t).then(function(e){return a(e),e.text()})},json:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,t).then(function(e){return a(e),e.json()})},xml:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,t).then(function(e){return a(e),e.text()}).then(function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})},texture:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.crossOrigin=n.crossOrigin;var a=new Promise(function(e,n){t=e,r=n});return i.load(e,t,function(){},r),a},arrayBuffer:o,textureFloat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e,t).then(function(e){return function(e){var t=new n.DataTexture(e,256,256,n.AlphaFormat,n.FloatType);return t.needsUpdate=!0,t}(new Float32Array(e))})}};t.default=s},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?e.exports=n=function(e){return r(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},n(t)}e.exports=n},function(e,t,r){var n=r(41);function i(t,r,a){return function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?e.exports=i=Reflect.construct:e.exports=i=function(e,t,r){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return r&&n(a,r.prototype),a},i.apply(null,arguments)}e.exports=i},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.VIEW_EVENTS=void 0;var a=i(r(12)),o=n(r(0)),s=i(r(81)),l=n(r(13)),u=i(r(86)),h=i(r(36)),c=r(17),d=i(r(14)),f=i(r(47)),p=i(r(50)),m=i(r(38)),v=i(r(89)),g=i(r(25)),y=i(r(61)),x=i(r(62)),b=i(r(63)),w=i(r(64)),_=i(r(65)),M=i(r(66)),E=new Map([["wmts",y.default],["file",M.default],["wfs",b.default],["wms",x.default],["tms",w.default],["xyz",w.default],["static",_.default]]),S={LAYERS_INITIALIZED:"layers-initialized"};function T(e,t){var r,n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("Invalid viewerDiv parameter (must non be null/undefined)");this.referenceCrs=e,r=i.renderer&&i.renderer.domElement?new u.default(i.renderer):new u.default(t,i.renderer),this.mainLoop=i.mainLoop||new l.default(new v.default,r),this.scene=i.scene3D||new o.Scene,i.scene3D||(this.scene.autoUpdate=!1),this.camera=new s.default(this.referenceCrs,this.mainLoop.gfxEngine.getWindowSize().x,this.mainLoop.gfxEngine.getWindowSize().y,i),this._frameRequesters={},this._layers=[],window.addEventListener("resize",function(){var e=new o.Vector2(t.clientWidth,t.clientHeight);n.mainLoop.gfxEngine.onWindowResize(e.x,e.y),n.notifyChange(n.camera.camera3D)},!1),this._changeSources=new Set,this._delayedFrameRequesterRemoval=[],this._allLayersAreReadyCallback=function(){n.getLayers().every(function(e){return e.ready})&&0==n.mainLoop.scheduler.commandsWaitingExecutionCount()&&n.mainLoop.renderingState==l.RENDERING_PAUSED&&(n.dispatchEvent({type:S.LAYERS_INITIALIZED}),n.removeFrameRequester(l.MAIN_LOOP_EVENTS.UPDATE_END,n._allLayersAreReadyCallback))}}t.VIEW_EVENTS=S,T.prototype=Object.create(o.EventDispatcher.prototype),T.prototype.constructor=T;var A=function(e,t){e.object3d&&(e.object3d.visible=e.visible),e.threejsLayer&&(e.visible?t.camera.camera3D.layers.enable(e.threejsLayer):t.camera.camera3D.layers.disable(e.threejsLayer))};function L(e,t,r,n){if(t.isLayer||(t=function(e){switch(console.warn("Deprecation warning: passing a layer as an object is deprecated. Instantiate the layer before adding it to the view instead."),e.type){case"color":return new f.default(e.id,e);case"elevation":return new p.default(e.id,e);case"geometry":return new m.default(e.id,new o.Group,e);case"debug":return new d.default(e.id,"debug",e);default:throw new Error("Unknown layer type ".concat(e.type,": please\n                specify a valid one"))}}(t)),n&&!t.extent&&(t.extent=n.extent,t.source&&!t.source.extent&&(t.source.extent=n.extent)),"geometry"==t.type||"debug"==t.type?((n||"debug"==t.type)&&(t.threejsLayer=e.mainLoop.gfxEngine.getUniqueThreejsLayer()),t.defineLayerProperty("visible",!0,function(){return A(t,e)}),A(t,e),t.projection=e.referenceCrs):"PM"===t.source.tileMatrixSet?t.projection="EPSG:3857":t.projection=n.extent.crs(),!t.whenReady){var i=Promise.resolve();if(r&&r.preprocessDataLayer)(i=r.preprocessDataLayer(t,e,e.mainLoop.scheduler,n))&&i.then||(i=Promise.resolve());else if(t.source){if(t.source.toTexture="geometry"!=t.type,!t.source.isSource){console.warn("Deprecation warning: passing a source as an object is deprecated. Instantiate the source before adding it to the layer instead.");var a=t.source.protocol;t.source=new(E.get(a))(t.source,t.projection)}i=t.source.whenReady||i}t.whenReady=i.then(function(){return t.ready=!0,t})}return t}T.prototype.addLayer=function(e,t){var r=this;return new Promise(function(n,i){if(e)if(r.getLayers(function(t){return t.id==e.id}).length>0)i(new Error("Invalid id '".concat(e.id,"': id already used")));else{var o=e.source?e.source.protocol:e.protocol,s=r.mainLoop.scheduler.getProtocolProvider(o);if(!e.protocol||s){if(e=L(r,e,s,t),t)if("color"==e.type){var u=r.getLayers(function(e){return"color"===e.type});if(!(t.countColorLayersTextures.apply(t,(0,a.default)(u).concat([e]))<=(0,c.getMaxColorSamplerUnitsCount)()))return void i(new Error("Cant add color layer ".concat(e.id,": the maximum layer is reached")));t.attach(e)}else t.attach(e);else{if("function"!=typeof e.update)return void i(new Error("Cant add GeometryLayer: missing a update function"));if("function"!=typeof e.preUpdate)return void i(new Error("Cant add GeometryLayer: missing a preUpdate function"));r._layers.push(e)}e.object3d&&!e.object3d.parent&&e.object3d!==r.scene&&r.scene.add(e.object3d),e.whenReady.then(function(e){r.notifyChange(t||e,!1),r._frameRequesters[l.MAIN_LOOP_EVENTS.UPDATE_END]&&r._frameRequesters[l.MAIN_LOOP_EVENTS.UPDATE_END].includes(r._allLayersAreReadyCallback)||r.addFrameRequester(l.MAIN_LOOP_EVENTS.UPDATE_END,r._allLayersAreReadyCallback),n(e)})}else i(new Error("".concat(e.protocol," is not a recognized protocol name.")))}else i(new Error("layer is undefined"))})},T.prototype.notifyChange=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this._changeSources.add(e),this.mainLoop.scheduleViewUpdate(this,t)},T.prototype.getLayers=function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=this._layers[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;e&&!e(s)||t.push(s);var l=!0,u=!1,h=void 0;try{for(var c,d=s.attachedLayers[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;e&&!e(f,s)||t.push(f)}}catch(e){u=!0,h=e}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},T.prototype.getParentLayer=function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._layers[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=!0,l=!1,u=void 0;try{for(var h,c=o.attachedLayers[Symbol.iterator]();!(s=(h=c.next()).done);s=!0)if(h.value===e)return o}catch(e){l=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(l)throw u}}}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}},T.prototype.addFrameRequester=function(e,t){if("function"!=typeof t)throw new Error("frameRequester must be a function");this._frameRequesters[e]?this._frameRequesters[e].push(t):this._frameRequesters[e]=[t]},T.prototype.removeFrameRequester=function(e,t){this._frameRequesters[e].includes(t)?this._delayedFrameRequesterRemoval.push({when:e,frameRequester:t}):console.error("Invalid call to removeFrameRequester: frameRequester isn't registered")},T.prototype._executeFrameRequestersRemovals=function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._delayedFrameRequesterRemoval[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value,o=this._frameRequesters[a.when].indexOf(a.frameRequester);o>=0?this._frameRequesters[a.when].splice(o,1):console.warn("FrameReq has already been removed")}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this._delayedFrameRequesterRemoval.length=0},T.prototype.execFrameRequesters=function(e,t,r){if(this._frameRequesters[e]){this._delayedFrameRequesterRemoval.length>0&&this._executeFrameRequestersRemovals();for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];var o=!0,s=!1,l=void 0;try{for(var u,h=this._frameRequesters[e][Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var c=u.value;c.update?c.update(t,r,i):c(t,r,i)}}catch(e){s=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(s)throw l}}}};var P=new o.Vector2;function C(e,t){var r=e.getLayers(function(e){return e.id==t});if(!r.length)throw new Error("Invalid layer id used as where argument (value = ".concat(t,")"));return r[0]}T.prototype.eventToViewCoords=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(void 0!==e.touches&&e.touches.length){var r=this.mainLoop.gfxEngine.renderer.domElement.getBoundingClientRect();return P.set(e.touches[t].clientX-r.x,e.touches[t].clientY-r.y)}return P.set(e.offsetX,e.offsetY)},T.prototype.eventToNormalizedCoords=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.viewToNormalizedCoords(this.eventToViewCoords(e,t))},T.prototype.viewToNormalizedCoords=function(e){return P.x=e.x/this.camera.width*2-1,P.y=e.y/this.camera.height*-2+1,P},T.prototype.normalizedToViewCoords=function(e){return P.x=.5*(e.x+1)*this.camera.width,P.y=-.5*(e.y-1)*this.camera.height,P},T.prototype.pickObjectsAt=function(e,t){for(var r=[],n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];var s=0==i.length?this.getLayers(function(e){return"geometry"==e.type}):i.concat(),l=e instanceof Event?this.eventToViewCoords(e):e;t=t||0;var u=!0,h=!1,c=void 0;try{for(var d,f=s[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var p=d.value;if(p.isLayer||"string"==typeof p){var m="string"==typeof p?C(this,p):p,v=this.getParentLayer(m);if(v){var y=g.default.pickObjectsAt(this,l,t,v.object3d),x=!0,b=!1,w=void 0;try{for(var _,M=y[Symbol.iterator]();!(x=(_=M.next()).done);x=!0){var E=_.value;E.layer===m&&r.push(E)}}catch(e){b=!0,w=e}finally{try{x||null==M.return||M.return()}finally{if(b)throw w}}}else for(var S=m.pickObjectsAt(this,l,t),T=0;T<S.length;T++)r.push(S[T])}else{if(!(p instanceof o.Object3D))throw new Error("Invalid where arg (value = ".concat(i,"). Expected layers, layer ids or Object3Ds"));g.default.pickObjectsAt(this,l,t,p,r)}}}catch(e){h=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}return r},T.prototype.readDepthBuffer=function(e,t,r,n){var i=this.mainLoop.gfxEngine,a=this.tileLayer.wireframe,o=this.tileLayer.opacity,s=this.tileLayer.visible;a&&(this.tileLayer.wireframe=!1),o<1&&(this.tileLayer.opacity=1),s||(this.tileLayer.visible=!0);var l=this.tileLayer.level0Nodes.map(function(e){return h.default.push(e,h.default.MODES.DEPTH)}),u=i.renderViewToBuffer({camera:this.camera,scene:this.tileLayer.object3d},{x:e,y:t,width:r,height:n});return l.forEach(function(e){return e()}),this.tileLayer.wireframe!==a&&(this.tileLayer.wireframe=a),this.tileLayer.opacity!==o&&(this.tileLayer.opacity=o),this.tileLayer.visible!==s&&(this.tileLayer.visible=s),u};var R=new o.Matrix4,O=new o.Vector2,D=new o.Ray,I=new o.Vector3;T.prototype.getPickingPositionFromDepth=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.Vector3;if(this.tileLayer&&0!=this.tileLayer.level0Nodes.length&&this.tileLayer.level0Nodes[0]){var r=this.mainLoop,n=0==r.scheduler.commandsWaitingExecutionCount()&&r.renderingState==l.RENDERING_PAUSED,i=r.gfxEngine,a=i.getWindowSize(),s=this.camera.camera3D;(e=e||a.clone().multiplyScalar(.5)).x=Math.floor(e.x),e.y=Math.floor(e.y);var u,h=s.layers.mask;if(s.layers.mask=1<<this.tileLayer.threejsLayer,n){this._fullSizeDepthBuffer=this._fullSizeDepthBuffer||this.readDepthBuffer(0,0,a.x,a.y);var c=4*((a.y-e.y-1)*a.x+e.x);u=this._fullSizeDepthBuffer.slice(c,c+4)}else u=this.readDepthBuffer(e.x,e.y,1,1);O.x=e.x/a.x*2-1,O.y=-e.y/a.y*2+1,D.origin.copy(s.position),D.direction.set(O.x,O.y,.5),R.multiplyMatrices(s.matrixWorld,R.getInverse(s.projectionMatrix)),D.direction.applyMatrix4(R),D.direction.sub(D.origin),I.set(0,0,1),I.applyMatrix4(R),I.sub(D.origin);var d=I.angleTo(D.direction),f=i.depthBufferRGBAValueToOrthoZ(u,s)/Math.cos(d);if(t.addVectors(s.position,D.direction.setLength(f)),s.layers.mask=h,!(t.length()>1e7))return t}else t=void 0};var N=T;t.default=N},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=!1,i=8;function a(e,t,r){var n=e.context,i=n.createShader(t);return n.shaderSource(i,r),n.compileShader(i),i}function o(){return navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes("firefox")}var s={isLogDepthBufferSupported:function(){return n},isFirefox:o,isInternetExplorer:function(){return!!document.documentMode},getMaxTextureUnitsCount:function(){return i},updateCapabilities:function(e){var t=e.context;i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);var r=t.createProgram(),s=a(e,t.VERTEX_SHADER,"void main() {\n    gl_Position = vec4( 0.0, 0.0, 0.0, 1.0 );\n}"),l="#define SAMPLE ".concat(i,"\n");l+="uniform sampler2D uni[SAMPLE];\nvoid main() {\n    gl_FragColor += texture2D(uni[SAMPLE-1], vec2(0));\n}";var u=a(e,t.FRAGMENT_SHADER,l);if(t.attachShader(r,s),t.attachShader(r,u),t.linkProgram(r),!1===t.getProgramParameter(r,t.LINK_STATUS)){if(!(i>16))throw new Error("The GPU capabilities could not be determined accurately.\n                    Impossible to link a shader with the Maximum texture units ".concat(i));var h=t.getProgramInfoLog(r);console.warn("".concat(h,": using a maximum of 16 texture units instead of the reported value (").concat(i,")")),o()&&console.warn("It can come from a Mesa/Firefox bug;\n                        the shader compiles to an error when using more than 16 sampler uniforms,\n                        see https://bugzilla.mozilla.org/show_bug.cgi?id=777028"),i=16}t.deleteProgram(r),t.deleteShader(s),t.deleteShader(u),n=e.capabilities.logarithmicDepthBuffer}};t.default=s},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.updateLayeredMaterialNodeImagery=function(e,t,r,n){var l=r.material;if(n&&l){var u=r.getCoordsForSource(t.source),p=l.getLayer(t.id);if(void 0===r.layerUpdateState[t.id]){if(r.layerUpdateState[t.id]=new a.default,!t.source.extentsInsideLimit(u)&&(t.noTextureParentOutsideLimit||!n.material||!n.material.getLayer||!n.material.getLayer(t.id)))return void r.layerUpdateState[t.id].noMoreUpdatePossible();if(!p){var m=t.options.tileMatrixSet||u[0].crs();p=l.addLayer(t,m);var v=e.view.getLayers(function(e){return"color"===e.type}),g=o.ImageryLayers.getColorLayersIdOrderedBySequence(v);l.setSequence(g);var y=n.material&&n.material.getLayer(t.id);p.initFromParent(y,u)}if(p.level>=t.source.zoom.min)return void e.view.notifyChange(r,!1)}if(l.visible){p&&(p.visible=t.visible,p.opacity=t.opacity);var x=Date.now();if(t.visible&&r.layerUpdateState[t.id].canTryUpdate(x)){if(t.source.canTileTextureBeImproved){if(!t.source.canTileTextureBeImproved(r.extent,p.textures[0]))return void r.layerUpdateState[t.id].noMoreUpdatePossible()}else if(p.level>=r.getZoomForLayer(t))return void r.layerUpdateState[t.id].noMoreUpdatePossible();if(!t.frozen){var b=r.layerUpdateState[t.id].failureParams,w=u[0].zoom||r.level,_=(0,i.chooseNextLevelToFetch)(t.updateStrategy.type,r,w,p.level,t,b);if(!(_<=p.level)){var M=[],E=!0,S=!1,T=void 0;try{for(var A,L=u[Symbol.iterator]();!(E=(A=L.next()).done);E=!0){var P=A.value,C=c(r,P,_,t.source);if(C&&!t.source.extentInsideLimit(C))return void r.layerUpdateState[t.id].noMoreUpdatePossible();M.push(C)}}catch(e){S=!0,T=e}finally{try{E||null==L.return||L.return()}finally{if(S)throw T}}r.layerUpdateState[t.id].newTry();var R={view:e.view,layer:t,extentsSource:M,extentsDestination:u,parsedData:t.source.parsedData,requester:r,priority:d(l),earlyDropFunction:f};return e.scheduler.execute(R).then(function(e){if(null!==l){var n=u.map(function(e,t){return e.offsetToParent(M[t])});return e&&p.setTextures(e,n),r.layerUpdateState[t.id].success(),e}},function(n){if(n instanceof s.default)r.layerUpdateState[t.id].success();else{var i=r.layerUpdateState[t.id].errorCount>h;r.layerUpdateState[t.id].failure(Date.now(),i,{targetLevel:_}),i||window.setTimeout(function(){e.view.notifyChange(r,!1)},1e3*r.layerUpdateState[t.id].secondsUntilNextTry())}})}}}}}},t.updateLayeredMaterialNodeElevation=function(e,t,r,n){var o=r.material;if(n&&o){var p=r.getCoordsForSource(t.source),m=t.options.tileMatrixSet||p[0].crs(),v=o.getElevationLayer();if(void 0===r.layerUpdateState[t.id]){r.layerUpdateState[t.id]=new a.default,v||(v=o.addLayer(t,m),o.setSequenceElevation(t.id));var g=n.material&&n.material.getLayer(t.id);v.initFromParent(g,p);var y=p[0].zoom-v.zoom>6;if(v.textures[0]&&!y){var x=(0,u.computeMinMaxElevation)(v.textures[0].image.data,l.SIZE_TEXTURE_TILE,l.SIZE_TEXTURE_TILE,v.offsetScales[0]),b=x.min,w=x.max;r.setBBoxZ(b,w)}if(v.level>=t.source.zoom.min)return void e.view.notifyChange(r,!1)}var _=Date.now();if(!t.frozen&&o.visible&&r.layerUpdateState[t.id].canTryUpdate(_)){if(!t.source.canTileTextureBeImproved||t.source.canTileTextureBeImproved(t,v.textures[0])){var M=(0,i.chooseNextLevelToFetch)(t.updateStrategy.type,r,p[0].zoom,v.level,t);if(M<=v.level)return r.layerUpdateState[t.id].noMoreUpdatePossible(),Promise.resolve();var E=[],S=!0,T=!1,A=void 0;try{for(var L,P=p[Symbol.iterator]();!(S=(L=P.next()).done);S=!0){var C=L.value,R=c(r,C,M);if(R&&!t.source.extentInsideLimit(R))return void r.layerUpdateState[t.id].noMoreUpdatePossible();E.push(R)}}catch(e){T=!0,A=e}finally{try{S||null==P.return||P.return()}finally{if(T)throw A}}r.layerUpdateState[t.id].newTry();var O={view:e.view,layer:t,extentsSource:E,extentsDestination:p,requester:r,priority:d(o),earlyDropFunction:f};return e.scheduler.execute(O).then(function(e){var i={texture:e[0],pitch:p[0].offsetToParent(E[0])};if(M<=v.level)r.layerUpdateState[t.id].noMoreUpdatePossible();else{if(r.layerUpdateState[t.id].success(),i.texture)if(t.useColorTextureElevation)i.min=t.colorTextureElevationMinZ,i.max=t.colorTextureElevationMaxZ;else{var a=(0,u.computeMinMaxElevation)(i.texture.image.data),s=a.min,l=a.max;i.min=s||0,i.max=l||0}r.setBBoxZ(i.min,i.max),(v=o.getLayer(t.id))||(v=o.addLayer(t,m)),o.setSequenceElevation(t.id),v.setTexture(0,i.texture,i.pitch);var h=n.material&&n.material.getElevationLayer();v.replaceNoDataValueFromParent(h,t.noDataValue)}},function(n){if(n instanceof s.default)r.layerUpdateState[t.id].success();else{var i=r.layerUpdateState[t.id].errorCount>h;r.layerUpdateState[t.id].failure(Date.now(),i),i||window.setTimeout(function(){e.view.notifyChange(r,!1)},1e3*r.layerUpdateState[t.id].secondsUntilNextTry())}})}r.layerUpdateState[t.id].noMoreUpdatePossible()}}},t.removeLayeredMaterialNodeLayer=function(e){return function(t){t.material&&t.material.removeLayer&&t.material.removeLayer(e),t.layerUpdateState&&t.layerUpdateState[e]&&delete t.layerUpdateState[e]}};var i=r(37),a=n(r(48)),o=r(14),s=n(r(15)),l=r(24),u=r(45),h=4;function c(e,t,r,n){if(n&&n.getSourceExtents){var i=n.getSourceExtents(t).extent;return i.zoom=e.level,i}if(t.isTiledCrs())return t.extentParent(r);var a=e.findAncestorFromLevel(r);return a.extent&&(a.extent.zoom=a.level),a.extent}function d(e){return e.visible?100:10}function f(e){return!(e.requester.parent&&e.requester.material&&(e.force||!("elevation"==e.layer.type&&e.requester.material.getElevationLayer()&&e.targetLevel<=e.requester.material.getElevationLayer().level)&&e.requester.material.visible))}},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SIZE_DIAGONAL_TEXTURE=t.SIZE_TEXTURE_TILE=void 0;var i=n(r(33)),a=n(r(9));t.SIZE_TEXTURE_TILE=256;var o=Math.pow(131072,.5);t.SIZE_DIAGONAL_TEXTURE=o;var s=new a.default("WMTS:WGS84G",0,0,0),l={computeTileMatrixSetCoordinates:function(e,t){if(!((t=t||"WGS84G")in e.wmtsCoords)){if(e.wmtsCoords.WGS84G){var r=e.wmtsCoords.WGS84G[0];s.zoom=r.zoom,s.col=r.col,s.row=r.row}else i.default.WGS84toWMTS(e.extent,s),e.wmtsCoords.WGS84G=[s.clone()];e.wmtsCoords[t]=i.default.getCoordWMTS_WGS84(s,e.extent,t)}},computeTMSCoordinates:function(e,t,r){t=e.extent.crs()==t.crs()?t:t.as(e.extent.crs());var n,i=e.extent.center(),o=t.dimensions(),s=Math.round(o.x/e.extent.dimensions().x),l=Math.floor(Math.log2(s)),u=(i.x()-t.west())/o.x;return n=r?(t.north()-i.y())/o.y:(i.y()-t.south())/o.y,[new a.default("TMS",l,Math.floor(n*s),Math.floor(u*s))]}};t.default=l},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(51)),s=n(r(36)),l=r(17);function u(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.camera.camera3D.layers.mask;return e.camera.camera3D.layers.mask=1<<t,function(){e.camera.camera3D.layers.mask=r}}var h=new a.Vector4;function c(e,t){for(var r,n=0;n<=e;n++){for(var i=n*n,a=-n;a<=n;a++)for(var o=a*a,s=-n;s<=n;s++){var l=o+s*s;if(!(l>i||l<=r||!1!==t(a,s)))return}r=i}}function d(e){return e.layer?e.layer:e.parent?d(e.parent):void 0}var f=new a.Raycaster,p={pickTilesAt:function(e,t,r,n){var i=[],d=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.mainLoop.gfxEngine.getWindowSize();r=r||new a.Vector2(Math.floor(i.x/2),Math.floor(i.y/2));var o=t.level0Nodes.map(function(e){return s.default.push(e,s.default.MODES.ID)}),d=u(e,t.object3d,t.threejsLayer),f=e.mainLoop.gfxEngine.renderViewToBuffer({camera:e.camera,scene:t.object3d},{x:r.x-n,y:r.y-n,width:1+2*n,height:1+2*n});d(),o.forEach(function(e){return e()});var p=[];return c(n,function(e,t){var r=4*(2*t*n+e),i=f.slice(r,r+4);h.fromArray(i).divideScalar(255);var a=(0,l.unpack1K)(h,Math.pow(256,3)),o=Math.round(a);p.includes(o)||p.push(o)}),p}(e,n,t,r),f=function(e){d.includes(e.id)&&e instanceof o.default&&i.push({object:e,layer:n})},p=!0,m=!1,v=void 0;try{for(var g,y=n.level0Nodes[Symbol.iterator]();!(p=(g=y.next()).done);p=!0)g.value.traverse(f)}catch(e){m=!0,v=e}finally{try{p||null==y.return||y.return()}finally{if(m)throw v}}return i},pickPointsAt:function(e,t,r,n){if(n.root){n.object3d.traverse(function(e){e.isPoints&&e.baseId&&e.material.enablePicking(!0)});var i=u(e,n.object3d,n.threejsLayer),a=e.mainLoop.gfxEngine.renderViewToBuffer({camera:e.camera,scene:n.object3d},{x:t.x-r,y:t.y-r,width:1+2*r,height:1+2*r});i();var o=[];c(r,function(e,t){for(var n=4*(2*t*r+e),i=a.slice(n,n+4),s={objId:i[0]<<8|i[1],index:i[2]<<8|i[3]},l=0;l<o.length;l++)if(o[l].objId==s.objId&&o[l].index==s.index)return;o.push(s)});var s=[];return n.object3d.traverse(function(e){if(e.isPoints&&e.baseId){e.material.enablePicking(!1);for(var t=0;t<o.length;t++)o[t].objId==e.baseId&&s.push({object:e,index:o[t].index,layer:n})}}),s}},pickObjectsAt:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a={x:t.x-r,y:t.y-r,width:1+2*r,height:1+2*r},o=e.mainLoop.gfxEngine.renderViewToBuffer({scene:n,camera:e.camera},a),s=e.mainLoop.gfxEngine.renderer.getClearColor(),l=Math.round(255*s.r),u=Math.round(255*s.g),h=Math.round(255*s.b),p=e.viewToNormalizedCoords(t),m=p.clone();return c(r,function(t,a){var s=4*((a+r)*(2*r+1)+(t+r)),c=o[s],v=o[s+1],g=o[s+2];if(!(Math.abs(l-c)<=1&&Math.abs(u-v)<=1&&Math.abs(h-g)<=1)){m.setX(p.x+t/e.camera.width).setY(p.y+a/e.camera.height),f.setFromCamera(m,e.camera.camera3D);var y=f.intersectObject(n,!0),x=!0,b=!1,w=void 0;try{for(var _,M=y[Symbol.iterator]();!(x=(_=M.next()).done);x=!0){var E=_.value;E.layer=d(E.object),i.push(E)}}catch(e){b=!0,w=e}finally{try{x||null==M.return||M.return()}finally{if(b)throw w}}return 0==i.length}}),i}};t.default=p},function(e,t,r){r(5);var n=r(88);function i(t,r,a){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,r){var i=n(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(r):a.value}},i(t,r,a||t)}e.exports=i},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(8)),a=n(r(9)),o=new i.default("EPSG:4978",0,0,0),s=new i.default("EPSG:4978",0,0,0);function l(e,t,r,n,i,a,l){var u=0,h=s;if(i){u=i.length;var c=r.length*l;i.length+=c,a&&(a.length+=c)}i=i||new Array(r.length);var d=0,f=!0,p=!1,m=void 0;try{for(var v,g=r[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;3==l&&"number"==typeof y[2]&&(d=y[2]),o.set(e,y[0],y[1],d),e!==t?o.as(t,s):h=o,a&&h.geodesicNormal.toArray(a,u),i[u]=h._values[0],i[u+1]=h._values[1],3==l&&(i[u+2]=h._values[2]),n&&(n.crs()==e?n.expandByPoint(o):n.expandByPoint(h)),u+=l}}catch(e){p=!0,m=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw m}}return i}var u=new i.default("EPSG:4978",0,0,0),h=function(e,t,r){var n=t[0];return u.set(r,n[0],n[1],0),!e.isPointInside(u)},c={point:function(e,t,r,n,i,o){if(!i||!h(i,n,t)){var s=o.buildExtent?new a.default(r,1/0,-1/0,1/0,-1/0):void 0,u=e.vertices.length/e.size;return l(t,r,n,s,e.vertices,e.normals,e.size),e.geometry.push({extent:s,indices:[{offset:u,count:1}]}),e}},polygon:function(e,t,r,n,i,o){if(!i||!h(i,n[0],t)){var s=o.buildExtent?new a.default(r,1/0,-1/0,1/0,-1/0):void 0,u=e.vertices.length/e.size;l(t,r,n[0],s,e.vertices,e.normals,e.size);var c=[{offset:u,count:n[0].length}];u+=n[0].length;for(var d=1;d<n.length;d++){l(t,r,n[d],s,e.vertices,e.normals,e.size);var f=n[d].length;c.push({offset:u,count:f}),u+=f}return e.geometry.push({extent:s,indices:c}),e}},lineString:function(e,t,r,n,i,o){if(!i||!h(i,n,t)){var s=o.buildExtent?new a.default(r,1/0,-1/0,1/0,-1/0):void 0,u=e.vertices.length/e.size;l(t,r,n,s,e.vertices,e.normals,e.size);var c=[{offset:u,count:e.vertices.length/e.size-u}];return e.geometry.push({extent:s,indices:c}),e}},multi:function(e,t,r,n,i,a,o){var s=!0,l=!1,u=void 0;try{for(var h,c=i[Symbol.iterator]();!(s=(h=c.next()).done);s=!0){var d=h.value;this[e](t,r,n,d,a,o)}}catch(e){l=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(l)throw u}}return t}},d=["type","geometry","properties"];function f(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(!i.filter||i.filter(r.properties,r.geometry)){var o=r.geometry.type.toLowerCase(),s=i.mergeFeatures?function(e){switch(e){case"point":case"multipoint":return"multipoint";case"linestring":case"multilinestring":return"multilinestring";case"polygon":case"multipolygon":return"multipolygon";case"geometrycollection":default:throw new Error("Unhandled geometry type ".concat(e))}}(o):o,l=a[s]||{type:s,geometry:[],vertices:[],normals:i.withNormal?[]:void 0,crs:t,size:i.withAltitude?3:2},u=l.geometry.length;if(function(e,t,r,n,i,a,o){if(0!=i.length)switch(e){case"point":return c.point(t,r,n,[i],a,o);case"multipoint":return c.multi("point",t,r,n,i,a,o);case"linestring":return c.lineString(t,r,n,i,a,o);case"multilinestring":return c.multi("lineString",t,r,n,i,a,o);case"polygon":return c.polygon(t,r,n,i,a,o);case"multipolygon":return c.multi("polygon",t,r,n,i,a,o);case"geometrycollection":default:throw new Error("Unhandled geometry type ".concat(t.type))}}(o,l,e,t,r.geometry.coordinates,n,i),l.geometry.length!=u){for(var h=r.properties||{},f=Object.keys(r),p=0;p<f.length;p++){var m=f[p];d.includes(m.toLowerCase())||(h[m]=r[m])}for(var v=u;v<l.geometry.length;v++){var g=l.geometry[v];i.buildExtent&&(l.extent=l.extent||g.extent,l.extent.union(g.extent)),g.properties=h}return l}}}var p=function(e,t){e.extent?e.extent.union(t):e.extent=t.clone()},m=["multipolygon","multilinestring","multipoint"];function v(e,t,r,n,i){var a={features:[]},o={};if(i.mergeFeatures)for(var s=0;s<m.length;s++){var l=m[s];o[l]={type:l,geometry:[],vertices:[],normals:i.withNormal?[]:void 0,crs:t,size:i.withAltitude?3:2}}var u=!0,h=!1,c=void 0;try{for(var d,v=r[Symbol.iterator]();!(u=(d=v.next()).done);u=!0){var g=f(e,t,d.value,n,i,o);g&&!i.mergeFeatures&&(i.buildExtent&&p(a,g.extent),a.features.push(g))}}catch(e){h=!0,c=e}finally{try{u||null==v.return||v.return()}finally{if(h)throw c}}if(i.mergeFeatures)for(var y=0;y<m.length;y++){var x=o[m[y]];x.geometry.length&&(x.vertices.crs=t,a.features.push(x),i.buildExtent&&p(a,x.extent))}return a.crs=t,a.isFeature=!0,a}var g={parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.crsOut,n=t.filteringExtent;switch("string"==typeof e&&(e=JSON.parse(e)),t.crsIn=t.crsIn||function(e){if(e.crs){if("epsg"==e.crs.type.toLowerCase())return"EPSG:".concat(e.crs.properties.code);if("name"==e.crs.type.toLowerCase()){var t=e.crs.properties.name.toLowerCase().indexOf("epsg:");if(t>=0){var r=e.crs.properties.name.indexOf(":",t+5);if(r>0)return"EPSG:".concat(e.crs.properties.name.substr(r+1))}}throw new Error("Unsupported CRS type '".concat(e.crs,"'"))}return"EPSG:4326"}(e),t.mergeFeatures=null==t.mergeFeatures||t.mergeFeatures,t.withNormal=null==t.withNormal||t.withNormal,t.withAltitude=null==t.withAltitude||t.withAltitude,e.type.toLowerCase()){case"featurecollection":return Promise.resolve(v(t.crsIn,r,e.features,n,t));case"feature":return Promise.resolve(v(t.crsIn,r,[e],n,t));default:throw new Error("Unsupported GeoJSON type: '".concat(e.type))}}};t.default=g},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TextDecoder=void 0;var n=r(106),i="function"==typeof e.TextDecoder?e.TextDecoder:n.TextDecoder;t.TextDecoder=i;var a=new i("utf-8");t.default=a}).call(this,r(55))},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(26)),h=i(r(7)),c=n(r(0)),d=i(r(56)),f=new(i(r(57)).default),p=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new c.Vector3(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.Vector3(-1/0,-1/0,-1/0);return(0,a.default)(this,t),(e=(0,s.default)(this,(0,l.default)(t).call(this))).box3D=new c.Box3(r.clone(),n.clone()),e.natBox=e.box3D.clone(),e.z={min:0,max:0},e.topPointsWorld=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3],e.update(),e}return(0,h.default)(t,e),(0,o.default)(t,[{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){(0,u.default)((0,l.default)(t.prototype),"copy",this).call(this,e),this.box3D.copy(e.box3D),this.natBox.copy(e.natBox),this.z.min=e.z.min,this.z.max=e.z.max;for(var r=0,n=this.topPointsWorld.length;r<n;r++)this.topPointsWorld[r].copy(e.topPointsWorld[r]);return this}},{key:"update",value:function(){this.updateMatrixWorld(!0),this.toPoints(this.topPointsWorld);for(var e=0,t=this.topPointsWorld.length;e<t;e++)this.topPointsWorld[e].applyMatrix4(this.matrixWorld);return this.topPointsWorld}},{key:"updateZ",value:function(e,t){this.z={min:e,max:t},this.box3D.min.z=this.natBox.min.z+e,this.box3D.max.z=this.natBox.max.z+t,this.update()}},{key:"toPoints",value:function(e){return e[0].set(this.box3D.max.x,this.box3D.max.y,this.box3D.max.z),e[1].set(this.box3D.min.x,this.box3D.max.y,this.box3D.max.z),e[2].set(this.box3D.min.x,this.box3D.min.y,this.box3D.max.z),e[3].set(this.box3D.max.x,this.box3D.min.y,this.box3D.max.z),e.length>4&&(e[4].set(this.box3D.max.x,this.box3D.max.y,this.box3D.min.z),e[5].set(this.box3D.min.x,this.box3D.max.y,this.box3D.min.z),e[6].set(this.box3D.min.x,this.box3D.min.y,this.box3D.min.z),e[7].set(this.box3D.max.x,this.box3D.min.y,this.box3D.min.z)),e}},{key:"isSphereAboveXYBox",value:function(e){var t=this.worldToLocal(e.position),r=Math.max(this.box3D.min.x,Math.min(t.x,this.box3D.max.x)),n=Math.max(this.box3D.min.y,Math.min(t.y,this.box3D.max.y));return Math.sqrt((r-t.x)*(r-t.x)+(n-t.y)*(n-t.y))<e.radius}}],[{key:"extentToOBB",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;if("EPSG:4326"!=e._crs)throw new Error("The extent crs is not a Geographic Coordinates (EPSG:4326)");var a=f.computeSharableExtent(e),o=a.sharableExtent,s=a.quaternion,l=a.position,u=Math.max(Math.floor(o.dimensions().x/90+1),2),h=new d.default({extent:o,level:0,segment:u,disableSkirt:!0},f);return i instanceof t?i.copy(h.OBB):i=h.OBB,i.updateZ(r,n),i.position.copy(l),i.quaternion.copy(s),i.update(),i}}]),t}(c.Object3D);t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default={xyz:function(e,t){return t.url.replace(/(\$\{z\}|%TILEMATRIX)/,e.zoom).replace(/(\$\{y\}|%ROW)/,e.row).replace(/(\$\{x\}|%COL)/,e.col)},bbox:function(e,t){var r="EPSG:4326"==t.projection?9:2,n=e.as(t.projection),i=n.west().toFixed(r),a=n.south().toFixed(r),o=n.east().toFixed(r),s=n.north().toFixed(r),l=t.axisOrder||"wsen";return l=l.replace("w","".concat(i,",")).replace("s","".concat(a,",")).replace("e","".concat(o,",")).replace("n","".concat(s,",")).slice(0,-1),t.url.replace("%bbox",l)}}},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=i(r(11)),c=n(r(0)),d=i(r(38)),f=r(46),p=i(r(25)),m=i(r(116)),v=i(r(15)),g=i(r(71)),y=r(24),x=new c.Vector3,b=new c.Vector3,w=function(e){function t(e,r,n,i,o){var u;if((0,a.default)(this,t),(u=(0,s.default)(this,(0,l.default)(t).call(this,e,r,o))).isTiledGeometryLayer=!0,u.protocol="tile",u.lighting={enable:!1,position:{x:-.5,y:0,z:1}},u.sseSubdivisionThreshold=u.sseSubdivisionThreshold||1,u.schemeTile=n,u.builder=i,u.info=new f.InfoTiledGeometryLayer((0,h.default)((0,h.default)(u))),!u.schemeTile)throw new Error("Cannot init tiled layer without schemeTile for layer ".concat(u.id));if(!u.builder)throw new Error("Cannot init tiled layer without builder for layer ".concat(u.id));u.level0Nodes=[];var c=[],d=!0,p=!1,m=void 0;try{for(var v,g=u.schemeTile[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var y=v.value;c.push(u.convert(void 0,y))}}catch(e){p=!0,m=e}finally{try{d||null==g.return||g.return()}finally{if(p)throw m}}return Promise.all(c).then(function(e){u.level0Nodes=e;var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;u.object3d.add(o),o.updateMatrixWorld()}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}),u}return(0,u.default)(t,e),(0,o.default)(t,[{key:"pickObjectsAt",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.defaultPickingRadius;return p.default.pickTilesAt(e,t,r,this)}},{key:"preUpdate",value:function(e,t){var r=this;if(t.has(void 0)||0==t.size)return this.level0Nodes;e.colorLayers=e.view.getLayers(function(e,t){return t&&t.id==r.id&&"color"==e.type}),e.elevationLayers=e.view.getLayers(function(e,t){return t&&t.id==r.id&&"elevation"==e.type}),e.maxElevationLevel=-1;var n,i=!0,a=!1,o=void 0;try{for(var s,l=e.elevationLayers[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;e.maxElevationLevel=Math.max(u.source.zoom.max,e.maxElevationLevel)}}catch(e){a=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}-1==e.maxElevationLevel&&(e.maxElevationLevel=1/0);var h=!0,c=!1,d=void 0;try{for(var f,p=t.values()[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var m=f.value;if(m.isCamera)return this.level0Nodes;if(m.layer===this){if(n){if(!(n=m.findCommonAncestor(n)))return this.level0Nodes}else n=m;null==n.material&&(n=void 0)}}}catch(e){c=!0,d=e}finally{try{h||null==p.return||p.return()}finally{if(c)throw d}}return n?[n]:this.level0Nodes}},{key:"update",value:function(e,r,n){var i=this;if(!n.parent)return g.default.removeChildrenAndCleanup(this,n);if(n.parent.pendingSubdivision)return n.visible=!1,n.material.visible=!1,void this.info.update(n);if(n.visible=!this.culling(n,e.camera),n.visible){var a=!1;return n.material.visible=!0,this.info.update(n),(n.pendingSubdivision||t.hasEnoughTexturesToSubdivide(e,n)&&this.subdivision(e,this,n))&&(this.subdivideNode(e,n),n.material.visible=n.pendingSubdivision,this.info.update(n),a=!0),n.material.visible&&(null!=e.view.fogDistance&&(n.material.fogDistance=e.view.fogDistance),!a)?g.default.removeChildren(this,n):a?n.children.filter(function(e){return e.layer==i}):void 0}return n.material.visible=!1,this.info.update(n),g.default.removeChildren(this,n)}},{key:"convert",value:function(e,t){return m.default.convert(e,t,this)}},{key:"countColorLayersTextures",value:function(){return arguments.length}},{key:"culling",value:function(e,t){return!t.isBox3Visible(e.obb.box3D,e.obb.matrixWorld)}},{key:"subdivideNode",value:function(e,t){var r=this;if(!t.pendingSubdivision&&!t.children.some(function(e){return e.layer==r})){var n=t.extent.subdivision();t.pendingSubdivision=!0;var i={view:e.view,requester:t,layer:this,priority:1e4,extentsSource:n,redraw:!1};e.scheduler.execute(i).then(function(r){var n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;t.add(l),l.updateMatrixWorld(!0)}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}t.pendingSubdivision=!1,e.view.notifyChange(t,!1)},function(e){if(t.pendingSubdivision=!1,!(e instanceof v.default))throw new Error(e)})}}},{key:"subdivision",value:function(e,t,r){if(r.level<this.minSubdivisionLevel)return!0;if(this.maxSubdivisionLevel<=r.level)return!1;var n=r.material.getElevationLayer();if(n){var i=n.textures[0];if(i&&i.extent&&n.offsetScales[0].z<1/Math.pow(2,this.maxDeltaElevationLevel))return!1}x.setFromMatrixScale(r.matrixWorld),b.copy(r.boundingSphere.center).applyMatrix4(r.matrixWorld);var a=Math.max(0,e.camera.camera3D.position.distanceTo(b)-r.boundingSphere.radius*x.x);r.screenSize=e.camera._preSSE*(2*r.boundingSphere.radius*x.x)/a;var o=r.screenSize/(2*y.SIZE_DIAGONAL_TEXTURE);return this.sseSubdivisionThreshold<o}}],[{key:"hasEnoughTexturesToSubdivide",value:function(e,t){var r=t.layerUpdateState||{},n=t.material.getElevationLayer(),i=!0,a=!1,o=void 0;try{for(var s,l=e.elevationLayers[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value,h=t.getCoordsForSource(u.source);if(!u.frozen&&u.ready&&u.source.extentsInsideLimit(h)&&(!n||n.level<0)){if(r[u.id]&&r[u.id].inError())continue;return!1}}}catch(e){a=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}var c=!0,d=!1,f=void 0;try{for(var p,m=e.colorLayers[Symbol.iterator]();!(c=(p=m.next()).done);c=!0){var v=p.value;if(!v.frozen&&v.visible&&v.ready&&(!r[v.id]||!r[v.id].inError())){var g=t.getCoordsForSource(v.source);if(n=t.material.getLayer(v.id),v.source.extentsInsideLimit(g)&&(!n||n.level<0))return!1}}}catch(e){d=!0,f=e}finally{try{c||null==m.return||m.return()}finally{if(d)throw f}}return!0}}]),t}(d.default);t.default=w},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(8));function s(e){this.rayon_1=e.x,this.rayon_2=e.y,this.rayon_3=e.z,this.size=new a.Vector3(e.x,e.y,e.z),this._radiiSquared=new a.Vector3(e.x*e.x,e.y*e.y,e.z*e.z),this._oneOverRadiiSquared=new a.Vector3(0===e.x?0:1/(e.x*e.x),0===e.y?0:1/(e.y*e.y),0===e.z?0:1/(e.z*e.z))}s.prototype.geodeticSurfaceNormal=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.Vector3;return t.set(e.x()*this._oneOverRadiiSquared.x,e.y()*this._oneOverRadiiSquared.y,e.z()*this._oneOverRadiiSquared.z),t.normalize()},s.prototype.geodeticSurfaceNormalCartographic=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.Vector3,r=a.Math.degToRad(e.longitude()),n=a.Math.degToRad(e.latitude()),i=Math.cos(n),o=i*Math.cos(r),s=i*Math.sin(r),l=Math.sin(n);return t.set(o,s,l)},s.prototype.setSize=function(e){this.rayon_1=e.x,this.rayon_2=e.y,this.rayon_3=e.z,this._radiiSquared=new a.Vector3(e.x*e.x,e.y*e.y,e.z*e.z)};var l=new a.Vector3;s.prototype.cartographicToCartesian=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.Vector3;l.copy(e.geodesicNormal),t.multiplyVectors(this._radiiSquared,l);var r=Math.sqrt(l.dot(t));return t.divideScalar(r),l.multiplyScalar(e.altitude()),t.add(l)},s.prototype.cartesianToCartographic=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.default("EPSG:4326",0,0,0),r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=this.rayon_1,i=this.rayon_3,s=Math.abs((n*n-i*i)/(n*n)),l=1-Math.sqrt(1-s),u=Math.sqrt(e.x*e.x+e.y*e.y),h=Math.atan2(e.y,e.x),c=Math.atan(e.z/u*(1-l+s*n/r)),d=Math.sin(c),f=Math.cos(c),p=Math.atan((e.z*(1-l)+s*n*d*d*d)/((1-l)*(u-s*n*f*f*f))),m=u*Math.cos(p)+e.z*Math.sin(p)-n*Math.sqrt(1-s*Math.sin(p)*Math.sin(p));return t.set("EPSG:4326",a.Math.radToDeg(h),a.Math.radToDeg(p),m)},s.prototype.cartographicToCartesianArray=function(e){for(var t=[],r=0;r<e.length;r++)t.push(this.cartographicToCartesian(e[r]));return t},s.prototype.intersection=function(e){var t=e.origin,r=e.direction,n=r.x*r.x/(this.size.x*this.size.x)+r.y*r.y/(this.size.y*this.size.y)+r.z*r.z/(this.size.z*this.size.z),i=2*t.x*r.x/(this.size.x*this.size.x)+2*t.y*r.y/(this.size.y*this.size.y)+2*t.z*r.z/(this.size.z*this.size.z),o=t.x*t.x/(this.size.x*this.size.x)+t.y*t.y/(this.size.y*this.size.y)+t.z*t.z/(this.size.z*this.size.z)-1,s=i*i-4*n*o;if(s<0||0===n||0===i||0===o)return!1;var l=(-i+(s=Math.sqrt(s)))/(2*n),u=(-i-s)/(2*n);if(l<=1e-4&&u<=1e-4)return!1;var h;if((h=l<=1e-4?u:u<=1e-4?l:l<u?l:u)<1e-4)return!1;var c=new a.Vector3;return c.addVectors(e.origin,r.clone().setLength(h)),c},s.prototype.computeDistance=function(e,t){var r=a.Math.degToRad(e.longitude()),n=a.Math.degToRad(e.latitude()),i=a.Math.degToRad(t.longitude()),o=a.Math.degToRad(t.latitude()),s=Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(i-r)),l=this.rayon_1,u=this.rayon_3,h=Math.sqrt((l*l-u*u)/(l*l)),c=(n+o)/2,d=l*(1-h*h)/Math.sqrt(1-h*h*Math.sin(c)*Math.sin(c)),f=l/Math.sqrt(1-h*h*Math.sin(c)*Math.sin(c));return s*Math.sqrt(d*f)};var u=s;t.default=u},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(0),a=n(r(8)),o=n(r(9)),s=Math.PI/4,l=Math.PI/2,u=1/(2*Math.PI),h=Math.log(2);function c(e){return Math.min(84,Math.max(-86,e))}var d={x:0,y:0},f=new a.default("EPSG:4326",0,0,0),p={WGS84ToY:function(e){return.5-Math.log(Math.tan(s+.5*i.Math.degToRad(e)))*u},YToWGS84:function(e){return i.Math.radToDeg(2*(Math.atan(Math.exp(-(e-.5)/u))-s))},getCoordWMTS_WGS84:function(e,t,r){if("PM"===r)return function(e,t){var r,n=[],i=e.zoom+1,a=Math.pow(2,i),s=1/a,l=p.WGS84ToY(c(t.north())),u=p.WGS84ToY(c(t.south())),h=Math.floor(l/s);r=Math.ceil(u/s)-1,r=Math.min(r,a-1);for(var d=e.col,f=r;f>=h;f--)for(var m=d;m<=d;m++)n.push(new o.default("WMTS:PM",i,f,m));return n}(e,t);if("WGS84G"===r)return[e.clone()];throw new Error("Unsupported TileMatrixSet '".concat(r,"'"))},WGS84toWMTS:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.default("WMTS:WGS84G",0,0,0);e.dimensions(d);var r=Math.floor(Math.log(Math.PI/i.Math.degToRad(d.y))/h+.5),n=Math.pow(2,r),a=2*Math.PI/(2*n),s=Math.PI/n;e.center(f);var u=Math.floor((Math.PI+i.Math.degToRad(f.longitude()))/a),c=Math.floor(n-(l+i.Math.degToRad(f.latitude()))/s);return t.set(r,c,u)},UnitaryToLongitudeWGS84:function(e,t){return t.dimensions(d),t.west()+e*d.x},UnitaryToLatitudeWGS84:function(e,t){return t.dimensions(d),t.south()+e*d.y}},m=p;t.default=m},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=i(r(82)),s=n(r(0)),l=i(r(8)),u=1,h={getElevationValueAt:function(e,t){var r=y(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t,(arguments.length>3?arguments[3]:void 0)||e.level0Nodes);if(r)return{z:r.coord._values[2],texture:r.texture,tile:r.tile}},placeObjectOnGround:function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;if(n=a?a.concat(e.level0Nodes):e.level0Nodes,i.modifyGeometry){var o={worldFromLocal:r.matrixWorld,localFromWorld:(new s.Matrix4).getInverse(r.matrixWorld)},u=r.geometry;if(u.vertices){i.cache&&(i.cache.length=u.vertices.length);for(var h=!0,c=new l.default(t),d=0;d<u.vertices.length;d++){var f=i.cache?i.cache[d]:void 0,p=x(e,i.method||0,n,t,u.vertices[d],i.offset||0,o,c,f);i.cache&&(i.cache[d]=p),p||(h=!1)}return u.verticesNeedUpdate=!0,h}if(u instanceof s.BufferGeometry){i.cache&&(i.cache.length=u.attributes.position.count);for(var m=!0,v=new s.Vector3,g=new l.default(t),y=0;y<u.attributes.position.count;y++){var b=i.cache?i.cache[y]:void 0;v.fromBufferAttribute(u.attributes.position,y);var w=v.z,_=x(e,i.method||0,n,t,v,i.offset||0,o,g,b);i.cache&&(i.cache[y]=_),_||(m=!1),w!=v.z&&(u.attributes.position.needsUpdate=!0),u.attributes.position.setXYZ(y,v.x,v.y,v.z)}return m}}else{i.cache&&(i.cache.length=1);var M={worldFromLocal:r.parent?r.parent.matrixWorld:void 0,localFromWorld:r.parent?(new s.Matrix4).getInverse(r.parent.matrixWorld):void 0},E=x(e,i.method||0,n,t,r.position,i.offset||0,M,void 0,i.cache?i.cache[0]:void 0);if(E)return i.cache&&(i.cache[0]=E),r.updateMatrix(),r.updateMatrixWorld(),!0}},FAST_READ_Z:0,PRECISE_READ_Z:u};function c(e,t){if(t.extent){if(!t.extent.isPointInside(e))return;for(var r=0;r<t.children.length;r++){var n=c(e,t.children[r]);if(n)return n}var i=t.material.getElevationLayer();return i&&i.level>=0?t:void 0}}function d(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];for(var o=0;o<n.length;o+=2)n[o]=s.Math.clamp(n[o],0,t.image.width-1),n[o+1]=s.Math.clamp(n[o+1],0,t.image.height-1);if(t.image.data){if(2===n.length)return t.image.data[n[1]*t.image.width+n[0]];for(var l=[],u=0;u<n.length;u+=2)l.push(t.image.data[n[u+1]*t.image.width+n[u]]);return l}a||((a=document.createElement("canvas")).width=2,a.height=2);for(var h=1/0,c=1/0,d=-1/0,f=-1/0,p=0;p<n.length;p+=2)h=Math.min(n[p],h),c=Math.min(n[p+1],c),d=Math.max(n[p],d),f=Math.max(n[p+1],f);var m=d-h+1,v=f-c+1;a.width=Math.max(a.width,m),a.height=Math.max(a.height,v);var g=a.getContext("2d");g.drawImage(t.image,h,c,m,v,0,0,m,v);for(var y=g.getImageData(0,0,m,v),x=e.attachedLayers.filter(function(e){return"elevation"==e.type})[0],b=[],w=0;w<n.length;w+=2){var _=n[w]-h,M=n[w+1]-c;b.push(s.Math.lerp(x.colorTextureElevationMinZ,x.colorTextureElevationMaxZ,y.data[4*M*m+4*_]/255))}return 2===n.length?b[0]:b}function f(e,t,r){var n=e.image.width,i=e.image.height,a=Math.max(0,t*n-.5),o=Math.max(0,r*i-.5),s=Math.floor(a),l=Math.ceil(a),u=Math.floor(o);return{u1:s,u2:l,v1:u,v2:Math.ceil(o),wu:a-s,wv:o-u}}function p(e,t,r,n){var i=f(t,r,n),a=d(e,t,i.u1,i.v1,i.u2,i.v1,i.u1,i.v2,i.u2,i.v2),l=(0,o.default)(a,4),u=l[0],h=l[1],c=l[2],p=l[3],m=s.Math.lerp(u,h,i.wu),v=s.Math.lerp(c,p,i.wu);return s.Math.lerp(m,v,i.wv)}function m(e,t,r){return function(e,t,r,n){var i=f(t,r,n);return d(e,t,i.wu<=0?i.u1:i.u2,i.wv<=0?i.v1:i.v2)}(e,t,r.x,r.y)}t.default=h;var v=new s.Vector3,g={v:new s.Vector3,coord1:new l.default("EPSG:4978"),coord2:new l.default("EPSG:4978"),offset:new s.Vector2};function y(e,t,r,n,i){var a=r.as(e.extent.crs(),g.coord1),o=null;i&&i.tile&&i.tile.material&&(o=c(a,i.tile));for(var l=0;!o&&l<n.length;l++)o=c(a,n[l]);if(o){var h=o,d=h.material.getElevationLayer(),f=d.textures[0];if(i&&i.id===f.id&&i.version===f.version)return{coord:a,texture:f,tile:h};for(var y=Math.round(Math.log2(1/d.offsetScales[0].z)),x=0;x<y;x++)o=o.parent;var b=a.offsetInExtent(o.extent,g.offset);return a._values[2]=t==u?function(e,t,r,n,i){var a=n.x/i.x/16,o=Math.floor(r.x/a)*a,l=Math.floor(r.y/a)*a;1==o&&(o-=a),1==l&&(l-=a);var u=o,h=o+a,c=l,d=l+a,f=(r.x-o)/a,m=(r.y-l)/a,g=new s.Triangle(new s.Vector3(u,d),new s.Vector3(h,c),1==m||f/(1-m)>=1?new s.Vector3(h,d):new s.Vector3(u,c));g.getBarycoord(new s.Vector3(r.x,r.y),v);var y=p(e,t,g.a.x,g.a.y),x=p(e,t,g.b.x,g.b.y),b=p(e,t,g.c.x,g.c.y);return y*v.x+x*v.y+b*v.z}(e,f,b,h.extent.dimensions(),o.extent.dimensions()):m(e,f,b),{coord:a,texture:f,tile:h}}}function x(e,t,r,n,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,h=s||new l.default(n);o.worldFromLocal?h.set(n,g.v.copy(i).applyMatrix4(o.worldFromLocal)):h.set(n,i);var c=y(e,t,h,r,u);if(c)return c.coord._values[2]+=a,c.coord.as(n,g.coord2).xyz(i),o.localFromWorld&&i.applyMatrix4(o.localFromWorld),{id:c.texture.id,version:c.texture.version,tile:c.tile}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new Map,i=new Map,a={POLICIES:{INFINITE:1/0,TEXTURE:9e5,ELEVATION:9e5},get:function(e){var t=n.get(e),r=i.get(e)||i.set(e,{hit:0,miss:0});if(t)return r.hit++,t.lastTimeUsed=Date.now(),t.value;r.miss++},set:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i={value:t,lastTimeUsed:Date.now(),lifetime:r};return n.set(e,i),t},delete:function(e){return n.delete(e)},clear:n.clear(),flush:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=n.size;n.forEach(function(t,r){t.lifetime<e-t.lastTimeUsed&&n.delete(r)});var r=0,a=0;return i.forEach(function(e){r+=e.hit,a+=e.miss}),i.clear(),{before:t,after:n.size,hit:r,miss:a}}};Object.freeze(a);var o=a;t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={FINAL:0,DEPTH:1,ID:2},i={MODES:n,push:function(e,t){var r=void 0!==e.mode?e.mode:n.FINAL;if(r==t)return function(){};var i=function(e){return function(t){var r=t.material;r&&(r.mode=e)}};return e.traverse(i(t)),function(){e.traverse(i(r))}}};t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chooseNextLevelToFetch=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.level,u=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,d=h.source.zoom?h.source.zoom.max:1/0;if(c)r=l(c.targetLevel,u,h.source);else switch(e){case a:r=function(e,t,r){var n=r.groups.filter(function(t){return t<=e});return n.length?n[n.length-1]:r.groups[0]}(n,0,h.updateStrategy.options);break;case o:r=function(e,t,r){return Math.min(e,t+(r.increment||1))}(n,u,h.updateStrategy.options);break;case s:r=l(n,u,h.source);break;case i:default:r=function(e,t,r){return e.pendingSubdivision?r:t}(t,n=c?Math.ceil((u+c.targetLevel)/2):n,u)}return Math.min(r,d)},t.STRATEGY_DICHOTOMY=t.STRATEGY_PROGRESSIVE=t.STRATEGY_GROUP=t.STRATEGY_MIN_NETWORK_TRAFFIC=void 0;var n=r(44),i=0;t.STRATEGY_MIN_NETWORK_TRAFFIC=i;var a=1;t.STRATEGY_GROUP=a;var o=2;t.STRATEGY_PROGRESSIVE=o;var s=3;function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t==n.EMPTY_TEXTURE_ZOOM?r.zoom?r.zoom.min:0:Math.min(e,Math.ceil((t+e)/2))}t.STRATEGY_DICHOTOMY=s},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(11)),h=n(r(14)),c=n(r(25)),d=function(e){function t(e,r){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,i.default)(this,t),(n=(0,o.default)(this,(0,s.default)(t).call(this,e,"geometry",a))).isGeometryLayer=!0,!r||!r.isObject3D)throw new Error("Missing/Invalid object3d parameter (must be a\n                three.js Object3D instance)");return"Group"===r.type&&""===r.name&&(r.name=e),Object.defineProperty((0,u.default)((0,u.default)(n)),"object3d",{value:r,writable:!1,configurable:!0}),n.defineLayerProperty("opacity",1,function(){(n.parent?n.parent.object3d:n.object3d).traverse(function(e){e.layer==(0,u.default)((0,u.default)(n))?n.changeOpacity(e):e.content&&e.content.layer==(0,u.default)((0,u.default)(n))&&e.content.traverse(n.changeOpacity)})}),n.defineLayerProperty("wireframe",!1,function(){(n.parent?n.parent.object3d:n.object3d).traverse(function(e){e.layer==(0,u.default)((0,u.default)(n))&&e.material?e.material.wireframe=n.wireframe:e.content&&e.content.layer==(0,u.default)((0,u.default)(n))&&e.content.traverse(function(e){e.material&&e.layer==(0,u.default)((0,u.default)(n))&&(e.material.wireframe=n.wireframe)})})}),n.attachedLayers=[],n.visible=!0,n.getObjectToUpdateForAttachedLayers=function(e){if(e.parent&&e.material)return{element:e,parent:e.parent}},n}return(0,l.default)(t,e),(0,a.default)(t,[{key:"postUpdate",value:function(){}},{key:"culling",value:function(){return!0}},{key:"attach",value:function(e){if(!e.update)throw new Error("Missing 'update' function -> can't attach layer\n                ".concat(e.id));this.attachedLayers.push(e),e.parent=this}},{key:"detach",value:function(e){var t=this.attachedLayers.length;return this.attachedLayers=this.attachedLayers.filter(function(t){return t.id!=e.id}),e.parent=void 0,this.attachedLayers.length<t}},{key:"pickObjectsAt",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.defaultPickingRadius;return c.default.pickObjectsAt(e,t,r,this.object3d)}},{key:"changeOpacity",value:function(e){e.material&&(null!=e.material.opacity&&(e.material.transparent=this.opacity<1,e.material.opacity=this.opacity),e.material.uniforms&&null!=e.material.uniforms.opacity&&(e.material.transparent=this.opacity<1,e.material.uniforms.opacity.value=this.opacity))}}]),t}(h.default);t.default=d},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=n(r(0)),c=i(r(114)),d=i(r(34)),f=r(13),p=n(r(8)),m=i(r(32));h.Object3D.DefaultUp.set(0,0,1);var v=new h.Vector3,g=new p.default("EPSG:4326",0,0,0),y=new m.default(p.ellipsoidSizes),x=[];function b(e){return e-360*Math.floor((e+180)/360)}function w(e){return e.getLayers(function(e){return"tile"==e.protocol})[0]}var _=function(e){function t(){var e;return(0,a.default)(this,t),(e=(0,s.default)(this,(0,l.default)(t).call(this))).seaLevel=new h.Object3D,e.target=new h.Object3D,e.target.rotation.order="ZXY",e.camera=new h.Camera,e.add(e.seaLevel),e.seaLevel.add(e.target),e.target.add(e.camera),e.coord=new p.default("EPSG:4978",0,0),e.targetWorldPosition=new h.Vector3,e.removeAll=function(){},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"applyTransformToCamera",value:function(e,t){var r=this;this.proxy?(t.quaternion.onChange(function(){}),this.camera.matrixWorld.decompose(this.proxy.position,t.quaternion,t.scale),t.quaternion.onChange(function(){return r.removeProxy(e,t)})):this.camera.matrixWorld.decompose(t.position,t.quaternion,t.scale)}},{key:"setProxy",value:function(e,t){var r=this;!this.proxy&&e&&t&&(this.proxy={position:new h.Vector3},Object.keys(t.position).forEach(function(n){return function(e,t,r,n){r.proxy.position[n]=t.position[n],Object.defineProperty(t.position,n,{get:function(){return r.proxy.position[n]},set:function(i){r.removeProxy(e,t),t.position[n]=i}})}(e,t,r,n)}),t.quaternion.onChange(function(){return r.removeProxy(e,t)}))}},{key:"removeProxy",value:function(e,t){var r=this;this.stop(e),this.proxy&&e&&t&&(Object.keys(t.position).forEach(function(e){return Object.defineProperty(t.position,e,{value:r.proxy.position[e],writable:!0})}),t.quaternion.onChange(function(){}),this.proxy=null)}},{key:"setTargetFromCoordinate",value:function(e,t){t.as(w(e).extent.crs(),this.coord);var r=Math.max(0,this.coord._values[2]);this.coord._values[2]=r,this.coord.as(e.referenceCrs).xyz(v),"EPSG:4978"==e.referenceCrs?(this.lookAt(v),this.seaLevel.position.set(0,0,v.length()-r)):(this.position.set(v.x,v.y,0),this.seaLevel.position.set(0,0,0)),this.target.position.set(0,0,r)}},{key:"setFromPositions",value:function(e,t,r){this.setTargetFromCoordinate(e,new p.default(e.referenceCrs,r)),this.target.rotation.set(0,0,0),this.updateMatrixWorld(!0),this.camera.position.copy(t),this.target.worldToLocal(this.camera.position);var n=this.camera.position.length();this.target.rotation.x=Math.asin(this.camera.position.z/n);var i=h.Math.clamp(this.camera.position.y/(Math.cos(this.target.rotation.x)*n),-1,1);this.target.rotation.z=Math.sign(-this.camera.position.x)*Math.acos(i),this.camera.position.set(0,n,0)}},{key:"applyParams",value:function(e,t){t.coord&&this.setTargetFromCoordinate(e,t.coord),null!=t.tilt&&(this.target.rotation.x=h.Math.degToRad(t.tilt)),null!=t.heading&&(this.target.rotation.z=h.Math.degToRad(b(t.heading+180))),t.range&&this.camera.position.set(0,t.range,0),this.camera.rotation.set(.5*-Math.PI,0,Math.PI),this.updateMatrixWorld(!0),this.targetWorldPosition.setFromMatrixPosition(this.seaLevel.matrixWorld)}},{key:"getParams",value:function(){return{coord:this.coord.clone(),tilt:this.tilt,heading:this.heading,range:this.range,targetWorldPosition:this.targetWorldPosition}}},{key:"setfromCamera",value:function(e,t){(function(e,t,r){t.updateMatrixWorld(!0);var n=e.getPickingPositionFromDepth()||function(e,t){var r=new h.Vector3(0,0,.5);if(r.unproject(t),r.sub(t.position).normalize(),"EPSG:4978"==e.referenceCrs)return y.intersection({direction:r,origin:t.position});var n=t.position.z/r.z;return r.multiplyScalar(n).add(t.position)}(e,t),i=n&&!isNaN(n.x)?t.position.distanceTo(n):100;t.localToWorld(r.set(0,0,-i))})(e,t,v),this.setFromPositions(e,t.position,v)}},{key:"copyObject3D",value:function(e){return this.copy(e,!1),this.seaLevel.copy(e.seaLevel,!1),this.target.copy(e.target,!1),this.camera.copy(e.camera),this}},{key:"animateCameraToLookAtTarget",value:function(e,r,n){var i=this;n.easing=n.easing||c.default.Easing.Quartic.InOut,this.setfromCamera(e,r);var a=new c.default.Group;this.start=(this.start||new t).copyObject3D(this),this.end=(this.end||new t).copyObject3D(this);var o,s,l=n.time||2500,u={t:0},d=[],p={promise:new Promise(function(e,t){o=e,s=t}),resolve:o,reject:s};return this.addPlaceTargetOnGround(e,r,n.coord,u),this.end.applyParams(e,n),d.push(new c.default.Tween(u,a).to({t:1},l).easing(n.easing).onUpdate(function(t){"EPSG:4978"==e.referenceCrs&&h.Quaternion.slerp(i.start.quaternion,i.end.quaternion,i.quaternion,t.t),h.Quaternion.slerp(i.start.camera.quaternion,i.end.camera.quaternion,i.camera.quaternion,t.t),i.target.rotation.set(0,0,0),i.target.rotateZ(h.Math.lerp(i.start.target.rotation.z,i.end.target.rotation.z,t.t)),i.target.rotateX(h.Math.lerp(i.start.target.rotation.x,i.end.target.rotation.x,t.t))})),"EPSG:4978"!=e.referenceCrs&&d.push(new c.default.Tween(this.position,a).to(this.end.position,l).easing(n.easing)),d.push(new c.default.Tween(this.seaLevel.position,a).to(this.end.seaLevel.position,l).easing(n.easing)),d.push(new c.default.Tween(this.camera.position,a).to(this.end.camera.position,l).easing(n.easing)),this.animationFrameRequester=function(){a.update(),i.updateMatrixWorld(!0),i.applyTransformToCamera(e,r),i.targetWorldPosition.setFromMatrixPosition(i.seaLevel.matrixWorld),n.callback&&n.callback(i),g.set(e.referenceCrs,i.targetWorldPosition).as(w(e).extent.crs(),i.coord),e.notifyChange(r)},this.removeAll=function(t){this.removeAll=function(){},a.removeAll(),this.animationFrameRequester&&e.removeFrameRequester(f.MAIN_LOOP_EVENTS.BEFORE_RENDER,this.animationFrameRequester),p.resolve(void 0!==t),this.animationFrameRequester=null},d[d.length-1].onComplete(this.removeAll),d.forEach(function(e){return e.start()}),e.addFrameRequester(f.MAIN_LOOP_EVENTS.BEFORE_RENDER,this.animationFrameRequester),e.notifyChange(r),p}},{key:"stop",value:function(e){this.removePlaceTargetOnGround(e),this.removeAll()}},{key:"addPlaceTargetOnGround",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{t:1};if(this.removePlaceTargetOnGround(e),e&&t){var a=this.target.position.z;this.placeTargetOnGround=function(){var o=d.default.getElevationValueAt(w(e),r||n.coord,d.default.PRECISE_READ_Z),s=Math.max(0,o?o.z:0);n.target.position.z=a*(1-i.t)+s*i.t,n.target.updateMatrixWorld(!0),n.applyTransformToCamera(e,t)},this.placeTargetOnGround(),e.addFrameRequester(f.MAIN_LOOP_EVENTS.BEFORE_RENDER,this.placeTargetOnGround)}}},{key:"removePlaceTargetOnGround",value:function(e){e&&this.placeTargetOnGround&&(e.removeFrameRequester(f.MAIN_LOOP_EVENTS.BEFORE_RENDER,this.placeTargetOnGround),this.placeTargetOnGround=null)}},{key:"tilt",get:function(){return h.Math.radToDeg(this.target.rotation.x)}},{key:"heading",get:function(){return b(h.Math.radToDeg(this.target.rotation.z)+180)}},{key:"range",get:function(){return this.camera.position.y}}]),t}(h.Object3D);function M(e){return x[e.uuid]=x[e.uuid]||new _(e),x[e.uuid]}var E={defaultStopPlaceOnGroundAtEnd:!1,Easing:c.default.Easing,stop:function(e,t){M(t).stop(e)},getTransformCameraLookingAtTarget:function(e,t){var r=M(t);return r.setfromCamera(e,t),r.getParams()},transformCameraToLookAtTarget:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.proxy=void 0===r.proxy||r.proxy;var n=M(t);return n.stop(e),n.setfromCamera(e,t),r.proxy&&n.setProxy(e,t),n.applyParams(e,r),n.addPlaceTargetOnGround(e,t,r.coord),n.applyTransformToCamera(e,t),e.notifyChange(t),Promise.resolve(n.getParams())},animateCameraToLookAtTarget:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.proxy=void 0===n.proxy||n.proxy;var i=M(t);return i.stop(e),n.proxy&&i.setProxy(e,t),i.animateCameraToLookAtTarget(e,t,n).promise.then(function(t){var n=i.getParams();return(void 0===n.stopPlaceOnGroundAtEnd?r.defaultStopPlaceOnGroundAtEnd:n.stopPlaceOnGroundAtEnd)&&i.stop(e),n.finished=t,n})},sequenceAnimationsToLookAtTarget:function(e,t){var r=this;return function(e){return e.reduce(function(e,t){return e.then(function(e){return!e.length||e[e.length-1].finished?t().then(Array.prototype.concat.bind(e)):Promise.resolve([{finished:!1}])})},Promise.resolve([]))}((arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{}]).map(function(n){return function(){return r.animateCameraToLookAtTarget(e,t,n)}}))},getDiffParams:function(e,t){var r;if(e&&t)return Math.abs(e.range-t.range)/e.range>.001&&((r=r||{}).range={previous:e.range,new:t.range}),Math.abs(e.tilt-t.tilt)>.1&&((r=r||{}).tilt={previous:e.tilt,new:t.tilt}),Math.abs(e.heading-t.heading)>.1&&((r=r||{}).heading={previous:e.heading,new:t.heading}),(Math.abs(e.coord._values[0]-t.coord._values[0])>.1||Math.abs(e.coord._values[1]-t.coord._values[1]>.1))&&((r=r||{}).coord={previous:e.coord,new:t.coord}),r}};t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default={CYLINDRICAL:1,SPHERICAL:2}},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(t,n)}e.exports=r},function(e){e.exports={a:"2.5.0"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new RegExp("gl_Position.*(?![^]*gl_Position)"),i=new RegExp("[^\\w]*main[^\\w]*(void)?[^\\w]*{"),a={patchMaterialForLogDepthSupport:function(e){if(!e.vertexShader.includes("USE_LOGDEPTHBUF")&&!e.vertexShader.includes("logdepthbuf_pars_vertex")){e.vertexShader="#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n".concat(e.vertexShader);var t=n.exec(e.vertexShader),r=t[0].length+t.index;e.vertexShader="".concat(e.vertexShader.slice(0,r),"\n#include <logdepthbuf_vertex>\n").concat(e.vertexShader.slice(r)),e.fragmentShader="#include <itowns/precision_qualifier\n".concat(e.fragmentShader),e.fragmentShader="#include <logdepthbuf_pars_fragment>\n".concat(e.fragmentShader),r=(t=i.exec(e.fragmentShader))[0].length+t.index,e.fragmentShader="".concat(e.fragmentShader.slice(0,r),"\n#include <logdepthbuf_fragment>\n").concat(e.fragmentShader.slice(r)),e.defines={USE_LOGDEPTHBUF:1,USE_LOGDEPTHBUF_EXT:1}}},unrollLoops:function(e,t){return e.replace(/#pragma unroll_loop\s+for\s*\(\s*int\s+i\s*=\s*([\w\d]+);\s*i\s+<\s+([\w\d]+);\s*i\s*\+\+\s*\)\s*\{\n([^}]*)\}/g,function(e,r,n,i){var a="";r=r in t?t[r]:parseInt(r,10),n=n in t?t[n]:parseInt(n,10);for(var o=r;o<n;o++)a+=i.replace(/\bi\b/g," ".concat(o," "));return a})}};t.default=a},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.EMPTY_TEXTURE_ZOOM=void 0;var a=i(r(3)),o=i(r(4)),s=n(r(0)),l=r(17),u=r(45),h=-1;function c(e,t,r,n){var i=void 0!==r?r:n;Object.defineProperty(e,t,{get:function(){return i},set:function(e){i!==e&&(i=e)}})}t.EMPTY_TEXTURE_ZOOM=h;var d=function(){function e(t,r,n){var i=this;(0,a.default)(this,e),this.id=r.id,this.textureOffset=0,this.crs=l.CRS_DEFINES.findIndex(function(e){return e.includes(n||"WGS84")}),-1==this.crs&&console.error("Unknown crs:",n);var o=void 0===r.opacity||r.opacity;Object.defineProperty(this,"opacity",{get:function(){return o},set:function(e){o!==e&&(0!==e&&0!==o||(i.material.layersNeedUpdate=!0),o=e)}});var s=void 0===r.visible||r.visible;Object.defineProperty(this,"visible",{get:function(){return s},set:function(e){s!==e&&(i.material.layersNeedUpdate=!0,s=e)}}),c(this,"effect",r.fx,0);var u={bias:0,scale:1,mode:l.ELEVATION_MODES.DATA,zmin:0,zmax:1/0};if(r.useRgbaTextureElevation)throw u.mode=l.ELEVATION_MODES.RGBA,u.zmax=5e3,new Error("Restore this feature");if(r.useColorTextureElevation){u.mode=l.ELEVATION_MODES.COLOR;var d=r.colorTextureElevationMinZ,f=r.colorTextureElevationMaxZ;u.scale=f-d,u.bias=d}c(this,"bias",r.bias,u.bias),c(this,"scale",r.scale,u.scale),c(this,"mode",r.mode,u.mode),c(this,"zmin",r.zmin,u.zmin),c(this,"zmax",r.zmax,u.zmax),this.textures=[],this.offsetScales=[],this.level=h,this.type=r.type,this.material=t}return(0,o.default)(e,[{key:"initFromParent",value:function(e,t){if(e&&e.level>this.level){var r=0,n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,u=!0,h=!1,c=void 0;try{for(var d,f=e.textures[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var p=d.value;if(l.isInside(p.coords)){this.setTexture(r++,p,l.offsetToParent(p.coords));break}}}catch(e){h=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"replaceNoDataValueFromParent",value:function(e,t){var r=this.textures[0].image.data,n=e&&e.textures[0];if(r&&n&&!(0,u.checkNodeElevationTextureValidity)(r,t)){var i=this.textures[0].coords.offsetToParent(n.coords);(0,u.insertSignificantValuesFromParent)(r,n.image.data,t,i)}}},{key:"dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.textures[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;a instanceof s.Texture&&a.dispose()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.level=h,this.textures=[],this.offsetScales=[],this.material.layersNeedUpdate=!0}},{key:"setTexture",value:function(e,t,r){this.level=t&&0==e?t.coords.zoom:this.level,this.textures[e]=t||null,this.offsetScales[e]=r,this.material.layersNeedUpdate=!0}},{key:"setTextures",value:function(e,t){this.dispose(!1);for(var r=0,n=e.length;r<n;++r)this.setTexture(r,e[r],t[r])}}]),e}();t.default=d},function(e,t,r){"use strict";function n(e,t,r){var n=Math.floor(e/r)/r,i=t.x+e%r/r*t.z,a=t.y+n*t.w;return Math.floor(a*r)*r+Math.floor(i*r)}Object.defineProperty(t,"__esModule",{value:!0}),t.computeMinMaxElevation=function(e,t,r,n){var i=1e6,a=-1e6;if(!e)return{min:null,max:null};for(var o=n?Math.floor(n.z*t):e.length,s=n?Math.floor(n.z*r):1,l=n?Math.floor(n.x*t):0,u=n?Math.floor(n.y*r):0,h=n?Math.max(Math.floor(o/8),2):16,c=u;c<u+s;c+=h)for(var d=c*(t||0),f=l;f<l+o;f+=h){var p=e[d+f];p>-10&&void 0!==p&&(a=Math.max(a,p),i=Math.min(i,p))}return-1e6===a||1e6===i?{min:null,max:null}:{min:i,max:a}},t.checkNodeElevationTextureValidity=function(e,t){var r=e.length;return e[0]>t&&e[r-1]>t&&e[Math.sqrt(r)-1]>t&&e[r-Math.sqrt(r)]>t},t.insertSignificantValuesFromParent=function(e,t,r,i){for(var a=0,o=e.length;a<o;++a)e[a]===r&&(e[a]=t[n(a,i,256)])}},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.InfoTiledGeometryLayer=t.default=void 0;var i=n(r(12)),a=n(r(6)),o=n(r(5)),s=n(r(7)),l=n(r(3)),u=n(r(4)),h=n(r(9)),c=function(){function e(t){(0,l.default)(this,e),this.layer=t}return(0,u.default)(e,[{key:"clear",value:function(){}},{key:"update",value:function(){}}]),e}();t.default=c;var d=function(e){function t(e){var r;return(0,l.default)(this,t),(r=(0,a.default)(this,(0,o.default)(t).call(this,e))).displayed={tiles:new Set},Object.defineProperty(r.displayed,"layers",{get:function(){var e=[];return r.displayed.tiles.forEach(function(t){var r=t.material;e=(0,i.default)(new Set((0,i.default)(e).concat((0,i.default)(r.colorLayerIds.filter(function(e){return r.getLayer(e)})),(0,i.default)(r.elevationLayerIds))))}),r.layer.attachedLayers.filter(function(t){return e.includes(t.id)})}}),Object.defineProperty(r.displayed,"extent",{get:function(){var e=new h.default(r.layer.extent.crs(),1/0,-1/0,1/0,-1/0);return e.min=1/0,e.max=-1/0,r.displayed.tiles.forEach(function(t){e.union(t.extent),e.min=Math.min(t.obb.z.min,e.min),e.max=Math.max(t.obb.z.max,e.max)}),e}}),r}return(0,s.default)(t,e),(0,u.default)(t,[{key:"clear",value:function(){this.displayed.tiles.clear()}},{key:"update",value:function(e){e.material.visible?this.displayed.tiles.add(e):this.displayed.tiles.delete(e)}}]),t}(c);t.InfoTiledGeometryLayer=d},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(14)),h=r(23),c=n(r(49)),d=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.default)(this,t),(r=(0,o.default)(this,(0,s.default)(t).call(this,e,"color",n))).isColorLayer=!0,r.style=n.style||{},r.defineLayerProperty("visible",!0),r.defineLayerProperty("opacity",1),r.defineLayerProperty("sequence",0),r.transparent=n.transparent||r.opacity<1,r.noTextureParentOutsideLimit=!!n.source&&"file"==n.source.protocol,r}return(0,l.default)(t,e),(0,a.default)(t,[{key:"update",value:function(e,t,r,n){return(0,h.updateLayeredMaterialNodeImagery)(e,this,r,n)}},{key:"convert",value:function(e,t){return c.default.convert(e,t,this)}}]),t}(u.default);t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={IDLE:0,PENDING:1,ERROR:2,DEFINITIVE_ERROR:3,FINISHED:4},i=[1,3,7,60];function a(){this.state=n.IDLE,this.lastErrorTimestamp=0,this.errorCount=0}a.prototype.canTryUpdate=function(e){switch(this.state){case n.IDLE:return!0;case n.DEFINITIVE_ERROR:case n.PENDING:case n.FINISHED:return!1;case n.ERROR:default:return 1e3*this.secondsUntilNextTry()<=e-this.lastErrorTimestamp}},a.prototype.secondsUntilNextTry=function(){if(this.state!==n.ERROR)return 0;var e=Math.max(0,Math.min(this.errorCount,i.length)-1);return i[e]},a.prototype.newTry=function(){this.state=n.PENDING},a.prototype.success=function(){this.failureParams=void 0,this.lastErrorTimestamp=0,this.state=n.IDLE},a.prototype.noMoreUpdatePossible=function(){this.failureParams=void 0,this.state=n.FINISHED},a.prototype.failure=function(e,t,r){this.failureParams=r,this.lastErrorTimestamp=e,this.state=t?n.DEFINITIVE_ERROR:n.ERROR,this.errorCount++},a.prototype.inError=function(){return this.state==n.DEFINITIVE_ERROR||this.state==n.ERROR};var o=a;t.default=o},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(87)),s=function(e){return e.generateMipmaps=!1,e.magFilter=a.LinearFilter,e.minFilter=a.LinearFilter,e},l={convert:function(e,t,r){var n;if(e.isFeature){var i=r.backgroundLayer&&r.backgroundLayer.paint?new a.Color(r.backgroundLayer.paint["background-color"]):void 0,l=t.as(r.projection);(n=o.default.createTextureFromFeature(e,l,256,r.style,i)).parsedData=e,n.coords=t}else{if(!e.isTexture)throw new Error("Data type is not supported to convert into texture");n=e}return"color"===r.type?function(e,t){return e.anisotropy=16,e.premultiplyAlpha=t,s(e)}(n,r.transparent):"elevation"===r.type?(n.flipY&&(n.flipY=!1),s(n)):void 0}};t.default=l},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(14)),h=r(23),c=n(r(49)),d=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.default)(this,t),(r=(0,o.default)(this,(0,s.default)(t).call(this,e,"elevation",n))).isElevationLayer=!0,r}return(0,l.default)(t,e),(0,a.default)(t,[{key:"update",value:function(e,t,r,n){return(0,h.updateLayeredMaterialNodeElevation)(e,this,r,n)}},{key:"convert",value:function(e,t){return c.default.convert(e,t,this)}}]),t}(u.default);t.default=d},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(26)),h=i(r(7)),c=n(r(0)),d=i(r(24)),f=r(8),p=function(e){function t(e,r,n,i){var o,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((0,a.default)(this,t),o=(0,s.default)(this,(0,l.default)(t).call(this,e,r)),!i)throw new Error("extent is mandatory to build a TileMesh");return o.layer=n,o.extent=i,o.level=u,o.material.objectId=o.id,o.obb=o.geometry.OBB.clone(),o.boundingSphere=new c.Sphere,o.obb.box3D.getBoundingSphere(o.boundingSphere),o.wmtsCoords={},o.frustumCulled=!1,o.matrixAutoUpdate=!1,o.rotationAutoUpdate=!1,o.layerUpdateState={},o}return(0,h.default)(t,e),(0,o.default)(t,[{key:"updateMatrixWorld",value:function(e){(0,u.default)((0,l.default)(t.prototype),"updateMatrixWorld",this).call(this,e),this.obb.update()}},{key:"setBBoxZ",value:function(e,t){null==e&&null==t||Math.floor(e)===Math.floor(this.obb.z.min)&&Math.floor(t)===Math.floor(this.obb.z.max)||(this.obb.updateZ(e,t),this.obb.box3D.getBoundingSphere(this.boundingSphere))}},{key:"getCoordsForSource",value:function(e){if(e.isWMTSSource)return d.default.computeTileMatrixSetCoordinates(this,e.tileMatrixSet),this.wmtsCoords[e.tileMatrixSet];if(e.isWMSSource&&this.extent.crs()!=e.projection){if("EPSG:3857"==e.projection)return d.default.computeTileMatrixSetCoordinates(this,"PM"),this.wmtsCoords.PM;throw new Error("unsupported projection wms for this viewer")}return e.isTMSSource?(0,f.is4326)(this.extent.crs())&&("EPSG:3857"==e.extent.crs()||(0,f.is4326)(e.extent.crs()))?(d.default.computeTileMatrixSetCoordinates(this,"PM"),this.wmtsCoords.PM):d.default.computeTMSCoordinates(this,e.extent,e.isInverted):e.extent.crs()==this.extent.crs()?[this.extent]:[this.extent.as(e.extent.crs())]}},{key:"getZoomForLayer",value:function(e){return this.getCoordsForSource(e.source)[0].zoom||this.level}},{key:"findCommonAncestor",value:function(e){if(e)return e.level==this.level?e.id==this.id?e:0!=e.level?this.parent.findCommonAncestor(e.parent):void 0:e.level<this.level?this.parent.findCommonAncestor(e):this.findCommonAncestor(e.parent)}},{key:"findAncestorFromLevel",value:function(e){for(var t=this;t&&t.level>e;)t=t.parent;return t||Promise.reject("Invalid targetLevel requested ".concat(e))}},{key:"onBeforeRender",value:function(){this.material.layersNeedUpdate&&this.material.updateLayersUniforms()}}]),t}(c.Mesh);t.default=p},function(e,t,r){"use strict";var n=r(53);function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(a,this,t),this.length=this._features.length}function a(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,t,this.extent,this._keys,this._values)}},function(e,t,r){"use strict";var n=r(97);function i(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(a,this,t)}function a(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function o(e){for(var t,r,n=0,i=0,a=e.length,o=a-1;i<a;o=i++)t=e[i],n+=((r=e[o]).x-t.x)*(t.y+r.y);return n}e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,l=[];e.pos<r;){if(a<=0){var u=e.readVarint();i=7&u,a=u>>3}if(a--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&l.push(t),t=[]),t.push(new n(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&l.push(t),l},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,l=1/0,u=-1/0;e.pos<t;){if(n<=0){var h=e.readVarint();r=7&h,n=h>>3}if(n--,1===r||2===r)(i+=e.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=e.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,l,s,u]},i.prototype.toGeoJSON=function(e,t,r){var n,a,s=this.extent*Math.pow(2,r),l=this.extent*e,u=this.extent*t,h=this.loadGeometry(),c=i.types[this.type];function d(e){for(var t=0;t<e.length;t++){var r=e[t],n=180-360*(r.y+u)/s;e[t]=[360*(r.x+l)/s-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(n=0;n<h.length;n++)f[n]=h[n][0];d(h=f);break;case 2:for(n=0;n<h.length;n++)d(h[n]);break;case 3:for(h=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],a=0;a<t;a++){var s=o(e[a]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}return r&&i.push(r),i}(h),n=0;n<h.length;n++)for(a=0;a<h[n].length;a++)d(h[n][a])}1===h.length?h=h[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p}},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(28)),a={parse:function(e){var t=i.default.decode(new Uint8Array(e)),r=JSON.parse(t);return Promise.resolve(r)}};t.default=a},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=new Map;function o(e,t){i.BufferGeometry.call(this),this.center=t.Center(e.extent).clone(),this.extent=e.extent;var r=this.computeBuffers(e,t);this.setIndex(r.index),this.addAttribute("position",r.position),this.addAttribute("normal",r.normal),this.addAttribute("uv_wgs84",r.uv.wgs84),this.addAttribute("uv_pm",r.uv.pm),this.computeBoundingBox(),this.OBB=t.OBB(this.boundingBox)}o.prototype=Object.create(i.BufferGeometry.prototype),o.prototype.constructor=o,o.prototype.computeBuffers=function(e,t){var r=new function(){this.index=null,this.position=null,this.normal=null,this.uv={wgs84:null,pm:null}},n=e.segment,o=(n+1)*(n+1)+(e.disableSkirt?0:4*n),s=n*n*2+(e.disableSkirt?0:4*n*2);r.position=new i.BufferAttribute(new Float32Array(3*o),3),r.normal=new i.BufferAttribute(new Float32Array(3*o),3),r.uv.pm=new i.BufferAttribute(new Float32Array(o),1);var l="".concat(t.type,"_").concat(e.disableSkirt?0:1,"_").concat(e.segment),u=a.get(l),h=!u;u?(r.index=u.index,r.uv.wgs84=u.uvwgs84):(r.index=new i.BufferAttribute(new Uint32Array(3*s),1),r.uv.wgs84=new i.BufferAttribute(new Float32Array(2*o),2),a.set(l,{index:r.index,uvwgs84:r.uv.wgs84}));var c=Math.max(2,Math.floor(n)||2),d=Math.max(2,Math.floor(n)||2),f=0,p=[],m=[],v=[];t.Prepare(e);var g=function(){},y=function(){};h&&(g=function(e,t,r,n){e.uv.wgs84.array[2*t+0]=r,e.uv.wgs84.array[2*t+1]=n}),t.getUV_PM&&(y=function(e,t,r){e.uv.pm.array[t]=r});for(var x=0;x<=d;x++){var b=[],w=x/d;t.vProjecte(w,e);for(var _=t.getUV_PM?t.getUV_PM(e):void 0,M=0;M<=c;M++){var E=M/c,S=3*f;t.uProjecte(E,e);var T=t.VertexPosition(e,e.projected),A=t.VertexNormal(e);T.sub(this.center),e.quatNormalToZ&&(T.applyQuaternion(e.quatNormalToZ),A.applyQuaternion(e.quatNormalToZ)),T.toArray(r.position.array,S),A.toArray(r.normal.array,S),g(r,f,E,w),y(r,f,_),e.disableSkirt||0!==x&&x!==d&&(M===c?m.push(f):0===M&&v.push(f)),b.push(f),f++}p.push(b),0===x?m=m.concat(b):x===d&&(m=m.concat(b.slice().reverse()))}function L(e,t,n,i){return r.index.array[i+0]=e,r.index.array[i+1]=t,r.index.array[i+2]=n,i+3}e.disableSkirt||(m=m.concat(v.reverse()));var P=0;if(h)for(var C=0;C<d;C++)for(var R=0;R<c;R++){var O=p[C][R+1],D=p[C][R],I=p[C+1][R],N=p[C+1][R+1];P=L(N,I,D,P=L(N,D,O,P))}var F=f;if(!e.disableSkirt){var U=(new i.Vector3).fromArray(r.position.array).distanceTo((new i.Vector3).fromArray(r.position.array,3)),k=function(){},B=function(){};h&&(k=function(e,t,r,n,i){return L(t,n,i,e=L(t,r,n,e))},B=function(e){r.uv.wgs84.array[2*f+0]=r.uv.wgs84.array[2*e+0],r.uv.wgs84.array[2*f+1]=r.uv.wgs84.array[2*e+1]});for(var z=0;z<m.length;z++){var G=m[z],j=3*f,V=3*G;r.position.array[j+0]=r.position.array[V+0]-r.normal.array[V+0]*U,r.position.array[j+1]=r.position.array[V+1]-r.normal.array[V+1]*U,r.position.array[j+2]=r.position.array[V+2]-r.normal.array[V+2]*U,r.normal.array[j+0]=r.normal.array[V+0],r.normal.array[j+1]=r.normal.array[V+1],r.normal.array[j+2]=r.normal.array[V+2],B(G),r.uv.pm.array[f]=r.uv.pm.array[G];var H=(z+1)%m.length;P=k(P,G,f,0===H?F:f+1,m[H]),f++}}return r};var s=o;t.default=s},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(8)),s=n(r(33)),l=n(r(29)),u=n(r(9)),h=new a.Vector3(0,0,1),c=new a.Vector3(0,1,0);function d(e){return 1-s.default.WGS84ToY(e)}function f(){this.tmp={coords:[new o.default("EPSG:4326",0,0),new o.default("EPSG:4326",0,0)],position:new a.Vector3},this.type="e"}f.prototype.constructor=f,f.prototype.Prepare=function(e){e.nbRow=Math.pow(2,e.level+1);var t=d(e.extent.south());isFinite(t)||(t=0);var r=t%(1/e.nbRow);e.deltaUV1=(t-r)*e.nbRow,e.quatNormalToZ=(new a.Quaternion).setFromAxisAngle(c,-(.5*Math.PI-a.Math.degToRad(e.extent.center().latitude()))),e.projected={longitude:0,latitude:0}},f.prototype.Center=function(e){return e.center(this.tmp.coords[0]).as("EPSG:4978",this.tmp.coords[1]).xyz()},f.prototype.VertexPosition=function(e){return this.tmp.coords[0].set("EPSG:4326",e.projected.longitude,e.projected.latitude),this.tmp.coords[0].as("EPSG:4978",this.tmp.coords[1]).xyz(this.tmp.position),this.tmp.position},f.prototype.VertexNormal=function(){return this.tmp.coords[1].geodesicNormal},f.prototype.uProjecte=function(e,t){t.projected.longitude=s.default.UnitaryToLongitudeWGS84(e,t.extent)},f.prototype.vProjecte=function(e,t){t.projected.latitude=s.default.UnitaryToLatitudeWGS84(e,t.extent)},f.prototype.getUV_PM=function(e){var t=d(e.projected.latitude)*e.nbRow;return isFinite(t)||(t=0),t-e.deltaUV1};var p=new a.Quaternion,m=new a.Quaternion;f.prototype.computeSharableExtent=function(e){var t=Math.abs(e.west()-e.east())/2,r=new u.default(e.crs(),-t,t,e.south(),e.north()),n=a.Math.degToRad(e.west()-r.west()),i=a.Math.degToRad(90-e.center().latitude());return p.setFromAxisAngle(h,n),m.setFromAxisAngle(c,i),p.multiply(m),{sharableExtent:r,quaternion:p.clone(),position:this.Center(e)}},f.prototype.OBB=function(e){return new l.default(e.min,e.max)};var v=f;t.default=v},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.$3dTilesCulling=m,t.pre3dTilesUpdate=function(){if(!this.visible)return[];var e=Date.now();if(this._cleanableTiles.length&&e-this._cleanableTiles[0].cleanableSince>this.cleanupDelay){this.root.cleanableSince=void 0;for(var t=0;t<this._cleanableTiles.length;t++){var r=this._cleanableTiles[t];if(!(e-r.cleanableSince>this.cleanupDelay))break;v(this,r)}this._cleanableTiles.splice(0,t)}return[this.root]},t.computeNodeSSE=b,t.init3dTilesLayer=function(e,t,r){return u(e,t,r,r.tileset.root,void 0,!0).then(function(t){delete r.tileset,r.object3d.add(t),t.updateMatrixWorld(),r.tileIndex.index[t.tileId].loaded=!0,r.root=t,r.extent=f(r.projection||e.referenceCrs,t.boundingVolume,t.matrixWorld)})},t.process3dTilesNode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;return function(r,n,i){if(!i.parent.pendingSubdivision||i.parent.additiveRefinement){var a=!e||!e(r.camera,i,i.matrixWorld);if(i.visible=a,a){var s;if(i.cleanableSince&&(n._cleanableTiles.splice(n._cleanableTiles.indexOf(i),1),i.cleanableSince=void 0),i.pendingSubdivision||t(r,n,i))!function(e,t,r,n){r.additiveRefinement?function(e,t,r,n){var i=!0,a=!1,o=void 0;try{for(var s,l=function(){var i=s.value;if(i.promise||i.loaded)return"continue";var a=r.matrixWorld;if(i.transform&&(a=p.multiplyMatrices(r.matrixWorld,i.transform)),!(!n||!n(e.camera,i,a)))return"continue";i.promise=u(e.view,e.scheduler,t,i,r,!0).then(function(n){r.add(n),n.updateMatrixWorld();var a=f(t.extent.crs(),n.boundingVolume,n.matrixWorld);n.traverse(function(e){e.extent=a}),e.view.notifyChange(i),i.loaded=!0,delete i.promise})},h=t.tileIndex.index[r.tileId].children[Symbol.iterator]();!(i=(s=h.next()).done);i=!0)l()}catch(e){a=!0,o=e}finally{try{i||null==h.return||h.return()}finally{if(a)throw o}}}(e,t,r,n):function(e,t,r){if(!r.pendingSubdivision&&0==h(r).length){var n=function(){var n=t.tileIndex.index[r.tileId].children;if(void 0===n||0===n.length)return{v:void 0};r.pendingSubdivision=!0;for(var i=[],a=function(a){i.push(u(e.view,e.scheduler,t,n[a],r,!1).then(function(i){n[a].loaded=!0,r.add(i),i.updateMatrixWorld(),r.additiveRefinement&&e.view.notifyChange(r),t.tileIndex.index[i.tileId].loaded=!0}))},o=0;o<n.length;o++)a(o);Promise.all(i).then(function(){r.pendingSubdivision=!1,e.view.notifyChange(r)})}();"object"===(0,o.default)(n)&&n.v}}(e,t,r)}(r,n,i,e),w(i,i.pendingSubdivision||i.additiveRefinement),s=h(i);else{w(i,!0);var l=!0,c=!1,d=void 0;try{for(var m,v=h(i)[Symbol.iterator]();!(l=(m=v.next()).done);l=!0){var g=m.value;g.visible=!1,_(n,g)}}catch(e){c=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw d}}}return s}_(n,i)}else i.visible=!1}},t.$3dTilesSubdivisionControl=M;var a=i(r(12)),o=i(r(19)),s=n(r(0)),l=i(r(9));function u(e,t,r,n,i,a){var o={view:e,requester:i,layer:r,priority:i?1/(i.distance+1):100,metadata:n,redraw:a};return t.execute(o)}function h(e){return e.children.filter(function(t){return t.layer==e.layer&&t.tileId})}var c=new s.Box3,d=new s.Sphere;function f(e,t,r){if(t.region)return new l.default("EPSG:4326",s.Math.radToDeg(t.region[0]),s.Math.radToDeg(t.region[2]),s.Math.radToDeg(t.region[1]),s.Math.radToDeg(t.region[3]));if(t.box){var n=c.copy(t.box).applyMatrix4(r);return l.default.fromBox3(e,n)}var i=d.copy(t.sphere).applyMatrix4(r);return new l.default(e,{west:i.center.x-i.radius,east:i.center.x+i.radius,south:i.center.y-i.radius,north:i.center.y+i.radius})}var p=new s.Matrix4;function m(e,t,r){if(t.viewerRequestVolume){var n=t.viewerRequestVolume;if(n.region)return!0;if(n.box)return!0;if(n.sphere){var i=n.sphere.center.clone();if(i.applyMatrix4(r),!(e.camera3D.position.distanceTo(i)<=n.sphere.radius))return!0}}if(t.boundingVolume){var a=t.boundingVolume;if(a.region)return!e.isBox3Visible(a.region.box3D,r.clone().multiply(a.region.matrix));if(a.box)return!e.isBox3Visible(a.box,r);if(a.sphere)return!e.isSphereVisible(a.sphere,r)}return!1}function v(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.additiveRefinement||r>0,i=0;i<t.children.length;i++)t.children[i].content?v(e,t.children[i],r+1):n&&t.children[i].traverse(g);if(n)t.dispose&&t.dispose(),delete t.content,e.tileIndex.index[t.tileId].loaded=!1,t.remove.apply(t,(0,a.default)(t.children)),0==r&&t.parent&&t.parent.remove(t);else{var o=h(t);t.remove.apply(t,(0,a.default)(o))}}function g(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e.children[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)g(i.value)}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),e.remove.apply(e,(0,a.default)(e.children))}var y=new s.Box3,x=new s.Sphere;function b(e,t){if(t.distance=0,t.boundingVolume.region)y.copy(t.boundingVolume.region.box3D),y.applyMatrix4(t.boundingVolume.region.matrixWorld),t.distance=y.distanceToPoint(e.camera3D.position);else if(t.boundingVolume.box)y.copy(t.boundingVolume.box),y.applyMatrix4(t.matrixWorld),t.distance=y.distanceToPoint(e.camera3D.position);else{if(!t.boundingVolume.sphere)return 1/0;x.copy(t.boundingVolume.sphere),x.applyMatrix4(t.matrixWorld),t.distance=Math.max(0,x.distanceToPoint(e.camera3D.position))}return 0===t.distance?1/0:e._preSSE*(t.geometricError/t.distance)}function w(e,t){e.content&&(e.content.visible=t)}function _(e,t){t.cleanableSince||(t.cleanableSince=Date.now(),e._cleanableTiles.push(t))}function M(e,t,r){return void 0!==t.tileIndex.index[r.tileId].children&&(!!t.tileIndex.index[r.tileId].isTileset||b(e.camera,r)>t.sseThreshold)}},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(15));function s(e,t,r,n){if(n<=0)return 1/0;var i=t.metadata.spacing/Math.pow(2,r.name.length),a=e.camera.preSSE*i/n;return Math.max(0,a-t.pointSize)}function l(e){e.obj&&(e.obj.material.visible=!1),e.notVisibleSince||(e.notVisibleSince=Date.now(),e.sse=-1);var t=!0,r=!1,n=void 0;try{for(var i,a=e.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)l(i.value)}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}var u={preUpdate:function(e,t){if(!this.root)return[];var r;e.camera.preSSE=e.camera.height/(2*Math.tan(.5*a.Math.degToRad(e.camera.camera3D.fov))),this.material&&(this.material.visible=this.visible,this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.size=this.pointSize);var n=!0,i=!1,o=void 0;try{for(var s,l=t.values()[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value;if(u.isCamera||u==this)return[this.root];if(void 0!==u.obj&&u.obj.isPoints&&u.obj.layer==this)if(r){var h=void 0;for(h=0;h<Math.min(u.name.length,r.length)&&u.name[h]==r[h];h++);if(0==(r=r.substr(0,h)).length)break}else r=u.name}}catch(e){i=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}return r?[this.root.findChildrenByName(r)]:[this.root]},update:function(e,t,r){if(r.visible=!1,t.octreeDepthLimit>=0&&t.octreeDepthLimit<r.name.length)l(r);else{var n=r.tightbbox?r.tightbbox:r.bbox;if(r.visible=e.camera.isBox3Visible(n,t.object3d.matrixWorld),r.visible){if(r.notVisibleSince=void 0,r.numPoints>0)if(r.obj)r.obj.material.update?r.obj.material.update(t.material):r.obj.material.copy(t.material);else if(!r.promise){var i=Math.max(.001,n.distanceToPoint(e.camera.camera3D.position)),a=s(e,t,r,i)/i;r.promise=e.scheduler.execute({layer:t,requester:r,view:e.view,priority:a,redraw:!0,isLeaf:0==r.childrenBitField,earlyDropFunction:function(e){return!e.requester.visible||!t.visible}}).then(function(e){t.onPointsCreated&&t.onPointsCreated(t,e),r.obj=e,r.tightbbox=e.tightbbox,t.group.add(r.obj),r.obj.updateMatrixWorld(!0),r.promise=null},function(e){e instanceof o.default&&(r.promise=null)})}if(r.children&&r.children.length){var u=n.distanceToPoint(e.camera.camera3D.position);if(r.sse=s(e,t,r,u)/t.sseThreshold,r.sse>=1)return r.children;var h=!0,c=!1,d=void 0;try{for(var f,p=r.children[Symbol.iterator]();!(h=(f=p.next()).done);h=!0)l(f.value)}catch(e){c=!0,d=e}finally{try{h||null==p.return||p.return()}finally{if(c)throw d}}}}else l(r)}},postUpdate:function(e,t){if(t.group){t.displayedCount=0;var r=!0,n=!1,i=void 0;try{for(var a,o=t.group.children[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(s.material.visible){var l=s.geometry.attributes.position.count;s.geometry.setDrawRange(0,l),t.displayedCount+=l}}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}if(t.displayedCount>t.pointBudget)if(t.supportsProgressiveDisplay){var u=t.pointBudget/t.displayedCount,h=!0,c=!1,d=void 0;try{for(var f,p=t.group.children[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var m=f.value;if(m.material.visible){var v=Math.floor(m.geometry.drawRange.count*u);v>0?m.geometry.setDrawRange(0,v):m.material.visible=!1}}}catch(e){c=!0,d=e}finally{try{h||null==p.return||p.return()}finally{if(c)throw d}}t.displayedCount*=u}else{t.group.children.sort(function(e,t){return t.userData.metadata.sse-e.userData.metadata.sse});var g=!1;t.displayedCount=0;var y=!0,x=!1,b=void 0;try{for(var w,_=t.group.children[Symbol.iterator]();!(y=(w=_.next()).done);y=!0){var M=w.value,E=M.geometry.attributes.position.count;g||t.displayedCount+E>t.pointBudget?(M.material.visible=!1,g=!0):t.displayedCount+=E}}catch(e){x=!0,b=e}finally{try{y||null==_.return||_.return()}finally{if(x)throw b}}}for(var S=Date.now(),T=t.group.children.length-1;T>=0;T--){var A=t.group.children[T];!A.material.visible&&S-A.userData.metadata.notVisibleSince>1e4&&(t.group.children.splice(T,1),A.material.dispose(),A.geometry.dispose(),A.material=null,A.geometry=null,A.userData.metadata.obj=null)}}}};t.default=u},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MODE=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=r(0),h=n(r(22)),c="precision highp float;\nprecision highp int;\n\n#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n\nattribute vec3 position;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float size;\n\nuniform bool pickingMode;\nuniform int mode;\nuniform float opacity;\nuniform vec4 overlayColor;\nattribute vec3 color;\nattribute vec4 unique_id;\nattribute float intensity;\n\n#if defined(NORMAL_OCT16)\nattribute vec2 oct16Normal;\n#elif defined(NORMAL_SPHEREMAPPED)\nattribute vec2 sphereMappedNormal;\n#else\nattribute vec3 normal;\n#endif\n\nvarying vec4 vColor;\n\n// see https://web.archive.org/web/20150303053317/http://lgdv.cs.fau.de/get/1602\n// and implementation in PotreeConverter (BINPointReader.cpp) and potree (BinaryDecoderWorker.js)\n#if defined(NORMAL_OCT16)\nvec3 decodeOct16Normal(vec2 encodedNormal) {\n    vec2 nNorm = 2. * (encodedNormal / 255.) - 1.;\n    vec3 n;\n    n.z = 1. - abs(nNorm.x) - abs(nNorm.y);\n    if (n.z >= 0.) {\n        n.x = nNorm.x;\n        n.y = nNorm.y;\n    } else {\n        n.x = sign(nNorm.x) - sign(nNorm.x) * sign(nNorm.y) * nNorm.y;\n        n.y = sign(nNorm.y) - sign(nNorm.y) * sign(nNorm.x) * nNorm.x;\n    }\n    return normalize(n);\n}\n#elif defined(NORMAL_SPHEREMAPPED)\n// see http://aras-p.info/texts/CompactNormalStorage.html method #4\n// or see potree's implementation in BINPointReader.cpp\nvec3 decodeSphereMappedNormal(vec2 encodedNormal) {\n    vec2 fenc = 2. * encodedNormal / 255. - 1.;\n    float f = dot(fenc,fenc);\n    float g = 2. * sqrt(1. - f);\n    vec3 n;\n    n.xy = fenc * g;\n    n.z = 1. - 2. * f;\n    return n;\n}\n#endif\n\nvoid main() {\n\n#if defined(NORMAL_OCT16)\n    vec3  normal = decodeOct16Normal(oct16Normal);\n#elif defined(NORMAL_SPHEREMAPPED)\n    vec3 normal = decodeSphereMappedNormal(sphereMappedNormal);\n#elif defined(NORMAL)\n    // nothing to do\n#else\n    // default to color\n    vec3 normal = color;\n#endif\n\n    if (pickingMode) {\n        vColor = unique_id;\n    } else if (mode == MODE_INTENSITY) {\n        vColor = vec4(intensity, intensity, intensity, opacity);\n    } else if (mode == MODE_NORMAL) {\n        vColor = vec4(abs(normal), opacity);\n    } else {\n        // default to color mode\n        vColor = vec4(mix(color, overlayColor.rgb, overlayColor.a), opacity);\n    }\n\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));\n\n    if (size > 0.) {\n        gl_PointSize = size;\n    } else {\n        gl_PointSize = clamp(-size / gl_Position.w, 3.0, 10.0);\n    }\n\n    #include <logdepthbuf_vertex>\n}\n",d="precision highp float;\nprecision highp int;\n\n#include <logdepthbuf_pars_fragment>\n\nvarying vec4 vColor;\n\nvoid main() {\n    // circular point rendering\n    if(length(gl_PointCoord - 0.5) > 0.5){\n        discard;\n    }\n\n    gl_FragColor = vColor;\n\n    #include <logdepthbuf_fragment>\n}\n",f={COLOR:0,INTENSITY:1,CLASSIFICATION:2,NORMAL:3};t.MODE=f;var p=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var n in(0,i.default)(this,t),(e=(0,o.default)(this,(0,s.default)(t).call(this,r))).vertexShader=c,e.fragmentShader=d,e.size=r.size||0,e.scale=r.scale||.025/Math.tan(.5),e.overlayColor=r.overlayColor||new u.Vector4(0,0,0,0),e.mode=r.mode||f.COLOR,e.picking=!1,f)Object.prototype.hasOwnProperty.call(f,n)&&(e.defines["MODE_".concat(n)]=f[n]);return e.uniforms.size=new u.Uniform(e.size),e.uniforms.mode=new u.Uniform(e.mode),e.uniforms.pickingMode=new u.Uniform(e.picking),e.uniforms.opacity=new u.Uniform(e.opacity),e.uniforms.overlayColor=new u.Uniform(e.overlayColor),h.default.isLogDepthBufferSupported()&&(e.defines.USE_LOGDEPTHBUF=1,e.defines.USE_LOGDEPTHBUF_EXT=1),e.updateUniforms(),e}return(0,l.default)(t,e),(0,a.default)(t,[{key:"enablePicking",value:function(e){this.picking=e,this.blending=e?u.NoBlending:u.NormalBlending,this.updateUniforms()}},{key:"updateUniforms",value:function(){this.uniforms.size.value=this.size>0?this.size:-this.scale*window.innerHeight,this.uniforms.mode.value=this.mode,this.uniforms.pickingMode.value=this.picking,this.uniforms.opacity.value=this.opacity,this.uniforms.overlayColor.value=this.overlayColor}},{key:"update",value:function(e){return this.visible=e.visible,this.opacity=e.opacity,this.transparent=e.transparent,this.size=e.size,this.mode=e.mode,this.picking=e.picking,this.scale=e.scale,this.overlayColor.copy(e.overlayColor),this.updateUniforms(),Object.assign(this.defines,e.defines),this}}]),t}(u.RawShaderMaterial);t.default=p},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(16)),h=n(r(30)),c=function(e){function t(e){var r;if((0,i.default)(this,t),!e.name)throw new Error("New WMTSSource: name is required");if((r=(0,o.default)(this,(0,s.default)(t).call(this,e))).isWMTSSource=!0,r.format=r.format||"image/png",r.version=e.version||"1.0.0",r.tileMatrixSet=e.tileMatrixSet||"WGS84",r.style=e.style||"normal",r.name=e.name,r.url="".concat(r.url)+"?LAYER=".concat(r.name)+"&FORMAT=".concat(r.format)+"&SERVICE=WMTS"+"&VERSION=".concat(r.version)+"&REQUEST=GetTile"+"&STYLE=".concat(r.style)+"&TILEMATRIXSET=".concat(r.tileMatrixSet)+"&TILEMATRIX=%TILEMATRIX&TILEROW=%ROW&TILECOL=%COL",r.zoom=e.zoom,r.tileMatrixSetLimits=e.tileMatrixSetLimits,r.projection||("WGS84"===r.tileMatrixSet||"WGS84G"===r.tileMatrixSet?r.projection="EPSG:4326":r.projection="EPSG:3857"),!r.zoom)if(r.tileMatrixSetLimits){var n=Object.keys(r.tileMatrixSetLimits),a=n.length,l=Number(n[a-1]);r.zoom={min:l-a+1,max:l}}else r.zoom={min:2,max:20};return r}return(0,l.default)(t,e),(0,a.default)(t,[{key:"urlFromExtent",value:function(e){return h.default.xyz(e,this)}},{key:"extentInsideLimit",value:function(e){return e.zoom>=this.zoom.min&&e.zoom<=this.zoom.max&&(null==this.tileMatrixSetLimits||e.row>=this.tileMatrixSetLimits[e.zoom].minTileRow&&e.row<=this.tileMatrixSetLimits[e.zoom].maxTileRow&&e.col>=this.tileMatrixSetLimits[e.zoom].minTileCol&&e.col<=this.tileMatrixSetLimits[e.zoom].maxTileCol)}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(16)),h=n(r(30)),c=function(e){function t(e){var r;if((0,i.default)(this,t),!e.name)throw new Error("source.name is required.");if(!e.extent)throw new Error("source.extent is required");if(!e.projection)throw new Error("source.projection is required");(r=(0,o.default)(this,(0,s.default)(t).call(this,e))).isWMSSource=!0,r.name=e.name,r.zoom=e.zoom||{min:0,max:21},r.format=r.format||"image/png",r.style=e.style||"",e.heightMapWidth&&(console.warn("source.heightMapWidth is deprecated, please use source.width instead."),e.width=e.width||e.heightMapWidth),r.width=e.width||e.height||256,r.height=e.height||e.width||256,r.version=e.version||"1.3.0",r.transparent=e.transparent||!1,e.axisOrder||("EPSG:4326"==e.projection?r.axisOrder="1.1.0"===r.version?"wsen":"swne":r.axisOrder="wsen");var n="1.3.0"===r.version?"CRS":"SRS";return r.url="".concat(e.url,"?SERVICE=WMS&REQUEST=GetMap&LAYERS=").concat(r.name,"&VERSION=").concat(r.version,"&STYLES=").concat(r.style,"&FORMAT=").concat(r.format,"&TRANSPARENT=").concat(r.transparent,"&BBOX=%bbox&").concat(n,"=").concat(r.projection,"&WIDTH=").concat(r.width,"&HEIGHT=").concat(r.height),r}return(0,l.default)(t,e),(0,a.default)(t,[{key:"urlFromExtent",value:function(e){return h.default.bbox(e,this)}},{key:"extentInsideLimit",value:function(e){var t=this.projection==e.crs()?e:e.as(this.projection);return(null==e.zoom||!(e.zoom<this.zoom.min||e.zoom>this.zoom.max))&&this.extent.intersectsExtent(t)}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(16)),h=n(r(30)),c=function(e){function t(e){var r;if((0,i.default)(this,t),!e.typeName)throw new Error("source.typeName is required in wfs source.");if(!e.projection)throw new Error("source.projection is required in wfs source");return(r=(0,o.default)(this,(0,s.default)(t).call(this,e))).isWFSSource=!0,r.typeName=e.typeName,r.format=r.format||"application/json",r.version=e.version||"2.0.2",r.url="".concat(e.url,"SERVICE=WFS&REQUEST=GetFeature&typeName=").concat(r.typeName,"&VERSION=").concat(r.version,"&SRSNAME=").concat(r.projection,"&outputFormat=").concat(r.format,"&BBOX=%bbox,").concat(r.projection),r.zoom=e.zoom||{min:0,max:21},r}return(0,l.default)(t,e),(0,a.default)(t,[{key:"handlingError",value:function(e,t){var r=this;if(e.response&&400==e.response.status)return e.response.text().then(function(t){var n="".concat(r.url,"SERVICE=WFS&REQUEST=GetCapabilities&VERSION=").concat(r.version),i=(new DOMParser).parseFromString(t,"application/xml").querySelector("Exception"),a=i.getAttribute("exceptionCode"),o=i.querySelector("ExceptionText").textContent;throw console.error("Source ".concat(r.typeName,': bad request when fetching data. Server says: "').concat(a,": ").concat(o,'". \nReviewing ').concat(n," may help."),e),e});throw console.error("Source ".concat(this.typeName,": error while trying to fetch/parse/convert WFS data. Url was ").concat(t,"."),e),e}},{key:"urlFromExtent",value:function(e){return h.default.bbox(e.as(this.projection),this)}},{key:"extentInsideLimit",value:function(e){return(null==e.zoom||e.zoom>=this.zoom.min&&e.zoom<=this.zoom.max)&&this.extent.intersectsExtent(e)}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(16)),h=n(r(30)),c=n(r(9)),d=function(e){function t(e){var r;return(0,i.default)(this,t),(r=(0,o.default)(this,(0,s.default)(t).call(this,e))).isTMSSource=!0,e.extent||(r.extent=new c.default("EPSG:3857",-20037508.342789244,20037508.342789244,-20037508.342789255,20037508.342789244)),r.zoom=e.zoom||{min:0,max:18},r.isInverted=e.isInverted||!1,e.origin&&(console.warn("Deprecation warning: origin is not supported anymore, use isInverted instead"),r.isInverted="top"==e.origin),r.format=r.format||"image/png",r.url=e.url,e.tileMatrixSet?r.tileMatrixSet=e.tileMatrixSet:"EPSG:3857"==r.projection?r.tileMatrixSet="PM":r.tileMatrixSet="WGS84",r}return(0,l.default)(t,e),(0,a.default)(t,[{key:"urlFromExtent",value:function(e){return h.default.xyz(e,this)}},{key:"handlingError",value:function(e){console.warn("err ".concat(this.url),e)}},{key:"extentInsideLimit",value:function(e){return e.zoom>=this.zoom.min&&e.zoom<=this.zoom.max}}]),t}(u.default);t.default=d},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(20)),a=n(r(12)),o=n(r(3)),s=n(r(4)),l=n(r(6)),u=n(r(5)),h=n(r(7)),c=n(r(11)),d=n(r(147)),f=n(r(16)),p=n(r(18)),m=n(r(9)),v=function(e){function t(e){var r;if((0,o.default)(this,t),console.warn("Deprecation warning: this source is going to be removed in iTowns 2.7.0, please consider stop using it."),!e.extent)throw new Error("layer.extent is required");return(r=(0,l.default)(this,(0,u.default)(t).call(this,e))).isStaticSource=!0,r.zoom={min:0,max:3},r.url=new URL(e.url,window.location),r.whenReady=p.default.json(r.url.href).then(function(e){for(var t in r.images=[],e){var n=(0,i.default)(m.default,[r.projection].concat((0,a.default)(e[t])));r.images.push({image:t,extent:n})}if(r.images.length){r._spatialIndex=new d.default(r.images.length);var o=!0,s=!1,l=void 0;try{for(var u,h=r.images[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var c=u.value;r._spatialIndex.add(c.extent.west(),c.extent.south(),c.extent.east(),c.extent.north())}}catch(e){s=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(s)throw l}}r._spatialIndex.finish()}}).then(function(){if(!r.format&&r.images.length){var e=(t=(0,c.default)((0,c.default)(r)),n=r.images[0].image,t.url.href.substr(0,t.url.href.lastIndexOf("/")+1)+n);return fetch(e,r.networkOptions).then(function(e){if(r.format=e.headers.get("Content-type"),"application/octet-stream"===r.format&&(r.format="image/x-bil"),!r.format)throw new Error("".concat(r.name,": could not detect layer format, please configure 'layer.format'."))})}var t,n}),r}return(0,h.default)(t,e),(0,s.default)(t,[{key:"urlFromExtent",value:function(e){var t=this.getSourceExtents(e);return this.url.href.substr(0,this.url.href.lastIndexOf("/")+1)+t.image}},{key:"handlingError",value:function(e,t){console.error("Source static: ".concat(this.url,", ").concat(e.response.status," error while trying to fetch data. Url was ").concat(t,"."),e)}},{key:"canTileTextureBeImproved",value:function(e,t){if(!this.images)return!1;var r=this.getSourceExtents(e);if(!r)return!1;if(!t||!t.image)return!0;var n=t.image.currentSrc;return this.url.href.substr(0,this.url.href.lastIndexOf("/")+1)+r.image!=n}},{key:"getSourceExtents",value:function(e){e=e.crs()===this.extent.crs()?e:e.as(this.extent.crs());var t,r=function(e,t,r){return e.search(r.west(),r.south(),r.east(),r.north()).map(function(e){return t[e]})}(this._spatialIndex,this.images,e),n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;if(e.isInside(l.extent))if(t){var u=t.extent.dimensions(),h=l.extent.dimensions();h.x<=u.x&&h.y<=u.y&&(t=l)}else t=l}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return t}},{key:"extentInsideLimit",value:function(e){return e.intersectsExtent(this.extent)}}]),t}(f.default);t.default=v},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),o=n(r(6)),s=n(r(5)),l=n(r(7)),u=n(r(111)),h=n(r(16)),c=n(r(18)),d=n(r(9)),f=n(r(27));function p(e){var t,r=e.trim();if(r.startsWith("<")){var n=(new DOMParser).parseFromString(e,"application/xml");if("kml"===n.documentElement.tagName.toLowerCase())t=u.default.kml(n);else{if("gpx"!==n.documentElement.tagName.toLowerCase())throw"parsererror"===n.documentElement.tagName.toLowerCase()?new Error("Error parsing XML document"):new Error("Unsupported xml file, only valid KML and GPX are supported, but no <gpx> or <kml> tag found.",n);(t=u.default.gpx(n)).features.find(function(e){return"LineString"==e.geometry.type}).properties.stroke="red",t.extent=function(e){var t=e.getElementsByTagName("bounds")[0];if(t){var r=t.getAttribute("minlon"),n=t.getAttribute("maxlon"),i=t.getAttribute("minlat"),a=t.getAttribute("maxlat");return new d.default("EPSG:4326",r,n,i,a)}return new d.default("EPSG:4326",-180,180,-90,90)}(n)}}else{if(!r.startsWith("{")&&!r.startsWith("["))throw new Error("Unsupported file: only well-formed KML, GPX or GeoJSON are supported");if("Feature"!==(t=JSON.parse(e)).type&&"FeatureCollection"!==t.type)throw new Error("This json is not a GeoJSON")}return t}var m=function(e){function t(e,r){var n;if((0,i.default)(this,t),!e.projection)throw new Error("source.projection is required in FileSource");(n=(0,o.default)(this,(0,s.default)(t).call(this,e))).isFileSource=!0,n.url=e.url,n.parsedData=[],n.zoom=e.zoom||{min:5,max:21};var a={buildExtent:!0,crsIn:n.projection,crsOut:r,withNormal:!e.toTexture,withAltitude:!e.toTexture,mergeFeatures:!0};return n.whenReady=c.default.text(n.url,e.networkOptions).then(p).then(function(e){return f.default.parse(e,a).then(function(t){t.style=e.style,n.parsedData=t})}),n}return(0,l.default)(t,e),(0,a.default)(t,[{key:"urlFromExtent",value:function(e){return"".concat(this.url,",").concat(e.crs())}},{key:"extentInsideLimit",value:function(e){var t=this.parsedData.extent,r=this.projection==e.crs()?e:e.as(this.projection);return(null==e.zoom||!(e.zoom<this.zoom.min||e.zoom>this.zoom.max))&&t.intersectsExtent(r)}}]),t}(h.default);t.default=m},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,u=[],h=!1,c=-1;function d(){h&&l&&(h=!1,l.length?u=l.concat(u):c=-1,u.length&&f())}function f(){if(!h){var e=s(d);h=!0;for(var t=u.length;t;){for(l=u,u=[];++c<t;)l&&l[c].run();c=-1,t=u.length}l=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||h||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.COLOR_LAYERS_ORDER_CHANGED=void 0;var n=r(14);function i(e,t){var r=n.ImageryLayers.getColorLayersIdOrderedBySequence(t),i=function(e){e.material&&e.material.setSequence&&e.material.setSequence(r)},a=!0,o=!1,s=void 0;try{for(var l,u=e.level0Nodes[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)l.value.traverse(i)}catch(e){o=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}t.COLOR_LAYERS_ORDER_CHANGED="layers-order-changed";var a={moveLayerUp:function(e,t){var r=e.getLayers(function(e){return e.isColorLayer}),a=e.getLayers(function(e){return e.id===t})[0];if(!a)throw new Error("".concat(t," isn't color layer"));var o=n.ImageryLayers.getColorLayersIdOrderedBySequence(r);n.ImageryLayers.moveLayerUp(a,r),i(e.tileLayer,r),e.dispatchEvent({type:"layers-order-changed",previous:{sequence:o},new:{sequence:n.ImageryLayers.getColorLayersIdOrderedBySequence(r)}}),e.notifyChange(e.tileLayer)},moveLayerDown:function(e,t){var r=e.getLayers(function(e){return e.isColorLayer}),a=e.getLayers(function(e){return e.id===t})[0];if(!a)throw new Error("".concat(t," isn't color layer"));var o=n.ImageryLayers.getColorLayersIdOrderedBySequence(r);n.ImageryLayers.moveLayerDown(a,r),i(e.tileLayer,r),e.dispatchEvent({type:"layers-order-changed",previous:{sequence:o},new:{sequence:n.ImageryLayers.getColorLayersIdOrderedBySequence(r)}}),e.notifyChange(e.tileLayer)},moveLayerToIndex:function(e,t,r){var a=e.getLayers(function(e){return e.isColorLayer}),o=e.getLayers(function(e){return e.id===t})[0];if(!o)throw new Error("".concat(t," isn't color layer"));var s=n.ImageryLayers.getColorLayersIdOrderedBySequence(a);n.ImageryLayers.moveLayerToIndex(o,r,a),i(e.tileLayer,a),e.dispatchEvent({type:"layers-order-changed",previous:{sequence:s},new:{sequence:n.ImageryLayers.getColorLayersIdOrderedBySequence(a)}}),e.notifyChange(e.tileLayer)}};t.default=a},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.CONTROL_EVENTS=void 0;var a=i(r(0)),o=i(r(113)),s=i(r(8)),l=n(r(39)),u=n(r(115)),h=1e-6,c=new a.Vector2,d=new a.Vector2,f=new a.Vector2,p=new a.Spherical(1,.01,0),m=new a.Spherical(1,0,0),v=1,g=new a.Vector2,y=new a.Vector2,x=new a.Vector2,b=new a.Vector3,w=new a.Vector2,_=new a.Vector2,M=new a.Vector2,E=new a.Quaternion,S=new a.Object3D;S.matrixWorldInverse=new a.Matrix4;var T=new s.default("EPSG:4978",0,0,0),A=new s.default("EPSG:4326",0,0,0);function L(e,t){T.set("EPSG:4978",e).as("EPSG:4326",A),t.position.copy(e),t.lookAt(A.geodesicNormal.add(e)),t.rotateX(.5*Math.PI),t.updateMatrixWorld(!0)}var P,C,R,O,D=0,I=!0,N=null,F=.25,U=new a.Quaternion(0,0,0,1),k=new o.Animation({duration:120,name:"damping-move"}),B=new o.Animation({duration:60,name:"damping-orbit"}),z=new a.Vector3,G=new a.Vector3,j=new a.Quaternion,V=new a.Sphere,H=new a.Vector3,W=new a.Vector3,q=!1,X={},Y={PAN_CHANGED:"pan-changed",ORIENTATION_CHANGED:"orientation-changed",RANGE_CHANGED:"range-changed",CAMERA_TARGET_CHANGED:"camera-target-changed"};function Z(e,t,r,n){var i,T=this,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};N=new o.default,this._view=e,this.camera=e.camera.camera3D,this.domElement=e.mainLoop.gfxEngine.renderer.domElement;var I=new u.default;i=I.NONE,this.getStates=function(){return I},this.isPaused=function(){return i==I.NONE},this.enabled=!0,this.zoomSpeed=A.zoomSpeed||2,this.minDistance=A.minDistance||300,this.maxDistance=A.maxDistance||8*n,this.minZoom=0,this.maxZoom=1/0,this.rotateSpeed=A.rotateSpeed||.25,this.keyPanSpeed=7,this.minPolarAngle=a.Math.degToRad(.5),this.maxPolarAngle=a.Math.degToRad(86),this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.handleCollision=void 0===A.handleCollision||A.handleCollision,this.minDistanceCollision=60,this.enableKeys=!0,this.enableDamping=!0,this.startEvent={type:"start"},this.endEvent={type:"end"},this.getDollyScale=function(){return Math.pow(.95,this.zoomSpeed)},this.rotateLeft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;m.theta-=e},this.rotateUp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;m.phi-=e},this.panLeft=function(e){var t=this.camera.matrix.elements;b.fromArray(t),b.multiplyScalar(-e),z.add(b)},this.panUp=function(e){var t=this.camera.matrix.elements;b.fromArray(t,4),b.multiplyScalar(e),z.add(b)},this._mouseToPan=function(t,r){var n=e.mainLoop.gfxEngine;if(i=I.PAN,this.camera instanceof a.PerspectiveCamera){var o=this.camera.position.distanceTo(this.getCameraTargetPosition());o*=2*Math.tan(a.Math.degToRad(.5*this.camera.fov)),this.panLeft(t*o/n.width*this.camera.aspect),this.panUp(r*o/n.height)}else this.camera instanceof a.OrthographicCamera&&(this.panLeft(t*(this.camera.right-this.camera.left)/n.width),this.panUp(r*(this.camera.top-this.camera.bottom)/n.height))},this.dollyIn=function(t){void 0===t&&(t=this.getDollyScale()),this.camera instanceof a.PerspectiveCamera?v/=t:this.camera instanceof a.OrthographicCamera&&(this.camera.zoom=a.Math.clamp(this.camera.zoom*t,this.minZoom,this.maxZoom),this.camera.updateProjectionMatrix(),e.notifyChange(this.camera))},this.dollyOut=function(t){void 0===t&&(t=this.getDollyScale()),this.camera instanceof a.PerspectiveCamera?v*=t:this.camera instanceof a.OrthographicCamera&&(this.camera.zoom=a.Math.clamp(this.camera.zoom/t,this.minZoom,this.maxZoom),this.camera.updateProjectionMatrix(),e.notifyChange(this.camera))};var Z=new a.Quaternion,J=new a.Quaternion,K=new a.Vector3(1,0,0),Q=1/0,$=function(e){if(e.level>10&&1==e.children.length&&e.geometry){var t=e.obb,r={position:T.camera.position.clone(),radius:T.minDistanceCollision};t.isSphereAboveXYBox(r)&&(Q=Math.min(r.position.z-t.box3D.max.z,Q))}},ee=new a.Vector3,te=new a.Vector3,re=function(){if(T.handleCollision&&e.tileLayer){Q=1/0;var t=!0,r=!1,n=void 0;try{for(var o,s=e.tileLayer.level0Nodes[Symbol.iterator]();!(t=(o=s.next()).done);t=!0)o.value.traverse($)}catch(e){r=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(r)throw n}}}switch(i){case I.MOVE_GLOBE:if(Q<0)S.translateY(-Q),T.camera.position.setLength(T.camera.position.length()-Q);else if(Q<T.minDistanceCollision){var l=T.minDistanceCollision*(1-Q/T.minDistanceCollision);S.translateY(l),T.camera.position.setLength(T.camera.position.length()+l)}ee.copy(te).applyQuaternion(E),S.position.applyQuaternion(E),T.camera.position.applyQuaternion(E);break;case I.PAN:T.camera.position.add(z),S.position.add(z);break;case I.PANORAMIC:T.camera.worldToLocal(S.position);var u=T.camera.position.clone().normalize().applyQuaternion(T.camera.quaternion.clone().inverse());Z.setFromAxisAngle(u,m.theta).multiply(J.setFromAxisAngle(K,m.phi)),S.position.applyQuaternion(Z),T.camera.localToWorld(S.position);break;default:T.camera.position.applyMatrix4(S.matrixWorldInverse),(m.theta||m.phi)&&p.setFromVector3(T.camera.position);var c=p.radius*Math.sin(T.minPolarAngle),d=8*c,f=2*c;if(Q<d&&Q>f&&m.phi>0){var g=d-f,y=1-(g-(Q-f))/g;m.phi*=y*y}else if(Q<f&&Q>-f&&m.phi>-.01){var x=-Math.asin(.25*(f-Q)/p.radius);x=a.Math.clamp(x,-.01,0);var b=1-(f-Q)/(2*f);m.phi=a.Math.lerp(m.phi,x,b),Q-=Math.sin(m.phi)*p.radius}p.theta+=m.theta,p.phi+=m.phi,p.theta=Math.max(T.minAzimuthAngle,Math.min(T.maxAzimuthAngle,p.theta)),p.phi=Math.max(T.minPolarAngle,Math.min(T.maxPolarAngle,p.phi)),p.radius=T.camera.position.length()*v,p.makeSafe(),p.radius=Math.max(T.minDistance,Math.min(T.maxDistance,p.radius)),T.camera.position.setFromSpherical(p),Q<0&&(T.camera.position.y-=Q,p.setFromVector3(T.camera.position),m.phi=0),S.localToWorld(T.camera.position)}T.camera.up.copy(S.position).normalize(),T.camera.lookAt(S.position),T.enableDamping?(m.theta*=1-F,m.phi*=1-F,E.slerp(U,.2*F)):(m.theta=0,m.phi=0,E.set(0,0,0,1)),v=1,z.set(0,0,0),(G.distanceToSquared(T.camera.position)>h||8*(1-j.dot(T.camera.quaternion))>h)&&(e.notifyChange(T.camera),G.copy(T.camera.position),j.copy(T.camera.quaternion)),T.enableDamping&&i===I.ORBIT&&N.isStopped()&&(m.theta>h||m.phi>h)&&N.playLater(B,2)};this.update=re;var ne=q?function(t,r){L(t,r),e.notifyChange(this.camera)}:function(){},ie=new a.Raycaster;function ae(t){if(N.isPlaying()&&N.stop(),!1!==this.enabled){t.preventDefault();var r=e.eventToViewCoords(t);switch(i){case I.ORBIT:case I.PANORAMIC:d.copy(r),f.subVectors(d,c);var n=e.mainLoop.gfxEngine;this.rotateLeft(2*Math.PI*f.x/n.width*this.rotateSpeed),this.rotateUp(2*Math.PI*f.y/n.height*this.rotateSpeed),c.copy(d);break;case I.DOLLY:_.copy(r),M.subVectors(_,w),M.y>0?this.dollyIn():M.y<0&&this.dollyOut(),w.copy(_);break;case I.PAN:y.copy(r),x.subVectors(y,g),this._mouseToPan(x.x,x.y),g.copy(y);break;case I.MOVE_GLOBE:var a=e.viewToNormalizedCoords(r);ie.setFromCamera(a,this.camera),ie.ray.intersectSphere(V,W),W?(te.copy(W).normalize(),E.setFromUnitVectors(te,ee),D=Date.now()):he.bind(this)()}i!==I.NONE&&re()}}var oe=new a.Vector3,se=new a.Vector3,le=function(){e.getPickingPositionFromDepth(null,se);var t=isNaN(se.x)?100:T.camera.position.distanceTo(se);oe.set(0,0,-t),T.camera.localToWorld(oe),L(oe,S),S.matrixWorldInverse.getInverse(S.matrixWorld),oe.copy(T.camera.position),oe.applyMatrix4(S.matrixWorldInverse),p.setFromVector3(oe)};function ue(t){var r=this;l.default.stop(e,this.camera),N.stop().then(function(){if(!1!==r.enabled){t.preventDefault(),le(),O=l.default.getTransformCameraLookingAtTarget(e,r.camera),i=I.inputToState(t.button,R);var n=e.eventToViewCoords(t);switch(i){case I.ORBIT:case I.PANORAMIC:c.copy(n);break;case I.MOVE_GLOBE:e.getPickingPositionFromDepth(n,H)?(V.radius=H.length(),ee.copy(H).normalize(),ne.bind(r)(H,X.picking)):i=I.NONE;break;case I.DOLLY:w.copy(n);break;case I.PAN:g.copy(n)}i!=I.NONE&&(r.domElement.addEventListener("mousemove",P,!1),r.domElement.addEventListener("mouseup",C,!1),r.domElement.addEventListener("mouseleave",C,!1),r.dispatchEvent(r.startEvent))}})}function he(){!1!==this.enabled&&(this.domElement.removeEventListener("mousemove",P,!1),this.domElement.removeEventListener("mouseup",C,!1),this.domElement.removeEventListener("mouseleave",C,!1),this.dispatchEvent(this.endEvent),N.stop(),this.enableDamping?i===I.ORBIT&&(m.theta>h||m.phi>h)?N.play(B).then(this._onEndingMove):i===I.MOVE_GLOBE&&Date.now()-D<50?N.play(k).then(this._onEndingMove):this._onEndingMove():this._onEndingMove())}function ce(t){var r=this;N.stop().then(function(){if(r.enabled&&I.DOLLY.enable){l.default.stop(e,r.camera),t.preventDefault(),t.stopPropagation(),le();var n=0;void 0!==t.wheelDelta?n=t.wheelDelta:void 0!==t.detail&&(n=-t.detail),n>0?r.dollyOut():n<0&&r.dollyIn();var i=r.getRange();re();var a=r.getRange();Math.abs(a-i)/i>.001&&r.dispatchEvent({type:Y.RANGE_CHANGED,previous:i,new:a}),r.dispatchEvent(r.startEvent),r.dispatchEvent(r.endEvent)}})}function de(){!1!==this.enabled&&!1!==this.enableKeys&&(R=void 0)}function fe(e){var t=this;N.stop().then(function(){if(!1!==t.enabled&&!1!==t.enableKeys)switch(R=e.keyCode,e.keyCode){case I.PAN.up:t._mouseToPan(0,t.keyPanSpeed),i=I.PAN,re();break;case I.PAN.bottom:t._mouseToPan(0,-t.keyPanSpeed),i=I.PAN,re();break;case I.PAN.left:t._mouseToPan(t.keyPanSpeed,0),i=I.PAN,re();break;case I.PAN.right:t._mouseToPan(-t.keyPanSpeed,0),i=I.PAN,re()}})}function pe(t){var r=this;N.stop().then(function(){if(!1!==r.enabled&&(i=I.touchToState(t.touches.length),le(),i!==I.NONE)){switch(i){case I.MOVE_GLOBE:var n=e.eventToViewCoords(t);e.getPickingPositionFromDepth(n,H)?(V.radius=H.length(),ee.copy(H).normalize(),ne.bind(r)(H,X.picking)):i=I.NONE;break;case I.DOLLY:var a=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(a*a+o*o);w.set(0,s);break;case I.PAN:g.set(t.touches[0].pageX,t.touches[0].pageY)}r.dispatchEvent(r.startEvent)}})}function me(t){if(N.isPlaying()&&N.stop(),!1!==this.enabled){switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case I.MOVE_GLOBE.finger:var r=e.eventToViewCoords(t),n=e.viewToNormalizedCoords(r);ie.setFromCamera(n,this.camera),ie.ray.intersectSphere(V,W),W?(te.copy(W).normalize(),E.setFromUnitVectors(te,ee),D=Date.now()):he.bind(this)();break;case I.ORBIT.finger:case I.DOLLY.finger:var a=e.mainLoop.gfxEngine;d.set(t.touches[0].pageX,t.touches[0].pageY),f.subVectors(d,c),this.rotateLeft(2*Math.PI*f.x/a.width*this.rotateSpeed),this.rotateUp(2*Math.PI*f.y/a.height*this.rotateSpeed),c.copy(d);var o=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,l=Math.sqrt(o*o+s*s);_.set(0,l),M.subVectors(_,w),M.y>0?this.dollyOut():M.y<0&&this.dollyIn(),w.copy(_);break;case I.PAN.finger:y.set(t.touches[0].pageX,t.touches[0].pageY),x.subVectors(y,g),this._mouseToPan(x.x,x.y),g.copy(y);break;default:i=I.NONE}i!==I.NONE&&re()}}function ve(){he.bind(this)()}if(this._handlingEvent=function(t){t=t||l.default.getTransformCameraLookingAtTarget(e,T.camera);var r=l.default.getDiffParams(O,t);if(r&&(r.range&&T.dispatchEvent({type:Y.RANGE_CHANGED,previous:r.range.previous,new:r.range.new}),r.coord&&T.dispatchEvent({type:Y.CAMERA_TARGET_CHANGED,previous:r.coord.previous,new:r.coord.new}),r.tilt||r.heading)){var n={type:Y.ORIENTATION_CHANGED};r.tilt&&(n.previous={tilt:r.tilt.previous},n.new={tilt:r.tilt.new}),r.heading&&(n.previous=n.previous||{},n.new=n.new||{},n.new.heading=r.heading.new,n.previous.heading=r.heading.previous),T.dispatchEvent(n)}},this._onEndingMove=function(e){i=I.NONE,T._handlingEvent(e)},this.dispose=function(){this.domElement.removeEventListener("mousedown",ue,!1),this.domElement.removeEventListener("mousewheel",ce,!1),this.domElement.removeEventListener("DOMMouseScroll",ce,!1),this.domElement.removeEventListener("touchstart",pe,!1),this.domElement.removeEventListener("touchend",ve,!1),this.domElement.removeEventListener("touchmove",me,!1),this.domElement.removeEventListener("mousemove",ae,!1),this.domElement.removeEventListener("mouseup",he,!1),window.removeEventListener("keydown",fe,!1),this.dispatchEvent({type:"dispose"})},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",ue.bind(this),!1),this.domElement.addEventListener("mousewheel",ce.bind(this),!1),this.domElement.addEventListener("dblclick",function(t){var r=this;!1===this.enabled||R||N.stop().then(function(){var n=e.getPickingPositionFromDepth(e.eventToViewCoords(t)),i=r.getRange();n&&i>r.minDistance&&r.lookAtCoordinate({coord:new s.default("EPSG:4978",n),range:.6*i,time:1500})})}.bind(this),!1),this.domElement.addEventListener("DOMMouseScroll",ce.bind(this),!1),this.domElement.addEventListener("touchstart",pe.bind(this),!1),this.domElement.addEventListener("touchend",ve.bind(this),!1),this.domElement.addEventListener("touchmove",me.bind(this),!1),N.addEventListener("animation-frame",this.update),window.addEventListener("keydown",fe.bind(this),!1),window.addEventListener("keyup",de.bind(this),!1),window.addEventListener("blur",function(){de.bind(T)(),he.bind(T)()}),e.scene.add(S),q){S.add(X.target),e.scene.add(X.picking);var ge=e.mainLoop.gfxEngine.getUniqueThreejsLayer();X.target.layers.set(ge),X.picking.layers.set(ge),this.camera.layers.enable(ge)}P=ae.bind(this),C=he.bind(this),L(t.as("EPSG:4978").xyz(),S),this.lookAtCoordinate({coord:t,tilt:89.5,heading:0,range:r},!1)}t.CONTROL_EVENTS=Y,Z.prototype=Object.create(a.EventDispatcher.prototype),Z.prototype.constructor=Z,Z.prototype.setTilt=function(e,t){return this.lookAtCoordinate({tilt:e},t)},Z.prototype.setHeading=function(e,t){return this.lookAtCoordinate({heading:e},t)},Z.prototype.setRange=function(e,t){return this.lookAtCoordinate({range:e},t)},Z.prototype.getCameraTargetPosition=function(){return S.position},Z.prototype.getRange=function(){return l.default.getTransformCameraLookingAtTarget(this._view,this.camera).range},Z.prototype.getTilt=function(){return l.default.getTransformCameraLookingAtTarget(this._view,this.camera).tilt},Z.prototype.getHeading=function(){return l.default.getTransformCameraLookingAtTarget(this._view,this.camera).heading},Z.prototype.pan=function(e){return this._mouseToPan(e.x,e.y),this.update(),Promise.resolve()},Z.prototype.getCameraOrientation=function(){return[this.getTilt(),this.getHeading()]},Z.prototype.getCameraCoordinate=function(){return new s.default("EPSG:4978",this.camera.position).as("EPSG:4326")},Z.prototype.getCameraTargetGeoPosition=function(){return console.warn("getCameraTargetGeoPosition has been deprecated, use getLookAtCoordinate"),this.getLookAtCoordinate()},Z.prototype.getLookAtCoordinate=function(){return l.default.getTransformCameraLookingAtTarget(this._view,this.camera).coord},Z.prototype.setAnimationEnabled=function(e){I=e},Z.prototype.isAnimationEnabled=function(){return I},Z.prototype.getZoom=function(){return this._view.tileLayer.computeTileZoomFromDistanceCamera(this.getRange(),this._view.camera)},Z.prototype.setZoom=function(e,t){return this.lookAtCoordinate({zoom:e},t)},Z.prototype.getScale=function(e){e=(e||.28)/1e3;var t=a.Math.degToRad(this.camera.fov);return e*(this._view.mainLoop.gfxEngine.height/(2*this.getRange()*Math.tan(.5*t)))},Z.prototype.pixelsToMeters=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;return e*t/this.getScale(t)/1e3},Z.prototype.pixelsToDegrees=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28,r=this.pixelsToMeters(e,t);return a.Math.radToDeg(2*Math.asin(r/(2*s.ellipsoidSizes.x)))},Z.prototype.metersToPixels=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;return e*this.getScale(t)/(t/1e3)},Z.prototype.setScale=function(e,t,r){return this.lookAtCoordinate({scale:e,pitch:t},r)},Z.prototype.setCameraTargetGeoPosition=function(e,t){return console.warn("setCameraTargetGeoPosition has been deprecated, use lookAtCoordinate"),this.lookAtCoordinate(new s.default("EPSG:4326",e.longitude,e.latitude,0),t)},Z.prototype.lookAtCoordinate=function(){var e,t,r,n,i=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isAnimationEnabled();if(o.zoom)o.range=this._view.tileLayer.computeDistanceCameraFromTileZoom(o.zoom,this._view.camera);else if(o.scale){var u=this._view.mainLoop.gfxEngine;o.range=(e=o.scale,t=o.pitch,r=this.camera.fov,n=u.height,t=(t||.28)/1e3,r=a.Math.degToRad(r),t*n/(2*e*Math.tan(.5*r))),(o.range<this.minDistance||o.range>this.maxDistance)&&(console.warn("This scale ".concat(o.scale," can not be reached")),o.range=a.Math.clamp(o.range,this.minDistance,this.maxDistance))}if(void 0!==o.tilt){var h=90-a.Math.radToDeg(this.maxPolarAngle),c=90-a.Math.radToDeg(this.minPolarAngle);(o.tilt<h||o.tilt>c)&&(o.tilt=a.Math.clamp(o.tilt,h,c),console.warn("Tilt was clamped to ",o.tilt," the interval is between ".concat(h," and ").concat(c," degree")))}return O=l.default.getTransformCameraLookingAtTarget(this._view,this.camera),s?(o.callback=function(e){return S.position.copy(e.targetWorldPosition)},this.dispatchEvent({type:"animation-started"}),l.default.animateCameraToLookAtTarget(this._view,this.camera,o).then(function(e){return i.dispatchEvent({type:"animation-ended"}),i._handlingEvent(e),e})):l.default.transformCameraToLookAtTarget(this._view,this.camera,o).then(function(e){return S.position.copy(e.targetWorldPosition),i._handlingEvent(e),e})},Z.prototype.setCameraTargetGeoPositionAdvanced=function(e,t){return console.warn("setCameraTargetGeoPositionAdvanced has been deprecated, use lookAtCoordinate"),e.coord=new s.default("EPSG:4326",e.longitude,e.latitude,0),this.lookAtCoordinate(e,t)},Z.prototype.setOrbitalPosition=function(e,t){return console.warn("setOrbitalPosition has been deprecated, use lookAtCoordinate"),this.lookAtCoordinate(e,t)},Z.prototype.pickGeoPosition=function(e){var t=this._view.getPickingPositionFromDepth(e);if(t)return new s.default("EPSG:4978",t).as("EPSG:4326")};var J=Z;t.default=J},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(26)),h=i(r(7)),c=n(r(0)),d=i(r(31)),f=r(8),p=i(r(9)),m=i(r(57)),v=r(24),g=new c.Matrix4,y=new c.Vector3,x=0,b=new c.Vector3,w=function(e){function t(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,a.default)(this,t);var o=[new p.default("EPSG:4326",-180,0,-90,90),new p.default("EPSG:4326",0,180,-90,90)],u=new m.default;(n=(0,s.default)(this,(0,l.default)(t).call(this,e,r||new c.Group,o,u,i))).isGlobeLayer=!0,n.options.defaultPickingRadius=5,n.minSubdivisionLevel=n.minSubdivisionLevel||2,n.maxSubdivisionLevel=n.maxSubdivisionLevel||18,n.maxDeltaElevation=n.maxDeltaElevation||4,n.extent=n.schemeTile[0].clone();for(var h=1;h<n.schemeTile.length;h++)n.extent.union(n.schemeTile[h]);return g.getInverse(n.object3d.matrixWorld),g.premultiply((new c.Matrix4).makeScale(1/f.ellipsoidSizes.x,1/f.ellipsoidSizes.y,1/f.ellipsoidSizes.z)),n}return(0,h.default)(t,e),(0,o.default)(t,[{key:"preUpdate",value:function(e,r){return y.copy(e.camera.camera3D.position).applyMatrix4(g),x=y.lengthSq()-1,(0,u.default)((0,l.default)(t.prototype),"preUpdate",this).call(this,e,r)}},{key:"countColorLayersTextures",value:function(){for(var e=0,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0;i<r.length;i++){var a=r[i];e+="EPSG:3857"==(a.projection||a.source.projection)?3:1}return e}},{key:"culling",value:function(e,r){if((0,u.default)((0,l.default)(t.prototype),"culling",this).call(this,e,r))return!0;if(e.level<this.minSubdivisionLevel)return!1;var n=e.obb.topPointsWorld,i=!0,a=!1,o=void 0;try{for(var s,h=n[Symbol.iterator]();!(i=(s=h.next()).done);i=!0){var c=s.value;b.copy(c),b.applyMatrix4(g).sub(y);var d=b.lengthSq(),f=-b.dot(y);if(!(x<f&&x<f*f/d))return!1}}catch(e){a=!0,o=e}finally{try{i||null==h.return||h.return()}finally{if(a)throw o}}return!0}},{key:"computeTileZoomFromDistanceCamera",value:function(e,t){var r=v.SIZE_DIAGONAL_TEXTURE*(.5*this.sseSubdivisionThreshold)/t._preSSE/f.ellipsoidSizes.x,n=e*r,i=Math.log(Math.PI/(2*Math.asin(n)))/Math.log(2),a=Math.PI/Math.pow(2,i);return n=(e-2*f.ellipsoidSizes.x*Math.sin(.5*a)*.5)*r,i=Math.log(Math.PI/(2*Math.asin(n)))/Math.log(2),isNaN(i)?0:Math.round(i)}},{key:"computeDistanceCameraFromTileZoom",value:function(e,t){var r=Math.PI/Math.pow(2,e),n=2*f.ellipsoidSizes.x*Math.sin(.5*r)*.5;return t._preSSE*(n/v.SIZE_DIAGONAL_TEXTURE)/(.5*this.sseSubdivisionThreshold)+n}}]),t}(d.default);t.default=w},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(12)),a={cleanup:function(e){e.layer=null,"function"==typeof e.dispose?e.dispose():(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose())},removeChildren:function(e,t){var r=t.children.filter(function(t){return t.layer===e});return t.remove.apply(t,(0,i.default)(r)),r},removeChildrenAndCleanup:function(e,t){var r=t.children.filter(function(t){return t.layer===e});return t.remove.apply(t,(0,i.default)(r)),t.layer===e&&this.cleanup(t),r},removeChildrenAndCleanupRecursively:function(e,t){var r=t.children.filter(function(t){return t.layer===e}),n=!0,a=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value;this.removeChildrenAndCleanupRecursively(e,u)}}catch(e){a=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(a)throw o}}return t.remove.apply(t,(0,i.default)(r)),t.layer===e&&this.cleanup(t),r}};t.default=a},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(6)),s=i(r(5)),l=i(r(7)),u=n(r(0)),h=i(r(31)),c=i(r(121)),d=function(e){function t(e,r,n){var i,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,a.default)(this,t),(i=(0,o.default)(this,(0,s.default)(t).call(this,e,n||new u.Group,[r],new c.default,l))).isPlanarLayer=!0,i.extent=r,i.minSubdivisionLevel=i.minSubdivisionLevel||0,i.maxSubdivisionLevel=i.maxSubdivisionLevel||5,i.maxDeltaElevation=i.maxDeltaElevation||4,i}return(0,l.default)(t,e),t}(h.default);t.default=d},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(26)),h=i(r(7)),c=i(r(11)),d=n(r(0)),f=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,h=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;return(0,a.default)(this,t),r=r.isVector2?r:new d.Vector2(r,r),f=f||r.x/r.y,(e=(0,s.default)(this,(0,l.default)(t).call(this,void 0,f,o,u))).size=r,e.focal=n.isVector2?n:new d.Vector2(n,n),e.center=i||r.clone().multiplyScalar(.5),e.skew=h||0,Object.defineProperty((0,c.default)((0,c.default)(e)),"fov",{get:function(){return 360*Math.atan2(e.size.y,2*e.focal.y)/Math.PI},set:function(t){var r=.5*e.size.y/Math.tan(t*Math.PI/360);e.focal.x=r,e.focal.y=r}}),e.updateProjectionMatrix(),e}return(0,h.default)(t,e),(0,o.default)(t,[{key:"updateProjectionMatrix",value:function(){if(this.focal){var e=this.near,t=e/this.focal.x,r=e/this.focal.y,n=-t*this.center.x,i=-r*this.center.y,a=n+t*this.size.x,o=i+r*this.size.y;this.projectionMatrix.makePerspective(n,a,o,i,e,this.far),this.projectionMatrix.elements[4]=2*this.skew/this.size.x;var s=this.size.x/this.size.y,l=this.aspect/s,u=new d.Vector3(this.zoom,this.zoom,1);l>1?u.x/=l:u.y*=l,this.projectionMatrix.scale(u)}}},{key:"copy",value:function(e,r){return(0,u.default)((0,l.default)(t.prototype),"copy",this).call(this,e,r),this.size=e.size.clone(),this.focal=e.focal.clone(),this.center=e.center.clone(),this.skew=e.skew,this}}]),t}(d.PerspectiveCamera);t.default=f},function(e,t,r){"use strict";t.decode=t.parse=r(138),t.encode=t.stringify=r(139)},function(e,t,r){"use strict";const n=r(137);let i;const a=function(){return i||fetch};function o(e){return n("string"==typeof e?e:e.headers.get("Link"))||{}}e.exports={all:function(e,t){return new class{constructor(e,t){t=t||{},this.fetchOptions=t.fetch,this.limit="number"==typeof t&&t||"object"==typeof t&&t.limit,this.initialDirection="string"==typeof t&&t||"object"==typeof t&&t.direction,this.prevTerminated="next"===this.initialDirection,this.nextTerminated="prev"===this.initialDirection,this.failGracefully=t.failGracefully,this.initialUrl=e,this.promises=[]}exec(){return new Promise((e,t)=>{this.resolve=e,this.reject=t,this.fetch(this.initialUrl,this.initialDirection)})}fetch(e,t){const r="function"==typeof this.fetchOptions?this.fetchOptions(e):this.fetchOptions,i=(r&&"function"==typeof r.then?r:Promise.resolve(r)).then(t=>a()(e,t));if(this.promises["next"===t?"push":"unshift"](i),this.limit&&this.promises.length>=this.limit)return this.end();i.then(e=>{const r=n(e.headers.get("Link"))||{};if(r.prev||(this.prevTerminated=!0),r.next||(this.nextTerminated=!0),this.nextTerminated&&this.prevTerminated)return this.end();!r.next||"next"!==t&&t||this.fetch(r.next.url,"next"),!r.prev||"prev"!==t&&t||this.fetch(r.prev.url,"prev")}).catch(e=>{if(this.failGracefully){let e;this.promises=this.promises.map((t,r)=>t===i?(e=r,t.catch(e=>e)):t),0===e&&(this.prevTerminated=!0),e===this.promises.length-1&&(this.nextTerminated=!0),this.nextTerminated&&this.prevTerminated&&this.end()}else this.reject(e)})}end(){this.resolve(Promise.all(this.promises))}}(e,t).exec()},setFetchImplementation:function(e){i=e},next:function(e,t){const r=o(e);return console.log(r.next.url),r.next?a()(r.next.url,t):Promise.reject("No next link")},prev:function(e,t){const r=o(e);return r.prev?a()(r.prev.url,t):Promise.reject("No prev link")},last:function(e,t){const r=o(e);return r.last?a()(r.last.url,t):Promise.reject("No last link")},first:function(e,t){const r=o(e);return r.first?a()(r.first.url,t):Promise.reject("No first link")}}},function(e,t,r){e.exports=r(146)},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.createGlobeLayer=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.warn("createGlobeLayer is deprecated, use the GlobeLayer class instead."),new c.default(e,t.object3d,t)},t.default=t.GLOBE_VIEW_EVENTS=void 0;var a=i(r(0)),o=i(r(21)),s=r(13),l=r(68),u=n(r(69)),h=r(23),c=n(r(70)),d=n(r(117)),f=n(r(119)),p=i(r(8)),m={GLOBE_INITIALIZED:"initialized",LAYER_ADDED:"layer-added",LAYER_REMOVED:"layer-removed",COLOR_LAYERS_ORDER_CHANGED:l.COLOR_LAYERS_ORDER_CHANGED};function v(e,t){var r,n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a.Object3D.DefaultUp.set(0,0,1),o.default.call(this,"EPSG:4978",e,i),r=t instanceof p.default?t.as("EPSG:4326"):new p.C.EPSG_4326(t.longitude,t.latitude,t.altitude),this.camera.camera3D.near=Math.max(15,2352e-9*p.ellipsoidSizes.x),this.camera.camera3D.far=10*p.ellipsoidSizes.x;var l=new c.default("globe",i.object3d,i),h=new a.DirectionalLight;h.position.set(-.5,0,1),h.updateMatrixWorld(!0),l.object3d.add(h),this.addLayer(l),this.atmosphere=new d.default;var f=this.mainLoop.gfxEngine.getUniqueThreejsLayer();this.atmosphere.traverse(function(e){e.layers.set(f)}),this.camera.camera3D.layers.enable(f),l.object3d.add(this.atmosphere),this.atmosphere.updateMatrixWorld(!0);var v=r.clone();v.setAltitude(0),i.noControls?(this.camera.setPosition(r),this.camera.camera3D.lookAt(v.as("EPSG:4978").xyz())):(this.controls=new u.default(this,v,r.altitude(),p.ellipsoidSizes.x),this.controls.handleCollision=void 0===i.handleCollision||i.handleCollision);var g=160*p.ellipsoidSizes.x;this._fullSizeDepthBuffer=null;var y=this.mainLoop.gfxEngine.renderer,x=new p.default(this.referenceCrs,0,0,0),b=new p.C.EPSG_4326,w=new a.Color(9688568),_=new a.Color,M=new a.Color(197896);this.addFrameRequester(s.MAIN_LOOP_EVENTS.BEFORE_RENDER,function(){null!=n._fullSizeDepthBuffer&&(n._fullSizeDepthBuffer=null)}),this.addFrameRequester(s.MAIN_LOOP_EVENTS.AFTER_CAMERA_UPDATE,function(){var e=new a.Vector3;e.setFromMatrixPosition(l.object3d.matrixWorld);var t=e.distanceTo(n.camera.camera3D.position);e.setFromMatrixScale(l.object3d.matrixWorld),n.fogDistance=g*Math.pow(.25*(t-.99*p.ellipsoidSizes.x)/p.ellipsoidSizes.x,1.5),x.set(n.referenceCrs,n.camera.camera3D.position).as("EPSG:4326",b);var r=b.altitude();r<6e5?(_.copy(M).lerp(w,(6e5-r)/6e5),y.setClearColor(_,y.getClearAlpha())):y.setClearColor(M,y.getClearAlpha())}),this.tileLayer=l;var E=function(){n.removeEventListener(o.VIEW_EVENTS.LAYERS_INITIALIZED,E),n.dispatchEvent({type:m.GLOBE_INITIALIZED})};this.addEventListener(o.VIEW_EVENTS.LAYERS_INITIALIZED,E)}t.GLOBE_VIEW_EVENTS=m,v.prototype=Object.create(o.default.prototype),v.prototype.constructor=v,v.prototype.addLayer=function(e){if(!e)return new Promise(function(e,t){return t(new Error("layer is undefined"))});if("color"==e.type){var t=this.getLayers(function(e){return"color"===e.type}).length;e.sequence=t}else if("elevation"==e.type&&"wmts"===e.source.protocol&&"WGS84G"!==e.source.tileMatrixSet)throw new Error("Only WGS84G tileMatrixSet is currently supported for WMTS elevation layers");var r=e.id,n=o.default.prototype.addLayer.call(this,e,this.tileLayer);return this.dispatchEvent({type:m.LAYER_ADDED,layerId:r}),n},v.prototype.removeLayer=function(e){var t=this.getLayers(function(t){return t.id===e})[0];if(t&&"color"===t.type&&this.tileLayer.detach(t)){var r=!0,n=!1,i=void 0;try{for(var a,o=this.tileLayer.level0Nodes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)a.value.traverse((0,h.removeLayeredMaterialNodeLayer)(e))}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}var s=this.getLayers(function(e){return"color"===e.type}),l=!0,u=!1,c=void 0;try{for(var d,f=s[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var p=d.value;p.sequence>t.sequence&&p.sequence--}}catch(e){u=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw c}}return this.notifyChange(this.tileLayer),this.dispatchEvent({type:m.LAYER_REMOVED,layerId:e}),!0}throw new Error("".concat(e," isn't color layer"))},v.prototype.setRealisticLightingOn=function(e){var t=f.default.getSunPositionInScene((new Date).getTime(),48.85,2.35).normalize();this.lightingPos=t.normalize();var r=this.tileLayer.lighting;r.enable=e,r.position=t,this.atmosphere.setRealisticOn(e),this.atmosphere.updateLightingPos(t),this.updateMaterialProperty("lightingEnabled",e),this.updateMaterialProperty("lightPosition",t),this.notifyChange(this.tileLayer)},v.prototype.setLightingPos=function(e){var t=e||f.default.getSunPositionInScene(this.ellipsoid,(new Date).getTime(),48.85,2.35);this.updateMaterialProperty("lightPosition",t.clone().normalize()),this.notifyChange(this.tileLayer)},v.prototype.updateMaterialProperty=function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=this.tileLayer.level0Nodes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)a.value.traverse(function(r){r.material&&void 0!==r.material[e]&&(r.material[e]=t)})}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}};var g=v;t.default=g},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(8)),s=n(r(34));function l(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object.defineProperty(this,"crs",{get:function(){return e}}),this.camera3D=n.camera?n.camera:new a.PerspectiveCamera(30,t/r),this._viewMatrix=new a.Matrix4,this.width=t,this.height=r,this._preSSE=1/0}l.prototype.update=function(e,t){!function(e,t,r){e.width=t,e.height=r;var n=t/r;if(e.camera3D.aspect!==n&&(e.camera3D.aspect=n,e.camera3D.isOrthographicCamera)){var i=.5*(e.camera3D.right-e.camera3D.left)/n,a=.5*(e.camera3D.top+e.camera3D.bottom);e.camera3D.top=a+i,e.camera3D.bottom=a-i}e.camera3D.updateProjectionMatrix&&e.camera3D.updateProjectionMatrix()}(this,e,t),this.camera3D.updateMatrixWorld(),this._viewMatrix.multiplyMatrices(this.camera3D.projectionMatrix,this.camera3D.matrixWorldInverse);var r=a.Math.degToRad(this.camera3D.fov),n=this.height/(2*Math.tan(.5*r));this._preSSE=n},l.prototype.position=function(e){return new o.default(this.crs,this.camera3D.position).as(e||this.crs)},l.prototype.setPosition=function(e){this.camera3D.position.copy(e.as(this.crs).xyz())};var u={frustum:new a.Frustum,matrix:new a.Matrix4,box3:new a.Box3},h=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],c=new a.Box3(new a.Vector3(-1,-1,-1),new a.Vector3(1,1,1));l.prototype.isBox3Visible=function(e,t){return this.box3SizeOnScreen(e,t).intersectsBox(c)},l.prototype.isSphereVisible=function(e,t){return t?(u.matrix.multiplyMatrices(this._viewMatrix,t),u.frustum.setFromMatrix(u.matrix)):u.frustum.setFromMatrix(this._viewMatrix),u.frustum.intersectsSphere(e)},l.prototype.box3SizeOnScreen=function(e,t){var r=function(e,t,r){var n=e.camera3D.matrixWorldInverse;r&&(n=u.matrix.multiplyMatrices(e.camera3D.matrixWorldInverse,r)),h[0].set(t.min.x,t.min.y,t.min.z).applyMatrix4(n),h[1].set(t.min.x,t.min.y,t.max.z).applyMatrix4(n),h[2].set(t.min.x,t.max.y,t.min.z).applyMatrix4(n),h[3].set(t.min.x,t.max.y,t.max.z).applyMatrix4(n),h[4].set(t.max.x,t.min.y,t.min.z).applyMatrix4(n),h[5].set(t.max.x,t.min.y,t.max.z).applyMatrix4(n),h[6].set(t.max.x,t.max.y,t.min.z).applyMatrix4(n),h[7].set(t.max.x,t.max.y,t.max.z).applyMatrix4(n);for(var i=!1,a=0;a<8;a++)h[a].z<=-e.camera3D.near?i=!0:h[a].z=-e.camera3D.near;return i?h:void 0}(this,e,t);if(!r)return u.box3.makeEmpty();for(var n=0;n<8;n++)r[n].applyMatrix4(this.camera3D.projectionMatrix);return u.box3.setFromPoints(r)},l.prototype.adjustAltitudeToAvoidCollisionWithLayer=function(e,t,r){var n=e.camera.position().as("EPSG:4326");if(void 0!==t){var i=s.default.getElevationValueAt(t,n);null!=i&&n.altitude()-(i.z+r)<0&&(n.setAltitude(i.z+r),e.camera.camera3D.position.copy(n.as(e.referenceCrs).xyz()),e.notifyChange(this.camera3D))}};var d=l;t.default=d},function(e,t,r){var n=r(83),i=r(84),a=r(85);e.exports=function(e,t){return n(e)||i(e,t)||a()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(22)),s=r(17);function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!o.default.isInternetExplorer();void 0===t.antialias&&(t.antialias=!0),void 0===t.alpha&&(t.alpha=!0),void 0===t.logarithmicDepthBuffer&&(t.logarithmicDepthBuffer=this.gLDebug||r);var n=e.domElement?e:void 0,i=n?void 0:e;this.width=(n?n.domElement:i).clientWidth,this.height=(n?n.domElement:i).clientHeight,this.positionBuffer=null,this._nextThreejsLayer=1,this.fullSizeRenderTarget=new a.WebGLRenderTarget(this.width,this.height),this.fullSizeRenderTarget.texture.minFilter=a.LinearFilter,this.fullSizeRenderTarget.texture.magFilter=a.NearestFilter,this.fullSizeRenderTarget.depthBuffer=!0,this.fullSizeRenderTarget.depthTexture=new a.DepthTexture,this.fullSizeRenderTarget.depthTexture.type=a.UnsignedShortType,this.renderView=function(e){this.renderer.setViewport(0,0,this.width,this.height),this.renderer.clear(),this.renderer.render(e.scene,e.camera.camera3D)}.bind(this),this.onWindowResize=function(e,t){this.width=e,this.height=t,this.fullSizeRenderTarget.setSize(this.width,this.height),this.renderer.setSize(this.width,this.height)}.bind(this);try{this.renderer=n||new a.WebGLRenderer({canvas:document.createElement("canvas"),antialias:t.antialias,alpha:t.alpha,logarithmicDepthBuffer:t.logarithmicDepthBuffer})}catch(e){console.error("Failed to create WebGLRenderer",e),this.renderer=null}if(!this.renderer){var s=document.createElement("div");throw s.id="webgl-error-message",s.style.fontFamily="monospace",s.style.fontSize="13px",s.style.fontWeight="normal",s.style.textAlign="center",s.style.background="#fff",s.style.color="#000",s.style.padding="1.5em",s.style.width="400px",s.style.margin="5em auto 0",s.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.<br>','See also <a href="https://www.khronos.org/webgl/wiki/BlacklistsAndWhitelists">graphics card blacklisting</a>'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.<br>',"You can also try another browser like Firefox or Chrome."].join("\n"),i.appendChild(s),new Error("WebGL unsupported")}if(!n&&t.logarithmicDepthBuffer&&!this.renderer.extensions.get("EXT_frag_depth")){var l=this.renderer.domElement;this.renderer.dispose(),this.renderer=new a.WebGLRenderer({canvas:l,antialias:t.antialias,alpha:t.alpha,logarithmicDepthBuffer:!1})}-1===this.renderer.domElement.tabIndex&&(this.renderer.domElement.tabIndex=-1),o.default.updateCapabilities(this.renderer),this.renderer.setClearColor(197896),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,n||(this.renderer.setPixelRatio(i.devicePixelRatio),this.renderer.setSize(i.clientWidth,i.clientHeight),i.appendChild(this.renderer.domElement))}l.prototype.getWindowSize=function(){return new a.Vector2(this.width,this.height)},l.prototype.getRenderer=function(){return this.renderer},l.prototype.renderViewToBuffer=function(e,t){t||(t={x:0,y:0,width:this.width,height:this.height}),this.renderViewToRenderTarget(e,this.fullSizeRenderTarget,t);var r=new Uint8Array(4*t.width*t.height);return this.renderer.readRenderTargetPixels(this.fullSizeRenderTarget,t.x,this.height-(t.y+t.height),t.width,t.height,r),r},l.prototype.renderViewToRenderTarget=function(e,t,r){t||(t=this.fullSizeRenderTarget);var n=this.renderer.getRenderTarget();return this.fullSizeRenderTarget.viewport.set(0,0,t.width,t.height),r&&(this.fullSizeRenderTarget.scissor.set(r.x,t.height-(r.y+r.height),r.width,r.height),this.fullSizeRenderTarget.scissorTest=!0),this.renderer.setRenderTarget(t),this.renderer.clear(!0,!0,!1),this.renderer.render(e.scene,e.camera.camera3D,t),this.renderer.setRenderTarget(n),this.fullSizeRenderTarget.scissorTest=!1,t},l.prototype.bufferToImage=function(e,t,r){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=t,n.height=r;var a=i.getImageData(0,0,t,r);a.data.set(e),i.putImageData(a,0,0);var o=new Image;return o.src=n.toDataURL(),o},l.prototype.getUniqueThreejsLayer=function(){return this._nextThreejsLayer>31&&(console.warn("Too much three.js layers. Starting from now all of them will use layerMask = 31"),this._nextThreejsLayer=31),this._nextThreejsLayer++};var u=new a.Vector4;l.prototype.depthBufferRGBAValueToOrthoZ=function(e,t){if(u.fromArray(e).divideScalar(255),o.default.isLogDepthBufferSupported()){var r=(0,s.unpack1K)(u),n=2/(Math.log(t.far+1)/Math.LN2);return Math.pow(2,2*r/n)}var i=(0,s.unpack1K)(u);return i=2*i-1,2*t.near*t.far/(t.far+t.near-i*(t.far-t.near))};var h=l;t.default=h},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=new i.Vector2;function o(e,t,r,n,i){a.x=t-i.x,a.y=r-i.y,a.multiply(n),e.moveTo(Math.round(a.x),Math.round(a.y))}function s(e,t,r,n,i){a.x=t-i.x,a.y=r-i.y,a.multiply(n),e.lineTo(Math.round(a.x),Math.round(a.y))}function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{offset:0,count:1}],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0;if(0!==t.length)if(o.length){var l=!0,h=!1,c=void 0;try{for(var d,f=o[Symbol.iterator]();!(l=(d=f.next()).done);l=!0)u(e,t,r,n,i,a,d.value,s)}catch(e){h=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(h)throw c}}}else u(e,t,r,n,i,a,o,s)}function u(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},l=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0;e.beginPath();var h=!0,c=!1,d=void 0;try{for(var f,p=r[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var m=f.value,v=m.offset*u,g=v+m.count*u;o(e,t[v],t[v+1],i,n);for(var y=v+u;y<g;y+=u)s(e,t[y],t[y+1],i,n)}}catch(e){c=!0,d=e}finally{try{h||null==p.return||p.return()}finally{if(c)throw d}}(l.stroke||a.stroke)&&(e.strokeStyle=l.stroke||a.stroke,e.lineWidth=l.strokeWidth||a["stroke-width"]||2,e.globalAlpha=l.strokeOpacity||a["stroke-opacity"]||1,e.stroke()),r&&(l.fill||a.fill)&&(e.fillStyle=l.fill||a.fill,e.globalAlpha=l.fillOpacity||a["fill-opacity"]||1,e.fill())}function h(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};a.x=t-n.x,a.y=r-n.y,a.multiply(i),e.beginPath(),e.arc(Math.round(a.x),Math.round(a.y),Math.round(o.radius)||3,0,2*Math.PI,!1),e.fillStyle=o.fill||"white",e.fill(),e.lineWidth=o.lineWidth||1,e.strokeStyle=o.stroke||"red",e.stroke()}function c(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=a,s=!0,u=!1,c=void 0;try{for(var d,f=t.geometry[Symbol.iterator]();!(s=(d=f.next()).done);s=!0){var p=d.value,m=p.properties;if("function"==typeof a&&(o=a(m,t)),"point"===t.type)h(e,t.vertices[0],t.vertices[1],r,n,o);else if("multipoint"===t.type)for(var v=0;v<t.vertices.length;v+=t.size)h(e,t.vertices[v],t.vertices[v+1],r,n,o);else p.extent.intersectsExtent(i)&&l(e,t.vertices,p.indices,r,n,m,o,t.size)}}catch(e){u=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw c}}}var d={createTextureFromFeature:function(e,t,r,n,a){var o;if(e){var s=new i.Vector2(t.west(),t.south()),l=t.dimensions(),u=document.createElement("canvas");u.width=r,u.height=r;var h=u.getContext("2d");a&&(h.fillStyle=a.getStyle(),h.fillRect(0,0,r,r)),h.globalCompositeOperation=n.globalCompositeOperation||"source-over";var d=new i.Vector2(h.canvas.width/l.x,h.canvas.width/l.y),f=!0,p=!1,m=void 0;try{for(var v,g=e.features[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;c(h,y,s,d,y.crs==t.crs()?t:t.as(y.crs),n)}}catch(e){p=!0,m=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw m}}(o=new i.CanvasTexture(u)).flipY=!1}else if(a){var x=new Uint8Array(3);x[0]=255*a.r,x[1]=255*a.g,x[2]=255*a.b,(o=new i.DataTexture(x,1,1,i.RGBFormat)).needsUpdate=!0}else o=new i.Texture;return o}};t.default=d},function(e,t,r){var n=r(5);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(90)),a=n(r(91)),o=n(r(98)),s=n(r(99)),l=n(r(108)),u=n(r(15));function h(e,t){var r=t.priority-e.priority;return 0===r?t.timestamp-e.timestamp:r}function c(){return{queue:function(e){var t=e.layer,r=this.storages.get(t.id);r||(r={q:new i.default({comparator:h}),priority:1,accumulator:0},this.storages.set(t.id,r)),r.priority=t.priority||1,r.q.queue(e),this.counters.pending++},storages:new Map,counters:{executing:0,executed:0,failed:0,cancelled:0,pending:0},execute:function(e,t){var r=this;return this.counters.pending--,this.counters.executing++,t.executeCommand(e).then(function(t){r.counters.executing--,e.resolve(t),r.counters.executed++},function(t){r.counters.executing--,e.reject(t),r.counters.failed++})}}}function d(){this.defaultQueue=c(),this.hostQueues=new Map,this.providers={},this.maxCommandsPerHost=6,this.initDefaultProviders()}d.prototype.constructor=d,d.prototype.initDefaultProviders=function(){this.addProtocolProvider("tile",o.default),this.addProtocolProvider("3d-tiles",s.default),this.addProtocolProvider("potreeconverter",l.default)},d.prototype.runCommand=function(e,t,r){var n=this,i=e.layer.protocol||e.layer.source.protocol,a=this.getProtocolProvider(i);if(!a)throw new Error("No known provider for layer",e.layer.id);t.execute(e,a,r).then(function(){if(e.view.notifyChange(e.requester,e.redraw),t.counters.executing<n.maxCommandsPerHost){var r=n.deQueue(t);r&&n.runCommand(r,t)}})},d.prototype.execute=function(e){var t=this,r=e.layer,n=r.url?new URL(r.url,document.location).host:void 0;e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),n&&!this.hostQueues.has(n)&&this.hostQueues.set(n,c());var i=n?this.hostQueues.get(n):this.defaultQueue;return e.timestamp=Date.now(),i.queue(e),i.counters.executing<this.maxCommandsPerHost&&Promise.resolve().then(function(){if(i.counters.executing<t.maxCommandsPerHost){var e=t.deQueue(i);e&&t.runCommand(e,i)}}),e.promise},d.prototype.addProtocolProvider=function(e,t){if("function"!=typeof t.executeCommand)throw new Error("Can't add provider for ".concat(e,": missing a executeCommand function."));this.providers[e]=t},d.prototype.getProtocolProvider=function(e){return this.providers[e]||a.default},d.prototype.commandsWaitingExecutionCount=function(){var e=this.defaultQueue.counters.pending+this.defaultQueue.counters.executing,t=!0,r=!1,n=void 0;try{for(var i,a=this.hostQueues[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e+=o[1].counters.pending+o[1].counters.executing}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e},d.prototype.commandsRunningCount=function(){var e=this.defaultQueue.counters.executing,t=!0,r=!1,n=void 0;try{for(var i,a=this.hostQueues[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)e+=i.value[1].counters.executing}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e},d.prototype.resetCommandsCount=function(e){var t=this.defaultQueue.counters[e];this.defaultQueue.counters[e]=0;var r=!0,n=!1,i=void 0;try{for(var a,o=this.hostQueues[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;t+=s[1].counters[e],s[1].counters[e]=0}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},d.prototype.deQueue=function(e){for(var t=function(e){var t,r,n=0,i=!0,a=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value[1];u.q.length>0&&(n+=u.priority,u.accumulator+=u.priority,(!t||u.accumulator>r)&&(t=u,r=u.accumulator))}}catch(e){a=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}if(t)return t.accumulator-=n,t.q}(e.storages);t&&t.length>0;){var r=t.dequeue();if(!r.earlyDropFunction||!r.earlyDropFunction(r))return r;e.counters.pending--,e.counters.cancelled++,r.reject(new u.default(r))}};var f=d;t.default=f},function(e,t,r){var n;e.exports=function e(t,r,i){function a(s,l){if(!r[s]){if(!t[s]){if(!l&&("function"==typeof n&&n))return n(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[s]={exports:{}};t[s][0].call(h.exports,function(e){return a(t[s][1][e]||e)},h,h.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof n&&n,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){var n,i,a,o,s,l={}.hasOwnProperty;n=e("./PriorityQueue/AbstractPriorityQueue"),i=e("./PriorityQueue/ArrayStrategy"),o=e("./PriorityQueue/BinaryHeapStrategy"),a=e("./PriorityQueue/BHeapStrategy"),(s=function(e){function t(e){e||(e={}),e.strategy||(e.strategy=o),e.comparator||(e.comparator=function(e,t){return(e||0)-(t||0)}),t.__super__.constructor.call(this,e)}return function(e,t){for(var r in t)l.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,n),t}()).ArrayStrategy=i,s.BinaryHeapStrategy=o,s.BHeapStrategy=a,t.exports=s},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,t,r){t.exports=function(){function e(e){var t;if(null==(null!=e?e.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=e?e.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new e.strategy(e),this.length=(null!=e&&null!=(t=e.initialValues)?t.length:void 0)||0}return e.prototype.queue=function(e){this.length++,this.priv.queue(e)},e.prototype.dequeue=function(e){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},e.prototype.peek=function(e){if(!this.length)throw"Empty queue";return this.priv.peek()},e.prototype.clear=function(){return this.length=0,this.priv.clear()},e}()},{}],3:[function(e,t,r){var n;n=function(e,t,r){var n,i,a;for(i=0,n=e.length;i<n;)r(e[a=i+n>>>1],t)>=0?i=a+1:n=a;return i},t.exports=function(){function e(e){var t;this.options=e,this.comparator=this.options.comparator,this.data=(null!=(t=this.options.initialValues)?t.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return e.prototype.queue=function(e){var t;t=n(this.data,e,this.comparator),this.data.splice(t,0,e)},e.prototype.dequeue=function(){return this.data.pop()},e.prototype.peek=function(){return this.data[this.data.length-1]},e.prototype.clear=function(){this.data.length=0},e}()},{}],4:[function(e,t,r){t.exports=function(){function e(e){var t,r,n,i,a,o,s,l;for(this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.pageSize=(null!=e?e.pageSize:void 0)||512,this.length=0,s=0;1<<s<this.pageSize;)s+=1;if(1<<s!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=s,this._emptyMemoryPageTemplate=t=[],r=0,a=this.pageSize;0<=a?r<a:r>a;0<=a?++r:--r)t.push(null);if(this._memory=[],this._mask=this.pageSize-1,e.initialValues)for(n=0,i=(o=e.initialValues).length;n<i;n++)l=o[n],this.queue(l)}return e.prototype.queue=function(e){this.length+=1,this._write(this.length,e),this._bubbleUp(this.length,e)},e.prototype.dequeue=function(){var e,t;return e=this._read(1),t=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,t),this._bubbleDown(1,t)),e},e.prototype.peek=function(){return this._read(1)},e.prototype.clear=function(){this.length=0,this._memory.length=0},e.prototype._write=function(e,t){var r;for(r=e>>this._shift;r>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[r][e&this._mask]=t},e.prototype._read=function(e){return this._memory[e>>this._shift][e&this._mask]},e.prototype._bubbleUp=function(e,t){var r,n,i,a;for(r=this.comparator;e>1&&(n=e&this._mask,e<this.pageSize||n>3?i=e&~this._mask|n>>1:n<2?(i=e-this.pageSize>>this._shift,i+=i&~(this._mask>>1),i|=this.pageSize>>1):i=e-2,!(r(a=this._read(i),t)<0));)this._write(i,t),this._write(e,a),e=i},e.prototype._bubbleDown=function(e,t){var r,n,i,a,o;for(o=this.comparator;e<this.length;)if(e>this._mask&&!(e&this._mask-1)?r=n=e+2:e&this.pageSize>>1?(r=(e&~this._mask)>>1,n=(r=1+(r|=e&this._mask>>1)<<this._shift)+1):n=(r=e+(e&this._mask))+1,r!==n&&n<=this.length)if(i=this._read(r),a=this._read(n),o(i,t)<0&&o(i,a)<=0)this._write(r,t),this._write(e,i),e=r;else{if(!(o(a,t)<0))break;this._write(n,t),this._write(e,a),e=n}else{if(!(r<=this.length))break;if(!(o(i=this._read(r),t)<0))break;this._write(r,t),this._write(e,i),e=r}},e}()},{}],5:[function(e,t,r){t.exports=function(){function e(e){var t;this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.length=0,this.data=(null!=(t=e.initialValues)?t.slice(0):void 0)||[],this._heapify()}return e.prototype._heapify=function(){var e,t,r;if(this.data.length>0)for(e=t=1,r=this.data.length;1<=r?t<r:t>r;e=1<=r?++t:--t)this._bubbleUp(e)},e.prototype.queue=function(e){this.data.push(e),this._bubbleUp(this.data.length-1)},e.prototype.dequeue=function(){var e,t;return t=this.data[0],e=this.data.pop(),this.data.length>0&&(this.data[0]=e,this._bubbleDown(0)),t},e.prototype.peek=function(){return this.data[0]},e.prototype.clear=function(){this.length=0,this.data.length=0},e.prototype._bubbleUp=function(e){for(var t,r;e>0&&(t=e-1>>>1,this.comparator(this.data[e],this.data[t])<0);)r=this.data[t],this.data[t]=this.data[e],this.data[e]=r,e=t},e.prototype._bubbleDown=function(e){var t,r,n,i,a;for(t=this.data.length-1;i=1+(r=1+(e<<1)),n=e,r<=t&&this.comparator(this.data[r],this.data[n])<0&&(n=r),i<=t&&this.comparator(this.data[i],this.data[n])<0&&(n=i),n!==e;)a=this.data[n],this.data[n]=this.data[e],this.data[e]=a,e=n},e}()},{}]},{},[1])(1)},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.supportedFetchers=void 0;var i=n(r(27)),a=n(r(92)),o=n(r(18)),s=n(r(35)),l=n(r(15)),u=new Map([["image/x-bil;bits=32",o.default.textureFloat],["geojson",o.default.json],["application/json",o.default.json],["application/x-protobuf;type=mapbox-vector",o.default.arrayBuffer]]);t.supportedFetchers=u;var h=new Map([["geojson",i.default.parse],["application/json",i.default.parse],["application/x-protobuf;type=mapbox-vector",a.default.parse],[!0,function(e){return e}]]);function c(e,t,r){if(e&&(!r||r(e,t)))return e}var d=function(e,t,r){throw r.handlingError(e,t),e};function f(e,t,r,n){var i=t.source;return(i.fetcher||u.get(i.format)||o.default.texture)(e,i.networkOptions).then(function(e){return e.coords=r,function(e,t,r){var n=e.isTexture||e.isFeature||t.source.format,i={buildExtent:"geometry"!==t.type,crsIn:t.source.projection,crsOut:t.projection,filteringExtent:"geometry"===t.type?r:void 0,filter:t.filter,isInverted:t.source.isInverted,mergeFeatures:void 0===t.mergeFeatures||t.mergeFeatures,withNormal:"geometry"===t.type,withAltitude:"geometry"===t.type};return h.get(n)(e,i)}(e,t,n)},function(t){return d(t,e,i)}).then(function(e){return t.convert(e,n)},function(t){return d(t,e,i)})}var p={executeCommand:function(e){var t=[],r=e.layer,n=r.source,i=e.requester,a=e.extentsSource,o=e.extentsDestination||a,u=e.parsedData||[];if(i&&!i.material)return Promise.reject(new l.default(e));for(var h=0,d=a.length;h<d;h++){var p=a[h],m=o[h],v=n.urlFromExtent(p),g=c(u[h],m,r.isValidData)||n.parsedData,y=g?"".concat(v,",").concat(m.toString(",")):v,x=s.default.get(y);x||(x=g?r.convert(g,m,r):f(v,r,p,m),s.default.set(y,x,s.default.POLICIES.TEXTURE)),t.push(x)}return Promise.all(t)}};t.default=p},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(93)),a=r(95),o=n(r(27));function s(e){for(var t,r,n=0,i=0,a=e.length,o=a-1;i<a;o=i++)t=e[i],n+=((r=e[o]).x-t.x)*(t.y+r.y);return n}var l={types:["Unknown","Point","LineString","Polygon"]},u=new(n(r(8)).default)("EPSG:4326",180,85.06);u.as("EPSG:3857",u);var h=2*u._values[0],c=2*u._values[1];function d(e,t,r,n){for(var i=0;i<e.length;i++){var a=e[i];e[i]=[((a.x+t)/n-.5)*h,(.5-(a.y+r)/n)*c]}}function f(e,t,r){var n=this.extent*Math.pow(2,r),i=this.extent*e,a=this.extent*t,o=this.loadGeometry(),u=l.types[this.type];switch(this.type){case 1:for(var h=[],c=0;c<o.length;c++)h[c]=o[c][0];d(o=h,i,a,n);break;case 2:for(var f=0;f<o.length;f++)d(o[f],i,a,n);break;case 3:o=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],a=0;a<t;a++){var o=s(e[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}return r&&i.push(r),i}(o);for(var p=0;p<o.length;p++)for(var m=0;m<o[p].length;m++)d(o[p][m],i,a,n)}1===o.length?o=o[0]:u="Multi".concat(u);var v={type:"Feature",geometry:{type:u,coordinates:o},properties:this.properties};return"id"in this&&(v.id=this.id),v}var p={parse:function(e,t){return Promise.resolve(function(e,t){var r=new a.VectorTile(new i.default(e)),n=t.extentSource||e.coords,s=Object.keys(r.layers);if(!(s.length<1)){var l={type:"FeatureCollection",features:[],crs:{type:"EPSG",properties:{code:Number(t.crsIn.slice(5))}}};return s.forEach(function(e){for(var i=r.layers[e],a=0;a<i.length;a++){var o=void 0;if(t.isInverted)o=f.bind(i.feature(a))(n.col,n.row,n.zoom);else{var u=1<<n.zoom;o=f.bind(i.feature(a))(n.col,u-n.row-1,n.zoom)}s.length>1&&(o.properties.vt_layer=e),l.features.push(o)}}),o.default.parse(l,{crsIn:t.crsIn,crsOut:t.crsOut,filteringExtent:t.filteringExtent,filter:t.filter,withNormal:t.withNormal,withAltitude:t.withAltitude,mergeFeatures:t.mergeFeatures,buildExtent:!0}).then(function(e){return e.extent.zoom=n.zoom,e})}}(e,t))}};t.default=p},function(e,t,r){"use strict";e.exports=i;var n=r(94);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}function a(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function o(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function s(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function l(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function u(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function h(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function c(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function d(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function f(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function p(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function m(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function v(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function g(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function y(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function x(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5,i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,e(i,t,this),this.pos===a&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=g(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=x(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=g(this.buf,this.pos)+4294967296*g(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=g(this.buf,this.pos)+4294967296*x(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(e,t,r){var n,i,a=r.buf;if(n=(112&(i=a[r.pos++]))>>4,i<128)return o(e,n,t);if(n|=(127&(i=a[r.pos++]))<<3,i<128)return o(e,n,t);if(n|=(127&(i=a[r.pos++]))<<10,i<128)return o(e,n,t);if(n|=(127&(i=a[r.pos++]))<<17,i<128)return o(e,n,t);if(n|=(127&(i=a[r.pos++]))<<24,i<128)return o(e,n,t);if(n|=(1&(i=a[r.pos++]))<<31,i<128)return o(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,r){for(var n="",i=t;i<r;){var a,o,s,l=e[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h>r)break;1===h?l<128&&(u=l):2===h?128==(192&(a=e[i+1]))&&(u=(31&l)<<6|63&a)<=127&&(u=null):3===h?(a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&((u=(15&l)<<12|(63&a)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=h}return n}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=a(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var n,i,a=0;a<t.length;a++){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&s(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),n.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),n.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&s(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,i.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,l,t)},writePackedSVarint:function(e,t){this.writeMessage(e,u,t)},writePackedBoolean:function(e,t){this.writeMessage(e,d,t)},writePackedFloat:function(e,t){this.writeMessage(e,h,t)},writePackedDouble:function(e,t){this.writeMessage(e,c,t)},writePackedFixed32:function(e,t){this.writeMessage(e,f,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,p,t)},writePackedFixed64:function(e,t){this.writeMessage(e,m,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,v,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,a=f&(1<<-h)-1,f>>=-h,h+=s;h>0;a=256*a+e[t+c],c+=d,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=n;h>0;o=256*o+e[t+c],c+=d,h-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,h=(1<<u)-1,c=h>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(o++,l/=2),o+c>=h?(s=0,o=h):o+c>=1?(s=(t*l-1)*Math.pow(2,i),o+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}},function(e,t,r){e.exports.VectorTile=r(96),e.exports.VectorTileFeature=r(53),e.exports.VectorTileLayer=r(52)},function(e,t,r){"use strict";var n=r(52);function i(e,t,r){if(3===e){var i=new n(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}e.exports=function(e,t){this.layers=e.readFields(i,{},t)}},function(e,t,r){"use strict";function n(e,t){this.x=e,this.y=t}e.exports=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),a=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e}},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(15)),a={executeCommand:function(e){var t=[],r=e.layer,n=e.requester,a=e.extentsSource;if(n&&!n.material)return Promise.reject(new i.default(e));for(var o=0,s=a.length;o<s;o++)t.push(r.convert(n,a[o]));return Promise.all(t)}};t.default=a},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.$3dTilesIndex=f,t.getObjectToUpdateForAttachedLayers=p,t.configureTile=y,t.default=void 0;var a=i(r(0)),o=n(r(100)),s=n(r(107)),l=n(r(18)),u=n(r(29)),h=n(r(9)),c=r(58),d=n(r(28));function f(e,t){var r=1;this.index={};var n=new a.Matrix4,i=function(e,t,o){if(e.transform=e.transform?(new a.Matrix4).fromArray(e.transform):void 0,e._worldFromLocalTransform=e.transform,o&&o._worldFromLocalTransform&&(e.transform?e._worldFromLocalTransform=(new a.Matrix4).multiplyMatrices(o._worldFromLocalTransform,e.transform):e._worldFromLocalTransform=o._worldFromLocalTransform),(e.viewerRequestVolume&&e.viewerRequestVolume.region||e.boundingVolume&&e.boundingVolume.region)&&(e._worldFromLocalTransform?n.getInverse(e._worldFromLocalTransform):n.identity()),e.viewerRequestVolume=e.viewerRequestVolume?m(e.viewerRequestVolume,n):void 0,e.boundingVolume=m(e.boundingVolume,n),this.index[r]=e,e.tileId=r,e.baseURL=t,r++,e.children){var s=!0,l=!1,u=void 0;try{for(var h,c=e.children[Symbol.iterator]();!(s=(h=c.next()).done);s=!0){var d=h.value;i(d,t,e)}}catch(e){l=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(l)throw u}}}}.bind(this);i(e.root,t),this.extendTileset=function(e,t,r){i(e.root,r,this.index[t]),this.index[t].children=[e.root],this.index[t].isTileset=!0}}function p(e){if(e.content){var t=[];e.content.traverse(function(r){r.isObject3D&&r.material&&r.layer==e.layer&&t.push(r)});var r=e.parent;return r&&r.content?{elements:t,parent:r.content}:{elements:t}}}function m(e,t){if(e.region){var r=e.region,n=new h.default("EPSG:4326",a.Math.radToDeg(r[0]),a.Math.radToDeg(r[2]),a.Math.radToDeg(r[1]),a.Math.radToDeg(r[3])),i=u.default.extentToOBB(n,r[4],r[5]);return i.matrix.premultiply(t),i.matrix.decompose(i.position,i.quaternion,i.scale),{region:i}}if(e.box){var o=e.box,s=new a.Vector3(o[0],o[1],o[2]),l=s.x-o[3],c=s.x+o[3],d=s.y-o[7],f=s.y+o[7],p=s.z-o[11],m=s.z+o[11];return{box:new a.Box3(new a.Vector3(l,d,p),new a.Vector3(c,f,m))}}if(e.sphere)return{sphere:new a.Sphere(new a.Vector3(e.sphere[0],e.sphere[1],e.sphere[2]),e.sphere[3])}}function v(e,t,r){var n=a.LoaderUtils.extractUrlBase(r),i={gltfUpAxis:t.asset.gltfUpAxis,urlBase:n,overrideMaterials:t.overrideMaterials,doNotPatchMaterial:t.doNotPatchMaterial,opacity:t.opacity};return o.default.parse(e,i).then(function(e){return{batchTable:e.batchTable,object3d:e.gltf.scene}})}function g(e,t){return s.default.parse(e).then(function(e){var r=t.material?t.material.clone():new a.PointsMaterial({size:.05,vertexColors:a.VertexColors}),n=new a.Points(e.point.geometry,r);return e.point.offset&&n.position.copy(e.point.offset),{object3d:n}})}function y(e,t,r,n){e.frustumCulled=!1,e.layer=t,r.transform&&e.applyMatrix(r.transform),e.geometricError=r.geometricError,e.tileId=r.tileId,r.refine?e.additiveRefinement="ADD"===r.refine.toUpperCase():e.additiveRefinement=!!n&&n.additiveRefinement,e.viewerRequestVolume=r.viewerRequestVolume,e.boundingVolume=r.boundingVolume,e.boundingVolume.region&&e.add(e.boundingVolume.region),e.updateMatrixWorld()}var x={preprocessDataLayer:function(e,t,r){return e.preUpdate=e.preUpdate||c.pre3dTilesUpdate,e.update=e.update||(0,c.process3dTilesNode)(),e.sseThreshold=e.sseThreshold||16,e.cleanupDelay=e.cleanupDelay||1e3,e.getObjectToUpdateForAttachedLayers=p,e._cleanableTiles=[],l.default.json(e.url,e.networkOptions).then(function(n){e.tileset=n;var i=e.url.slice(0,e.url.lastIndexOf("/")+1);return e.tileIndex=new f(n,i),e.asset=n.asset,(0,c.init3dTilesLayer)(t,r,e,n.root)})},executeCommand:function(e){var t=e.layer,r=e.metadata,n=new a.Object3D;y(n,t,r,e.requester);var i=r.content&&(r.content.url||r.content.uri),o=function(e){e.layers.set(t.threejsLayer),e.userData.metadata=r,e.layer=t,e.material&&(e.material.transparent=t.opacity<1,e.material.opacity=t.opacity,e.material.wireframe=t.wireframe)};if(i){var s=i.startsWith("http")?i:r.baseURL+i,u={b3dm:v,pnts:g};return l.default.arrayBuffer(s,t.networkOptions).then(function(e){if(void 0!==e){var i,a=d.default.decode(new Uint8Array(e,0,4));if("{"===a[0]){e=JSON.parse(d.default.decode(new Uint8Array(e)));var l=s.slice(0,s.lastIndexOf("/")+1);t.tileIndex.extendTileset(e,r.tileId,l)}else if("b3dm"==a)i=u.b3dm;else{if("pnts"!=a)return Promise.reject("Unsupported magic code ".concat(a));i=u.pnts}if(i)return i(e,t,s).then(function(e){return n.content=e.object3d,e.batchTable&&(n.batchTable=e.batchTable),n.add(e.object3d),n.traverse(o),n})}return n.traverse(o),n})}return n.traverse(o),Promise.resolve(n)}};t.default=x},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(19)),o=n(r(0)),s=i(r(22)),l=i(r(101)),u=i(r(105)),h=i(r(54)),c=i(r(43)),d=i(r(28)),f=(new o.Matrix4).makeRotationX(Math.PI/2),p=(new o.Matrix4).makeRotationZ(-Math.PI/2),m=new l.default,v=new u.default;function g(e){var t=["MODELVIEW","MODELVIEWINVERSETRANSPOSE","PROJECTION","JOINTMATRIX"];if(e.gltfShader){var r=[];for(var n in e.gltfShader.boundUniforms)r.push(n);for(var i=0;i<r.length;i++){var a=r[i],o=e.gltfShader.boundUniforms[a].semantic;t.includes(o)||delete e.gltfShader.boundUniforms[a]}}}var y={parse:function(e,t){var r=t.gltfUpAxis,n=t.urlBase;if(!e)throw new Error("No array buffer provided.");var i=new DataView(e,4),l=0,u={};if(u.magic=d.default.decode(new Uint8Array(e,0,4)),u.magic){u.version=i.getUint32(l,!0),l+=Uint32Array.BYTES_PER_ELEMENT,u.byteLength=i.getUint32(l,!0),l+=Uint32Array.BYTES_PER_ELEMENT,u.FTJSONLength=i.getUint32(l,!0),l+=Uint32Array.BYTES_PER_ELEMENT,u.FTBinaryLength=i.getUint32(l,!0),l+=Uint32Array.BYTES_PER_ELEMENT,u.BTJSONLength=i.getUint32(l,!0),l+=Uint32Array.BYTES_PER_ELEMENT,u.BTBinaryLength=i.getUint32(l,!0);var y=(l+=Uint32Array.BYTES_PER_ELEMENT)+4,x=[];if(u.BTJSONLength>0){var b=y+u.FTJSONLength+u.FTBinaryLength;x.push(h.default.parse(e.slice(b,u.BTJSONLength+b)))}else x.push(Promise.resolve({}));return x.push(new Promise(function(i){var l=function(n){var l=!0,h=!1,m=void 0;try{for(var v,x=n.scenes[Symbol.iterator]();!(l=(v=x.next()).done);l=!0)v.value.traverse(g)}catch(e){h=!0,m=e}finally{try{l||null==x.return||x.return()}finally{if(h)throw m}}void 0===r||"Y"===r?n.scene.applyMatrix(f):"X"===r&&n.scene.applyMatrix(p),function(e,t){var r=new DataView(e,0,20),n=new Uint8Array(e,20,r.getUint32(12,!0)),i=d.default.decode(new Uint8Array(n)),a=JSON.parse(i);a.extensions&&a.extensions.CESIUM_RTC&&(t.position.fromArray(a.extensions.CESIUM_RTC.center),t.updateMatrixWorld(!0))}(e.slice(y+u.FTJSONLength+u.FTBinaryLength+u.BTJSONLength+u.BTBinaryLength),n.scene),n.scene.traverse(function(e){e.frustumCulled=!1,e.material&&(t.overrideMaterials?(e.material.dispose(),"object"===(0,a.default)(t.overrideMaterials)&&t.overrideMaterials.isMaterial?e.material=t.overrideMaterials.clone():e.material=new o.MeshLambertMaterial({color:16777215})):s.default.isLogDepthBufferSupported()&&e.material.isRawShaderMaterial&&!t.doNotPatchMaterial&&(c.default.patchMaterialForLogDepthSupport(e.material),console.warn("b3dm shader has been patched to add log depth buffer support")),e.material.transparent=t.opacity<1,e.material.opacity=t.opacity)}),i(n)},h=e.slice(y+u.FTJSONLength+u.FTBinaryLength+u.BTJSONLength+u.BTBinaryLength);1===new DataView(h,0,20).getUint32(4,!0)?v.parse(h,n,l):m.parse(h,n,l)})),Promise.all(x).then(function(e){return{gltf:e[1],batchTable:e[0]}})}throw new Error("Invalid b3dm file.")}};t.default=y},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(19)),o=n(r(0)),s=i(r(102)),l=i(r(103)),u=i(r(104)),h={};h.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this.dracoLoader=null}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,n){var i,a=this;i=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:o.LoaderUtils.extractUrlBase(e),a.manager.itemStart(e);var s=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new o.FileLoader(a.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(e,function(r){try{a.parse(r,i,function(r){t(r),a.manager.itemEnd(e)},s)}catch(e){s(e)}},r,s)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,a,s,l){var u,v={};if("string"==typeof e)u=e;else if(o.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{v[t.KHR_BINARY_GLTF]=new function(e){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(e,0,c);if(this.header={magic:o.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==h)throw new Error("threeExamples.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("threeExamples.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var n=new DataView(e,c),i=0;i<n.byteLength;){var a=n.getUint32(i,!0);i+=4;var s=n.getUint32(i,!0);if(i+=4,s===d.JSON){var l=new Uint8Array(e,c+i,a);this.content=o.LoaderUtils.decodeText(l)}else if(s===d.BIN){var u=c+i;this.body=e.slice(u,u+a)}i+=a}if(null===this.content)throw new Error("threeExamples.GLTFLoader: JSON content not found.")}(e)}catch(e){return void(l&&l(e))}u=v[t.KHR_BINARY_GLTF].content}else u=o.LoaderUtils.decodeText(new Uint8Array(e));var g=JSON.parse(u);if(void 0===g.asset||g.asset.version[0]<2)l&&l(new Error("threeExamples.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(g.extensionsUsed)for(var y=0;y<g.extensionsUsed.length;++y){var x=g.extensionsUsed[y],b=g.extensionsRequired||[];switch(x){case t.KHR_LIGHTS_PUNCTUAL:v[x]=new n(g);break;case t.KHR_MATERIALS_UNLIT:v[x]=new i(g);break;case t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:v[x]=new m(g);break;case t.KHR_DRACO_MESH_COMPRESSION:v[x]=new f(g,this.dracoLoader);break;case t.MSFT_TEXTURE_DDS:v[t.MSFT_TEXTURE_DDS]=new r(g);break;case t.KHR_TEXTURE_TRANSFORM:v[t.KHR_TEXTURE_TRANSFORM]=new p(g);break;default:b.indexOf(x)>=0&&console.warn('threeExamples.GLTFLoader: Unknown extension "'+x+'".')}}var w=new D(g,v,{path:a||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});w.parse(function(e,t,r,n,i){var a={scene:e,scenes:t,cameras:r,animations:n,asset:i.asset,parser:w,userData:{}};T(v,a,i),s(a)},l)}}};var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(){if(!s.default)throw new Error("threeExamples.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=t.MSFT_TEXTURE_DDS,this.ddsLoader=new s.default}function n(e){this.name=t.KHR_LIGHTS_PUNCTUAL;var r=e.extensions&&e.extensions[t.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=r.lights||[]}function i(){this.name=t.KHR_MATERIALS_UNLIT}n.prototype.loadLight=function(e){var t,r=this.lightDefs[e],n=new o.Color(16777215);void 0!==r.color&&n.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new o.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new o.PointLight(n)).distance=i;break;case"spot":(t=new o.SpotLight(n)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('threeExamples.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},i.prototype.getMaterialType=function(){return o.MeshBasicMaterial},i.prototype.extendParams=function(e,t,r){var n=[];e.color=new o.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(n)};var h="glTF",c=12,d={JSON:1313821514,BIN:5130562};function f(e,r){if(!r)throw new Error("threeExamples.GLTFLoader: No DRACOLoader instance provided.");this.name=t.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=r,l.default.getDecoderModule()}function p(){this.name=t.KHR_TEXTURE_TRANSFORM}function m(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return o.ShaderMaterial},extendParams:function(e,t,r){var n=t.extensions[this.name],i=o.ShaderLib.standard,a=o.UniformsUtils.clone(i.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),l=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),d=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",l).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",c);delete a.roughness,delete a.metalness,delete a.roughnessMap,delete a.metalnessMap,a.specular={value:(new o.Color).setHex(1118481)},a.glossiness={value:.5},a.specularMap={value:null},a.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=d,e.uniforms=a,e.defines={STANDARD:""},e.color=new o.Color(1,1,1),e.opacity=1;var f=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==n.diffuseTexture&&f.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new o.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new o.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var m=n.specularGlossinessTexture;f.push(r.assignTexture(e,"glossinessMap",m)),f.push(r.assignTexture(e,"specularMap",m))}return Promise.all(f)},createMaterial:function(e){var t=new o.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++)t[r[n]]=e[r[n]];return t},refreshUniforms:function(e,t,r,n,i){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,o=i.uniforms,s=i.defines;o.opacity.value=i.opacity,o.diffuse.value.copy(i.color),o.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),o.map.value=i.map,o.specularMap.value=i.specularMap,o.alphaMap.value=i.alphaMap,o.lightMap.value=i.lightMap,o.lightMapIntensity.value=i.lightMapIntensity,o.aoMap.value=i.aoMap,o.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),o.uvTransform.value.copy(a.matrix)),i.envMap&&(o.envMap.value=i.envMap,o.envMapIntensity.value=i.envMapIntensity,o.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,o.reflectivity.value=i.reflectivity,o.refractionRatio.value=i.refractionRatio,o.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),o.specular.value.copy(i.specular),o.glossiness.value=i.glossiness,o.glossinessMap.value=i.glossinessMap,o.emissiveMap.value=i.emissiveMap,o.bumpMap.value=i.bumpMap,o.normalMap.value=i.normalMap,o.displacementMap.value=i.displacementMap,o.displacementScale.value=i.displacementScale,o.displacementBias.value=i.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function v(e,t,r,n){o.Interpolant.call(this,e,t,r,n)}f.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a)u in w&&(o[w[u]]=a[u]);for(u in e.attributes)if(void 0!==w[u]&&void 0!==a[u]){var h=r.accessors[e.attributes[u]],c=g[h.componentType];l[w[u]]=c,s[w[u]]=!0===h.normalized}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){n.decodeDracoFile(e,function(e){for(var r in e.attributes){var n=e.attributes[r],i=s[r];void 0!==i&&(n.normalized=i)}t(e)},o,l)})})},p.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('threeExamples.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},v.prototype=Object.create(o.Interpolant.prototype),v.prototype.constructor=v,v.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=0;i!==n;i++)t[i]=r[e*n*3+n+i];return t},v.prototype.beforeStart_=v.prototype.copySampleValue_,v.prototype.afterEnd_=v.prototype.copySampleValue_,v.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=3*o,l=n-t,u=(r-t)/l,h=u*u,c=h*u,d=e*s,f=d-s,p=-2*c+3*h,m=c-h,v=0;v!==o;v++){var g=a[f+v+o],y=a[f+v+2*o]*l,x=a[d+v+o],b=a[d+v]*l;i[v]=(1-p)*g+(m-h+u)*y+p*x+m*b}return i};Number,o.Matrix3,o.Matrix4,o.Vector2,o.Vector3,o.Vector4,o.Texture;var g={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},y={9728:o.NearestFilter,9729:o.LinearFilter,9984:o.NearestMipMapNearestFilter,9985:o.LinearMipMapNearestFilter,9986:o.NearestMipMapLinearFilter,9987:o.LinearMipMapLinearFilter},x={33071:o.ClampToEdgeWrapping,33648:o.MirroredRepeatWrapping,10497:o.RepeatWrapping};o.BackSide,o.FrontSide,o.NeverDepth,o.LessDepth,o.EqualDepth,o.LessEqualDepth,o.GreaterEqualDepth,o.NotEqualDepth,o.GreaterEqualDepth,o.AlwaysDepth,o.AddEquation,o.SubtractEquation,o.ReverseSubtractEquation,o.ZeroFactor,o.OneFactor,o.SrcColorFactor,o.OneMinusSrcColorFactor,o.SrcAlphaFactor,o.OneMinusSrcAlphaFactor,o.DstAlphaFactor,o.OneMinusDstAlphaFactor,o.DstColorFactor,o.OneMinusDstColorFactor,o.SrcAlphaSaturateFactor;var b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},w={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex",_BATCHID:"_BATCHID"},_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},M={CUBICSPLINE:o.InterpolateSmooth,LINEAR:o.InterpolateLinear,STEP:o.InterpolateDiscrete},E={"image/png":o.RGBAFormat,"image/jpeg":o.RGBFormat};function S(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function T(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function A(e,t){void 0!==t.extras&&("object"===(0,a.default)(t.extras)?e.userData=t.extras:console.warn("threeExamples.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function L(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length)for(e.morphTargetDictionary={},r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r;else console.warn("threeExamples.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function P(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}function C(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function R(e,r){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(s=r,l=(o=a.primitive).extensions?o.extensions[t.KHR_DRACO_MESH_COMPRESSION]:void 0,u=s.extensions?s.extensions[t.KHR_DRACO_MESH_COMPRESSION]:void 0,l&&u?l.bufferView===u.bufferView&&P(l.attributes,u.attributes):o.indices===s.indices&&P(o.attributes,s.attributes))return a.promise}var o,s,l,u;return null}function O(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,n=e.array.slice(0,t*r),i=0;i<t;++i)n[i]=e.getX(i),r>=2&&(n[i+1]=e.getY(i)),r>=3&&(n[i+2]=e.getZ(i)),r>=4&&(n[i+3]=e.getW(i));return new o.BufferAttribute(n,r,e.normalized)}return e.clone()}function D(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}},this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new o.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new o.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function I(e,t,r){var n=t.attributes,i=[];function a(t,n){return r.getDependency("accessor",t).then(function(t){e.addAttribute(n,t)})}for(var o in n){var s=w[o];s&&(s in e.attributes||i.push(a(n[o],s)))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(l)}return A(e,t),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(u=t[a]).POSITION&&(n=!0),void 0!==u.NORMAL&&(i=!0),!n||!i);a++);if(!n&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(n){var h=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION).then(function(e){return O(e)}):e.attributes.position;s.push(h)}i&&(h=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL).then(function(e){return O(e)}):e.attributes.normal,l.push(h))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(r){for(var a=r[0],o=r[1],s=0,l=t.length;s<l;s++){var u=t[s],h="morphTarget"+s;if(n&&void 0!==u.POSITION){var c=a[s];c.name=h;for(var d=e.attributes.position,f=0,p=c.count;f<p;f++)c.setXYZ(f,c.getX(f)+d.getX(f),c.getY(f)+d.getY(f),c.getZ(f)+d.getZ(f))}if(i&&void 0!==u.NORMAL){var m=o[s];m.name=h;var v=e.attributes.normal;for(f=0,p=m.count;f<p;f++)m.setXYZ(f,m.getX(f)+v.getX(f),m.getY(f)+v.getY(f),m.getZ(f)+v.getZ(f))}}return n&&(e.morphAttributes.position=a),i&&(e.morphAttributes.normal=o),e})}(e,t.targets,r):e})}return D.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var n=t.scenes||[],i=n[r.scene||0],a=t.animations||[],o=t.cameras||[];e(i,n,o,a,r)}).catch(t)},D.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var h=0,c=e.length;h<c;h++){var d=e[h];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},D.prototype.getDependency=function(e,r){var n=e+":"+r,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(r);break;case"node":i=this.loadNode(r);break;case"mesh":i=this.loadMesh(r);break;case"accessor":i=this.loadAccessor(r);break;case"bufferView":i=this.loadBufferView(r);break;case"buffer":i=this.loadBuffer(r);break;case"material":i=this.loadMaterial(r);break;case"texture":i=this.loadTexture(r);break;case"skin":i=this.loadSkin(r);break;case"animation":i=this.loadAnimation(r);break;case"camera":i=this.loadCamera(r);break;case"light":i=this.extensions[t.KHR_LIGHTS_PUNCTUAL].loadLight(r);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},D.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t},D.prototype.getMultiDependencies=function(e){for(var t={},r=[],n=0,i=e.length;n<i;n++){var a=e[n],o=this.getDependencies(a);o=o.then(function(e,r){t[e]=r}.bind(this,a+("mesh"===a?"es":"s"))),r.push(o)}return Promise.all(r).then(function(){return t})},D.prototype.loadBuffer=function(e){var r=this.json.buffers[e],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("threeExamples.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,t){n.load(S(r.uri,i.path),e,void 0,function(){t(new Error('threeExamples.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},D.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})},D.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,a,s=e[0],l=b[n.type],u=g[n.componentType],h=u.BYTES_PER_ELEMENT,c=n.byteOffset||0,d=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,f=!0===n.normalized;if(d&&d!==h*l){var p="InterleavedBuffer:"+n.bufferView+":"+n.componentType,m=t.cache.get(p);m||(i=new u(s),m=new o.InterleavedBuffer(i,d/h),t.cache.add(p,m)),a=new o.InterleavedBufferAttribute(m,l,c/h,f)}else i=null===s?new u(n.count*l):new u(s,c,n.count*l),a=new o.BufferAttribute(i,l,f);if(void 0!==n.sparse){var v=b.SCALAR,y=g[n.sparse.indices.componentType],x=n.sparse.indices.byteOffset||0,w=n.sparse.values.byteOffset||0,_=new y(e[1],x,n.sparse.count*v),M=new u(e[2],w,n.sparse.count*l);null!==s&&a.setArray(a.array.slice());for(var E=0,S=_.length;E<S;E++){var T=_[E];if(a.setX(T,M[E*l]),l>=2&&a.setY(T,M[E*l+1]),l>=3&&a.setZ(T,M[E*l+2]),l>=4&&a.setW(T,M[E*l+3]),l>=5)throw new Error("threeExamples.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})},D.prototype.loadTexture=function(e){var r,n=this,i=this.json,a=this.options,s=this.textureLoader,l=window.URL||window.webkitURL,u=i.textures[e],h=u.extensions||{},c=(r=h[t.MSFT_TEXTURE_DDS]?i.images[h[t.MSFT_TEXTURE_DDS].source]:i.images[u.source]).uri,d=!1;return void 0!==r.bufferView&&(c=n.getDependency("bufferView",r.bufferView).then(function(e){d=!0;var t=new Blob([e],{type:r.mimeType});return c=l.createObjectURL(t)})),Promise.resolve(c).then(function(e){var r=o.Loader.Handlers.get(e);return r||(r=h[t.MSFT_TEXTURE_DDS]?n.extensions[t.MSFT_TEXTURE_DDS].ddsLoader:s),new Promise(function(t,n){r.load(S(e,a.path),t,void 0,n)})}).then(function(e){!0===d&&l.revokeObjectURL(c),e.flipY=!1,void 0!==u.name&&(e.name=u.name),r.mimeType in E&&(e.format=E[r.mimeType]);var t=(i.samplers||{})[u.sampler]||{};return e.magFilter=y[t.magFilter]||o.LinearFilter,e.minFilter=y[t.minFilter]||o.LinearMipMapLinearFilter,e.wrapS=x[t.wrapS]||o.RepeatWrapping,e.wrapT=x[t.wrapT]||o.RepeatWrapping,e})},D.prototype.assignTexture=function(e,r,n){var i=this;return this.getDependency("texture",n.index).then(function(a){if(i.extensions[t.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[t.KHR_TEXTURE_TRANSFORM]:void 0;o&&(a=i.extensions[t.KHR_TEXTURE_TRANSFORM].extendTexture(a,o))}e[r]=a})},D.prototype.loadMaterial=function(e){var r,n=this.json,i=this.extensions,a=n.materials[e],s={},l=a.extensions||{},u=[];if(l[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=i[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=h.getMaterialType(a),u.push(h.extendParams(s,a,this))}else if(l[t.KHR_MATERIALS_UNLIT]){var c=i[t.KHR_MATERIALS_UNLIT];r=c.getMaterialType(a),u.push(c.extendParams(s,a,this))}else{r=o.MeshStandardMaterial;var d=a.pbrMetallicRoughness||{};if(s.color=new o.Color(1,1,1),s.opacity=1,Array.isArray(d.baseColorFactor)){var f=d.baseColorFactor;s.color.fromArray(f),s.opacity=f[3]}void 0!==d.baseColorTexture&&u.push(this.assignTexture(s,"map",d.baseColorTexture)),s.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,s.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(this.assignTexture(s,"metalnessMap",d.metallicRoughnessTexture)),u.push(this.assignTexture(s,"roughnessMap",d.metallicRoughnessTexture)))}!0===a.doubleSided&&(s.side=o.DoubleSide);var p=a.alphaMode||"OPAQUE";return"BLEND"===p?s.transparent=!0:(s.transparent=!1,"MASK"===p&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==o.MeshBasicMaterial&&(u.push(this.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new o.Vector2(1,1),void 0!==a.normalTexture.scale&&s.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&r!==o.MeshBasicMaterial&&(u.push(this.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==o.MeshBasicMaterial&&(s.emissive=(new o.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&r!==o.MeshBasicMaterial&&u.push(this.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(u).then(function(){var e;return e=r===o.ShaderMaterial?i[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new r(s),void 0!==a.name&&(e.name=a.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=o.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=o.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=o.sRGBEncoding),A(e,a),a.extensions&&T(i,e,a),e})},D.prototype.loadGeometries=function(e){var r,n=this,i=this.extensions,a=this.primitiveCache,s=function(e){if(e.length<2)return!1;var r=e[0],n=r.targets||[];if(void 0===r.indices)return!1;for(var i=1,a=e.length;i<a;i++){var o=e[i];if(r.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[t.KHR_DRACO_MESH_COMPRESSION])return!1;if(!P(r.attributes,o.attributes))return!1;var s=o.targets||[];if(n.length!==s.length)return!1;for(var l=0,u=n.length;l<u;l++)if(!P(n[l],s[l]))return!1}return!0}(e);function l(e){return i[t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then(function(t){return I(t,e,n)})}s&&(r=e,e=[e[0]]);for(var h=[],c=0,d=e.length;c<d;c++){var f,p=e[c],m=R(a,p);m?h.push(m):(f=p.extensions&&p.extensions[t.KHR_DRACO_MESH_COMPRESSION]?l(p):I(new o.BufferGeometry,p,n),a.push({primitive:p,promise:f}),h.push(f))}return Promise.all(h).then(function(t){if(s){var i=t[0];if(null!==(p=function(e,t,r){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(t===a.baseGeometry&&C(r,a.primitives))return a.geometry}return null}(f=n.multiPassGeometryCache,i,r)))return[p.geometry];var a=new o.BufferGeometry;for(var l in a.name=i.name,a.userData=i.userData,i.attributes)a.addAttribute(l,i.attributes[l]);for(var l in i.morphAttributes)a.morphAttributes[l]=i.morphAttributes[l];for(var h=[],c=0,d=r.length;c<d;c++)h.push(n.getDependency("accessor",r[c].indices));return Promise.all(h).then(function(e){for(var t=[],n=0,o=0,s=r.length;o<s;o++){for(var l=e[o],u=0,h=l.count;u<h;u++)t.push(l.array[u]);a.addGroup(n,l.count,o),n+=l.count}return a.setIndex(t),f.push({geometry:a,baseGeometry:i,primitives:r}),[a]})}if(t.length>1&&void 0!==u.default){for(c=1,d=e.length;c<d;c++)if(e[0].mode!==e[c].mode)return t;var f,p;if(p=function(e,t){for(var r=0,n=e.length;r<n;r++){var i=e[r];if(C(t,i.baseGeometries))return i.geometry}return null}(f=n.multiplePrimitivesCache,t)){if(null!==p.geometry)return[p.geometry]}else if(a=u.default.mergeBufferGeometries(t,!0),f.push({geometry:a,baseGeometries:t}),null!==a)return[a]}return t})},D.prototype.loadMesh=function(e){for(var r=this,n=this.json,i=this.extensions,a=n.meshes[e],s=a.primitives,l=[],u=0,h=s.length;u<h;u++){var c=void 0===s[u].material?new o.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:o.FrontSide}):this.getDependency("material",s[u].material);l.push(c)}return Promise.all(l).then(function(n){return r.loadGeometries(s).then(function(l){for(var u=1===l.length&&l[0].groups.length>0,h=[],c=0,d=l.length;c<d;c++){var f,p=l[c],m=s[c],v=u?n:n[c];if(4===m.mode||5===m.mode||6===m.mode||void 0===m.mode)!0===(f=!0===a.isSkinnedMesh?new o.SkinnedMesh(p,v):new o.Mesh(p,v)).isSkinnedMesh&&f.normalizeSkinWeights(),5===m.mode?f.drawMode=o.TriangleStripDrawMode:6===m.mode&&(f.drawMode=o.TriangleFanDrawMode);else if(1===m.mode)f=new o.LineSegments(p,v);else if(3===m.mode)f=new o.Line(p,v);else if(2===m.mode)f=new o.LineLoop(p,v);else{if(0!==m.mode)throw new Error("threeExamples.GLTFLoader: Primitive mode unsupported: "+m.mode);f=new o.Points(p,v)}Object.keys(f.geometry.morphAttributes).length>0&&L(f,a),f.name=a.name||"mesh_"+e,l.length>1&&(f.name+="_"+c),A(f,a),h.push(f);for(var g=u?f.material:[f.material],y=void 0!==p.attributes.color,x=void 0===p.attributes.normal,b=!0===f.isSkinnedMesh,w=Object.keys(p.morphAttributes).length>0,_=w&&void 0!==p.morphAttributes.normal,M=0,E=g.length;M<E;M++){if(v=g[M],f.isPoints){var S="PointsMaterial:"+v.uuid,T=r.cache.get(S);T||(T=new o.PointsMaterial,o.Material.prototype.copy.call(T,v),T.color.copy(v.color),T.map=v.map,T.lights=!1,r.cache.add(S,T)),v=T}else if(f.isLine){S="LineBasicMaterial:"+v.uuid;var P=r.cache.get(S);P||(P=new o.LineBasicMaterial,o.Material.prototype.copy.call(P,v),P.color.copy(v.color),P.lights=!1,r.cache.add(S,P)),v=P}if(y||x||b||w){S="ClonedMaterial:"+v.uuid+":",v.isGLTFSpecularGlossinessMaterial&&(S+="specular-glossiness:"),b&&(S+="skinning:"),y&&(S+="vertex-colors:"),x&&(S+="flat-shading:"),w&&(S+="morph-targets:"),_&&(S+="morph-normals:");var C=r.cache.get(S);C||(C=v.isGLTFSpecularGlossinessMaterial?i[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(v):v.clone(),b&&(C.skinning=!0),y&&(C.vertexColors=o.VertexColors),x&&(C.flatShading=!0),w&&(C.morphTargets=!0),_&&(C.morphNormals=!0),r.cache.add(S,C)),v=C}g[M]=v,v.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("threeExamples.GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new o.BufferAttribute(p.attributes.uv.array,2))),v.isGLTFSpecularGlossinessMaterial&&(f.onBeforeRender=i[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}f.material=u?g:g[0]}if(1===h.length)return h[0];var R=new o.Group;for(c=0,d=h.length;c<d;c++)R.add(h[c]);return R})})},D.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new o.PerspectiveCamera(o.Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new o.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==r.name&&(t.name=r.name),A(t,r),Promise.resolve(t);console.warn("threeExamples.GLTFLoader: Missing camera parameters.")},D.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},D.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],i=[],a=[],s=[],l=0,u=t.channels.length;l<u;l++){var h=t.channels[l],c=t.samplers[h.sampler],d=h.target,f=void 0!==d.node?d.node:d.id,p=void 0!==t.parameters?t.parameters[c.input]:c.input,m=void 0!==t.parameters?t.parameters[c.output]:c.output;r.push(this.getDependency("node",f)),n.push(this.getDependency("accessor",p)),i.push(this.getDependency("accessor",m)),a.push(c),s.push(d)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(s)]).then(function(r){for(var n=r[0],i=r[1],a=r[2],s=r[3],l=r[4],u=[],h=0,c=n.length;h<c;h++){var d=n[h],f=i[h],p=a[h],m=s[h],g=l[h];if(void 0!==d){var y;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,_[g.path]){case _.weights:y=o.NumberKeyframeTrack;break;case _.rotation:y=o.QuaternionKeyframeTrack;break;case _.position:case _.scale:default:y=o.VectorKeyframeTrack}var x=d.name?d.name:d.uuid,b=void 0!==m.interpolation?M[m.interpolation]:o.InterpolateLinear,w=[];_[g.path]===_.weights?d.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&w.push(e.name?e.name:e.uuid)}):w.push(x);for(var E=0,S=w.length;E<S;E++){var T=new y(w[E]+"."+_[g.path],o.AnimationUtils.arraySlice(f.array,0),o.AnimationUtils.arraySlice(p.array,0),b);"CUBICSPLINE"===m.interpolation&&(T.createInterpolant=function(e){return new v(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(T)}}}var A=void 0!==t.name?t.name:"animation_"+e;return new o.AnimationClip(A,void 0,u)})},D.prototype.loadNode=function(e){var r=this.json,n=this.extensions,i=this,a=r.meshReferences,s=r.meshUses,l=r.nodes[e];return new Promise(function(e){!0===l.isBone?e(new o.Bone):void 0!==l.mesh?i.getDependency("mesh",l.mesh).then(function(t){var r;if(a[l.mesh]>1){var n=s[l.mesh]++;(r=t.clone()).name+="_instance_"+n,r.onBeforeRender=t.onBeforeRender;for(var i=0,o=r.children.length;i<o;i++)r.children[i].name+="_instance_"+n,r.children[i].onBeforeRender=t.children[i].onBeforeRender}else r=t;e(r)}):void 0!==l.camera?i.getDependency("camera",l.camera).then(e):l.extensions&&l.extensions[t.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[t.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",l.extensions[t.KHR_LIGHTS_PUNCTUAL].light).then(e):e(new o.Object3D)}).then(function(e){if(void 0!==l.name&&(e.name=o.PropertyBinding.sanitizeNodeName(l.name)),A(e,l),l.extensions&&T(n,e,l),void 0!==l.matrix){var t=new o.Matrix4;t.fromArray(l.matrix),e.applyMatrix(t)}else void 0!==l.translation&&e.position.fromArray(l.translation),void 0!==l.rotation&&e.quaternion.fromArray(l.rotation),void 0!==l.scale&&e.scale.fromArray(l.scale);return e})},D.prototype.loadScene=function(){function e(t,r,n,i){var a=n.nodes[t];return i.getDependency("node",t).then(function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then(function(e){for(var r=[],n=0,a=(t=e).joints.length;n<a;n++)r.push(i.getDependency("node",t.joints[n]));return Promise.all(r)}).then(function(r){for(var n=!0===e.isGroup?e.children:[e],i=0,a=n.length;i<a;i++){for(var s=n[i],l=[],u=[],h=0,c=r.length;h<c;h++){var d=r[h];if(d){l.push(d);var f=new o.Matrix4;void 0!==t.inverseBindMatrices&&f.fromArray(t.inverseBindMatrices.array,16*h),u.push(f)}else console.warn('threeExamples.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}s.bind(new o.Skeleton(l,u),s.matrixWorld)}return e});var t}).then(function(t){r.add(t);var o=[];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){var h=s[l];o.push(e(h,t,n,i))}return Promise.all(o)})}return function(t){var r=this.json,n=this.extensions,i=this.json.scenes[t],a=new o.Scene;void 0!==i.name&&(a.name=i.name),A(a,i),i.extensions&&T(n,a,i);for(var s=i.nodes||[],l=[],u=0,h=s.length;u<h;u++)l.push(e(s[u],a,r,this));return Promise.all(l).then(function(){return a})}}(),e}();var c=h.GLTFLoader;t.default=c},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a={DDSLoader:function(e){i.CompressedTextureLoader.call(this,e),this._parser=a.DDSLoader.parse}};a.DDSLoader.prototype=Object.create(i.CompressedTextureLoader.prototype),a.DDSLoader.prototype.constructor=a.DDSLoader,a.DDSLoader.parse=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function a(e,t,r,n){for(var i=r*n*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,u=0;u<n;u++)for(var h=0;h<r;h++){var c=a[l],d=a[++l],f=a[++l],p=a[++l];l++,o[s]=f,o[++s]=d,o[++s]=c,o[++s]=p,s++}return o}var o,s=n("DXT1"),l=n("DXT3"),u=n("DXT5"),h=n("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("threeExamples.DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!c[20])return console.error("threeExamples.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var d,f=c[21],p=!1;switch(f){case s:o=8,r.format=i.RGB_S3TC_DXT1_Format;break;case l:o=16,r.format=i.RGBA_S3TC_DXT3_Format;break;case u:o=16,r.format=i.RGBA_S3TC_DXT5_Format;break;case h:o=8,r.format=i.RGB_ETC1_Format;break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("threeExamples.DDSLoader.parse: Unsupported FourCC code ",(d=f,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),r;p=!0,o=64,r.format=i.RGBAFormat}r.mipmapCount=1,131072&c[2]&&!1!==t&&(r.mipmapCount=Math.max(1,c[7]));var m=c[28];if(r.isCubemap=!!(512&m),r.isCubemap&&(!(1024&m)||!(2048&m)||!(4096&m)||!(8192&m)||!(16384&m)||!(32768&m)))return console.error("threeExamples.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=c[4],r.height=c[3];for(var v=c[1]+4,g=r.isCubemap?6:1,y=0;y<g;y++)for(var x=r.width,b=r.height,w=0;w<r.mipmapCount;w++){if(p)var _=(M=a(e,v,x,b)).length;else{_=Math.max(4,x)/4*Math.max(4,b)/4*o;var M=new Uint8Array(e,v,_)}var E={data:M,width:x,height:b};r.mipmaps.push(E),v+=_,x=Math.max(x>>1,1),b=Math.max(b>>1,1)}return r};var o=a.DDSLoader;t.default=o},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(19)),o=n(r(0)),s={DRACOLoader:function(e){this.timeLoaded=0,this.manager=e||o.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=o.TrianglesDrawMode,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}}};s.DRACOLoader.prototype={constructor:s.DRACOLoader,load:function(e,t,r,n){var i=this,a=new o.FileLoader(i.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){i.decodeDracoFile(e,t)},r,n)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this},setDrawMode:function(e){return this.drawMode=e,this},setSkipDequantization:function(e,t){var r=!0;return void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r,this},decodeDracoFile:function(e,t,r,n){var i=this;s.DRACOLoader.getDecoderModule().then(function(a){i.decodeDracoFileInternal(e,a.decoder,t,r,n)})},decodeDracoFileInternal:function(e,t,r,n,i){var a=new t.DecoderBuffer;a.Init(new Int8Array(e),e.byteLength);var o=new t.Decoder,s=o.GetEncodedGeometryType(a);if(s==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(s!=t.POINT_CLOUD){var l="threeExamples.DRACOLoader: Unknown geometry type.";throw console.error(l),new Error(l)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,o,s,a,n,i))},addAttributeToGeometry:function(e,t,r,n,i,a,s,l){if(0===a.ptr){var u="threeExamples.DRACOLoader: No attribute "+n;throw console.error(u),new Error(u)}var h,c,d=a.num_components(),f=r.num_points()*d;switch(i){case Float32Array:h=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,a,h),l[n]=new Float32Array(f),c=o.Float32BufferAttribute;break;case Int8Array:h=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,a,h),l[n]=new Int8Array(f),c=o.Int8BufferAttribute;break;case Int16Array:h=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,a,h),l[n]=new Int16Array(f),c=o.Int16BufferAttribute;break;case Int32Array:h=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,a,h),l[n]=new Int32Array(f),c=o.Int32BufferAttribute;break;case Uint8Array:h=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,a,h),l[n]=new Uint8Array(f),c=o.Uint8BufferAttribute;break;case Uint16Array:h=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,a,h),l[n]=new Uint16Array(f),c=o.Uint16BufferAttribute;break;case Uint32Array:h=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,a,h),l[n]=new Uint32Array(f),c=o.Uint32BufferAttribute;break;default:throw u="threeExamples.DRACOLoader: Unexpected attribute type.",console.error(u),new Error(u)}for(var p=0;p<f;p++)l[n][p]=h.GetValue(p);s.addAttribute(n,new c(l[n],d)),e.destroy(h)},convertDracoGeometryTo3JS:function(e,t,r,n,i,a){var s,l;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var u=performance.now();if(r===e.TRIANGULAR_MESH?(s=new e.Mesh,l=t.DecodeBufferToMesh(n,s)):(s=new e.PointCloud,l=t.DecodeBufferToPointCloud(n,s)),!l.ok()||0==s.ptr){var h="threeExamples.DRACOLoader: Decoding failed: ";throw h+=l.error_msg(),console.error(h),e.destroy(t),e.destroy(s),new Error(h)}var c,d=performance.now();e.destroy(n),r==e.TRIANGULAR_MESH?(c=s.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+c.toString())):c=0;var f=s.num_points(),p=s.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+f.toString()),console.log("Number of attributes loaded: "+p.toString()));var m=t.GetAttributeId(s,e.POSITION);if(-1==m)throw h="threeExamples.DRACOLoader: No position attribute found.",console.error(h),e.destroy(t),e.destroy(s),new Error(h);var v=t.GetAttribute(s,m),g={},y=new o.BufferGeometry;if(i)for(var x in i){var b=a[x],w=i[x],_=t.GetAttributeByUniqueId(s,w);this.addAttributeToGeometry(e,t,s,x,b,_,y,g)}else for(var x in this.nativeAttributeMap){var M=t.GetAttributeId(s,e[this.nativeAttributeMap[x]]);-1!==M&&(this.verbosity>0&&console.log("Loaded "+x+" attribute."),_=t.GetAttribute(s,M),this.addAttributeToGeometry(e,t,s,x,Float32Array,_,y,g))}if(r==e.TRIANGULAR_MESH)if(this.drawMode===o.TriangleStripDrawMode){var E=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(s,E),g.indices=new Uint32Array(E.size());for(var S=0;S<E.size();++S)g.indices[S]=E.GetValue(S);e.destroy(E)}else{var T=3*c;g.indices=new Uint32Array(T);var A=new e.DracoInt32Array;for(S=0;S<c;++S){t.GetFaceFromMesh(s,S,A);var L=3*S;g.indices[L]=A.GetValue(0),g.indices[L+1]=A.GetValue(1),g.indices[L+2]=A.GetValue(2)}e.destroy(A)}y.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&y.setIndex(new(g.indices.length>65535?o.Uint32BufferAttribute:o.Uint16BufferAttribute)(g.indices,1));var P=new e.AttributeQuantizationTransform;if(P.InitFromAttribute(v))for(y.attributes.position.isQuantized=!0,y.attributes.position.maxRange=P.range(),y.attributes.position.numQuantizationBits=P.quantization_bits(),y.attributes.position.minValues=new Float32Array(3),S=0;S<3;++S)y.attributes.position.minValues[S]=P.min_value(S);return e.destroy(P),e.destroy(t),e.destroy(s),this.decode_time=d-u,this.import_time=performance.now()-d,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),y},isVersionSupported:function(e,t){s.DRACOLoader.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},s.DRACOLoader.decoderPath="./",s.DRACOLoader.decoderConfig={},s.DRACOLoader.decoderModulePromise=null,s.DRACOLoader.setDecoderPath=function(e){s.DRACOLoader.decoderPath=e},s.DRACOLoader.setDecoderConfig=function(e){var t=s.DRACOLoader.decoderConfig.wasmBinary;s.DRACOLoader.decoderConfig=e||{},s.DRACOLoader.releaseDecoderModule(),t&&(s.DRACOLoader.decoderConfig.wasmBinary=t)},s.DRACOLoader.releaseDecoderModule=function(){s.DRACOLoader.decoderModulePromise=null},s.DRACOLoader.getDecoderModule=function(){var e=this,t=s.DRACOLoader.decoderPath,r=s.DRACOLoader.decoderConfig,n=s.DRACOLoader.decoderModulePromise;return n||("undefined"!=typeof DracoDecoderModule?n=Promise.resolve():"object"!==("undefined"==typeof WebAssembly?"undefined":(0,a.default)(WebAssembly))||"js"===r.type?n=s.DRACOLoader._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",n=s.DRACOLoader._loadScript(t+"draco_wasm_wrapper.js").then(function(){return s.DRACOLoader._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),n=n.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),s.DRACOLoader.decoderModulePromise=n,n)},s.DRACOLoader._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],n=document.createElement("script");return n.id="decoder_script",n.type="text/javascript",n.src=e,new Promise(function(e){n.onload=e,r.appendChild(n)})},s.DRACOLoader._loadArrayBuffer=function(e){var t=new o.FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(r,n){t.load(e,r,void 0,n)})};var l=s.DRACOLoader;t.default=l},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a={};a.BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.position&&void 0!==r.normal&&void 0!==r.uv){var n=t.array,a=r.position.array,o=r.normal.array,s=r.uv.array,l=a.length/3;void 0===r.tangent&&e.addAttribute("tangent",new i.BufferAttribute(new Float32Array(4*l),4));for(var u=r.tangent.array,h=[],c=[],d=0;d<l;d++)h[d]=new i.Vector3,c[d]=new i.Vector3;var f=new i.Vector3,p=new i.Vector3,m=new i.Vector3,v=new i.Vector2,g=new i.Vector2,y=new i.Vector2,x=new i.Vector3,b=new i.Vector3,w=e.groups;0===w.length&&(w=[{start:0,count:n.length}]),d=0;for(var _=w.length;d<_;++d)for(var M=D=(O=w[d]).start,E=D+O.count;M<E;M+=3)I(n[M+0],n[M+1],n[M+2]);var S,T,A,L=new i.Vector3,P=new i.Vector3,C=new i.Vector3,R=new i.Vector3;for(d=0,_=w.length;d<_;++d){var O,D;for(M=D=(O=w[d]).start,E=D+O.count;M<E;M+=3)N(n[M+0]),N(n[M+1]),N(n[M+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function I(e,t,r){f.fromArray(a,3*e),p.fromArray(a,3*t),m.fromArray(a,3*r),v.fromArray(s,2*e),g.fromArray(s,2*t),y.fromArray(s,2*r);var n=p.x-f.x,i=m.x-f.x,o=p.y-f.y,l=m.y-f.y,u=p.z-f.z,d=m.z-f.z,w=g.x-v.x,_=y.x-v.x,M=g.y-v.y,E=y.y-v.y,S=1/(w*E-_*M);x.set((E*n-M*i)*S,(E*o-M*l)*S,(E*u-M*d)*S),b.set((w*i-_*n)*S,(w*l-_*o)*S,(w*d-_*u)*S),h[e].add(x),h[t].add(x),h[r].add(x),c[e].add(b),c[t].add(b),c[r].add(b)}function N(e){C.fromArray(o,3*e),R.copy(C),T=h[e],L.copy(T),L.sub(C.multiplyScalar(C.dot(T))).normalize(),P.crossVectors(R,T),A=P.dot(c[e]),S=A<0?-1:1,u[4*e]=L.x,u[4*e+1]=L.y,u[4*e+2]=L.z,u[4*e+3]=S}},mergeBufferGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),a=new Set(Object.keys(e[0].morphAttributes)),o={},s={},l=new i.BufferGeometry,u=0,h=0;h<e.length;++h){var c=e[h];if(r!==(null!==c.index))return null;for(var d in c.attributes){if(!n.has(d))return null;void 0===o[d]&&(o[d]=[]),o[d].push(c.attributes[d])}for(var d in c.morphAttributes){if(!a.has(d))return null;void 0===s[d]&&(s[d]=[]),s[d].push(c.morphAttributes[d])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(c.userData),t){var f;if(r)f=c.index.count;else{if(void 0===c.attributes.position)return null;f=c.attributes.position.count}l.addGroup(u,f,h),u+=f}}if(r){var p=0,m=[];for(h=0;h<e.length;++h){for(var v=e[h].index,g=0;g<v.count;++g)m.push(v.getX(g)+p);p+=e[h].attributes.position.count}l.setIndex(m)}for(var d in o){var y=this.mergeBufferAttributes(o[d]);if(!y)return null;l.addAttribute(d,y)}for(var d in s){var x=s[d][0].length;if(0===x)break;for(l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[],h=0;h<x;++h){var b=[];for(g=0;g<s[d].length;++g)b.push(s[d][g][h]);var w=this.mergeBufferAttributes(b);if(!w)return null;l.morphAttributes[d].push(w)}}return l},mergeBufferAttributes:function(e){for(var t,r,n,a=0,o=0;o<e.length;++o){var s=e[o];if(s.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return null;if(void 0===r&&(r=s.itemSize),r!==s.itemSize)return null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return null;a+=s.array.length}var l=new t(a),u=0;for(o=0;o<e.length;++o)l.set(e[o].array,u),u+=e[o].array.length;return new i.BufferAttribute(l,r,n)}};var o=a.BufferGeometryUtils;t.default=o},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a={};a.LegacyGLTFLoader=function(){function e(e){this.manager=void 0!==e?e:i.DefaultLoadingManager}function t(e,t){var r={},n=e.material.uniforms;for(var a in n){var o=n[a];if(o.semantic){var s=o.node,l=e;s&&(l=t[s]),r[a]={semantic:o.semantic,sourceNode:l,targetNode:e,uniform:o}}}this.boundUniforms=r,this._m4=new i.Matrix4}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,n){var a,o=this;a=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:i.LoaderUtils.extractUrlBase(e);var s=new i.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(e){o.parse(e,a,t)},r,n)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){this.path=e},setResourcePath:function(e){return this.resourcePath=e,this},parse:function(e,t,a){var s,l={};i.LoaderUtils.decodeText(new Uint8Array(e,0,4))===n.magic?(l[r.KHR_BINARY_GLTF]=new o(e),s=l[r.KHR_BINARY_GLTF].content):s=i.LoaderUtils.decodeText(new Uint8Array(e));var u=JSON.parse(s);u.extensionsUsed&&u.extensionsUsed.indexOf(r.KHR_MATERIALS_COMMON)>=0&&(l[r.KHR_MATERIALS_COMMON]=new function(e){this.name=r.KHR_MATERIALS_COMMON,this.lights={};var t=(e.extensions&&e.extensions[r.KHR_MATERIALS_COMMON]||{}).lights||{};for(var n in t){var a,o=t[n],s=o[o.type],l=(new i.Color).fromArray(s.color);switch(o.type){case"directional":(a=new i.DirectionalLight(l)).position.set(0,0,1);break;case"point":a=new i.PointLight(l);break;case"spot":(a=new i.SpotLight(l)).position.set(0,0,1);break;case"ambient":a=new i.AmbientLight(l)}a&&(this.lights[n]=a)}}(u)),new S(u,l,{crossOrigin:this.crossOrigin,manager:this.manager,path:t||this.resourcePath||""}).parse(function(e,t,r,n){a({scene:e,scenes:t,cameras:r,animations:n})})}},e.Shaders={update:function(){console.warn("threeExamples.LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},t.prototype.update=function(e,t){var r=this.boundUniforms;for(var n in r){var i=r[n];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(t.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var a=i.uniform.value;this._m4.multiplyMatrices(t.matrixWorldInverse,i.sourceNode.matrixWorld),a.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var o=i.uniform.value,s=0;s<o.length;s++)o[s].getInverse(i.sourceNode.matrixWorld).multiply(i.targetNode.skeleton.bones[s].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[s]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},e.Animations={update:function(){console.warn("threeExamples.LegacyGLTFLoader.Animation has been deprecated. Use THREE.AnimationMixer instead.")}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"},n={magic:"glTF",version:1,contentFormat:0},a=20;function o(e){this.name=r.KHR_BINARY_GLTF;var t=new DataView(e,0,a),o={magic:i.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0),contentLength:t.getUint32(12,!0),contentFormat:t.getUint32(16,!0)};for(var s in n){var l=n[s];if(o[s]!==l)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',s,l)}var u=new Uint8Array(e,a,o.contentLength);this.header=o,this.content=i.LoaderUtils.decodeText(u),this.body=e.slice(a+o.contentLength,o.length)}o.prototype.loadShader=function(e,t){var n=t[e.extensions[r.KHR_BINARY_GLTF].bufferView],a=new Uint8Array(n);return i.LoaderUtils.decodeText(a)};var s={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},l={5126:Number,35675:i.Matrix3,35676:i.Matrix4,35664:i.Vector2,35665:i.Vector3,35666:i.Vector4,35678:i.Texture},u={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},h={9728:i.NearestFilter,9729:i.LinearFilter,9984:i.NearestMipMapNearestFilter,9985:i.LinearMipMapNearestFilter,9986:i.NearestMipMapLinearFilter,9987:i.LinearMipMapLinearFilter},c={33071:i.ClampToEdgeWrapping,33648:i.MirroredRepeatWrapping,10497:i.RepeatWrapping},d={6406:i.AlphaFormat,6407:i.RGBFormat,6408:i.RGBAFormat,6409:i.LuminanceFormat,6410:i.LuminanceAlphaFormat},f={5121:i.UnsignedByteType,32819:i.UnsignedShort4444Type,32820:i.UnsignedShort5551Type,33635:i.UnsignedShort565Type},p={1028:i.BackSide,1029:i.FrontSide},m={512:i.NeverDepth,513:i.LessDepth,514:i.EqualDepth,515:i.LessEqualDepth,516:i.GreaterEqualDepth,517:i.NotEqualDepth,518:i.GreaterEqualDepth,519:i.AlwaysDepth},v={32774:i.AddEquation,32778:i.SubtractEquation,32779:i.ReverseSubtractEquation},g={0:i.ZeroFactor,1:i.OneFactor,768:i.SrcColorFactor,769:i.OneMinusSrcColorFactor,770:i.SrcAlphaFactor,771:i.OneMinusSrcAlphaFactor,772:i.DstAlphaFactor,773:i.OneMinusDstAlphaFactor,774:i.DstColorFactor,775:i.OneMinusDstColorFactor,776:i.SrcAlphaSaturateFactor},y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},x={scale:"scale",translation:"position",rotation:"quaternion"},b={LINEAR:i.InterpolateLinear,STEP:i.InterpolateDiscrete},w={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function _(e,t,r){if(!e)return Promise.resolve();var n,i=[];if("[object Array]"===Object.prototype.toString.call(e)){n=[];for(var a=e.length,o=0;o<a;o++)(l=t.call(r||this,e[o],o))&&(i.push(l),l instanceof Promise?l.then(function(e,t){n[e]=t}.bind(this,o)):n[o]=l)}else for(var s in n={},e){var l;e.hasOwnProperty(s)&&(l=t.call(r||this,e[s],s))&&(i.push(l),l instanceof Promise?l.then(function(e,t){n[e]=t}.bind(this,s)):n[s]=l)}return Promise.all(i).then(function(){return n})}function M(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:(t||"")+e}function E(e){this.isDeferredShaderMaterial=!0,this.params=e}function S(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}},update:function(t,r){for(var n in e){var i=e[n];i.update&&i.update(t,r)}}}}}return E.prototype.create=function(){var e=i.UniformsUtils.clone(this.params.uniforms);for(var t in this.params.uniforms){var r=this.params.uniforms[t];r.value instanceof i.Texture&&(e[t].value=r.value,e[t].value.needsUpdate=!0),e[t].semantic=r.semantic,e[t].node=r.node}return this.params.uniforms=e,new i.RawShaderMaterial(this.params)},S.prototype._withDependencies=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i="load"+n.charAt(0).toUpperCase()+n.slice(1),a=this.cache.get(n);if(void 0!==a)t[n]=a;else if(this[i]){var o=this[i]();this.cache.add(n,o),t[n]=o}}return _(t,function(e){return e})},S.prototype.parse=function(e){var t=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(r){var n=[];for(var i in r.scenes)n.push(r.scenes[i]);var a=void 0!==t.scene?r.scenes[t.scene]:n[0],o=[];for(var i in r.cameras){var s=r.cameras[i];o.push(s)}var l=[];for(var i in r.animations)l.push(r.animations[i]);e(a,n,o,l)})},S.prototype.loadShaders=function(){var e=this.json,t=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then(function(a){return _(e.shaders,function(e){return e.extensions&&e.extensions[r.KHR_BINARY_GLTF]?t[r.KHR_BINARY_GLTF].loadShader(e,a.bufferViews):new Promise(function(t){var r=new i.FileLoader(n.manager);r.setResponseType("text"),r.load(M(e.uri,n.path),function(e){t(e)})})})})},S.prototype.loadBuffers=function(){var e=this.json,t=this.extensions,n=this.options;return _(e.buffers,function(e,a){return"binary_glTF"===a?t[r.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise(function(t){var r=new i.FileLoader(n.manager);r.setResponseType("arraybuffer"),r.load(M(e.uri,n.path),function(e){t(e)})}):void console.warn("threeExamples.LegacyGLTFLoader: "+e.type+" buffer type is not supported")})},S.prototype.loadBufferViews=function(){var e=this.json;return this._withDependencies(["buffers"]).then(function(t){return _(e.bufferViews,function(e){var r=t.buffers[e.buffer],n=void 0!==e.byteLength?e.byteLength:0;return r.slice(e.byteOffset,e.byteOffset+n)})})},S.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then(function(t){return _(e.accessors,function(e){var r=t.bufferViews[e.bufferView],n=y[e.type],a=u[e.componentType],o=a.BYTES_PER_ELEMENT;if(e.byteStride&&e.byteStride!==o*n){var s=new a(r),l=new i.InterleavedBuffer(s,e.byteStride/o);return new i.InterleavedBufferAttribute(l,n,e.byteOffset/o)}return s=new a(r,e.byteOffset,e.count*n),new i.BufferAttribute(s,n)})})},S.prototype.loadTextures=function(){var e=this.json;this.extensions;var t=this.options;return this._withDependencies(["bufferViews"]).then(function(n){return _(e.textures,function(a){if(a.source)return new Promise(function(o){var s=e.images[a.source],l=s.uri,u=!1;if(s.extensions&&s.extensions[r.KHR_BINARY_GLTF]){var p=s.extensions[r.KHR_BINARY_GLTF],m=n.bufferViews[p.bufferView],v=new Blob([m],{type:p.mimeType});l=URL.createObjectURL(v),u=!0}var g=i.Loader.Handlers.get(l);null===g&&(g=new i.TextureLoader(t.manager)),g.setCrossOrigin(t.crossOrigin),g.load(M(l,t.path),function(t){if(u&&URL.revokeObjectURL(l),t.flipY=!1,void 0!==a.name&&(t.name=a.name),t.format=void 0!==a.format?d[a.format]:i.RGBAFormat,void 0!==a.internalFormat&&t.format!==d[a.internalFormat]&&console.warn("threeExamples.LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==a.type?f[a.type]:i.UnsignedByteType,a.sampler){var r=e.samplers[a.sampler];t.magFilter=h[r.magFilter]||i.LinearFilter,t.minFilter=h[r.minFilter]||i.NearestMipMapLinearFilter,t.wrapS=c[r.wrapS]||i.RepeatWrapping,t.wrapT=c[r.wrapT]||i.RepeatWrapping}o(t)},void 0,function(){u&&URL.revokeObjectURL(l),o()})})})})},S.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then(function(t){return _(e.materials,function(n){var a,o,u={},h={};if(n.extensions&&n.extensions[r.KHR_MATERIALS_COMMON]&&(o=n.extensions[r.KHR_MATERIALS_COMMON]),o){var c=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":a=i.MeshPhongMaterial,c.push("diffuse","specular","shininess");break;case"LAMBERT":a=i.MeshLambertMaterial,c.push("diffuse");break;case"CONSTANT":default:a=i.MeshBasicMaterial}c.forEach(function(e){void 0!==o.values[e]&&(u[e]=o.values[e])}),(o.doubleSided||u.doubleSided)&&(h.side=i.DoubleSide),(o.transparent||u.transparent)&&(h.transparent=!0,h.opacity=void 0!==u.transparency?u.transparency:1)}else if(void 0===n.technique)a=i.MeshPhongMaterial,Object.assign(u,n.values);else{a=E;var d=e.techniques[n.technique];h.uniforms={};var f=e.programs[d.program];if(f){h.fragmentShader=t.shaders[f.fragmentShader],h.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",f.fragmentShader),a=i.MeshPhongMaterial);var y=t.shaders[f.vertexShader];y||(console.warn("ERROR: Missing vertex shader definition:",f.vertexShader),a=i.MeshPhongMaterial),h.vertexShader=function(e,t){var r={};for(var n in t.attributes){var i=t.attributes[n],a=(c=t.parameters[i]).type,o=c.semantic;r[n]={type:a,semantic:o}}var s=t.parameters,l=t.attributes,u={};for(var n in r){var h=s[i=l[n]];(o=h.semantic)&&(u[n]=h)}for(var i in u){o=(c=u[i]).semantic;var c,d=new RegExp("\\b"+i+"\\b","g");switch(o){case"POSITION":e=e.replace(d,"position");break;case"NORMAL":e=e.replace(d,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(d,"uv");break;case"TEXCOORD_1":e=e.replace(d,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":e=e.replace(d,"color");break;case"WEIGHT":e=e.replace(d,"skinWeight");break;case"JOINT":e=e.replace(d,"skinIndex")}}return e}(y,d);var x=d.uniforms;for(var b in x){var _=x[b],M=d.parameters[_],S=M.type;if(!l[S])throw new Error("Unknown shader uniform param type: "+S);var T,A=M.count;void 0!==n.values&&(T=n.values[_]);var L=new l[S],P=M.semantic,C=M.node;switch(S){case s.FLOAT:L=M.value,"transparency"==_&&(h.transparent=!0),void 0!==T&&(L=T);break;case s.FLOAT_VEC2:case s.FLOAT_VEC3:case s.FLOAT_VEC4:case s.FLOAT_MAT3:M&&M.value&&L.fromArray(M.value),T&&L.fromArray(T);break;case s.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case s.FLOAT_MAT4:if(A){L=new Array(A);for(var R=0;R<A;R++)L[R]=new l[S];if(M&&M.value){var O=M.value;L.fromArray(O)}T&&L.fromArray(T)}else{if(M&&M.value){var D=M.value;L.fromArray(D)}T&&L.fromArray(T)}break;case s.SAMPLER_2D:L=void 0!==T?t.textures[T]:void 0!==M.value?t.textures[M.value]:null}h.uniforms[b]={value:L,semantic:P,node:C}}for(var I=d.states||{},N=I.enable||[],F=I.functions||{},U=!1,k=!1,B=!1,z=0,G=N.length;z<G;z++){var j=N[z];switch(w[j]){case"CULL_FACE":U=!0;break;case"DEPTH_TEST":k=!0;break;case"BLEND":B=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+j)}}h.side=U?void 0!==F.cullFace?p[F.cullFace]:i.FrontSide:i.DoubleSide,h.depthTest=k,h.depthFunc=void 0!==F.depthFunc?m[F.depthFunc]:i.LessDepth,h.depthWrite=void 0===F.depthMask||F.depthMask[0],h.blending=B?i.CustomBlending:i.NoBlending,h.transparent=B;var V=F.blendEquationSeparate;void 0!==V?(h.blendEquation=v[V[0]],h.blendEquationAlpha=v[V[1]]):(h.blendEquation=i.AddEquation,h.blendEquationAlpha=i.AddEquation);var H=F.blendFuncSeparate;void 0!==H?(h.blendSrc=g[H[0]],h.blendDst=g[H[1]],h.blendSrcAlpha=g[H[2]],h.blendDstAlpha=g[H[3]]):(h.blendSrc=i.OneFactor,h.blendDst=i.ZeroFactor,h.blendSrcAlpha=i.OneFactor,h.blendDstAlpha=i.ZeroFactor)}}Array.isArray(u.diffuse)?h.color=(new i.Color).fromArray(u.diffuse):"string"==typeof u.diffuse&&(h.map=t.textures[u.diffuse]),delete h.diffuse,"string"==typeof u.reflective&&(h.envMap=t.textures[u.reflective]),"string"==typeof u.bump&&(h.bumpMap=t.textures[u.bump]),Array.isArray(u.emission)?a===i.MeshBasicMaterial?h.color=(new i.Color).fromArray(u.emission):h.emissive=(new i.Color).fromArray(u.emission):"string"==typeof u.emission&&(a===i.MeshBasicMaterial?h.map=t.textures[u.emission]:h.emissiveMap=t.textures[u.emission]),Array.isArray(u.specular)?h.specular=(new i.Color).fromArray(u.specular):"string"==typeof u.specular&&(h.specularMap=t.textures[u.specular]),void 0!==u.shininess&&(h.shininess=u.shininess);var W=new a(h);return void 0!==n.name&&(W.name=n.name),W})})},S.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then(function(t){return _(e.meshes,function(r){var n=new i.Group;void 0!==r.name&&(n.name=r.name),r.extras&&(n.userData=r.extras);var a=r.primitives||[];for(var o in a){var l=a[o];if(l.mode===s.TRIANGLES||void 0===l.mode){var u=new i.BufferGeometry,h=l.attributes;for(var c in h){if(!(v=h[c]))return;var d=t.accessors[v];switch(c){case"POSITION":u.addAttribute("position",d);break;case"NORMAL":u.addAttribute("normal",d);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":u.addAttribute("uv",d);break;case"TEXCOORD_1":u.addAttribute("uv2",d);break;case"COLOR_0":case"COLOR0":case"COLOR":u.addAttribute("color",d);break;case"WEIGHT":u.addAttribute("skinWeight",d);break;case"JOINT":u.addAttribute("skinIndex",d);break;case"_BATCHID":u.addAttribute("_BATCHID",d);break;default:if(!l.material)break;if(!(m=e.materials[l.material]).technique)break;var f=e.techniques[m.technique].parameters||{};for(var p in f)f[p].semantic===c&&u.addAttribute(p,d)}}l.indices&&u.setIndex(t.accessors[l.indices]);var m=void 0!==t.materials?t.materials[l.material]:new i.MeshPhongMaterial({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:i.FrontSide});(g=new i.Mesh(u,m)).castShadow=!0,g.name="0"===o?n.name:n.name+o,l.extras&&(g.userData=l.extras),n.add(g)}else if(l.mode===s.LINES){for(var c in u=new i.BufferGeometry,h=l.attributes){var v;if(!(v=h[c]))return;switch(d=t.accessors[v],c){case"POSITION":u.addAttribute("position",d);break;case"COLOR_0":case"COLOR0":case"COLOR":u.addAttribute("color",d)}}var g;m=t.materials[l.material],l.indices?(u.setIndex(t.accessors[l.indices]),g=new i.LineSegments(u,m)):g=new i.Line(u,m),g.name="0"===o?n.name:n.name+o,l.extras&&(g.userData=l.extras),n.add(g)}else console.warn("Only triangular and line primitives are supported")}return n})})},S.prototype.loadCameras=function(){return _(this.json.cameras,function(e){if("perspective"==e.type&&e.perspective){var t=e.perspective.yfov,r=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,n=new i.PerspectiveCamera(i.Math.radToDeg(t*r),r,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}if("orthographic"==e.type&&e.orthographic)return n=new i.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar),void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n})},S.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then(function(t){return _(e.skins,function(e){var r=new i.Matrix4;return void 0!==e.bindShapeMatrix&&r.fromArray(e.bindShapeMatrix),{bindShapeMatrix:r,jointNames:e.jointNames,inverseBindMatrices:t.accessors[e.inverseBindMatrices]}})})},S.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then(function(t){return _(e.animations,function(e,r){var n=[];for(var a in e.channels){var o=e.channels[a],s=e.samplers[o.sampler];if(s){var l=o.target,u=l.id,h=void 0!==e.parameters?e.parameters[s.input]:s.input,c=void 0!==e.parameters?e.parameters[s.output]:s.output,d=t.accessors[h],f=t.accessors[c],p=t.nodes[u];if(p){p.updateMatrix(),p.matrixAutoUpdate=!0;var m=x[l.path]===x.rotation?i.QuaternionKeyframeTrack:i.VectorKeyframeTrack,v=p.name?p.name:p.uuid,g=void 0!==s.interpolation?b[s.interpolation]:i.InterpolateLinear;n.push(new m(v+"."+x[l.path],i.AnimationUtils.arraySlice(d.array,0),i.AnimationUtils.arraySlice(f.array,0),g))}}}return u=void 0!==e.name?e.name:"animation_"+r,new i.AnimationClip(u,void 0,n)})})},S.prototype.loadNodes=function(){var e=this.json,t=this.extensions,n=this;return _(e.nodes,function(e){var t,r=new i.Matrix4;return e.jointName?((t=new i.Bone).name=void 0!==e.name?e.name:e.jointName,t.jointName=e.jointName):(t=new i.Object3D,void 0!==e.name&&(t.name=e.name)),e.extras&&(t.userData=e.extras),void 0!==e.matrix?(r.fromArray(e.matrix),t.applyMatrix(r)):(void 0!==e.translation&&t.position.fromArray(e.translation),void 0!==e.rotation&&t.quaternion.fromArray(e.rotation),void 0!==e.scale&&t.scale.fromArray(e.scale)),t}).then(function(a){return n._withDependencies(["meshes","skins","cameras"]).then(function(n){return _(a,function(o,s){var l=e.nodes[s];if(void 0!==l.meshes)for(var u in l.meshes){var h=l.meshes[u],c=n.meshes[h];if(void 0!==c)for(var d in c.children){var f,p=c.children[d],m=p.material,v=p.geometry,g=p.userData,y=p.name;switch(m.isDeferredShaderMaterial?m=x=m.create():x=m,p.type){case"LineSegments":p=new i.LineSegments(v,x);break;case"LineLoop":p=new i.LineLoop(v,x);break;case"Line":p=new i.Line(v,x);break;default:p=new i.Mesh(v,x)}if(p.castShadow=!0,p.userData=g,p.name=y,l.skin&&(f=n.skins[l.skin]),f){var x,b=function(e){for(var t=Object.keys(a),r=0,n=t.length;r<n;r++){var i=a[t[r]];if(i.jointName===e)return i}return null};(x=m).skinning=!0,(p=new i.SkinnedMesh(v,x)).castShadow=!0,p.userData=g,p.name=y;for(var w=[],_=[],M=0,E=f.jointNames.length;M<E;M++){var S=f.jointNames[M],T=b(S);if(T){w.push(T);var A=f.inverseBindMatrices.array,L=(new i.Matrix4).fromArray(A,16*M);_.push(L)}else console.warn("WARNING: joint: '"+S+"' could not be found")}p.bind(new i.Skeleton(w,_),f.bindShapeMatrix);var P=function(t,r,n){var i=t[n];if(void 0!==i)for(var o=0,s=i.length;o<s;o++){var l=i[o],u=a[l],h=e.nodes[l];void 0!==u&&!0===u.isBone&&void 0!==h&&(r.add(u),P(h,u,"children"))}};P(l,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+h+'".')}if(void 0!==l.camera){var C=n.cameras[l.camera];o.add(C)}if(l.extensions&&l.extensions[r.KHR_MATERIALS_COMMON]&&l.extensions[r.KHR_MATERIALS_COMMON].light){var R=t[r.KHR_MATERIALS_COMMON].lights[l.extensions[r.KHR_MATERIALS_COMMON].light];o.add(R)}return o})})})},S.prototype.loadScenes=function(){var e=this.json;function r(t,n,i){var a=i[t];n.add(a);var o=e.nodes[t];if(o.children)for(var s=o.children,l=0,u=s.length;l<u;l++)r(s[l],a,i)}return this._withDependencies(["nodes"]).then(function(n){return _(e.scenes,function(e){var a=new i.Scene;void 0!==e.name&&(a.name=e.name),e.extras&&(a.userData=e.extras);for(var o=e.nodes||[],s=0,l=o.length;s<l;s++)r(o[s],a,n.nodes);return a.traverse(function(e){e.material&&e.material.isRawShaderMaterial&&(e.gltfShader=new t(e,n.nodes),e.onBeforeRender=function(e,t,r){this.gltfShader.update(t,r)})}),a})})},e}();var o=a.LegacyGLTFLoader;t.default=o},function(e,t,r){"use strict";function n(e,t,r){return t<=e&&e<=r}function i(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}r.r(t),r.d(t,"TextEncoder",function(){return h}),r.d(t,"TextDecoder",function(){return u});function a(e){this.tokens=[].slice.call(e)}a.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():-1},prepend:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.unshift(t.pop());else this.tokens.unshift(e)},push:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.push(t.shift());else this.tokens.push(e)}};var o=-1;function s(e,t){if(e)throw TypeError("Decoder error");return t||65533}var l="utf-8";function u(e,t){if(!(this instanceof u))return new u(e,t);if((e=void 0!==e?String(e).toLowerCase():l)!==l)throw new Error("Encoding not supported. Only utf-8 is supported");t=i(t),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(t.fatal),this._ignoreBOM=Boolean(t.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function h(e,t){if(!(this instanceof h))return new h(e,t);if((e=void 0!==e?String(e).toLowerCase():l)!==l)throw new Error("Encoding not supported. Only utf-8 is supported");t=i(t),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(t.fatal)},Object.defineProperty(this,"encoding",{value:"utf-8"})}u.prototype={decode:function(e,t){var r;r="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t=i(t),this._streaming||(this._decoder=new function(e){var t=e.fatal,r=0,i=0,a=0,l=128,u=191;this.handler=function(e,h){if(-1===h&&0!==a)return a=0,s(t);if(-1===h)return o;if(0===a){if(n(h,0,127))return h;if(n(h,194,223))a=1,r=h-192;else if(n(h,224,239))224===h&&(l=160),237===h&&(u=159),a=2,r=h-224;else{if(!n(h,240,244))return s(t);240===h&&(l=144),244===h&&(u=143),a=3,r=h-240}return r<<=6*a,null}if(!n(h,l,u))return r=a=i=0,l=128,u=191,e.prepend(h),s(t);if(l=128,u=191,r+=h-128<<6*(a-(i+=1)),i!==a)return null;var c=r;return r=a=i=0,c}}({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(t.stream);for(var l,u=new a(r),h=[];!u.endOfStream()&&(l=this._decoder.handler(u,u.read()))!==o;)null!==l&&(Array.isArray(l)?h.push.apply(h,l):h.push(l));if(!this._streaming){do{if((l=this._decoder.handler(u,u.read()))===o)break;null!==l&&(Array.isArray(l)?h.push.apply(h,l):h.push(l))}while(!u.endOfStream());this._decoder=null}return h.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===h[0]?(this._BOMseen=!0,h.shift()):this._BOMseen=!0)),function(e){for(var t="",r=0;r<e.length;++r){var n=e[r];n<=65535?t+=String.fromCharCode(n):(n-=65536,t+=String.fromCharCode(55296+(n>>10),56320+(1023&n)))}return t}(h)}},h.prototype={encode:function(e,t){e=e?String(e):"",t=i(t),this._streaming||(this._encoder=new function(e){e.fatal,this.handler=function(e,t){if(-1===t)return o;if(n(t,0,127))return t;var r,i;n(t,128,2047)?(r=1,i=192):n(t,2048,65535)?(r=2,i=224):n(t,65536,1114111)&&(r=3,i=240);for(var a=[(t>>6*r)+i];r>0;){var s=t>>6*(r-1);a.push(128|63&s),r-=1}return a}}(this._options)),this._streaming=Boolean(t.stream);for(var r,s=[],l=new a(function(e){for(var t=String(e),r=t.length,n=0,i=[];n<r;){var a=t.charCodeAt(n);if(a<55296||a>57343)i.push(a);else if(56320<=a&&a<=57343)i.push(65533);else if(55296<=a&&a<=56319)if(n===r-1)i.push(65533);else{var o=e.charCodeAt(n+1);if(56320<=o&&o<=57343){var s=1023&a,l=1023&o;i.push(65536+(s<<10)+l),n+=1}else i.push(65533)}n+=1}return i}(e));!l.endOfStream()&&(r=this._encoder.handler(l,l.read()))!==o;)Array.isArray(r)?s.push.apply(s,r):s.push(r);if(!this._streaming){for(;(r=this._encoder.handler(l,l.read()))!==o;)Array.isArray(r)?s.push.apply(s,r):s.push(r);this._encoder=null}return new Uint8Array(s)}}},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(28)),s=n(r(54)),l={parse:function(e){if(!e)throw new Error("No array buffer provided.");var t=new DataView(e),r=0,n={},i={},l={};if(n.magic=o.default.decode(new Uint8Array(e,r,4)),r+=4,n.magic){if(n.version=t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,n.byteLength=t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,n.FTJSONLength=t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,n.FTBinaryLength=t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,n.BTJSONLength=t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,n.BTBinaryLength=t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,n.FTBinaryLength>0&&(l=function(e,t,r){var n,i=new a.BufferGeometry,s=o.default.decode(new Uint8Array(e,t,r)),l=JSON.parse(s);if(l.POINTS_LENGTH&&(n=l.POINTS_LENGTH),l.POSITION){var u=l.POSITION.byteOffset+s.length+t,h=new Float32Array(e,u,3*n);i.addAttribute("position",new a.BufferAttribute(h,3))}if(l.RGB){var c=l.RGB.byteOffset+s.length+t,d=new Uint8Array(e,c,3*n);i.addAttribute("color",new a.BufferAttribute(d,3,!0))}if(l.POSITION_QUANTIZED)throw new Error("For pnts loader, POSITION_QUANTIZED: not yet managed");if(l.RGBA)throw new Error("For pnts loader, RGBA: not yet managed");if(l.RGB565)throw new Error("For pnts loader, RGB565: not yet managed");if(l.NORMAL)throw new Error("For pnts loader, NORMAL: not yet managed");if(l.NORMAL_OCT16P)throw new Error("For pnts loader, NORMAL_OCT16P: not yet managed");if(l.BATCH_ID)throw new Error("For pnts loader, BATCH_ID: not yet managed");return{geometry:i,offset:l.RTC_CENTER?(new a.Vector3).fromArray(l.RTC_CENTER):void 0}}(e,r,n.FTJSONLength)),n.BTJSONLength>0){var u=28+n.FTJSONLength+n.FTBinaryLength;i=s.default.parse(e.slice(u,n.BTJSONLength+u))}var h={point:l,batchTable:i};return Promise.resolve(h)}throw new Error("Invalid pnts file.")}};t.default=l},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.getObjectToUpdateForAttachedLayers=v,t._testing=t.default=void 0;var a=i(r(0)),o=n(r(18)),s=n(r(59)),l=n(r(109)),u=n(r(110)),h=i(r(60)),c=n(r(25)),d=n(r(9));function f(e,t,r){return o.default.arrayBuffer("".concat(r.baseurl,"/r").concat(r.name,".hrc"),e.fetchOptions).then(function(n){var i,o,s,l,u,h,c,d,f,p,m=new DataView(n),v=[],g=0;for(r.childrenBitField=m.getUint8(0),g+=1,r.numPoints=m.getUint32(1,!0),g+=4,r.children=[],v.push(r);v.length&&g<n.byteLength;)for(var y=v.shift(),x=0;x<8;x++)if(y.childrenBitField&1<<x&&g+5<=n.byteLength){var b=m.getUint8(g);g+=1;var w=m.getUint32(g,!0);g+=4,0==w&&(w=r.numPoints);var _=y.name+x,M=(o=x,s=void 0,l=void 0,s=(i=y.bbox).min,l=i.max,u=(new a.Vector3).copy(l).sub(s).multiplyScalar(.5),h=new a.Vector3(u.x,0,0),c=new a.Vector3(0,u.y,0),d=new a.Vector3(0,0,u.z),f=s,p=(new a.Vector3).add(s).add(u),1===o?(s=(new a.Vector3).copy(f).add(d),l=(new a.Vector3).copy(p).add(d)):3===o?(s=(new a.Vector3).copy(f).add(d).add(c),l=(new a.Vector3).copy(p).add(d).add(c)):0===o?(s=f,l=p):2===o?(s=(new a.Vector3).copy(f).add(c),l=(new a.Vector3).copy(p).add(c)):5===o?(s=(new a.Vector3).copy(f).add(d).add(h),l=(new a.Vector3).copy(p).add(d).add(h)):7===o?(s=(new a.Vector3).copy(f).add(u),l=(new a.Vector3).copy(p).add(u)):4===o?(s=(new a.Vector3).copy(f).add(h),l=(new a.Vector3).copy(p).add(h)):6===o&&(s=(new a.Vector3).copy(f).add(h).add(c),l=(new a.Vector3).copy(p).add(h).add(c)),new a.Box3(s,l)),E=r.baseurl;if(_.length%t==0){var S=_.substr(r.name.length);E="".concat(r.baseurl,"/").concat(S)}var T={numPoints:w,childrenBitField:b,children:[],name:_,baseurl:E,bbox:M,layer:e,parent:y};y.children.push(T),v.push(T)}return r})}var p=1;function m(e,t){t.metadata=e;var r=!0;if(null!=t.metadata.scale){t.isFromPotreeConverter=!0,r="CIN"===t.metadata.pointAttributes;var n=Array.isArray(t.metadata.pointAttributes)&&t.metadata.pointAttributes.find(function(e){return e.startsWith("NORMAL")});n&&(t.material.defines[n]=1)}else t.metadata.scale=1,t.metadata.octreeDir="itowns/".concat(t.table,".points"),t.metadata.hierarchyStepSize=1e6,r=!0;t.parse=r?u.default.parse:l.default.parse,t.extension=r?"cin":"bin",t.supportsProgressiveDisplay=r}function v(e){if(e.obj){var t=e.parent;return t&&t.obj?{element:e.obj,parent:t.obj}:{element:e.obj}}}var g={preprocessDataLayer:function(e,t){return e.file||(e.file="cloud.js"),e.group||(e.group=new a.Group,e.object3d.add(e.group),e.group.updateMatrixWorld()),e.bboxes||(e.bboxes=new a.Group,e.object3d.add(e.bboxes),e.bboxes.updateMatrixWorld(),e.bboxes.visible=!1),e.fetchOptions=e.fetchOptions||{},e.octreeDepthLimit=e.octreeDepthLimit||-1,e.pointBudget=e.pointBudget||2e6,e.pointSize=0!==e.pointSize&&isNaN(e.pointSize)?4:e.pointSize,e.sseThreshold=e.sseThreshold||2,e.material=e.material||{},e.material=e.material.isMaterial?e.material:new h.default(e.material),e.material.defines=e.material.defines||{},e.mode=h.MODE.COLOR,e.preUpdate=s.default.preUpdate,e.update=s.default.update,e.postUpdate=s.default.postUpdate,e.getObjectToUpdateForAttachedLayers=v,e.pickObjectsAt=function(t,r,n){return c.default.pickPointsAt(t,r,n,e)},o.default.json("".concat(e.url,"/").concat(e.file),e.fetchOptions).then(function(t){m(t,e);var r=function(e){var t;if(e.isFromPotreeConverter)t=new a.Box3(new a.Vector3(e.metadata.boundingBox.lx,e.metadata.boundingBox.ly,e.metadata.boundingBox.lz),new a.Vector3(e.metadata.boundingBox.ux,e.metadata.boundingBox.uy,e.metadata.boundingBox.uz));else{var r=0,n=!0,i=!1,o=void 0;try{for(var s,l=e.metadata[Symbol.iterator]();!(n=(s=l.next()).done)&&s.value.table!=e.table;n=!0)r++}catch(e){i=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}t=new a.Box3(new a.Vector3(e.metadata[r].bbox.xmin,e.metadata[r].bbox.ymin,e.metadata[r].bbox.zmin),new a.Vector3(e.metadata[r].bbox.xmax,e.metadata[r].bbox.ymax,e.metadata[r].bbox.zmax))}return t}(e);return f(e,e.metadata.hierarchyStepSize,{baseurl:"".concat(e.url,"/").concat(e.metadata.octreeDir,"/r"),name:"",bbox:r})}).then(function(r){return console.log("LAYER metadata:",r),e.root=r,r.findChildrenByName=function e(t,r){if(t.name===r)return t;for(var n=t.name.length,i=0;i<t.children.length;i++)if(t.children[i].name[n]==r[n])return e(t.children[i],r);throw new Error("Cannot find node with name '".concat(r,"'"))}.bind(r,r),e.extent=d.default.fromBox3(t.referenceCrs,r.bbox),e})},executeCommand:function(e){var t=e.layer,r=e.requester;r.childrenBitField&&0===r.children.length&&f(t,t.metadata.hierarchyStepSize,r).then(function(){return e.view.notifyChange(t,!1)});var n="".concat(r.baseurl,"/r").concat(r.name,".").concat(t.extension,"?isleaf=").concat(e.isLeaf?1:0);return o.default.arrayBuffer(n,t.fetchOptions).then(function(e){return t.parse(e,t.metadata.pointAttributes)}).then(function(n){var i=new a.Points(n,t.material.clone());return function(e){var t=e.geometry.attributes.position.count,r=new Uint8Array(4*t),n=p++;if(t>65535||n>65535)return console.warn("Currently picking is limited to Points with less than 65535 elements and less than 65535 Points instances"),e;for(var i=0;i<t;i++){var o=n<<16|i;r[4*i+0]=(4278190080&o)>>24,r[4*i+1]=(16711680&o)>>16,r[4*i+2]=(65280&o)>>8,r[4*i+3]=(255&o)>>0}e.baseId=n,e.geometry.addAttribute("unique_id",new a.BufferAttribute(r,4,!0))}(i),i.frustumCulled=!1,i.matrixAutoUpdate=!1,i.position.copy(r.bbox.min),i.scale.set(t.metadata.scale,t.metadata.scale,t.metadata.scale),i.updateMatrix(),i.tightbbox=n.boundingBox.applyMatrix4(i.matrix),i.layers.set(t.threejsLayer),i.layer=t,i.extent=d.default.fromBox3(e.view.referenceCrs,r.bbox),i.userData.metadata=r,i})}};t.default=g;var y={parseMetadata:m};t._testing=y},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;for(var i=n(r(0)),a={POSITION_CARTESIAN:{numElements:3,arrayType:Float32Array,attributeName:"position"},COLOR_PACKED:{numElements:4,arrayType:Uint8Array,attributeName:"color",normalized:!0},INTENSITY:{numElements:1,numByte:2,arrayType:Float32Array,attributeName:"intensity",normalized:!0},CLASSIFICATION:{numElements:1,arrayType:Uint8Array,attributeName:"classification"},NORMAL_SPHEREMAPPED:{numElements:2,arrayType:Uint8Array,attributeName:"sphereMappedNormal"},NORMAL_OCT16:{numElements:2,arrayType:Uint8Array,attributeName:"oct16Normal"},NORMAL:{numElements:3,arrayType:Float32Array,attributeName:"normal"}},o=Object.keys(a),s=function(){var e=o[l],t=a[e];t.potreeName=e,t.numByte=t.numByte||t.arrayType.BYTES_PER_ELEMENT,t.byteSize=t.numElements*t.numByte,t.normalized=t.normalized||!1;var r="getUint".concat(8*t.numByte);t.getValue=1===t.numByte?function(e,t){return e[r](t)}:function(e,t){return e[r](t,!0)}},l=0;l<o.length;l++)s();var u={parse:function(e,t){if(!e)throw new Error("No array buffer provided.");var r=new DataView(e),n=0,o=!0,s=!1,l=void 0;try{for(var u,h=t[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var c=u.value;n+=a[c].byteSize}}catch(e){s=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(s)throw l}}var d=Math.floor(e.byteLength/n),f=new i.BufferGeometry,p=0,m=0,v=!0,g=!1,y=void 0;try{for(var x,b=t[Symbol.iterator]();!(v=(x=b.next()).done);v=!0){for(var w=x.value,_=a[w],M=_.numElements*d,E=new _.arrayType(M),S=0;S<M;S+=_.numElements){for(var T=0;T<_.numElements;T++)E[S+T]=_.getValue(r,m+T*_.numByte);m+=n}m=p+=_.byteSize,f.addAttribute(_.attributeName,new i.BufferAttribute(E,_.numElements,_.normalized))}}catch(e){g=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(g)throw y}}return f.computeBoundingBox(),Promise.resolve(f)}};t.default=u},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a={parse:function(e){if(!e)throw new Error("No array buffer provided.");var t=new DataView(e,0,24),r=new i.Vector3(t.getFloat32(0,!0),t.getFloat32(4,!0),t.getFloat32(8,!0)),n=new i.Vector3(t.getFloat32(12,!0),t.getFloat32(16,!0),t.getFloat32(20,!0)),a=new i.Box3(r,n),o=Math.floor((e.byteLength-24)/16),s=new Float32Array(e,24,3*o),l=new Uint8Array(e,24+12*o,4*o),u=new i.BufferGeometry;return u.addAttribute("position",new i.BufferAttribute(s,3)),u.addAttribute("color",new i.BufferAttribute(l,4,!0)),u.boundingBox=a,Promise.resolve(u)}};t.default=a},function(e,t,r){(function(t){var n=function(){"use strict";var e,n=/\s*/g,i=/^\s*|\s*$/g,a=/\s+/;function o(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function s(e,t){return e.getElementsByTagName(t)}function l(e,t){return e.getAttribute(t)}function u(e,t){return parseFloat(l(e,t))}function h(e,t){var r=s(e,t);return r.length?r[0]:null}function c(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function d(e){var t;return e&&(t=e).normalize&&t.normalize(),e&&e.textContent||""}function f(e,t){var r,n,i={};for(n=0;n<t.length;n++)(r=h(e,t[n]))&&(i[t[n]]=d(r));return i}function p(e,t){for(var r in t)e[r]=t[r]}function m(e){return c(e.replace(n,"").split(","))}function v(e){for(var t=e.replace(i,"").split(a),r=[],n=0;n<t.length;n++)r.push(m(t[n]));return r}function g(e){var t,r=[u(e,"lon"),u(e,"lat")],n=h(e,"ele"),i=h(e,"gpxtpx:hr")||h(e,"hr"),a=h(e,"time");return n&&(t=parseFloat(d(n)),isNaN(t)||r.push(t)),{coordinates:r,time:a?d(a):null,heartRate:i?parseFloat(d(i)):null}}function y(t){return void 0!==t.xml?t.xml:e.serializeToString(t)}return"undefined"!=typeof XMLSerializer?e=new XMLSerializer:"object"!=typeof t||t.browser||(e=new(r(112).XMLSerializer)),{kml:function(e){for(var t={type:"FeatureCollection",features:[]},r={},n={},i={},a=["Polygon","LineString","Point","Track","gx:Track"],u=s(e,"Placemark"),f=s(e,"Style"),p=s(e,"StyleMap"),g=0;g<f.length;g++){var x=o(y(f[g])).toString(16);r["#"+l(f[g],"id")]=x,n[x]=f[g]}for(var b=0;b<p.length;b++){r["#"+l(p[b],"id")]=o(y(p[b])).toString(16);for(var w=s(p[b],"Pair"),_={},M=0;M<w.length;M++)_[d(h(w[M],"key"))]=d(h(w[M],"styleUrl"));i["#"+l(p[b],"id")]=_}for(var E=0;E<u.length;E++)t.features=t.features.concat(A(u[E]));function S(e){var t,r;return"#"===(e=e||"").substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function T(e){var t=s(e,"coord"),r=[],n=[];0===t.length&&(t=s(e,"gx:coord"));for(var i=0;i<t.length;i++)r.push(c(d(t[i]).split(" ")));for(var a=s(e,"when"),o=0;o<a.length;o++)n.push(d(a[o]));return{coords:r,times:n}}function A(e){var t,o=function e(t){var r,n,i,o,l,u=[],c=[];if(h(t,"MultiGeometry"))return e(h(t,"MultiGeometry"));if(h(t,"MultiTrack"))return e(h(t,"MultiTrack"));if(h(t,"gx:MultiTrack"))return e(h(t,"gx:MultiTrack"));for(i=0;i<a.length;i++)if(n=s(t,a[i]))for(o=0;o<n.length;o++)if(r=n[o],"Point"===a[i])u.push({type:"Point",coordinates:m(d(h(r,"coordinates")))});else if("LineString"===a[i])u.push({type:"LineString",coordinates:v(d(h(r,"coordinates")))});else if("Polygon"===a[i]){var f=s(r,"LinearRing"),p=[];for(l=0;l<f.length;l++)p.push(v(d(h(f[l],"coordinates"))));u.push({type:"Polygon",coordinates:p})}else if("Track"===a[i]||"gx:Track"===a[i]){var g=T(r);u.push({type:"LineString",coordinates:g.coords}),g.times.length&&c.push(g.times)}return{geoms:u,coordTimes:c}}(e),u={},c=d(h(e,"name")),f=d(h(e,"address")),p=d(h(e,"styleUrl")),g=d(h(e,"description")),y=h(e,"TimeSpan"),x=h(e,"TimeStamp"),b=h(e,"ExtendedData"),w=h(e,"LineStyle"),_=h(e,"PolyStyle"),M=h(e,"visibility");if(!o.geoms.length)return[];if(c&&(u.name=c),f&&(u.address=f),p){"#"!==p[0]&&(p="#"+p),u.styleUrl=p,r[p]&&(u.styleHash=r[p]),i[p]&&(u.styleMapHash=i[p],u.styleHash=r[i[p].normal]);var E=n[u.styleHash];E&&(w||(w=h(E,"LineStyle")),_||(_=h(E,"PolyStyle")))}if(g&&(u.description=g),y){var A=d(h(y,"begin")),L=d(h(y,"end"));u.timespan={begin:A,end:L}}if(x&&(u.timestamp=d(h(x,"when"))),w){var P=S(d(h(w,"color"))),C=P[0],R=P[1],O=parseFloat(d(h(w,"width")));C&&(u.stroke=C),isNaN(R)||(u["stroke-opacity"]=R),isNaN(O)||(u["stroke-width"]=O)}if(_){var D=S(d(h(_,"color"))),I=D[0],N=D[1],F=d(h(_,"fill")),U=d(h(_,"outline"));I&&(u.fill=I),isNaN(N)||(u["fill-opacity"]=N),F&&(u["fill-opacity"]="1"===F?u["fill-opacity"]||1:0),U&&(u["stroke-opacity"]="1"===U?u["stroke-opacity"]||1:0)}if(b){var k=s(b,"Data"),B=s(b,"SimpleData");for(t=0;t<k.length;t++)u[k[t].getAttribute("name")]=d(h(k[t],"value"));for(t=0;t<B.length;t++)u[B[t].getAttribute("name")]=d(B[t])}M&&(u.visibility=d(M)),o.coordTimes.length&&(u.coordTimes=1===o.coordTimes.length?o.coordTimes[0]:o.coordTimes);var z={type:"Feature",geometry:1===o.geoms.length?o.geoms[0]:{type:"GeometryCollection",geometries:o.geoms},properties:u};return l(e,"id")&&(z.id=l(e,"id")),[z]}return t},gpx:function(e){var t,r,n=s(e,"trk"),i=s(e,"rte"),a=s(e,"wpt"),o={type:"FeatureCollection",features:[]};for(t=0;t<n.length;t++)(r=c(n[t]))&&o.features.push(r);for(t=0;t<i.length;t++)(r=m(i[t]))&&o.features.push(r);for(t=0;t<a.length;t++)o.features.push(v(a[t]));function u(e,t){var r=s(e,t),n=[],i=[],a=[],o=r.length;if(o<2)return{};for(var l=0;l<o;l++){var u=g(r[l]);n.push(u.coordinates),u.time&&i.push(u.time),u.heartRate&&a.push(u.heartRate)}return{line:n,times:i,heartRates:a}}function c(e){for(var t,r=s(e,"trkseg"),n=[],i=[],a=[],o=0;o<r.length;o++)(t=u(r[o],"trkpt"))&&(t.line&&n.push(t.line),t.times&&t.times.length&&i.push(t.times),t.heartRates&&t.heartRates.length&&a.push(t.heartRates));if(0!==n.length){var l=x(e);return p(l,y(h(e,"extensions"))),i.length&&(l.coordTimes=1===n.length?i[0]:i),a.length&&(l.heartRates=1===n.length?a[0]:a),{type:"Feature",properties:l,geometry:{type:1===n.length?"LineString":"MultiLineString",coordinates:1===n.length?n[0]:n}}}}function m(e){var t=u(e,"rtept");if(t.line){var r=x(e);return p(r,y(h(e,"extensions"))),{type:"Feature",properties:r,geometry:{type:"LineString",coordinates:t.line}}}}function v(e){var t=x(e);return p(t,f(e,["sym"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:g(e).coordinates}}}function y(e){var t={};if(e){var r=h(e,"line");if(r){var n=d(h(r,"color")),i=parseFloat(d(h(r,"opacity"))),a=parseFloat(d(h(r,"width")));n&&(t.stroke=n),isNaN(i)||(t["stroke-opacity"]=i),isNaN(a)||(t["stroke-width"]=96*a/25.4)}}return t}function x(e){var t=f(e,["name","cmt","desc","type","time","keywords"]),r=s(e,"link");r.length&&(t.links=[]);for(var n,i=0;i<r.length;i++)p(n={href:l(r[i],"href")},f(r[i],["text","type"])),t.links.push(n);return t}return o}}}();e.exports=n}).call(this,r(67))},function(e,t){},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.AnimatedExpression=t.Animation=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h={STOP:0,PLAY:1,END:2,PAUSE:3},c=function(e){e.id&&(clearInterval(e.id),e.id=void 0),e.waitTimer&&(clearInterval(e.waitTimer),e.waitTimer=void 0),e.keyframe=0},d=function(e){c(e),e.isEnded()&&e.dispatchEvent({type:"animation-ended",animation:e.animation}),e.dispatchEvent({type:"animation-stopped",animation:e.animation}),e.animation=null,e.resolve&&(e.resolve(),e.resolve=null,e.promise=null)},f=function(e){function t(){var e;return(0,a.default)(this,t),(e=(0,s.default)(this,(0,l.default)(t).call(this))).id=null,e.keyframe=0,e.animation=null,e.resolve=null,e.promise=null,e.state=h.STOP,e.waitTimer=null,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"isPlaying",value:function(){return this.state===h.PLAY}},{key:"isStopped",value:function(){return this.state===h.STOP}},{key:"isEnded",value:function(){return this.state===h.END}},{key:"play",value:function(e){var t=this;return this.animation=e,this.dispatchEvent({type:"animation-started",animation:e}),this.state=h.PLAY,c(this),this.id=setInterval(this.frame.bind(this),1e3/60),this.promise=new Promise(function(e){t.resolve=e}),this.promise}},{key:"playLater",value:function(e,t){var r=this;this.resolveWait=null;var n=new Promise(function(e){r.resolveWait=e}),i=Math.floor(1e3/60*t);return window.clearInterval(this.waitTimer),this.waitTimer=window.setTimeout(function(){r.play(e).then(function(){return r.resolveWait()})},i),n}},{key:"stop",value:function(){return this.state=h.STOP,d(this),Promise.resolve()}},{key:"frame",value:function(){this.keyframe<this.animation.duration?(this.animation.animate&&this.animation.animate(this.keyframe),this.keyframe++,this.dispatchEvent({type:"animation-frame"})):(this.state=h.END,d(this))}}]),t}(n(r(0)).EventDispatcher),p=function e(t){(0,a.default)(this,e),this.duration=t.duration||60,this.name=t.name};t.Animation=p;var m=function(e){function t(e){var r;return(0,a.default)(this,t),(r=(0,s.default)(this,(0,l.default)(t).call(this,e))).root=e.root,r.expression=e.expression,r}return(0,u.default)(t,e),(0,o.default)(t,[{key:"animate",value:function(e){this.expression(this.root,e/(this.duration-1))}}]),t}(p);t.AnimatedExpression=m;var v=f;t.default=v},function(e,t,r){(function(r){var n,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:o.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[r[n]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof window&&void 0!==r?o.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,n=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,n):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=i+(a-i)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):t>1?a(e[r],e[r-1],r-n):a(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=n;s++)r+=i(1-t,n-s)*i(t,s)*e[s]*a(n,s);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),a(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):a(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=o.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(a=[1],function(e){var t=1;if(a[e])return a[e];for(var r=e;r>1;r--)t*=r;return a[e]=t,t}),CatmullRom:function(e,t,r,n,i){var a=.5*(r-e),o=.5*(n-t),s=i*i;return(2*t-2*r+a+o)*(i*s)+(-3*t+3*r-2*a-o)*s+a*i+t}}},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}).call(this,r(67))},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=n(r(0)),l={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,SPACE:32,SHIFT:16,CTRL:17,S:83},u=function(){function e(){(0,a.default)(this,e),this.NONE={},this.ORBIT={mouseButton:s.MOUSE.LEFT,keyboard:l.CTRL,enable:!0,finger:2},this.DOLLY={mouseButton:s.MOUSE.MIDDLE,enable:!0},this.PAN={mouseButton:s.MOUSE.RIGHT,up:l.UP,bottom:l.BOTTOM,left:l.LEFT,right:l.RIGHT,enable:!0,finger:3},this.MOVE_GLOBE={mouseButton:s.MOUSE.LEFT,enable:!0,finger:1},this.PANORAMIC={mouseButton:s.MOUSE.LEFT,keyboard:l.SHIFT,enable:!0}}return(0,o.default)(e,[{key:"inputToState",value:function(e,t){for(var r=Object.keys(this),n=0;n<r.length;n++){var i=this[r[n]];if(i.enable&&i.mouseButton===e&&i.keyboard===t)return i}return this.NONE}},{key:"touchToState",value:function(e){for(var t=Object.keys(this),r=0;r<t.length;r++){var n=this[t[r]];if(n.enable&&e==n.finger)return n}return this.NONE}}]),e}();t.default=u},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(56)),s=n(r(51)),l=n(r(17)),u=n(r(35)),h={convert:function(e,t,r){var n=r.builder,i=e,h=void 0!==i?i.level+1:0,c=n.computeSharableExtent(t),d=c.sharableExtent,f=c.quaternion,p=c.position,m=d.south().toFixed(6),v=r.options.segments||16,g="".concat(n.type,"_").concat(r.disableSkirt?0:1,"_").concat(v,"_").concat(h,"_").concat(m),y=u.default.get(g);if(!y){var x={extent:d,level:h,segment:v,disableSkirt:r.disableSkirt};y=new o.default(x,n),u.default.set(g,y),y._count=0,y.dispose=function(){y._count--,0==y._count&&(a.BufferGeometry.prototype.dispose.call(y),u.default.delete(g))}}y._count++;var b=new l.default(r.materialOptions),w=new s.default(y,b,r,t,h);if(w.layers.set(r.threejsLayer),i&&i instanceof s.default){var _=n.computeSharableExtent(i.extent);p.sub(_.position).applyQuaternion(_.quaternion.inverse()),f.premultiply(_.quaternion)}return w.position.copy(p),w.quaternion.copy(f),w.material.transparent=r.opacity<1,w.material.opacity=r.opacity,w.visible=!1,w.updateMatrix(),i&&w.setBBoxZ(i.obb.z.min,i.obb.z.max),w.add(w.obb),w.material.lightingEnable=r.lighting.enable,w.material.lightPosition=r.lighting.position,r.diffuse&&(w.material.diffuse=r.diffuse),Promise.resolve(w)}};t.default=h},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.LIGHTING_POSITION=void 0;var a=i(r(0)),o=r(8),s=n(r(118)),l="#include <logdepthbuf_pars_fragment>\n\nuniform int atmoIN;\nvarying float intensity;\n\nvec4 glowColor = vec4(0.45, 0.74, 1. ,1.0);\n\nvoid main()\n{\n    #include <logdepthbuf_fragment>\n    gl_FragColor = glowColor * intensity;\n}\n\n",u="#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n\nuniform int atmoIN;\nvarying float intensity;\n\nvoid main()\n{\n    vec3 normalES    = normalize( normalMatrix * normal );\n    vec3 normalCAMES = normalize( normalMatrix * cameraPosition );\n\n    if(atmoIN == 0) {\n        intensity = pow(0.666 - dot(normalES, normalCAMES), 4. );\n    } else {\n        intensity = pow( 1.  - dot(normalES, normalCAMES), 0.8 );\n    }\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position,  1.0 );\n\n    #include <logdepthbuf_vertex>\n}\n\n\n",h=new a.Vector3(1,0,0);function c(){this.realistic=!1,this.uniformsOut={atmoIN:{type:"i",value:0},screenSize:{type:"v2",value:new a.Vector2(window.innerWidth,window.innerHeight)}};var e=new a.ShaderMaterial({uniforms:this.uniformsOut,vertexShader:u,fragmentShader:l,side:a.BackSide,blending:a.AdditiveBlending,transparent:!0,wireframe:!1}),t=new a.SphereGeometry(1.14,64,64).scale(o.ellipsoidSizes.x,o.ellipsoidSizes.y,o.ellipsoidSizes.z);a.Mesh.call(this,t,e),this.uniformsIn={atmoIN:{type:"i",value:1},screenSize:{type:"v2",value:new a.Vector2(window.innerWidth,window.innerHeight)}};var r=new a.ShaderMaterial({uniforms:this.uniformsIn,vertexShader:u,fragmentShader:l,side:a.FrontSide,blending:a.AdditiveBlending,transparent:!0,depthWrite:!1});this.atmosphereIN=new a.Mesh(new a.SphereGeometry(1.002,64,64).scale(o.ellipsoidSizes.x,o.ellipsoidSizes.y,o.ellipsoidSizes.z),r),this.add(this.atmosphereIN)}t.LIGHTING_POSITION=h,c.prototype=Object.create(a.Mesh.prototype),c.prototype.constructor=c,c.prototype._initRealisticLighning=function(){var e=-.95,t=64e5,r=67e5,n=[.65,.57,.475],i={v3LightPosition:{value:h.clone().normalize()},v3InvWavelength:{value:new a.Vector3(1/Math.pow(n[0],4),1/Math.pow(n[1],4),1/Math.pow(n[2],4))},fCameraHeight:{value:0},fCameraHeight2:{value:0},fInnerRadius:{value:t},fInnerRadius2:{value:t*t},fOuterRadius:{value:r},fOuterRadius2:{value:r*r},fKrESun:{value:.05},fKmESun:{value:.02},fKr4PI:{value:.01*Math.PI},fKm4PI:{value:.004*Math.PI},fScale:{value:1/3e5},fScaleDepth:{value:.25},fScaleOverScaleDepth:{value:1/3e5/.25},g:{value:e},g2:{value:e*e},nSamples:{value:3},fSamples:{value:3},tDisplacement:{value:new a.Texture},tSkyboxDiffuse:{value:new a.Texture},fNightScale:{value:1}};this.ground={geometry:new a.SphereGeometry(t,50,50),material:new a.ShaderMaterial({uniforms:i,vertexShader:"uniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nvarying vec3 c0;\nvarying vec3 c1;\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n\n     float cameraHeight2 = length(cameraPosition) * length(cameraPosition);\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n    float fCameraAngle = dot(-v3Ray, position) / length(position);\n    float fLightAngle = dot(v3LightPosition, position) / length(position);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Calculate the attenuation factor for the ground\n    c0 = v3Attenuate;\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec3 c0;\nvarying vec3 c1;\n\nvoid main (void) {\n\tgl_FragColor = vec4(c1, 1.0 - c0/4.);\n}",blending:a.AdditiveBlending,transparent:!0,depthTest:!1,depthWrite:!1})},this.ground.mesh=new a.Mesh(this.ground.geometry,this.ground.material),this.sky={geometry:new a.SphereGeometry(r,196,196),material:new a.ShaderMaterial({uniforms:i,vertexShader:"uniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\nfloat scale(float fCos) {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n    float lengthCamera = length(cameraPosition);\n    float cameraHeight2 = lengthCamera * lengthCamera;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n    float fStartDepth = exp(-1.0 / fScaleDepth);\n    float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;\n        float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n        float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\n    c1 = v3FrontColor * fKmESun;\n    v3Direction = cameraPosition - position;\n}",fragmentShader:"uniform vec3 v3LightPos;\nuniform float g;\nuniform float g2;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\n// Calculates the Mie phase function\nfloat getMiePhase(float fCos, float fCos2, float g, float g2) {\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(1.0 + g2 - 2.0 * g * fCos, 1.5);\n}\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(float fCos2) {\n    return 0.75 + 0.75 * fCos2;\n}\n\nvoid main (void) {\n    float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\n    float fCos2 = fCos * fCos;\n\n    vec3 color = getRayleighPhase(fCos2) * c0 + getMiePhase(fCos, fCos2, g, g2) * c1;\n\n    gl_FragColor = vec4(color, 1.0);\n    gl_FragColor.a = gl_FragColor.b;\n}"})},this.sky.mesh=new a.Mesh(this.sky.geometry,this.sky.material),this.sky.material.side=a.BackSide,this.sky.material.transparent=!0,this.ground.mesh.visible=!1,this.sky.mesh.visible=!1,this.skyDome=new s.default,this.skyDome.mesh.frustumCulled=!1,this.skyDome.mesh.material.transparent=!0,this.skyDome.mesh.visible=!1,this.skyDome.mesh.material.depthWrite=!1,this.ground.mesh.layers.mask=this.layers.mask,this.sky.mesh.layers.mask=this.layers.mask,this.skyDome.mesh.layers.mask=this.layers.mask,this.add(this.ground.mesh),this.add(this.sky.mesh),this.add(this.skyDome.mesh);var o=this.skyDome.uniforms;o.turbidity.value=10,o.reileigh.value=2,o.luminance.value=1,o.mieCoefficient.value=.005,o.mieDirectionalG.value=.8,o.up.value=new a.Vector3},c.prototype.setRealisticOn=function(e){e&&!this.sky&&this._initRealisticLighning(),this.realistic=e,this.material.visible=!this.realistic,this.atmosphereIN.visible=!this.realistic,this.ground.mesh.visible=this.realistic,this.sky.mesh.visible=this.realistic,this.skyDome.mesh.visible=this.realistic},c.prototype.updateLightingPos=function(e){this.realistic&&(this.ground.material.uniforms.v3LightPosition.value=e.clone().normalize(),this.sky.material.uniforms.v3LightPosition.value=e.clone().normalize(),this.skyDome.uniforms.sunPosition.value.copy(e))};var d=c;t.default=d},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a={uniforms:{luminance:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},sunPosition:{type:"v3",value:new i.Vector3},up:{type:"v3",value:new i.Vector3(0,1,0)}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix *  vec4( cameraPosition + position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( cameraPosition + position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","uniform vec3 up;","varying vec3 vWorldPosition;","// uniform sampler2D sDiffuse;","// const float turbidity = 10.0; //","// const float reileigh = 2.; //","// const float luminance = 1.0; //","// const float mieCoefficient = 0.005;","// const float mieDirectionalG = 0.8;","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","// constants for atmospheric scattering","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003; // refractive index of air","const float N = 2.545E25; // number of molecules per unit volume for air at","// 288.15K and 1013mb (sea level -45 celsius)","const float pn = 0.035; // depolatization factor for standard air","// wavelength of used primaries, according to preetham","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","// mie stuff","// K coefficient for the primaries","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","// optical length at zenith for molecules","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","// 66 arc seconds -> degrees, and the cosine of that","// earth shadow hack","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{ ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// float logLuminance(vec3 c)","// {","//     return log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);","// }","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","vec3 up2 = normalize(cameraPosition.xyz);","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up2));","// extinction (absorbtion + out scattering) ","// rayleigh coefficients","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","// mie coefficients","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","// optical length","// cutoff angle at 90 to avoid singularity in next formula.","float zenithAngle = acos(max(0.0, dot(up2, normalize(vWorldPosition - cameraPosition))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","// combined extinction factor","vec3 Fex = exp(-(betaR * sR + betaM * sM));","// in scattering","float cosTheta = dot(normalize(vWorldPosition - cameraPosition), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up2, sunDirection),5.0),0.0,1.0));","//nightsky","vec3 direction = normalize(vWorldPosition - cameraPosition);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;","vec3 L0 = vec3(0.1) * Fex;","// composition + solar disc","//if (cosTheta > sunAngularDiameterCos)","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","// if (normalize(vWorldPosition - cameraPosition).y>0.0)","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1. - ( (length(cameraPosition) - 6400000.) / 1000.);","}"].join("\n")};function o(){var e=i.UniformsUtils.clone(a.uniforms),t=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:e,side:i.BackSide}),r=new i.SphereBufferGeometry(4e4,32,15),n=new i.Mesh(r,t);this.mesh=n,this.uniforms=e}o.prototype.constructor=o;var s=o;t.default=s},function(e,t,r){"use strict";var n=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(8)),a={getSunPosition:function(){var e=Math,t=e.PI,r=e.sin,n=e.cos,i=e.tan,a=e.asin,o=e.atan2,s=t/180,l=23.4397*s;return function(e,u,h){var c,d=s*u,f=function(e){return function(e){return e.valueOf()/864e5-.5+2440588}(e)-2451545}(e),p=s*(357.5291+.98560028*f),m=function(e,r){return e+r+102.9372*s+t}(p,function(e){return s*(1.9148*r(e)+.02*r(2*e)+3e-4*r(3*e))}(p)),v=(c=m,a(r(0)*n(l)+n(0)*r(l)*r(c))),g=function(e,t){return o(r(e)*n(l)-i(0)*r(l),n(e))}(m),y=s*(280.16+360.9856235*f)-s*-h,x=y-g;return{EclipticLongitude:m,declinaison:v,ascension:g,H:x,SiderealTime:y,altitude:function(e,t,i){return a(r(t)*r(i)+n(t)*n(i)*n(e))}(x,d,v),azimuth:function(e,t,a){return o(r(e),n(e)*r(t)-i(a)*n(t))}(x,d,v)+t/2}}},getSunPositionInScene:function(e,t,r){var n=a.getSunPosition()(e,t,r).ascension+e%864e5/864e5*-360+180;return new i.default("EPSG:4326",n,t,5e7).as("EPSG:4978").xyz()}},o=a;t.default=o},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.createPlanarLayer=function(e,t,r){return console.warn("createPlanarLayer is deprecated, use the PlanarLayer class instead."),new u.default(e,t,r.object3d,r)},t.default=void 0;var a=i(r(0)),o=n(r(21)),s=r(13),l=n(r(39)),u=n(r(72));function h(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a.Object3D.DefaultUp.set(0,0,1),o.default.call(this,t.crs(),e,n);var i=t.dimensions(),h=Math.max(i.x,i.y),c=this.camera.camera3D;c.near=.1,c.far=2*h,this.camera.camera3D.updateProjectionMatrix();var d=new u.default("planar",t,n.object3d,n);this.addLayer(d);var f={coord:t.center(),range:h,tilt:20,heading:0};l.default.transformCameraToLookAtTarget(this,c,f),this._fullSizeDepthBuffer=null,this.addFrameRequester(s.MAIN_LOOP_EVENTS.BEFORE_RENDER,function(){null!=r._fullSizeDepthBuffer&&(r._fullSizeDepthBuffer=null)}),this.tileLayer=d}h.prototype=Object.create(o.default.prototype),h.prototype.constructor=h,h.prototype.addLayer=function(e){return o.default.prototype.addLayer.call(this,e,this.tileLayer)};var c=h;t.default=c},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(29)),s=n(r(8)),l=n(r(9));function u(){this.tmp={coords:new s.default("EPSG:4326",0,0),position:new a.Vector3,normal:new a.Vector3(0,0,1)},this.type="p"}u.prototype.constructor=u,u.prototype.Prepare=function(e){e.nbRow=Math.pow(2,e.zoom+1),e.projected=new a.Vector3};var h=new a.Vector3;u.prototype.Center=function(e){return e.center(this.tmp.coords),h.set(this.tmp.coords.x(),this.tmp.coords.y(),0),h},u.prototype.VertexPosition=function(e){return this.tmp.position.set(e.projected.x,e.projected.y,0),this.tmp.position},u.prototype.VertexNormal=function(){return this.tmp.normal},u.prototype.uProjecte=function(e,t){t.projected.x=t.extent.west()+e*(t.extent.east()-t.extent.west())},u.prototype.vProjecte=function(e,t){t.projected.y=t.extent.south()+e*(t.extent.north()-t.extent.south())},u.prototype.OBB=function(e){return new o.default(e.min,e.max)};var c=new a.Quaternion;u.prototype.computeSharableExtent=function(e){return{sharableExtent:new l.default(e.crs(),0,Math.abs(e.west()-e.east()),0,Math.abs(e.north()-e.south())),quaternion:c,position:this.Center(e).clone()}};var d=u;t.default=d},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.createPanoramaLayer=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return console.warn("createPanoramaLayer is deprecated, use the PanoramaLayer class instead."),new s.default(e,t,r,n)},t.default=void 0;var a=i(r(0)),o=n(r(21)),s=n(r(123));function l(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};console.warn("Deprecation warning: this view is going to be removed in iTowns 2.7.0, please consider stop using it."),a.Object3D.DefaultUp.set(0,0,1),o.default.call(this,t.crs,e,n);var i=this.camera.camera3D;t.xyz(i.position),i.fov=45,i.near=.1,i.far=1e3,i.up=t.geodesicNormal,i.lookAt(new a.Vector3(0,1,0).add(i.position)),i.updateProjectionMatrix&&i.updateProjectionMatrix(),i.updateMatrixWorld(),this.tileLayer=new s.default("panorama",t,r,n),o.default.prototype.addLayer.call(this,this.tileLayer)}l.prototype=Object.create(o.default.prototype),l.prototype.constructor=l,l.prototype.addLayer=function(e){if(!e)return new Promise(function(e,t){return t(new Error("layer is undefined"))});if("color"!=e.type)throw new Error("Unsupported layer type ".concat(e.type," (PanoramaView only support 'color' layers)"));return o.default.prototype.addLayer.call(this,e,this.tileLayer)};var u=l;t.default=u},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=n(r(0)),c=i(r(31)),d=i(r(9)),f=i(r(124)),p=i(r(40)),m=new h.Vector2(512,256),v=new h.Vector3,g=function(e){function t(e,r,n,i){var o,u;if((0,a.default)(this,t),console.warn("Deprecation warning: this layer is going to be removed in iTowns 2.7.0, please consider stop using it."),n===p.default.SPHERICAL)u=[new d.default("EPSG:4326",{west:-180,east:0,north:90,south:-90}),new d.default("EPSG:4326",{west:0,east:180,north:90,south:-90})];else{if(n!==p.default.CYLINDRICAL)throw new Error("Unsupported panorama projection type ".concat(n,".\n                Only ProjectionType.SPHERICAL and ProjectionType.CYLINDRICAL are supported"));u=[new d.default("EPSG:4326",{west:-180,east:-90,north:90,south:-90}),new d.default("EPSG:4326",{west:-90,east:0,north:90,south:-90}),new d.default("EPSG:4326",{west:0,east:90,north:90,south:-90}),new d.default("EPSG:4326",{west:90,east:180,north:90,south:-90})]}var c=new f.default(n,i.ratio||1);return o=(0,s.default)(this,(0,l.default)(t).call(this,e,i.object3d||new h.Group,u,c,i)),r.xyz(o.object3d.position),o.object3d.quaternion.setFromUnitVectors(new h.Vector3(0,0,1),r.geodesicNormal),o.object3d.updateMatrixWorld(!0),o.extent=new d.default("EPSG:4326",{west:-180,east:180,north:90,south:-90}),o.disableSkirt=!0,o.options.segments=8,o.options.quality=.5,o}return(0,u.default)(t,e),(0,o.default)(t,[{key:"culling",value:function(e,t){return!t.isBox3Visible(e.obb.box3D,e.obb.matrixWorld)}},{key:"subdivision",value:function(e,t,r){if(r.level<1)return!0;if((this.maxSubdivisionLevel||10)<=r.level)return!1;var n=r.obb;n.updateMatrixWorld();var i=e.camera.box3SizeOnScreen(n.box3D,n.matrixWorld);i.min.z=0,i.max.z=0,i.getCenter(v);var a=1+Math.max(0,1-v.length()),o=.5*(i.max.x-i.min.x)*e.camera.width,s=.5*(i.max.y-i.min.y)*e.camera.height,l=t.options.quality||1;return a*o*l>=m.x&&a*s*l>=m.y}}]),t}(c.default);t.default=g},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(29)),s=n(r(8)),l=n(r(9)),u=n(r(40));function h(e,t){if(this.tmp={coords:new s.default("EPSG:4326",0,0),position:new a.Vector3,normal:new a.Vector3(0,0,1)},void 0===e)throw new Error("Projection type must be defined");if(e===u.default.SPHERICAL)this.type="s",this.radius=100;else{if(e!==u.default.CYLINDRICAL)throw new Error("Unsupported panorama projection type ".concat(e));if(!t)throw new Error("Image ratio must be defined when using cylindrical projection");this.type="c",this.height=200,this.radius=t*this.height/(2*Math.PI)}this.projectionType=e}h.prototype.constructor=h;var c=new a.Vector3(0,1,0);h.prototype.Prepare=function(e){var t=.5*(e.extent.north()+e.extent.south());this.projectionType===u.default.SPHERICAL?(e.quatNormalToZ=(new a.Quaternion).setFromAxisAngle(c,a.Math.degToRad(90-t)),e.projected={theta:0,phi:0,radius:this.radius}):(e.quatNormalToZ=(new a.Quaternion).setFromAxisAngle(c,.5*Math.PI),e.projected={theta:0,radius:this.radius,y:0})},h.prototype.Center=function(e){var t={extent:e};return this.Prepare(t),this.uProjecte(.5,t),this.vProjecte(.5,t),this.VertexPosition(t).clone()},h.prototype.VertexPosition=function(e){return this.projectionType===u.default.SPHERICAL?this.tmp.position.setFromSpherical(e.projected):this.tmp.position.setFromCylindrical(e.projected),this.tmp.position.set(this.tmp.position.z,this.tmp.position.x,this.tmp.position.y),this.tmp.position},h.prototype.VertexNormal=function(){return this.tmp.position.clone().negate().normalize()},h.prototype.uProjecte=function(e,t){t.projected.theta=a.Math.degToRad(90-a.Math.lerp(t.extent.east(),t.extent.west(),1-e))},h.prototype.vProjecte=function(e,t){this.projectionType===u.default.SPHERICAL?t.projected.phi=a.Math.degToRad(90-a.Math.lerp(t.extent.north(),t.extent.south(),1-e)):t.projected.y=this.height*a.Math.lerp(t.extent.south(),t.extent.north(),e)/180},h.prototype.OBB=function(e){return new o.default(e.min,e.max)};var d=new a.Vector3(0,1,0),f=new a.Vector3(0,0,1),p=new a.Quaternion,m=new a.Quaternion;h.prototype.computeSharableExtent=function(e){var t=Math.abs(e.west()-e.east())/2,r=new l.default(e.crs(),-t,t,e.south(),e.north()),n=e.west()-r.west(),i=90-(this.projectionType===u.default.CYLINDRICAL?0:.5*(e.north()+e.south()));return p.setFromAxisAngle(f,-a.Math.degToRad(n)),m.setFromAxisAngle(d,-a.Math.degToRad(i)),p.multiply(m),{sharableExtent:r,quaternion:p.clone(),position:this.Center(e)}};var v=h;t.default=v},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(126)),s=n(r(8));function l(e){return e.getElementsByTagName("trkpt")}function u(e,t){var r=Number(e.attributes.lon.nodeValue),n=Number(e.attributes.lat.nodeValue),i=e.getElementsByTagName("ele")[0],a=i?Number(i.childNodes[0].nodeValue):0;return new s.default("EPSG:4326",r,n,a).as(t).xyz()}var h=new a.BoxGeometry(1,1,80),c=new a.MeshBasicMaterial({color:16777215}),d=new a.Vector3;function f(e,t){var r=e.geometry.boundingSphere.center.clone().applyMatrix4(e.matrixWorld);return d.setFromMatrixPosition(t.matrixWorld),d.distanceTo(r)}function p(e,t,r){var n=f(this,r),i=Math.max(2,Math.min(100,n/e.getSize().height));this.scale.set(i,i,i),this.updateMatrixWorld()}function m(e,t,r){var n=f(this,r);this.material.depthTest=n<2*this.geometry.boundingSphere.radius;var i=e.getSize();this.material.uniforms.resolution.value.set(i.width,i.height)}var v={parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof XMLDocument||(e=(new window.DOMParser).parseFromString(e,"text/xml")),Promise.resolve(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){null==t.enablePin&&(t.enablePin=!0);var r=new a.Object3D,n=function(e,t){var r=function(e){return e.getElementsByTagName("trkseg")}(e),n=new a.Object3D;if(r.length){var i=!0,s=!1,h=void 0;try{for(var c,d=r[Symbol.iterator]();!(i=(c=d.next()).done);i=!0){var f=l(c.value);if(f.length){e.center=e.center||u(f[0],t.crs);var p=new a.Geometry,v=!0,g=!1,y=void 0;try{for(var x,b=f[Symbol.iterator]();!(v=(x=b.next()).done);v=!0){var w=u(x.value,t.crs).sub(e.center);p.vertices.push(w)}}catch(e){g=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(g)throw y}}var _=new o.default.MeshLine;_.setGeometry(p);var M=new o.default.MeshLineMaterial({lineWidth:t.lineWidth||12,sizeAttenuation:0,color:new a.Color(16711680)}),E=new a.Mesh(_.geometry,M);E.onBeforeRender=m,n.add(E)}}}catch(e){s=!0,h=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw h}}return n}return null}(e,t);if(n&&r.add(n),t.enablePin){var i=function(e,t){var r=function(e){return e.getElementsByTagName("wpt")}(e);if(r.length){var n=new a.Group;e.center=e.center||u(r[0],t);var i=e.center.clone().negate(),o=!0,s=!1,l=void 0;try{for(var d,f=r[Symbol.iterator]();!(o=(d=f.next()).done);o=!0){var m=u(d.value,t).sub(e.center),v=new a.Mesh(h,c);v.position.copy(m),v.lookAt(i),v.onBeforeRender=p,n.add(v)}}catch(e){s=!0,l=e}finally{try{o||null==f.return||f.return()}finally{if(s)throw l}}return n}return null}(e,t.crs);i&&r.add(i)}return r.position.copy(e.center),r.updateMatrixWorld(),r.matrixAutoUpdate=!1,r}}(e,t))}};t.default=v},function(e,t,r){(function(){"use strict";var n=this.THREE||r(0);if(!n)throw new Error("MeshLine requires three.js");function i(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new n.BufferGeometry,this.widthCallback=null}function a(e,t,r,n,i){var a;if(e=e.subarray||e.slice?e:e.buffer,r=r.subarray||r.slice?r:r.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,r.set)r.set(e,n);else for(a=0;a<e.length;a++)r[a+n]=e[a];return r}function o(e){function t(e,t){return void 0===e?t:e}n.Material.call(this),e=e||{},this.lineWidth=t(e.lineWidth,1),this.map=t(e.map,null),this.useMap=t(e.useMap,0),this.alphaMap=t(e.alphaMap,null),this.useAlphaMap=t(e.useAlphaMap,0),this.color=t(e.color,new n.Color(16777215)),this.opacity=t(e.opacity,1),this.resolution=t(e.resolution,new n.Vector2(1,1)),this.sizeAttenuation=t(e.sizeAttenuation,1),this.near=t(e.near,1),this.far=t(e.far,1),this.dashArray=t(e.dashArray,0),this.dashOffset=t(e.dashOffset,0),this.dashRatio=t(e.dashRatio,.5),this.useDash=0!==this.dashArray?1:0,this.visibility=t(e.visibility,1),this.alphaTest=t(e.alphaTest,0),this.repeat=t(e.repeat,new n.Vector2(1,1));var r=new n.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"f",value:this.dashArray},dashOffset:{type:"f",value:this.dashOffset},dashRatio:{type:"f",value:this.dashRatio},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},repeat:{type:"v2",value:this.repeat}},vertexShader:["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","attribute float counters;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","","}"].join("\r\n"),fragmentShader:["#extension GL_OES_standard_derivatives : enable","precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","}"].join("\r\n")});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.dashOffset,delete e.dashRatio,delete e.visibility,delete e.alphaTest,delete e.repeat,r.type="MeshLineMaterial",r.setValues(e),r}i.prototype.setGeometry=function(e,t){if(this.widthCallback=t,this.positions=[],this.counters=[],e instanceof n.Geometry)for(var r=0;r<e.vertices.length;r++){var i=e.vertices[r];t=r/e.vertices.length,this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(t),this.counters.push(t)}if(n.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(r=0;r<e.length;r+=3)t=r/e.length,this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(t),this.counters.push(t);this.process()},i.prototype.compareV3=function(e,t){var r=6*e,n=6*t;return this.positions[r]===this.positions[n]&&this.positions[r+1]===this.positions[n+1]&&this.positions[r+2]===this.positions[n+2]},i.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},i.prototype.process=function(){var e,t,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var i=0;i<r;i++)this.side.push(1),this.side.push(-1);for(i=0;i<r;i++)e=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(e),this.width.push(e);for(i=0;i<r;i++)this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1);for(t=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]),i=0;i<r-1;i++)t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(i=1;i<r;i++)t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]);for(t=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),i=0;i<r-1;i++){var a=2*i;this.indices_array.push(a,a+1,a+2),this.indices_array.push(a+2,a+1,a+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new n.BufferAttribute(new Float32Array(this.positions),3),previous:new n.BufferAttribute(new Float32Array(this.previous),3),next:new n.BufferAttribute(new Float32Array(this.next),3),side:new n.BufferAttribute(new Float32Array(this.side),1),width:new n.BufferAttribute(new Float32Array(this.width),1),uv:new n.BufferAttribute(new Float32Array(this.uvs),2),index:new n.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new n.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},i.prototype.advance=function(e){var t=this.attributes.position.array,r=this.attributes.previous.array,n=this.attributes.next.array,i=t.length;a(t,0,r,0,i),a(t,6,t,0,i-6),t[i-6]=e.x,t[i-5]=e.y,t[i-4]=e.z,t[i-3]=e.x,t[i-2]=e.y,t[i-1]=e.z,a(t,6,n,0,i-6),n[i-6]=e.x,n[i-5]=e.y,n[i-4]=e.z,n[i-3]=e.x,n[i-2]=e.y,n[i-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},o.prototype=Object.create(n.Material.prototype),o.prototype.constructor=o,o.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},e.exports&&(t=e.exports={MeshLine:i,MeshLineMaterial:o}),t.MeshLine=i,t.MeshLineMaterial=o}).call(this)},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(73));a.Matrix4.prototype.setMatrix3=function(e){return this.elements[0]=e.elements[0],this.elements[1]=e.elements[1],this.elements[2]=e.elements[2],this.elements[4]=e.elements[3],this.elements[5]=e.elements[4],this.elements[6]=e.elements[5],this.elements[8]=e.elements[6],this.elements[9]=e.elements[7],this.elements[10]=e.elements[8],this};var s=new a.Matrix3,l={parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=JSON.parse(e)),Promise.resolve(e.map(function(e){return function(e,t){var r=e.projection,n=(new a.Vector2).fromArray(e.size),i=new a.Vector2(r[0],r[4]),l=new a.Vector2(r[2],r[5]),u=r[1],h=new o.default(n,i,l,t.near,t.far,u);h.position.fromArray(e.position);var c=s.fromArray(e.rotation);return h.matrix.setMatrix3(c),h.scale.set(1,-1,-1),h.quaternion.setFromRotationMatrix(h.matrix),h.matrix.compose(h.position,h.quaternion,h.scale),e.distortion&&(h.distortion={pps:(new a.Vector2).fromArray(e.distortion.pps),polynom:(new a.Vector4).fromArray(e.distortion.poly357),l1l2:(new a.Vector3).set(0,0,0)},h.distortion.polynom.w=e.distortion.limit*e.distortion.limit,e.distortion.l1l2&&(h.distortion.l1l2.fromArray(e.distortion.l1l2),h.distortion.l1l2.z=e.distortion.etats)),h.name=e.id,h}(e,t)}))}};t.default=l},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(48)),s=n(r(15)),l=n(r(71)),u=new a.Vector3,h=new a.Quaternion,c={update:function(e,t,r){if(r.parent||!r.children.length){if(r.visible){void 0===r.layerUpdateState[t.id]&&(r.layerUpdateState[t.id]=new o.default);var n=Date.now();if(r.layerUpdateState[t.id].canTryUpdate(n)){var i=r.children.filter(function(e){return e.layer==t});if(i.length>0)return i;var c=r.getCoordsForSource(t.source);c.forEach(function(e){e.zoom=r.level});var d=[],f=!0,p=!1,m=void 0;try{for(var v,g=c[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;if(!t.source.extentInsideLimit(y)||t.source.parsedData&&!t.source.parsedData.extent.isPointInside(y.center()))return;d.push(y)}}catch(e){p=!0,m=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw m}}r.layerUpdateState[t.id].newTry();var x={layer:t,extentsSource:d,view:e.view,threejsLayer:t.threejsLayer,requester:r};e.scheduler.execute(x).then(function(n){if(n=n[0]){var i=!n.layer;if(n.minAltitude=isNaN(n.minAltitude)?0:n.minAltitude,function e(t,r){if(t){t.layer=r,t.material&&(t.material.transparent=r.opacity<1,t.material.opacity=r.opacity,t.material.wireframe=r.wireframe,r.size&&(t.material.size=r.size),r.linewidth&&(t.material.linewidth=r.linewidth)),t.layers.set(r.threejsLayer);var n=!0,i=!1,a=void 0;try{for(var o,s=t.children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)e(o.value,r)}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return t}}(n,t),t.onMeshCreated&&t.onMeshCreated(n),r.layerUpdateState[t.id].success(),!r.parent)return void l.default.removeChildrenAndCleanupRecursively(t,n);if(i){var o=r.extent.center().as(e.view.referenceCrs).xyz().negate();h.setFromRotationMatrix(r.matrixWorld).inverse(),function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t.geometry)if(t.geometry instanceof a.BufferGeometry){for(var o=3*t.geometry.attributes.position.count,s=0;s<o;s+=3)u.fromArray(t.geometry.attributes.position.array,s),u.add(r).applyQuaternion(n),u.z-=i,u.toArray(t.geometry.attributes.position.array,s);t.geometry.attributes.position.needsUpdate=!0}else{var l=!0,h=!1,c=void 0;try{for(var d,f=t.geometry.vertices[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var p=d.value;p.add(r).applyQuaternion(n),p.z-=i}}catch(e){h=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(h)throw c}}t.geometry.verticesNeedUpdate=!0}t.children.forEach(function(t){return e(t,r,n,i)})}(n,o,h,n.minAltitude)}n.minAltitude&&(n.position.z=n.minAltitude),n.layer=t,r.add(n),r.updateMatrixWorld()}else r.layerUpdateState[t.id].failure(1,!0)},function(n){n instanceof s.default?r.layerUpdateState[t.id].success():n instanceof SyntaxError?r.layerUpdateState[t.id].failure(0,!0):(r.layerUpdateState[t.id].failure(Date.now()),setTimeout(1e3*r.layerUpdateState[t.id].secondsUntilNextTry(),function(){e.view.notifyChange(t,!1)}))})}}}else l.default.removeChildrenAndCleanupRecursively(t,r)}};t.default=c},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=i(r(11)),c=n(r(0)),d=r(13),f={38:{method:"translateZ",sign:-1},40:{method:"translateZ",sign:1},37:{method:"translateX",sign:-1},39:{method:"translateX",sign:1},33:{method:"rotateZ",sign:1,noSpeed:!0},34:{method:"rotateZ",sign:-1,noSpeed:!0},wheelup:{method:"translateZ",sign:1,oneshot:!0},wheeldown:{method:"translateZ",sign:-1,oneshot:!0}};function p(){this._isMouseDown=!1}function m(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t<0?this.moves.add(f.wheelup):this.moves.add(f.wheeldown),this.view.notifyChange(this._camera3D,!1)}var v=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.default)(this,t),r=(0,s.default)(this,(0,l.default)(t).call(this));var i=e.mainLoop.gfxEngine.renderer.domElement;r.view=e,r.options=n,r._camera3D=e.camera.camera3D,r.moves=new Set,r.moveSpeed=10,r._onMouseDownMouseX=0,r._onMouseDownMouseY=0,r._isMouseDown=!1,i.addEventListener("mousedown",function(e){e.preventDefault(),this._isMouseDown=!0;var t=this.view.eventToViewCoords(e);this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y}.bind((0,h.default)((0,h.default)(r))),!1),i.addEventListener("touchstart",function(e){e.preventDefault(),this._isMouseDown=!0,this._onMouseDownMouseX=e.touches[0].pageX,this._onMouseDownMouseY=e.touches[0].pageY}.bind((0,h.default)((0,h.default)(r))),!1);var o=function(e){if(!0===this._isMouseDown){var t=this.view.eventToViewCoords(e),r=c.Math.degToRad(this._camera3D.fov)/this.view.mainLoop.gfxEngine.height;this._camera3D.rotateY((t.x-this._onMouseDownMouseX)*r),this._camera3D.rotateX((t.y-this._onMouseDownMouseY)*r),this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y,this.view.notifyChange(this._camera3D,!1)}}.bind((0,h.default)((0,h.default)(r)));return i.addEventListener("mousemove",o,!1),i.addEventListener("touchmove",o,!1),i.addEventListener("mouseup",p.bind((0,h.default)((0,h.default)(r))),!1),i.addEventListener("touchend",p.bind((0,h.default)((0,h.default)(r))),!1),i.addEventListener("mousewheel",m.bind((0,h.default)((0,h.default)(r))),!1),i.addEventListener("DOMMouseScroll",m.bind((0,h.default)((0,h.default)(r))),!1),i.addEventListener("keyup",function(e){var t=f[e.keyCode];t&&(this.moves.delete(t),e.preventDefault())}.bind((0,h.default)((0,h.default)(r))),!0),i.addEventListener("keydown",function(e){var t=f[e.keyCode];t&&(this.moves.add(t),this.view.notifyChange(this._camera3D,!1),e.preventDefault())}.bind((0,h.default)((0,h.default)(r))),!0),r.view.addFrameRequester(d.MAIN_LOOP_EVENTS.AFTER_CAMERA_UPDATE,r.update.bind((0,h.default)((0,h.default)(r)))),n.focusOnMouseOver&&i.addEventListener("mouseover",function(){return i.focus()}),n.focusOnClick&&i.addEventListener("click",function(){return i.focus()}),r}return(0,u.default)(t,e),(0,o.default)(t,[{key:"isUserInteracting",value:function(){return 0!==this.moves.size||this._isMouseDown}},{key:"update",value:function(e,t){t&&(e=16);var r=!0,n=!1,i=void 0;try{for(var a,o=this.moves[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;this._camera3D[s.method](s.sign*(s.noSpeed?1:this.moveSpeed)*e/1e3)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}if(this.moves.size>0||this._isMouseDown){this.view.notifyChange(this._camera3D);var l=!0,u=!1,h=void 0;try{for(var c,d=this.moves[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;f.oneshot&&this.moves.delete(f)}}catch(e){u=!0,h=e}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}}]),t}(c.EventDispatcher);t.default=v},function(e,t,r){"use strict";var n=r(2),i=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(3)),o=i(r(4)),s=i(r(6)),l=i(r(5)),u=i(r(7)),h=i(r(11)),c=n(r(0)),d=r(13);function f(e,t,r){var n=.5*c.Math.degToRad(r-e.fov);return c.Math.clamp(t,-n,n)}function p(e,t,r){t.quaternion.setFromUnitVectors(new c.Vector3(0,1,0),t.up),t.rotateY(r.rotateY),t.rotateX(r.rotateX),e.notifyChange(e.camera.camera3D)}var m={38:{method:"translateZ",sign:-1},40:{method:"translateZ",sign:1},37:{method:"translateX",sign:-1},39:{method:"translateX",sign:1},33:{method:"translateY",sign:1},34:{method:"translateY",sign:-1}};function v(e){this.camera.position.z+=e}var g=new c.Vector3;function y(e){g.copy(this.camera.position),g.normalize(),this.camera.position.add(g.multiplyScalar(e))}var x=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,a.default)(this,t),(r=(0,s.default)(this,(0,l.default)(t).call(this))).camera=e.camera.camera3D,r.view=e,r.moves=new Set,n.panoramaRatio){var i=200*n.panoramaRatio/(2*Math.PI);n.verticalFOV=2==n.panoramaRatio?180:c.Math.radToDeg(2*Math.atan(200/(2*i)))}n.verticalFOV=n.verticalFOV||180,n.moveSpeed=void 0===n.moveSpeed?10:n.moveSpeed,r.options=n,r._isMouseDown=!1,r._onMouseDownMouseX=0,r._onMouseDownMouseY=0,r._state={rotateX:0,rotateY:0,snapshot:function(){return{rotateX:this.rotateX,rotateY:this.rotateY}}},r.reset();var o=e.mainLoop.gfxEngine.renderer.domElement;return n.disableEventListeners||(o.addEventListener("mousedown",r.onMouseDown.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("touchstart",r.onMouseDown.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("mousemove",r.onMouseMove.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("touchmove",r.onMouseMove.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("mouseup",r.onMouseUp.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("touchend",r.onMouseUp.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("keyup",r.onKeyUp.bind((0,h.default)((0,h.default)(r))),!0),o.addEventListener("keydown",r.onKeyDown.bind((0,h.default)((0,h.default)(r))),!0),o.addEventListener("mousewheel",r.onMouseWheel.bind((0,h.default)((0,h.default)(r))),!1),o.addEventListener("DOMMouseScroll",r.onMouseWheel.bind((0,h.default)((0,h.default)(r))),!1)),r.view.addFrameRequester(d.MAIN_LOOP_EVENTS.AFTER_CAMERA_UPDATE,r.update.bind((0,h.default)((0,h.default)(r)))),n.focusOnMouseOver&&o.addEventListener("mouseover",function(){return o.focus()}),n.focusOnClick&&o.addEventListener("click",function(){return o.focus()}),"EPSG:4978"==e.referenceCrs?r.moveCameraVertical=y:r.moveCameraVertical=v,r}return(0,u.default)(t,e),(0,o.default)(t,[{key:"isUserInteracting",value:function(){return 0!==this.moves.size&&!this._isMouseDown}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(new c.Quaternion).setFromUnitVectors(new c.Vector3(0,1,0),this.camera.up);t.inverse();var r=this.camera.quaternion.clone().premultiply(t),n=new c.Euler(0,0,0,"YXZ").setFromQuaternion(r);e||(this._state.rotateX=n.x),this._state.rotateY=n.y}},{key:"update",value:function(e,t,r){t&&(e=16);var n=!0,i=!1,a=void 0;try{for(var o,s=this.moves[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;"translateY"===l.method?this.moveCameraVertical(l.sign*this.options.moveSpeed*e/1e3):this.camera[l.method](l.sign*this.options.moveSpeed*e/1e3)}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}!0!==this._isMouseDown&&!0!==r||p(this.view,this.camera,this._state),this.moves.size&&this.view.notifyChange(this.view.camera.camera3D)}},{key:"onMouseDown",value:function(e){e.preventDefault(),this._isMouseDown=!0;var t=this.view.eventToViewCoords(e);this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y,this._stateOnMouseDown=this._state.snapshot()}},{key:"onMouseUp",value:function(){this._isMouseDown=!1}},{key:"onMouseMove",value:function(e){if(!0===this._isMouseDown){var t=c.Math.degToRad(this.camera.fov)/this.view.mainLoop.gfxEngine.height,r=this.view.eventToViewCoords(e);this._state.rotateY=(r.x-this._onMouseDownMouseX)*t+this._stateOnMouseDown.rotateY,this._state.rotateX=f(this.camera,(r.y-this._onMouseDownMouseY)*t+this._stateOnMouseDown.rotateX,this.options.verticalFOV),p(this.view,this.camera,this._state)}}},{key:"onMouseWheel",value:function(e){var t=0;void 0!==e.wheelDelta?t=-e.wheelDelta:void 0!==e.detail&&(t=e.detail),this.camera.fov=c.Math.clamp(this.camera.fov+Math.sign(t),10,Math.min(100,this.options.verticalFOV)),this.camera.updateProjectionMatrix(),this._state.rotateX=f(this.camera,this._state.rotateX,this.options.verticalFOV),p(this.view,this.camera,this._state)}},{key:"onKeyUp",value:function(e){var t=m[e.keyCode];t&&(this.moves.delete(t),this.view.notifyChange(void 0,!1),e.preventDefault())}},{key:"onKeyDown",value:function(e){var t=m[e.keyCode];t&&(this.moves.add(t),this.view.notifyChange(void 0,!1),e.preventDefault())}}]),t}(c.EventDispatcher);t.default=x},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=r(13),o=32,s=84,l=89,u=i.MOUSE.LEFT,h=i.MOUSE.MIDDLE,c=i.MOUSE.RIGHT,d=-1,f=0,p=1,m=2,v=3,g=new i.Vector3;t.default=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=e,this.camera=e.camera.camera3D,this.domElement=e.mainLoop.gfxEngine.renderer.domElement,this.enableRotation=void 0===r.enableRotation||r.enableRotation,this.rotateSpeed=r.rotateSpeed||2,this.maxPanSpeed=r.maxPanSpeed||15,this.minPanSpeed=r.minPanSpeed||.05,this.zoomTravelTime=r.zoomTravelTime||.2,this.zoomInFactor=r.zoomInFactor||.25,this.zoomOutFactor=r.zoomOutFactor||.4,this.maxAltitude=r.maxAltitude||12e3,this.groundLevel=r.groundLevel||200,this.autoTravelTimeMin=r.autoTravelTimeMin||1.5,this.autoTravelTimeMax=r.autoTravelTimeMax||4,this.autoTravelTimeDist=r.autoTravelTimeDist||2e4,this.smartZoomHeightMin=r.smartZoomHeightMin||75,this.smartZoomHeightMax=r.smartZoomHeightMax||500,this.instantTravel=r.instantTravel||!1,this.minZenithAngle=r.minZenithAngle||0*Math.PI/180,this.maxZenithAngle=(r.maxZenithAngle||82.5)*Math.PI/180,this.focusOnMouseOver=r.focusOnMouseOver||!0,this.focusOnMouseClick=r.focusOnMouseClick||!0,this.handleCollision=void 0===r.handleCollision||r.handleCollision,this.minDistanceCollision=30;var n=this.camera.position.clone(),y=this.camera.quaternion.clone();this.state=d;var x,b,w=new i.Vector2,_=new i.Vector2,M=new i.Vector2(0,0),E=new i.Vector3,S=new i.Vector3,T=new i.Vector3,A=new i.Vector3(0,0,0),L=0,P=new i.Vector3,C=new i.Vector3,R=new i.Quaternion,O=new i.Quaternion,D=0,I=0,N=!1,F=!1,U=function(e){this.state!==v&&(e.keyCode===s&&this.goToTopView(),e.keyCode===l&&this.goToStartView(),e.keyCode===o&&this.initiateSmartZoom(e))}.bind(this),k=function(e){e.preventDefault(),this.state!==v&&(this.updateMousePositionAndDelta(e),e.button===u?e.ctrlKey?this.initiateRotation():this.initiateDrag():e.button===h?this.initiateSmartZoom(e):e.button===c&&this.initiatePan(),this.updateMouseCursorType())}.bind(this),B=function(e){e.preventDefault(),this.state!==v&&(this.state=d),this.updateMouseCursorType()}.bind(this),z=function(e){e.preventDefault(),this.updateMousePositionAndDelta(e),this.state!==d&&this.view.notifyChange()}.bind(this),G=function(e){e.preventDefault(),e.stopPropagation(),this.state===d&&this.initiateZoom(e)}.bind(this);this.focusOnMouseOver&&this.domElement.addEventListener("mouseover",function(){return t.domElement.focus()}),this.focusOnMouseClick&&this.domElement.addEventListener("click",function(){return t.domElement.focus()}),this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()}.bind(this),!1),this.update=function(e,t){this.handleCollision&&this.view.camera.adjustAltitudeToAvoidCollisionWithLayer(this.view,this.view.tileLayer,this.minDistanceCollision),t&&(e=16),this.state===v&&(this.handleTravel(e),this.view.notifyChange(this.camera)),this.state===f&&(this.handleDragMovement(),this.view.notifyChange(this.camera)),this.state===m&&this.enableRotation&&(this.handleRotation(),this.view.notifyChange(this.camera)),this.state===p&&(this.handlePanMovement(),this.view.notifyChange(this.camera)),M.set(0,0)},this.view.addFrameRequester(a.MAIN_LOOP_EVENTS.AFTER_CAMERA_UPDATE,this.update.bind(this)),this.initiateDrag=function(){this.state=f,E.copy(this.getWorldPointAtScreenXY(w)),T.set(0,0,0)},this.handleDragMovement=function(){S.copy(this.getWorldPointFromMathPlaneAtScreenXY(w,E.z)),T.subVectors(E,S),this.camera.position.add(T),T.set(0,0,0)},this.initiatePan=function(){this.state=p},this.handlePanMovement=(x=new i.Vector3,function(){var e=i.Math.clamp((t.camera.position.z-t.groundLevel)/t.maxAltitude,0,1),r=i.Math.lerp(t.minPanSpeed,t.maxPanSpeed,e);x.set(-1*r*M.x,0,0),t.camera.position.copy(t.camera.localToWorld(x));var n=t.camera.position.z+r*M.y;n<t.maxAltitude&&n>t.groundLevel&&(t.camera.position.z=n)}),this.initiateRotation=function(){this.state=m,A.copy(this.getWorldPointAtScreenXY({x:.5*this.domElement.clientWidth,y:.5*this.domElement.clientHeight}));var e=this.camera.position.distanceTo(A);L=Math.acos((this.camera.position.z-A.z)/e)},this.handleRotation=function(){var e=new i.Vector3,r=new i.Quaternion;return function(){var n=-t.rotateSpeed*M.x/t.domElement.clientWidth,i=-t.rotateSpeed*M.y/t.domElement.clientHeight,a=t.camera.position.clone().sub(A);0===n&&0===i||(L+i>=t.minZenithAngle&&L+i<=t.maxZenithAngle&&0!==i&&(L+=i,e.set(0,0,1),r.setFromUnitVectors(t.camera.up,e),a.applyQuaternion(r),e.setFromMatrixColumn(t.camera.matrix,0),r.setFromAxisAngle(e,i),a.applyQuaternion(r),e.set(0,0,1),r.setFromUnitVectors(t.camera.up,e).inverse(),a.applyQuaternion(r)),0!==n&&(e.set(0,0,1),r.setFromAxisAngle(e,n),a.applyQuaternion(r))),t.camera.position.copy(a),t.camera.lookAt(g),t.camera.position.add(A),t.camera.updateMatrixWorld()}}(),this.initiateZoom=function(e){var t;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail);var r=this.getWorldPointAtScreenXY(w),n=new i.Vector3;t>0?(n.lerpVectors(this.camera.position,r,this.zoomInFactor),this.initiateTravel(n,this.zoomTravelTime,null,!1)):t<0&&this.camera.position.z<this.maxAltitude&&(n.lerpVectors(this.camera.position,r,-1*this.zoomOutFactor),this.initiateTravel(n,this.zoomTravelTime,null,!1))},this.initiateSmartZoom=function(){var e=this.getWorldPointAtScreenXY(w),t=new i.Vector3;t.copy(e).sub(this.camera.position),t.z=0,t.normalize();var r=this.camera.position.distanceTo(e),n=i.Math.lerp(this.smartZoomHeightMin,this.smartZoomHeightMax,Math.min(r/5e3,1)),a=new i.Vector3;a.copy(e).add(t.multiplyScalar(2*-n)),a.z=e.z+n,this.initiateTravel(a,"auto",e,!0)},this.initiateTravel=function(e,t,r,n){if(this.state=v,this.view.notifyChange(this.camera),D=0,this.updateMouseCursorType(),N=this.enableRotation&&(r instanceof i.Quaternion||r instanceof i.Vector3),F=n,C.copy(this.camera.position),R.copy(this.camera.quaternion),r instanceof i.Quaternion?O.copy(r):r instanceof i.Vector3&&(e===r?(this.camera.lookAt(r),O.copy(this.camera.quaternion),this.camera.quaternion.copy(R)):(this.camera.position.copy(e),this.camera.lookAt(r),O.copy(this.camera.quaternion),this.camera.quaternion.copy(R),this.camera.position.copy(C))),P.copy(e),this.instantTravel)I=0;else if("auto"===t){var a=Math.min(1,e.distanceTo(this.camera.position)/this.autoTravelTimeDist);if(I=i.Math.lerp(this.autoTravelTimeMin,this.autoTravelTimeMax,a),N){var o=.5-.5*O.normalize().dot(this.camera.quaternion.normalize());I*=1+2*o,I=Math.min(I,this.autoTravelTimeMax)}}else I=t},this.endTravel=function(){this.camera.position.copy(P),N&&this.camera.quaternion.copy(O),this.state=d,this.updateMouseCursorType()},this.handleTravel=function(e){D+=e/1e3/I;var t,r=F?(t=D,Math.pow(Math.pow(t,2)*(3-2*t),1.2)):D;this.camera.position.lerpVectors(C,P,r),!0===N&&i.Quaternion.slerp(R,O,this.camera.quaternion,r),D>1&&this.endTravel()},this.goToTopView=function(){var e=new i.Vector3,t=new i.Quaternion;e.copy(this.getWorldPointAtScreenXY({x:.5*this.domElement.clientWidth,y:.5*this.domElement.clientHeight})),e.z+=Math.min(this.maxAltitude,this.camera.position.distanceTo(e)),t.setFromAxisAngle(new i.Vector3(1,0,0),0),this.initiateTravel(e,"auto",t,!0)},this.goToStartView=function(){this.initiateTravel(n,"auto",y,!0)},this.getWorldPointFromMathPlaneAtScreenXY=(b=new i.Vector3,function(e,r){b.set(e.x/t.domElement.clientWidth*2-1,-e.y/t.domElement.clientHeight*2+1,.5),b.unproject(t.camera);var n=b.sub(t.camera.position).normalize(),i=(r-t.camera.position.z)/n.z;return t.camera.position.clone().add(n.multiplyScalar(i))});var j=new i.Vector3;this.getWorldPointAtScreenXY=function(e){return this.view.getPickingPositionFromDepth(e,j),j||this.getWorldPointFromMathPlaneAtScreenXY(e,this.groundLevel)},this.updateMousePositionAndDelta=function(e){w.set(e.clientX,e.clientY),M.copy(w).sub(_),_.copy(w)},this.addInputListeners=function(){this.domElement.addEventListener("keydown",U,!0),this.domElement.addEventListener("mousedown",k,!1),this.domElement.addEventListener("mouseup",B,!1),this.domElement.addEventListener("mousemove",z,!1),this.domElement.addEventListener("mousewheel",G,!1),this.domElement.addEventListener("MozMousePixelScroll",G,!1)},this.removeInputListeners=function(){this.domElement.removeEventListener("keydown",U,!0),this.domElement.removeEventListener("mousedown",k,!1),this.domElement.removeEventListener("mouseup",B,!1),this.domElement.removeEventListener("mousemove",z,!1),this.domElement.removeEventListener("mousewheel",G,!1),this.domElement.removeEventListener("MozMousePixelScroll",G,!1)},this.updateMouseCursorType=function(){switch(this.state){case d:this.domElement.style.cursor="auto";break;case f:this.domElement.style.cursor="move";break;case p:this.domElement.style.cursor="cell";break;case v:this.domElement.style.cursor="wait";break;case m:this.domElement.style.cursor="move"}},this.addInputListeners()}},function(e,t,r){"use strict";var n=r(1),i=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(0)),o=n(r(133));function s(e,t,r){for(var n=t[e],i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];if(n){if("function"!=typeof n)return n;var s=n.apply(void 0,a);if(s)return s}return"function"==typeof r?r.apply(void 0,a):r}function l(){return new a.Color(16777215*Math.random())}function u(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=(n*=3)+3*t,a=n;a<i;a+=3)e[a]=255*r.r,e[a+1]=255*r.g,e[a+2]=255*r.b}var h=new(n(r(8)).default)("EPSG:4326",0,0);function c(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.length/3,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:a;a*=3;var l,u=(s*=3)+(o*=3);l=isNaN(n)?Array.isArray(n)?function(e){return n[(e-s)/3]}:function(t){return n({},h.set(e.crs,e[t],e[t+1],e[t+2]))}:function(){return n};for(var c=s,d=a;c<u;c+=3,d+=3){var f=l(c)+(Array.isArray(i)?i[(c-s)/3]:i);r.minAltitude&&(r.minAltitude=Math.min(f,r.minAltitude)),r[d]=e[c]+t[c]*f,r[d+1]=e[c+1]+t[c+1]*f,r[d+2]=e[c+2]+t[c+2]*f}}function d(e,t,r,n,i){var a=e.length;e.length+=6*(n-1);for(var o=r,s=a;o<r+n-1;++o,++s)i?(e[s]=o,e[++s]=o+t,e[++s]=o+1,e[++s]=o+1,e[++s]=o+t,e[++s]=o+t+1):(e[s]=o+t,e[++s]=o,e[++s]=o+t+1,e[++s]=o+t+1,e[++s]=o,e[++s]=o+1)}var f=new a.PointsMaterial,p=new a.LineBasicMaterial({vertexColors:a.VertexColors}),m=new a.Color,v=new a.MeshBasicMaterial;function g(e,t){if(e.vertices){var r;switch(e.type){case"point":case"multipoint":r=function(e,t){var r=e.vertices,n=e.normals,i=new Float32Array(r.length),o=new Uint8Array(r.length);c(r,n,i,t.altitude);var h=!0,d=!1,p=void 0;try{for(var m,v=e.geometry[Symbol.iterator]();!(h=(m=v.next()).done);h=!0){var g=m.value,y=s("color",t,l,g.properties),x=g.indices[0].offset;u(o,g.indices[0].count,y,x)}}catch(e){d=!0,p=e}finally{try{h||null==v.return||v.return()}finally{if(d)throw p}}var b=new a.BufferGeometry;return b.addAttribute("position",new a.BufferAttribute(i,3)),b.addAttribute("color",new a.BufferAttribute(o,3,!0)),new a.Points(b,f)}(e,t);break;case"linestring":case"multilinestring":r=function(e,t){var r=e.vertices,n=e.normals,i=new Float32Array(r.length),o=new Uint8Array(r.length),h=r.length/3;c(r,n,i,t.altitude);var d=new a.BufferGeometry;if(d.addAttribute("position",new a.BufferAttribute(i,3)),e.geometry.length>1){var f=2*(h-e.geometry.length),m=new Uint16Array(f),v=0,g=!0,y=!1,x=void 0;try{for(var b,w=e.geometry[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var _=b.value,M=s("color",t,l,_.properties),E=_.indices[0].offset;if(E>65535){console.warn("Feature to Line: integer overflow, too many points in lines");break}var S=_.indices[0].count;u(o,S,M,E);for(var T=E;T<E+S-1&&T<65535;T++)m[v++]=T,m[v++]=T+1}}catch(e){y=!0,x=e}finally{try{g||null==w.return||w.return()}finally{if(y)throw x}}return d.addAttribute("color",new a.BufferAttribute(o,3,!0)),d.setIndex(new a.BufferAttribute(m,1)),new a.LineSegments(d,p)}return u(o,h,s("color",t,l,e.geometry.properties)),d.addAttribute("color",new a.BufferAttribute(o,3,!0)),new a.Line(d,p)}(e,t);break;case"polygon":case"multipolygon":r=t.extrude?function(e,t){var r=e.vertices,n=e.geometry[0].indices[0].offset,i=e.geometry[0].indices[0].count,h=function(e,t,r){for(var n=3*r,i=0,a=n+(t*=3)-3,o=t;o<n;a=o,o+=3)i+=e[a]*e[o+1]-e[o]*e[a+1];return.5*i}(r,n,i)<0,f=e.normals,p=new Float32Array(2*r.length),g=new Uint8Array(2*r.length),y=[],x=r.length/3;p.minAltitude=1/0;var b=!0,w=!1,_=void 0;try{for(var M,E=function(){var e=M.value,n=s("altitude",t,0,e.properties),i=s("extrude",t,0,e.properties),a=s("color",t,l,e.properties);m.copy(a),m.multiplyScalar(.6);var v=e.indices[0].offset,b=e.indices.slice(-1)[0],w=b.offset+b.count,_=w-v;c(r,f,p,n,0,v,_),u(g,_,m,v);var E=v+x;c(r,f,p,n,i,E,_,v),u(g,_,a,E);var S=p.slice(3*E,3*(w+x)),T=e.indices.map(function(e){return e.offset-v}).slice(1),A=(0,o.default)(S,T,3),L=y.length;y.length+=A.length;for(var P=0;P<A.length;P++)y[L+P]=A[P]+E;var C=!0,R=!1,O=void 0;try{for(var D,I=e.indices[Symbol.iterator]();!(C=(D=I.next()).done);C=!0){var N=D.value;d(y,x,N.offset,N.count,h)}}catch(e){R=!0,O=e}finally{try{C||null==I.return||I.return()}finally{if(R)throw O}}},S=e.geometry[Symbol.iterator]();!(b=(M=S.next()).done);b=!0)E()}catch(e){w=!0,_=e}finally{try{b||null==S.return||S.return()}finally{if(w)throw _}}var T=new a.BufferGeometry;T.addAttribute("position",new a.BufferAttribute(p,3)),T.addAttribute("color",new a.BufferAttribute(g,3,!0)),T.setIndex(new a.BufferAttribute(new Uint16Array(y),1));var A=new a.Mesh(T,v);return A.minAltitude=p.minAltitude,A}(e,t):function(e,t){var r=e.vertices,n=e.normals,i=new Float32Array(r.length),h=new Uint8Array(r.length),d=[];i.minAltitude=1/0;var f=!0,p=!1,m=void 0;try{for(var g,y=function(){var e=g.value,a=s("altitude",t,0,e.properties),f=s("color",t,l,e.properties),p=e.indices[0].offset;if(p>65535)return console.warn("Feature to Polygon: integer overflow, too many points in polygons"),"break";var m=e.indices.slice(-1)[0],v=m.offset+m.count,y=v-p;c(r,n,i,a,0,p,y),u(h,y,f,p);var x=i.slice(3*p,3*v),b=e.indices.map(function(e){return e.offset-p}).slice(1),w=(0,o.default)(x,b,3),_=d.length;d.length+=w.length;for(var M=0;M<w.length;M++)d[_+M]=w[M]+p},x=e.geometry[Symbol.iterator]();!(f=(g=x.next()).done)&&"break"!==y();f=!0);}catch(e){p=!0,m=e}finally{try{f||null==x.return||x.return()}finally{if(p)throw m}}var b=new a.BufferGeometry;b.addAttribute("position",new a.BufferAttribute(i,3)),b.addAttribute("color",new a.BufferAttribute(h,3,!0)),b.setIndex(new a.BufferAttribute(new Uint16Array(d),1));var w=new a.Mesh(b,v);return w.minAltitude=i.minAltitude,w}(e,t)}return r.material.vertexColors=a.VertexColors,r.material.color=new a.Color(16777215),r.feature=e,r}}var y={convert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){if(t)return function(e,t){if(e&&0!=e.length){if(1==e.length)return g(e[0],t);var r=new a.Group;r.minAltitude=1/0;var n=!0,i=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=g(s.value,t);r.add(u),r.minAltitude=Math.min(u.minAltitude,r.minAltitude)}}catch(e){i=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}return r}}(t.features,e)}}};t.default=y},function(e,t,r){"use strict";function n(e,t,r){r=r||2;var n,s,l,u,h,f,m,v=t&&t.length,g=v?t[0]*r:e.length,y=i(e,0,g,r,!0),x=[];if(!y||y.next===y.prev)return x;if(v&&(y=function(e,t,r,n){var o,s,l,u=[];for(o=0,s=t.length;o<s;o++)(l=i(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),u.push(p(l));for(u.sort(c),o=0;o<u.length;o++)d(u[o],r),r=a(r,r.next);return r}(e,t,y,r)),e.length>80*r){n=l=e[0],s=u=e[1];for(var b=r;b<g;b+=r)(h=e[b])<n&&(n=h),(f=e[b+1])<s&&(s=f),h>l&&(l=h),f>u&&(u=f);m=0!==(m=Math.max(l-n,u-s))?1/m:0}return o(y,x,r,n,s,m),x}function i(e,t,r,n,i){var a,o;if(i===S(e,t,r,n)>0)for(a=t;a<r;a+=n)o=_(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=_(a,e[a],e[a+1],o);return o&&y(o,o.next)&&(M(o),o=o.next),o}function a(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!y(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(M(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function o(e,t,r,n,i,c,d){if(e){!d&&c&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(e,n,i,c);for(var p,m,v=e;e.prev!==e.next;)if(p=e.prev,m=e.next,c?l(e,n,i,c):s(e))t.push(p.i/r),t.push(e.i/r),t.push(m.i/r),M(e),e=m.next,v=m.next;else if((e=m)===v){d?1===d?o(e=u(e,t,r),t,r,n,i,c,2):2===d&&h(e,t,r,n,i,c):o(a(e),t,r,n,i,c,1);break}}}function s(e){var t=e.prev,r=e,n=e.next;if(g(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(m(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(e,t,r,n){var i=e.prev,a=e,o=e.next;if(g(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,h=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=f(s,l,t,r,n),d=f(u,h,t,r,n),p=e.prevZ,v=e.nextZ;p&&p.z>=c&&v&&v.z<=d;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function u(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!y(i,a)&&x(i,n,n.next,a)&&b(i,a)&&b(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),M(n),M(n.next),n=e=a),n=n.next}while(n!==e);return n}function h(e,t,r,n,i,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&v(l,u)){var h=w(l,u);return l=a(l,l.next),h=a(h,h.next),o(l,t,r,n,i,s),void o(h,t,r,n,i,s)}u=u.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,u=r,h=r.x,c=r.y,d=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=h&&i!==n.x&&m(a<c?i:o,a,h,c,a<c?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&b(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=w(t,e);a(r,r.next)}}function f(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&x(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,r,n){return!!(y(e,t)&&y(r,n)||y(e,n)&&y(r,t))||g(e,t,r)>0!=g(e,t,n)>0&&g(r,n,e)>0!=g(r,n,t)>0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var r=new E(e.i,e.x,e.y),n=new E(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function _(e,t,r,n){var i=new E(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}e.exports=n,e.exports.default=n,n.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,o=Math.abs(S(e,0,a,r));if(i)for(var s=0,l=t.length;s<l;s++){var u=t[s]*r,h=s<l-1?t[s+1]*r:e.length;o-=Math.abs(S(e,u,h,r))}var c=0;for(s=0;s<n.length;s+=3){var d=n[s]*r,f=n[s+1]*r,p=n[s+2]*r;c+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},n.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}},function(e,t,r){"use strict";function n(e,t,r,n,i,a){if(("linestring"==t||"multilinestring"==t)&&function(e,t,r,n,i){for(var a=e._values[0],o=e._values[1],s=n+2,l=n;s<n+i;l=s,s+=2){var u=t[s],h=t[s+1],c=t[l],d=t[l+1],f=c-u,p=d-h,m=Math.sqrt(f*f+p*p),v=((a-u)*f+(o-h)*p)/m;if(v>=-r&&v<=m+r&&Math.abs(p*a-f*o+c*h-d*u)/m<=r)return!0}return!1}(e,r,n,i,a))return!0;if(("polygon"==t||"multipolygon"==t)&&function(e,t,r,n){for(var i=e._values[0],a=e._values[1],o=!1,s=r,l=r+n-2;s<r+n;l=s,s+=2){var u=t[s],h=t[s+1],c=t[l],d=t[l+1];h>a!=d>a&&i<(c-u)*(a-h)/(d-h)+u&&(o=!o)}return o}(e,r,i,a))return!0;if("point"==t||"multipoint"==t){var o=function(e,t,r,n,i){for(var a,o=e._values[0],s=e._values[1],l=r*r,u=n;u<n+i;u+=2){var h=o-t[u],c=s-t[u+1],d=h*h+c*c;d<l&&(a=[t[u],t[u+1]],l=d)}return a}(e,r,n,i,a);if(o)return{coordinates:o}}}function i(e,t,r,i){var a=e.as(t.crs),o=!0,s=!1,l=void 0;try{for(var u,h=t.geometry[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var c=u.value;if(null==c.extent||c.extent.isPointInside(a,r)){var d=2*c.indices[0].offset,f=2*c.indices[0].count,p=n(a,t.type,t.vertices,r,d,f);p&&i.push({type:t.type,geometry:c,coordinates:p.coordinates})}}}catch(e){s=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(s)throw l}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={filterFeaturesUnderCoordinate:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=[];if(t.extent&&!t.extent.isPointInside(e,r))return n;if(Array.isArray(t.features)){var a=!0,o=!1,s=void 0;try{for(var l,u=t.features[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var h=l.value;h.extent&&!h.extent.isPointInside(e,r)||i(e,h,r,n)}}catch(e){o=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}else t.geometry&&i(e,t,r,n);return n}};t.default=a},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a,o,s,l=n(r(0)),u=l.Math.DEG2RAD,h=(i=new l.Matrix4,a=i.elements,o=new l.Vector3,s=new l.Vector3,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Quaternion;return s.set(-e.y,e.x,0),s.normalize(),o.crossVectors(e,s),a[0]=s.x,a[4]=o.x,a[8]=e.x,a[1]=s.y,a[5]=o.y,a[9]=e.y,a[2]=s.z,a[6]=o.z,a[10]=e.z,t.setFromRotationMatrix(i)}),c=new l.Quaternion,d={localQuaternionFromAttitude:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Quaternion;return void 0!==e.roll||void 0!==e.pitch||void 0!==e.heading?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return e*=u,t*=u,r*=u,n.setFromEuler(new l.Euler(-t,-e,-r,"YXZ"))}(e.roll,e.pitch,e.heading,t):void 0!==e.omega||void 0!==e.phi||void 0!==e.kappa?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return e*=u,t*=u,r*=u,n.setFromEuler(new l.Euler(e,t,r,"XYZ")),n.set(n.w,n.z,-n.y,-n.x),n}(e.omega,e.phi,e.kappa,t):t.set(0,0,0,1)},globeQuaternionFromAttitude:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.Quaternion;return h(t.geodesicNormal,c),this.localQuaternionFromAttitude(e,r),r.premultiply(c),r},quaternionFromAttitude:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.Quaternion;return r?this.globeQuaternionFromAttitude(e,t,n):this.localQuaternionFromAttitude(e,n)}};t.default=d},function(e,t,r){"use strict";var n=r(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a={color_layers_pars_fragment:"struct Layer {\n    int textureOffset;\n    int crs;\n    float effect;\n    float opacity;\n};\n\nuniform sampler2D   colorTextures[NUM_FS_TEXTURES];\nuniform vec4        colorOffsetScales[NUM_FS_TEXTURES];\nuniform Layer       colorLayers[NUM_FS_TEXTURES];\nuniform int         colorTextureCount;\n\nvec3 uvs[NUM_CRS];\n\nfloat getBorderDistance(vec2 uv) {\n    vec2 p2 = min(uv, 1. -uv);\n    return min(p2.x, p2.y);\n}\n\nvec4 applyWhiteToInvisibleEffect(vec4 color, float intensity) {\n    float a = dot(color.rgb, vec3(0.333333333));\n    color.a *= 1.0 - pow(abs(a), intensity);\n    return color;\n}\n\nvec4 applyLightColorToInvisibleEffect(vec4 color, float intensity) {\n    float a = max(0.05,1. - length(color.xyz - 1.));\n    color.a *= 1.0 - pow(abs(a), intensity);\n    color.rgb *= color.rgb * color.rgb;\n    return color;\n}\n\n#if defined(DEBUG)\nuniform bool showOutline;\nuniform vec3 outlineColors[NUM_CRS];\nuniform float outlineWidth;\n\nvec4 getOutlineColor(vec3 outlineColor, vec2 uv) {\n    float alpha = 1. - clamp(getBorderDistance(uv) / outlineWidth, 0., 1.);\n    return vec4(outlineColor, alpha);\n}\n#endif\n\nuniform float minBorderDistance;\nvec4 getLayerColor(int textureOffset, sampler2D texture, vec4 offsetScale, Layer layer) {\n    if ( textureOffset >= colorTextureCount ) return vec4(0);\n\n    vec3 uv;\n    // #pragma unroll_loop\n    for ( int i = 0; i < NUM_CRS; i ++ ) {\n        if ( i == layer.crs ) uv = uvs[ i ];\n    }\n\n    float borderDistance = getBorderDistance(uv.xy);\n    if (textureOffset != layer.textureOffset + int(uv.z) || borderDistance < minBorderDistance ) return vec4(0);\n    vec4 color = texture2D(texture, pitUV(uv.xy, offsetScale));\n    if(color.a > 0.0) {\n        if(layer.effect > 2.0) {\n            color.rgb /= color.a;\n            color = applyLightColorToInvisibleEffect(color, layer.effect);\n        } else if(layer.effect > 0.0) {\n            color.rgb /= color.a;\n            color = applyWhiteToInvisibleEffect(color, layer.effect);\n        }\n    }\n\n    color.a *= layer.opacity;\n    return color;\n}\n",elevation_pars_vertex:"#if NUM_VS_TEXTURES > 0\n    struct Layer {\n        float scale;\n        float bias;\n        int mode;\n        float zmin;\n        float zmax;\n    };\n\n    uniform Layer       elevationLayers[NUM_VS_TEXTURES];\n    uniform sampler2D   elevationTextures[NUM_VS_TEXTURES];\n    uniform vec4        elevationOffsetScales[NUM_VS_TEXTURES];\n    uniform int         elevationTextureCount;\n\n    highp float decode32(highp vec4 rgba) {\n        highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;\n        highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;\n        highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);\n        highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));\n        return Result;\n    }\n\n    float getElevationMode(vec2 uv, sampler2D texture, int mode) {\n        if (mode == ELEVATION_RGBA)\n            return decode32(texture2D( texture, uv ).abgr * 255.0);\n        if (mode == ELEVATION_DATA)\n            return texture2D( texture, uv ).w;\n        if (mode == ELEVATION_COLOR)\n            return texture2D( texture, uv ).r;\n        return 0.;\n    }\n\n    float getElevation(vec2 uv, sampler2D texture, vec4 offsetScale, Layer layer) {\n        uv = uv * offsetScale.zw + offsetScale.xy;\n        float d = getElevationMode(uv, texture, layer.mode);\n        if (d < layer.zmin || d > layer.zmax) d = 0.;\n        return d * layer.scale + layer.bias;\n    }\n#endif\n",elevation_vertex:"#if NUM_VS_TEXTURES > 0\n    if(elevationTextureCount > 0) {\n        float elevation = getElevation(uv, elevationTextures[0], elevationOffsetScales[0], elevationLayers[0]);\n        transformed += elevation * normal;\n    }\n#endif\n",fog_fragment:"#if defined(USE_FOG)\n    float fogFactor = 1. - min( exp(-fogDepth / fogDistance), 1.);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor);\n#endif\n",fog_pars_fragment:"#if defined(USE_FOG)\nuniform vec3  fogColor;\nuniform float fogDistance;\nvarying float fogDepth;\n#endif\n",lighting_fragment:"if (lightingEnabled) {\n    float light = min(2. * dot(vNormal, lightPosition), 1.);\n    gl_FragColor.rgb *= light;\n}\n",lighting_pars_fragment:"uniform bool lightingEnabled;\nuniform vec3 lightPosition;\nvarying vec3 vNormal;\n",mode_depth_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragColor = packDepthToRGBA(gl_FragDepthEXT);\n#else\ngl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n#endif\n",mode_id_fragment:"// 16777216.0 == 256.0 * 256.0 * 256.0\ngl_FragColor = packDepthToRGBA(float(objectId) / 16777216.0);\n",mode_pars_fragment:"#if MODE == MODE_ID || MODE == MODE_DEPTH\n#include <packing>\n#endif\n\n#if MODE == MODE_ID\nuniform int objectId;\n#endif\n",overlay_fragment:"gl_FragColor.rgb = mix(gl_FragColor.rgb, overlayColor, overlayAlpha);\n",overlay_pars_fragment:"uniform vec3  overlayColor;\nuniform float overlayAlpha;\n",pitUV:"vec2 pitUV(vec2 uv, vec4 pit)\n{\n    return uv * pit.zw + vec2(pit.x, 1.0 - pit.w - pit.y);\n}\n\n",precision_qualifier:"precision highp float;\nprecision highp int;\n",projective_texturing_vertex:"for(int i = 0; i < NUM_TEXTURES; ++i)\n    projectiveTextureCoords[i] = projectiveTextureMatrix[i] * mvPosition;\n",projective_texturing_pars_vertex:"uniform mat4 projectiveTextureMatrix[NUM_TEXTURES];\nvarying vec4 projectiveTextureCoords[NUM_TEXTURES];\n",projective_texturing_pars_fragment:"uniform sampler2D projectiveTexture[NUM_TEXTURES];\nvarying vec4      projectiveTextureCoords[NUM_TEXTURES];\nuniform float     projectiveTextureAlphaBorder;\n\nstruct Distortion {\n    vec2 size;\n#if USE_DISTORTION\n    vec2 pps;\n    vec4 polynom;\n    vec3 l1l2;\n#endif\n};\n\nuniform Distortion projectiveTextureDistortion[NUM_TEXTURES];\n\nfloat getAlphaBorder(vec2 p)\n{\n    vec2 d = clamp(projectiveTextureAlphaBorder * min(p, 1. - p), 0., 1.);\n    return min(d.x, d.y);\n}\n\n#if USE_DISTORTION\nvoid distort(inout vec2 p, vec4 polynom, vec2 pps)\n{\n    vec2 v = p - pps;\n    float v2 = dot(v, v);\n    if (v2 > polynom.w) {\n        p = vec2(-1.);\n    }\n    else {\n        p += (v2 * (polynom.x + v2 * (polynom.y + v2 * polynom.z) ) ) * v;\n    }\n}\n\nvoid distort(inout vec2 p, vec4 polynom, vec3 l1l2, vec2 pps)\n{ \n    if ((l1l2.x == 0.) && (l1l2.y == 0.)) {\n        distort(p, polynom, pps);\n    } else {\n        vec2 AB = (p - pps) / l1l2.z;\n        float R = length(AB);\n        float lambda = atan(R) / R;\n        vec2 ab = lambda * AB;\n        float rho2 = dot(ab, ab);\n        float r357 = 1. + rho2* (polynom.x + rho2* (polynom.y + rho2 * polynom.z));\n        p = pps + l1l2.z * (r357 * ab + vec2(dot(l1l2.xy, ab), l1l2.y * ab.x));\n    }\n}\n#endif\n\nvec4 projectiveTextureColor(vec4 coords, Distortion distortion, sampler2D texture)\n{\n    vec3 p = coords.xyz / coords.w;\n    if(p.z * p.z < 1.) {\n#if USE_DISTORTION\n        p.xy *= distortion.size;\n        distort(p.xy, distortion.polynom, distortion.l1l2, distortion.pps);\n        p.xy /= distortion.size;\n#endif\n\n        float d = getAlphaBorder(p.xy);\n        if(d > 0.) {\n\n#if DEBUG_ALPHA_BORDER\n            vec3 r = texture2D(texture, p.xy).rgb;\n            return vec4( r.r * d, r.g, r.b, 1.0);\n#else\n            return d * texture2D(texture, p.xy);\n#endif\n\n        }\n    }\n    return vec4(0.);\n}\n",project_pars_vertex:"attribute vec3 position;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n",install:function(e,t,r){return r?(Object.keys(t).forEach(function(n){"install"!=n&&(e[r+n]=t[n])}),e):Object.assign(e,this)}};a.install(i.ShaderChunk,a,"itowns/");var o=a;t.default=o},function(e,t,r){"use strict";var n=r(74),i=r(140),a=r(144);function o(e){return e&&e.rel}function s(e,t){return t.rel.split(/\s+/).forEach(function(r){e[r]=a(t,{rel:r})}),e}function l(e,t){var r=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return r&&(e[r[1]]=r[2]),e}function u(e){try{var t=e.split(";"),r=t.shift().replace(/[<>]/g,""),o=i.parse(r),s=n.parse(o.query),u=t.reduce(l,{});return(u=a(s,u)).url=r,u}catch(e){return null}}e.exports=function(e){return e?e.split(/,\s*</).map(u).filter(o).reduce(s,{}):null}},function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,a){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var h=0;h<u;++h){var c,d,f,p,m=e[h].replace(s,"%20"),v=m.indexOf(r);v>=0?(c=m.substr(0,v),d=m.substr(v+1)):(c=m,d=""),f=decodeURIComponent(c),p=decodeURIComponent(d),n(o,f)?i(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?a(o(e),function(o){var s=encodeURIComponent(n(o))+r;return i(e[o])?a(e[o],function(e){return s+encodeURIComponent(n(e))}).join(t):s+encodeURIComponent(n(e[o]))}).join(t):s?encodeURIComponent(n(s))+r+encodeURIComponent(n(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){"use strict";var n=r(141),i=r(143);function a(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=x,t.resolve=function(e,t){return x(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?x(e,!1,!0).resolveObject(t):t},t.format=function(e){return i.isString(e)&&(e=x(e)),e instanceof a?e.format():a.prototype.format.call(e)},t.Url=a;var o=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(u),c=["%","/","?",";","#"].concat(h),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r(74);function x(e,t,r){if(e&&i.isObject(e)&&e instanceof a)return e;var n=new a;return n.parse(e,t,r),n}a.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var a=e.indexOf("?"),s=-1!==a&&a<e.indexOf("#")?"?":"#",u=e.split(s);u[0]=u[0].replace(/\\/g,"/");var x=e=u.join(s);if(x=x.trim(),!r&&1===e.split("#").length){var b=l.exec(x);if(b)return this.path=x,this.href=x,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=o.exec(x);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,x=x.substr(w.length)}if(r||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var M="//"===x.substr(0,2);!M||w&&v[w]||(x=x.substr(2),this.slashes=!0)}if(!v[w]&&(M||w&&!g[w])){for(var E,S,T=-1,A=0;A<d.length;A++)-1!==(L=x.indexOf(d[A]))&&(-1===T||L<T)&&(T=L);for(-1!==(S=-1===T?x.lastIndexOf("@"):x.lastIndexOf("@",T))&&(E=x.slice(0,S),x=x.slice(S+1),this.auth=decodeURIComponent(E)),T=-1,A=0;A<c.length;A++){var L;-1!==(L=x.indexOf(c[A]))&&(-1===T||L<T)&&(T=L)}-1===T&&(T=x.length),this.host=x.slice(0,T),x=x.slice(T),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var C=this.hostname.split(/\./),R=(A=0,C.length);A<R;A++){var O=C[A];if(O&&!O.match(f)){for(var D="",I=0,N=O.length;I<N;I++)O.charCodeAt(I)>127?D+="x":D+=O[I];if(!D.match(f)){var F=C.slice(0,A),U=C.slice(A+1),k=O.match(p);k&&(F.push(k[1]),U.unshift(k[2])),U.length&&(x="/"+U.join(".")+x),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+B,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!m[_])for(A=0,R=h.length;A<R;A++){var G=h[A];if(-1!==x.indexOf(G)){var j=encodeURIComponent(G);j===G&&(j=escape(G)),x=x.split(G).join(j)}}var V=x.indexOf("#");-1!==V&&(this.hash=x.substr(V),x=x.slice(0,V));var H=x.indexOf("?");if(-1!==H?(this.search=x.substr(H),this.query=x.substr(H+1),t&&(this.query=y.parse(this.query)),x=x.slice(0,H)):t&&(this.search="",this.query={}),x&&(this.pathname=x),g[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},a.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",a=!1,o="";this.host?a=e+this.host:this.hostname&&(a=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(a+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(o=y.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==a?(a="//"+(a||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):a||(a=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),t+a+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+n},a.prototype.resolve=function(e){return this.resolveObject(x(e,!1,!0)).format()},a.prototype.resolveObject=function(e){if(i.isString(e)){var t=new a;t.parse(e,!1,!0),e=t}for(var r=new a,n=Object.keys(this),o=0;o<n.length;o++){var s=n[o];r[s]=this[s]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var h=l[u];"protocol"!==h&&(r[h]=e[h])}return g[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!g[e.protocol]){for(var c=Object.keys(e),d=0;d<c.length;d++){var f=c[d];r[f]=e[f]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||v[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",y=r.search||"";r.path=m+y}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var x=r.pathname&&"/"===r.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||x||r.host&&e.pathname,_=w,M=r.pathname&&r.pathname.split("/")||[],E=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!g[r.protocol]);if(E&&(r.hostname="",r.port=null,r.host&&(""===M[0]?M[0]=r.host:M.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===M[0])),b)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,M=p;else if(p.length)M||(M=[]),M.pop(),M=M.concat(p),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search))return E&&(r.hostname=r.host=M.shift(),(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift())),r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!M.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=M.slice(-1)[0],T=(r.host||e.host||M.length>1)&&("."===S||".."===S)||""===S,A=0,L=M.length;L>=0;L--)"."===(S=M[L])?M.splice(L,1):".."===S?(M.splice(L,1),A++):A&&(M.splice(L,1),A--);if(!w&&!_)for(;A--;A)M.unshift("..");!w||""===M[0]||M[0]&&"/"===M[0].charAt(0)||M.unshift(""),T&&"/"!==M.join("/").substr(-1)&&M.push("");var P,C=""===M[0]||M[0]&&"/"===M[0].charAt(0);return E&&(r.hostname=r.host=C?"":M.length?M.shift():"",(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift())),(w=w||r.host&&M.length)&&!C&&M.unshift(""),M.length?r.pathname=M.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},a.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,r){(function(e,n){var i;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(a){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof n&&n;o.global!==o&&o.window!==o&&o.self;var s,l=2147483647,u=36,h=1,c=26,d=38,f=700,p=72,m=128,v="-",g=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-h,_=Math.floor,M=String.fromCharCode;function E(e){throw new RangeError(b[e])}function S(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function T(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+S((e=e.replace(x,".")).split("."),t).join(".")}function A(e){for(var t,r,n=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function L(e){return S(e,function(e){var t="";return e>65535&&(t+=M((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+M(e)}).join("")}function P(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,r){var n=0;for(e=r?_(e/f):e>>1,e+=_(e/t);e>w*c>>1;n+=u)e=_(e/w);return _(n+(w+1)*e/(e+d))}function R(e){var t,r,n,i,a,o,s,d,f,g,y,x=[],b=e.length,w=0,M=m,S=p;for((r=e.lastIndexOf(v))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&E("not-basic"),x.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<b;){for(a=w,o=1,s=u;i>=b&&E("invalid-input"),((d=(y=e.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:u)>=u||d>_((l-w)/o))&&E("overflow"),w+=d*o,!(d<(f=s<=S?h:s>=S+c?c:s-S));s+=u)o>_(l/(g=u-f))&&E("overflow"),o*=g;S=C(w-a,t=x.length+1,0==a),_(w/t)>l-M&&E("overflow"),M+=_(w/t),w%=t,x.splice(w++,0,M)}return L(x)}function O(e){var t,r,n,i,a,o,s,d,f,g,y,x,b,w,S,T=[];for(x=(e=A(e)).length,t=m,r=0,a=p,o=0;o<x;++o)(y=e[o])<128&&T.push(M(y));for(n=i=T.length,i&&T.push(v);n<x;){for(s=l,o=0;o<x;++o)(y=e[o])>=t&&y<s&&(s=y);for(s-t>_((l-r)/(b=n+1))&&E("overflow"),r+=(s-t)*b,t=s,o=0;o<x;++o)if((y=e[o])<t&&++r>l&&E("overflow"),y==t){for(d=r,f=u;!(d<(g=f<=a?h:f>=a+c?c:f-a));f+=u)S=d-g,w=u-g,T.push(M(P(g+S%w,0))),d=_(S/w);T.push(M(P(d,0))),a=C(r,b,n==i),r=0,++n}++r,++t}return T.join("")}s={version:"1.4.1",ucs2:{decode:A,encode:L},decode:R,encode:O,toASCII:function(e){return T(e,function(e){return y.test(e)?"xn--"+O(e):e})},toUnicode:function(e){return T(e,function(e){return g.test(e)?R(e.slice(4).toLowerCase()):e})}},void 0===(i=function(){return s}.call(t,r,t,e))||(e.exports=i)}()}).call(this,r(142)(e),r(55))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},function(e,t,r){"use strict";r.r(t);var n=1,i=2,a=484813681109536e-20,o=Math.PI/2,s=.16666666666666666,l=.04722222222222222,u=.022156084656084655,h=1e-10,c=.017453292519943295,d=57.29577951308232,f=Math.PI/4,p=2*Math.PI,m=3.14159265359,v={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},g={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},y=/[\s_\-\/\(\)]/g;function x(e,t){if(e[t])return e[t];for(var r,n=Object.keys(e),i=t.toLowerCase().replace(y,""),a=-1;++a<n.length;)if((r=n[a]).toLowerCase().replace(y,"")===i)return e[r]}var b=function(e){var t,r,n,i={},a=e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var r=t.split("=");return r.push(!0),e[r[0].toLowerCase()]=r[1],e},{}),o={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*c},lat_1:function(e){i.lat1=e*c},lat_2:function(e){i.lat2=e*c},lat_ts:function(e){i.lat_ts=e*c},lon_0:function(e){i.long0=e*c},lon_1:function(e){i.long1=e*c},lon_2:function(e){i.long2=e*c},alpha:function(e){i.alpha=parseFloat(e)*c},lonc:function(e){i.longc=e*c},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(e){i.units=e;var t=x(g,e);t&&(i.to_meter=t.to_meter)},from_greenwich:function(e){i.from_greenwich=e*c},pm:function(e){var t=x(v,e);i.from_greenwich=(t||parseFloat(e))*c},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){3===e.length&&-1!=="ewnsud".indexOf(e.substr(0,1))&&-1!=="ewnsud".indexOf(e.substr(1,1))&&-1!=="ewnsud".indexOf(e.substr(2,1))&&(i.axis=e)}};for(t in a)r=a[t],t in o?"function"==typeof(n=o[t])?n(r):i[n]=r:i[t]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i},w=1,_=/\s/,M=/[A-Za-z]/,E=/[A-Za-z84]/,S=/[,\]]/,T=/[\d\.E\-\+]/;function A(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=w}function L(e,t,r){Array.isArray(t)&&(r.unshift(t),t=null);var n=t?{}:e,i=r.reduce(function(e,t){return P(t,e),e},n);t&&(e[t]=i)}function P(e,t){if(Array.isArray(e)){var r,n=e.shift();if("PARAMETER"===n&&(n=e.shift()),1===e.length)return Array.isArray(e[0])?(t[n]={},void P(e[0],t[n])):void(t[n]=e[0]);if(e.length)if("TOWGS84"!==n)switch(Array.isArray(n)||(t[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[n]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&P(e[2],t[n]));case"SPHEROID":case"ELLIPSOID":return t[n]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&P(e[3],t[n]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void L(t,n,e);default:for(r=-1;++r<e.length;)if(!Array.isArray(e[r]))return P(e,t[n]);return L(t,n,e)}else t[n]=e;else t[n]=!0}else t[e]=!0}A.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;_.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case w:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},A.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(S.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},A.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=w)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=w,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},A.prototype.number=function(e){if(!T.test(e)){if(S.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},A.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},A.prototype.keyword=function(e){if(E.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=w)}if(!S.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},A.prototype.neutral=function(e){if(M.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(T.test(e))return this.word=e,void(this.state=3);if(!S.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},A.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var C=.017453292519943295;function R(e){return e*C}var O=function(e){var t=function(e){return new A(e).output()}(e),r=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",r]);var i={};return P(t,i),function(e){"GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var t=e.GEOGCS;function r(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(t=e),t&&(t.DATUM?e.datumCode=t.DATUM.name.toLowerCase():e.datumCode=t.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"===e.datumCode&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),t.DATUM&&t.DATUM.SPHEROID&&(e.ellps=t.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=t.DATUM.SPHEROID.a,e.rf=parseFloat(t.DATUM.SPHEROID.rf,10)),t.DATUM&&t.DATUM.TOWGS84&&(e.datum_params=t.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",R],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",R],["x0","false_easting",r],["y0","false_northing",r],["long0","central_meridian",R],["lat0","latitude_of_origin",R],["lat0","standard_parallel_1",R],["lat1","standard_parallel_1",R],["lat2","standard_parallel_2",R],["azimuth","Azimuth"],["alpha","azimuth",R],["srsCode","name"]].forEach(function(t){return r=e,i=(n=t)[0],a=n[1],void(!(i in r)&&a in r&&(r[i]=r[a],3===n.length&&(r[i]=n[2](r[i]))));var r,n,i,a}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=R(e.lat1>0?90:-90),e.lat_ts=e.lat1)}(i),i};function D(e){var t=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?D[e]=b(arguments[1]):D[e]=O(arguments[1]):D[e]=r}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?D.apply(t,e):D(e)});if("string"==typeof e){if(e in D)return D[e]}else"EPSG"in e?D["EPSG:"+e.EPSG]=e:"ESRI"in e?D["ESRI:"+e.ESRI]=e:"IAU2000"in e?D["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(D);var I=D,N=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],F=["3857","900913","3785","102113"],U=function(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in I}(e))return I[e];if(function(e){return N.some(function(t){return e.indexOf(t)>-1})}(e)){var t=O(e);if(function(e){var t=x(e,"authority");if(t){var r=x(t,"epsg");return r&&F.indexOf(r)>-1}}(t))return I["EPSG:3857"];var r=function(e){var t=x(e,"extension");if(t)return x(t,"proj4")}(t);return r?b(r):t}return function(e){return"+"===e[0]}(e)?b(e):void 0},k=function(e,t){var r,n;if(e=e||{},!t)return e;for(n in t)void 0!==(r=t[n])&&(e[n]=r);return e},B=function(e,t,r){var n=e*t;return r/Math.sqrt(1-n*n)},z=function(e){return e<0?-1:1},G=function(e){return Math.abs(e)<=m?e:e-z(e)*p},j=function(e,t,r){var n=e*r,i=.5*e;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(o-t))/n},V=function(e,t){for(var r,n,i=.5*e,a=o-2*Math.atan(t),s=0;s<=15;s++)if(r=e*Math.sin(a),a+=n=o-2*Math.atan(t*Math.pow((1-r)/(1+r),i))-a,Math.abs(n)<=1e-10)return a;return-9999};function H(e){return e}var W=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=B(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,r,n=e.x,i=e.y;if(i*d>90&&i*d<-90&&n*d>180&&n*d<-180)return null;if(Math.abs(Math.abs(i)-o)<=h)return null;if(this.sphere)t=this.x0+this.a*this.k0*G(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(f+.5*i));else{var a=Math.sin(i),s=j(this.e,i,a);t=this.x0+this.a*this.k0*G(n-this.long0),r=this.y0-this.a*this.k0*Math.log(s)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=o-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var a=Math.exp(-i/(this.a*this.k0));if(-9999===(r=V(this.e,a)))return null}return t=G(this.long0+n/(this.a*this.k0)),e.x=t,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:H,inverse:H,names:["longlat","identity"]}],q={},X=[];function Y(e,t){var r=X.length;return e.names?(X[r]=e,e.names.forEach(function(e){q[e.toLowerCase()]=r}),this):(console.log(t),!0)}var Z={start:function(){W.forEach(Y)},add:Y,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==q[t]&&X[q[t]]?X[q[t]]:void 0}},J={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},K=J.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};J.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Q={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},$=function(e,t,r,o,s,l){var u={};return u.datum_type=void 0===e||"none"===e?5:4,t&&(u.datum_params=t.map(parseFloat),0===u.datum_params[0]&&0===u.datum_params[1]&&0===u.datum_params[2]||(u.datum_type=n),u.datum_params.length>3&&(0===u.datum_params[3]&&0===u.datum_params[4]&&0===u.datum_params[5]&&0===u.datum_params[6]||(u.datum_type=i,u.datum_params[3]*=a,u.datum_params[4]*=a,u.datum_params[5]*=a,u.datum_params[6]=u.datum_params[6]/1e6+1))),u.a=r,u.b=o,u.es=s,u.ep2=l,u};function ee(e,t){if(!(this instanceof ee))return new ee(e);t=t||function(e){if(e)throw e};var r=U(e);if("object"==typeof r){var n=ee.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=x(Q,r.datumCode);i&&(r.datum_params=i.towgs84?i.towgs84.split(","):null,r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84";var a,o,c,d,f,p,m=function(e,t,r,n,i){if(!e){var a=x(J,n);a||(a=K),e=a.a,t=a.b,r=a.rf}return r&&!t&&(t=(1-1/r)*e),(0===r||Math.abs(e-t)<h)&&(i=!0,t=e),{a:e,b:t,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),v=(a=m.a,o=m.b,m.rf,f=((c=a*a)-(d=o*o))/c,p=0,r.R_A?(c=(a*=1-f*(s+f*(l+f*u)))*a,f=0):p=Math.sqrt(f),{es:f,e:p,ep2:(c-d)/d}),g=r.datum||$(r.datumCode,r.datum_params,m.a,m.b,v.es,v.ep2);k(this,r),k(this,n),this.a=m.a,this.b=m.b,this.rf=m.rf,this.sphere=m.sphere,this.es=v.es,this.e=v.e,this.ep2=v.ep2,this.datum=g,this.init(),t(null,this)}else t(e)}else t(e)}ee.projections=Z,ee.projections.start();var te=ee;function re(e){return e===n||e===i}var ne=function(e,t,r){return function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===n?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==i||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t)?r:5===e.datum_type||5===t.datum_type?r:e.es!==t.es||e.a!==t.a||re(e.datum_type)||re(t.datum_type)?(r=function(e,t,r){var n,i,a,s,l=e.x,u=e.y,h=e.z?e.z:0;if(u<-o&&u>-1.001*o)u=-o;else if(u>o&&u<1.001*o)u=o;else{if(u<-o)return{x:-1/0,y:-1/0,z:e.z};if(u>o)return{x:1/0,y:1/0,z:e.z}}return l>Math.PI&&(l-=2*Math.PI),i=Math.sin(u),s=Math.cos(u),a=i*i,{x:((n=r/Math.sqrt(1-t*a))+h)*s*Math.cos(l),y:(n+h)*s*Math.sin(l),z:(n*(1-t)+h)*i}}(r,e.es,e.a),re(e.datum_type)&&(r=function(e,t,r){if(t===n)return{x:e.x+r[0],y:e.y+r[1],z:e.z+r[2]};if(t===i){var a=r[0],o=r[1],s=r[2],l=r[3],u=r[4],h=r[5],c=r[6];return{x:c*(e.x-h*e.y+u*e.z)+a,y:c*(h*e.x+e.y-l*e.z)+o,z:c*(-u*e.x+l*e.y+e.z)+s}}}(r,e.datum_type,e.datum_params)),re(t.datum_type)&&(r=function(e,t,r){if(t===n)return{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]};if(t===i){var a=r[0],o=r[1],s=r[2],l=r[3],u=r[4],h=r[5],c=r[6],d=(e.x-a)/c,f=(e.y-o)/c,p=(e.z-s)/c;return{x:d+h*f-u*p,y:-h*d+f+l*p,z:u*d-l*f+p}}}(r,t.datum_type,t.datum_params)),function(e,t,r,n){var i,a,o,s,l,u,h,c,d,f,p,m,v,g,y,x=e.x,b=e.y,w=e.z?e.z:0;if(i=Math.sqrt(x*x+b*b),a=Math.sqrt(x*x+b*b+w*w),i/r<1e-12){if(g=0,a/r<1e-12)return y=-n,{x:e.x,y:e.y,z:e.z}}else g=Math.atan2(b,x);o=w/a,c=(s=i/a)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*s*s)),d=o*l,v=0;do{v++,u=t*(h=r/Math.sqrt(1-t*d*d))/(h+(y=i*c+w*d-h*(1-t*d*d))),m=(p=o*(l=1/Math.sqrt(1-u*(2-u)*s*s)))*c-(f=s*(1-u)*l)*d,c=f,d=p}while(m*m>1e-24&&v<30);return{x:g,y:Math.atan(p/Math.abs(f)),z:y}}(r,t.es,t.a,t.b)):r},ie=function(e,t,r){var n,i,a,o=r.x,s=r.y,l=r.z||0,u={};for(a=0;a<3;a++)if(!t||2!==a||void 0!==r.z)switch(0===a?(n=o,i="x"):1===a?(n=s,i="y"):(n=l,i="z"),e.axis[a]){case"e":u[i]=n;break;case"w":u[i]=-n;break;case"n":u[i]=n;break;case"s":u[i]=-n;break;case"u":void 0!==r[i]&&(u.z=n);break;case"d":void 0!==r[i]&&(u.z=-n);break;default:return null}return u},ae=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t},oe=function(e){se(e.x),se(e.y)};function se(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function le(e,t,r){var a;return Array.isArray(r)&&(r=ae(r)),oe(r),e.datum&&t.datum&&function(e,t){return(e.datum.datum_type===n||e.datum.datum_type===i)&&"WGS84"!==t.datumCode||(t.datum.datum_type===n||t.datum.datum_type===i)&&"WGS84"!==e.datumCode}(e,t)&&(r=le(e,a=new te("WGS84"),r),e=a),"enu"!==e.axis&&(r=ie(e,!1,r)),"longlat"===e.projName?r={x:r.x*c,y:r.y*c}:(e.to_meter&&(r={x:r.x*e.to_meter,y:r.y*e.to_meter}),r=e.inverse(r)),e.from_greenwich&&(r.x+=e.from_greenwich),r=ne(e.datum,t.datum,r),t.from_greenwich&&(r={x:r.x-t.from_greenwich,y:r.y}),"longlat"===t.projName?r={x:r.x*d,y:r.y*d}:(r=t.forward(r),t.to_meter&&(r={x:r.x/t.to_meter,y:r.y/t.to_meter})),"enu"!==t.axis?ie(t,!0,r):r}var ue=te("WGS84");function he(e,t,r){var n,i,a;return Array.isArray(r)?(n=le(e,t,r),3===r.length?[n.x,n.y,n.z]:[n.x,n.y]):(i=le(e,t,r),2===(a=Object.keys(r)).length?i:(a.forEach(function(e){"x"!==e&&"y"!==e&&(i[e]=r[e])}),i))}function ce(e){return e instanceof te?e:e.oProj?e.oProj:te(e)}var de=function(e,t,r){e=ce(e);var n,i=!1;return void 0===t?(t=e,e=ue,i=!0):(void 0!==t.x||Array.isArray(t))&&(r=t,t=e,e=ue,i=!0),t=ce(t),r?he(e,t,r):(n={forward:function(r){return he(e,t,r)},inverse:function(r){return he(t,e,r)}},i&&(n.oProj=t),n)},fe=6,pe="AJSAJS",me="AFAFAF",ve=65,ge=73,ye=79,xe=86,be=90,we={forward:_e,inverse:function(e){var t=Te(Le(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:Me};function _e(e,t){return t=t||5,function(e,t){var r,n,i,a,o,s,l,u,h,c,d,f="00000"+e.easting,p="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(h=e.easting,c=e.northing,d=Ae(e.zoneNumber),r=Math.floor(h/1e5),n=Math.floor(c/1e5)%20,i=d-1,a=pe.charCodeAt(i),o=me.charCodeAt(i),u=!1,(s=a+r-1)>be&&(s=s-be+ve-1,u=!0),(s===ge||a<ge&&s>ge||(s>ge||a<ge)&&u)&&s++,(s===ye||a<ye&&s>ye||(s>ye||a<ye)&&u)&&++s===ge&&s++,s>be&&(s=s-be+ve-1),(l=o+n)>xe?(l=l-xe+ve-1,u=!0):u=!1,(l===ge||o<ge&&l>ge||(l>ge||o<ge)&&u)&&l++,(l===ye||o<ye&&l>ye||(l>ye||o<ye)&&u)&&++l===ge&&l++,l>xe&&(l=l-xe+ve-1),String.fromCharCode(s)+String.fromCharCode(l))+f.substr(f.length-5,t)+p.substr(p.length-5,t)}(function(e){var t,r,n,i,a,o,s=e.lat,l=e.lon,u=6378137,h=Ee(s),c=Ee(l);o=Math.floor((l+180)/6)+1,180===l&&(o=60),s>=56&&s<64&&l>=3&&l<12&&(o=32),s>=72&&s<84&&(l>=0&&l<9?o=31:l>=9&&l<21?o=33:l>=21&&l<33?o=35:l>=33&&l<42&&(o=37)),a=Ee(6*(o-1)-180+3),t=u/Math.sqrt(1-.00669438*Math.sin(h)*Math.sin(h)),r=Math.tan(h)*Math.tan(h),n=.006739496752268451*Math.cos(h)*Math.cos(h);var d=.9996*t*((i=Math.cos(h)*(c-a))+(1-r+n)*i*i*i/6+(5-18*r+r*r+72*n-.39089081163157013)*i*i*i*i*i/120)+5e5,f=.9996*(u*(.9983242984503243*h-.002514607064228144*Math.sin(2*h)+2639046602129982e-21*Math.sin(4*h)-3.418046101696858e-9*Math.sin(6*h))+t*Math.tan(h)*(i*i/2+(5-r+9*n+4*n*n)*i*i*i*i/24+(61-58*r+r*r+600*n-2.2240339282485886)*i*i*i*i*i*i/720));return s<0&&(f+=1e7),{northing:Math.round(f),easting:Math.round(d),zoneNumber:o,zoneLetter:function(e){var t="Z";return 84>=s&&s>=72?t="X":72>s&&s>=64?t="W":64>s&&s>=56?t="V":56>s&&s>=48?t="U":48>s&&s>=40?t="T":40>s&&s>=32?t="S":32>s&&s>=24?t="R":24>s&&s>=16?t="Q":16>s&&s>=8?t="P":8>s&&s>=0?t="N":0>s&&s>=-8?t="M":-8>s&&s>=-16?t="L":-16>s&&s>=-24?t="K":-24>s&&s>=-32?t="J":-32>s&&s>=-40?t="H":-40>s&&s>=-48?t="G":-48>s&&s>=-56?t="F":-56>s&&s>=-64?t="E":-64>s&&s>=-72?t="D":-72>s&&s>=-80&&(t="C"),t}()}}({lat:e[1],lon:e[0]}),t)}function Me(e){var t=Te(Le(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Ee(e){return e*(Math.PI/180)}function Se(e){return e/Math.PI*180}function Te(e){var t=e.northing,r=e.easting,n=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var a,o,s,l,u,h,c,d,f=6378137,p=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=r-5e5,v=t;n<"N"&&(v-=1e7),h=6*(i-1)-180+3,d=(c=v/.9996/6367449.145945056)+(3*p/2-27*p*p*p/32)*Math.sin(2*c)+(21*p*p/16-55*p*p*p*p/32)*Math.sin(4*c)+151*p*p*p/96*Math.sin(6*c),a=f/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),o=Math.tan(d)*Math.tan(d),s=.006739496752268451*Math.cos(d)*Math.cos(d),l=.99330562*f/Math.pow(1-.00669438*Math.sin(d)*Math.sin(d),1.5),u=m/(.9996*a);var g=d-a*Math.tan(d)/l*(u*u/2-(5+3*o+10*s-4*s*s-.06065547077041606)*u*u*u*u/24+(61+90*o+298*s+45*o*o-1.6983531815716497-3*s*s)*u*u*u*u*u*u/720);g=Se(g);var y,x=(u-(1+2*o+s)*u*u*u/6+(5-2*s+28*o-3*s*s+.05391597401814761+24*o*o)*u*u*u*u*u/120)/Math.cos(d);if(x=h+Se(x),e.accuracy){var b=Te({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});y={top:b.lat,right:b.lon,bottom:g,left:x}}else y={lat:g,lon:x};return y}function Ae(e){var t=e%fe;return 0===t&&(t=fe),t}function Le(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,r=e.length,n=null,i="",a=0;!/[A-Z]/.test(t=e.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,a++}var o=parseInt(i,10);if(0===a||a+3>r)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(a++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;n=e.substring(a,a+=2);for(var l=Ae(o),u=function(e,t){for(var r=pe.charCodeAt(t-1),n=1e5,i=!1;r!==e.charCodeAt(0);){if(++r===ge&&r++,r===ye&&r++,r>be){if(i)throw"Bad character: "+e;r=ve,i=!0}n+=1e5}return n}(n.charAt(0),l),h=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var r=me.charCodeAt(t-1),n=0,i=!1;r!==e.charCodeAt(0);){if(++r===ge&&r++,r===ye&&r++,r>xe){if(i)throw"Bad character: "+e;r=ve,i=!0}n+=1e5}return n}(n.charAt(1),l);h<Pe(s);)h+=2e6;var c=r-a;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,f,p,m=c/2,v=0,g=0;return m>0&&(d=1e5/Math.pow(10,m),f=e.substring(a,a+m),v=parseFloat(f)*d,p=e.substring(a+m),g=parseFloat(p)*d),{easting:v+u,northing:g+h,zoneLetter:s,zoneNumber:o,accuracy:d}}function Pe(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function Ce(e,t,r){if(!(this instanceof Ce))return new Ce(e,t,r);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var n=e.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=e,this.y=t,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Ce.fromMGRS=function(e){return new Ce(Me(e))},Ce.prototype.toMGRS=function(e){return _e([this.x,this.y],e)};var Re=Ce,Oe=r(42),De=.01068115234375,Ie=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(.01953125+e*De))),t[1]=e*(.75-e*(.046875+e*(.01953125+e*De)));var r=e*e;return t[2]=r*(.46875-e*(.013020833333333334+.007120768229166667*e)),r*=e,t[3]=r*(.3645833333333333-.005696614583333333*e),t[4]=r*e*.3076171875,t},Ne=function(e,t,r,n){return r*=t,t*=t,n[0]*e-r*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))},Fe=function(e,t,r){for(var n=1/(1-t),i=e,a=20;a;--a){var o=Math.sin(i),s=1-t*o*o;if(i-=s=(Ne(i,o,Math.cos(i),r)-e)*(s*Math.sqrt(s))*n,Math.abs(s)<h)return i}return i},Ue={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Ie(this.es),this.ml0=Ne(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,r,n,i=e.x,a=e.y,o=G(i-this.long0),s=Math.sin(a),l=Math.cos(a);if(this.es){var u=l*o,c=Math.pow(u,2),d=this.ep2*Math.pow(l,2),f=Math.pow(d,2),p=Math.abs(l)>h?Math.tan(a):0,m=Math.pow(p,2),v=Math.pow(m,2);t=1-this.es*Math.pow(s,2),u/=Math.sqrt(t);var g=Ne(a,s,l,this.en);r=this.a*(this.k0*u*(1+c/6*(1-m+d+c/20*(5-18*m+v+14*d-58*m*d+c/42*(61+179*v-v*m-479*m)))))+this.x0,n=this.a*(this.k0*(g-this.ml0+s*o*u/2*(1+c/12*(5-m+9*d+4*f+c/30*(61+v-58*m+270*d-330*m*d+c/56*(1385+543*v-v*m-3111*m))))))+this.y0}else{var y=l*Math.sin(o);if(Math.abs(Math.abs(y)-1)<h)return 93;if(r=.5*this.a*this.k0*Math.log((1+y)/(1-y))+this.x0,n=l*Math.cos(o)/Math.sqrt(1-Math.pow(y,2)),(y=Math.abs(n))>=1){if(y-1>h)return 93;n=0}else n=Math.acos(n);a<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return e.x=r,e.y=n,e},inverse:function(e){var t,r,n,i,a=(e.x-this.x0)*(1/this.a),s=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+s/this.k0,r=Fe(t,this.es,this.en),Math.abs(r)<o){var l=Math.sin(r),u=Math.cos(r),c=Math.abs(u)>h?Math.tan(r):0,d=this.ep2*Math.pow(u,2),f=Math.pow(d,2),p=Math.pow(c,2),m=Math.pow(p,2);t=1-this.es*Math.pow(l,2);var v=a*Math.sqrt(t)/this.k0,g=Math.pow(v,2);n=r-(t*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*p-9*d*p+d-4*f-g/30*(61+90*p-252*d*p+45*m+46*d-g/56*(1385+3633*p+4095*m+1574*m*p)))),i=G(this.long0+v*(1-g/6*(1+2*p+d-g/20*(5+28*p+24*m+8*d*p+6*d-g/42*(61+662*p+1320*m+720*m*p))))/u)}else n=o*z(s),i=0;else{var y=Math.exp(a/this.k0),x=.5*(y-1/y),b=this.lat0+s/this.k0,w=Math.cos(b);t=Math.sqrt((1-Math.pow(w,2))/(1+Math.pow(x,2))),n=Math.asin(t),s<0&&(n=-n),i=0===x&&0===w?0:G(Math.atan2(x,w)+this.long0)}return e.x=i,e.y=n,e},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},ke=function(e){var t=Math.exp(e);return(t-1/t)/2},Be=function(e,t){e=Math.abs(e),t=Math.abs(t);var r=Math.max(e,t),n=Math.min(e,t)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))},ze=function(e,t){for(var r,n=2*Math.cos(2*t),i=e.length-1,a=e[i],o=0;--i>=0;)r=n*a-o+e[i],o=a,a=r;return t+r*Math.sin(2*t)},Ge=function(e,t,r){for(var n,i,a=Math.sin(t),o=Math.cos(t),s=ke(r),l=function(e){var t=Math.exp(e);return(t+1/t)/2}(r),u=2*o*l,h=-2*a*s,c=e.length-1,d=e[c],f=0,p=0,m=0;--c>=0;)n=p,i=f,d=u*(p=d)-n-h*(f=m)+e[c],m=h*p-i+u*f;return[(u=a*l)*d-(h=o*s)*m,u*m+h*d]},je={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),r=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),r*=t,this.cgb[1]=r*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),r*=t,this.cgb[2]=r*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=r*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),r*=t,this.cgb[3]=r*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=r*(1237/630+t*(t*(-24832/14175)-2.4)),r*=t,this.cgb[4]=r*(4174/315+t*(-144838/6237)),this.cbg[4]=r*(-734/315+t*(109598/31185)),r*=t,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+r*(.25+r*(1/64+r/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=r*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=r*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),r*=t,this.utg[2]=r*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=r*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),r*=t,this.utg[3]=r*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=r*(49561/161280+t*(-179/168+t*(6601661/7257600))),r*=t,this.utg[4]=r*(-4583/161280+t*(108847/3991680)),this.gtu[4]=r*(34729/80640+t*(-3418889/1995840)),r*=t,this.utg[5]=-.03233083094085698*r,this.gtu[5]=.6650675310896665*r;var n=ze(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(e,t){for(var r,n=2*Math.cos(t),i=e.length-1,a=e[i],o=0;--i>=0;)r=n*a-o+e[i],o=a,a=r;return Math.sin(t)*r}(this.gtu,2*n))},forward:function(e){var t=G(e.x-this.long0),r=e.y;r=ze(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),a=Math.sin(t),o=Math.cos(t);r=Math.atan2(n,o*i),t=Math.atan2(a*i,Be(n,i*o)),t=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r}(t*(1+t/(Be(1,t)+1))),e<0?-t:t}(Math.tan(t));var s,l,u=Ge(this.gtu,2*r,2*t);return r+=u[0],t+=u[1],Math.abs(t)<=2.623395162778?(s=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),e.x=s,e.y=l,e},inverse:function(e){var t,r,n=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var a=Ge(this.utg,2*i,2*n);i+=a[0],n+=a[1],n=Math.atan(ke(n));var o=Math.sin(i),s=Math.cos(i),l=Math.sin(n),u=Math.cos(n);i=Math.atan2(o*u,Be(l,u*s)),n=Math.atan2(l,u*s),t=G(n+this.long0),r=ze(this.cgb,i)}else t=1/0,r=1/0;return e.x=t,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},Ve={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(G(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*c,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,je.init.apply(this),this.forward=je.forward,this.inverse=je.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},He=function(e,t){return Math.pow((1-e)/(1+e),t)},We={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+f)/(Math.pow(Math.tan(.5*this.lat0+f),this.C)*He(this.e*e,this.ratexp))},forward:function(e){var t=e.x,r=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+f),this.C)*He(this.e*Math.sin(r),this.ratexp))-o,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,r=e.y,n=Math.pow(Math.tan(.5*r+f)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*He(this.e*Math.sin(e.y),-.5*this.e))-o,!(Math.abs(r-e.y)<1e-14));--i)e.y=r;return i?(e.x=t,e.y=r,e):null},names:["gauss"]},qe={init:function(){We.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,r,n,i;return e.x=G(e.x-this.long0),We.forward.apply(this,[e]),t=Math.sin(e.y),r=Math.cos(e.y),n=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*n),e.x=i*r*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*r*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,r,n,i,a;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,a=Math.sqrt(e.x*e.x+e.y*e.y)){var o=2*Math.atan2(a,this.R2);t=Math.sin(o),r=Math.cos(o),i=Math.asin(r*this.sinc0+e.y*t*this.cosc0/a),n=Math.atan2(e.x*t,a*this.cosc0*r-e.y*this.sinc0*t)}else i=this.phic0,n=0;return e.x=n,e.y=i,We.inverse.apply(this,[e]),e.x=G(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},Xe={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=h&&(this.k0=.5*(1+z(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=h&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=h&&(this.k0=.5*this.cons*B(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/j(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=B(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-o,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,r,n,i,a,s,l=e.x,u=e.y,c=Math.sin(u),d=Math.cos(u),f=G(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=h&&Math.abs(u+this.lat0)<=h?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*c+this.coslat0*d*Math.cos(f)),e.x=this.a*t*d*Math.sin(f)+this.x0,e.y=this.a*t*(this.coslat0*c-this.sinlat0*d*Math.cos(f))+this.y0,e):(r=2*Math.atan(this.ssfn_(u,c,this.e))-o,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=h?(a=j(this.e,u*this.con,this.con*c),s=2*this.a*this.k0*a/this.cons,e.x=this.x0+s*Math.sin(l-this.long0),e.y=this.y0-this.con*s*Math.cos(l-this.long0),e):(Math.abs(this.sinlat0)<h?(t=2*this.a*this.k0/(1+i*Math.cos(f)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(f))),e.y=t*(this.cosX0*n-this.sinX0*i*Math.cos(f))+this.y0),e.x=t*i*Math.sin(f)+this.x0,e))},inverse:function(e){var t,r,n,i,a;e.x-=this.x0,e.y-=this.y0;var s=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(s/(2*this.a*this.k0));return t=this.long0,r=this.lat0,s<=h?(e.x=t,e.y=r,e):(r=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/s),t=Math.abs(this.coslat0)<h?this.lat0>0?G(this.long0+Math.atan2(e.x,-1*e.y)):G(this.long0+Math.atan2(e.x,e.y)):G(this.long0+Math.atan2(e.x*Math.sin(l),s*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=t,e.y=r,e)}if(Math.abs(this.coslat0)<=h){if(s<=h)return r=this.lat0,t=this.long0,e.x=t,e.y=r,e;e.x*=this.con,e.y*=this.con,n=s*this.cons/(2*this.a*this.k0),r=this.con*V(this.e,n),t=this.con*G(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,s<=h?a=this.X0:(a=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/s),t=G(this.long0+Math.atan2(e.x*Math.sin(i),s*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),r=-1*V(this.e,Math.tan(.5*(o+a)));return e.x=t,e.y=r,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,r){return t*=r,Math.tan(.5*(o+e))*Math.pow((1-t)/(1+t),.5*r)}},Ye={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),a=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*s+this.alpha*a/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(a))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(a));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*o+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,r=e.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+o/this.alpha,l=0,u=a,h=-1e3,c=0;Math.abs(u-h)>1e-7;){if(++c>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),h=u,u=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=s,e.y=u,e},names:["somerc"]},Ze={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),r=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-r*r);var n,i,a=j(this.e,this.lat0,e),o=this.bl/t*Math.sqrt((1-this.es)/(1-r*r));if(o*o<1&&(o=1),isNaN(this.longc)){var s=j(this.e,this.lat1,Math.sin(this.lat1)),l=j(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(o+Math.sqrt(o*o-1))*Math.pow(a,this.bl):this.el=(o-Math.sqrt(o*o-1))*Math.pow(a,this.bl);var u=Math.pow(s,this.bl),h=Math.pow(l,this.bl);i=.5*((n=this.el/u)-1/n);var c=(this.el*this.el-h*u)/(this.el*this.el+h*u),d=(h-u)/(h+u),f=G(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(c*Math.tan(.5*this.bl*f)/d)/this.bl,this.long0=G(this.long0);var p=G(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*p)/i),this.alpha=Math.asin(o*Math.sin(this.gamma0))}else n=this.lat0>=0?o+Math.sqrt(o*o-1):o-Math.sqrt(o*o-1),this.el=n*Math.pow(a,this.bl),i=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/o),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha))},forward:function(e){var t,r,n,i=e.x,a=e.y,s=G(i-this.long0);if(Math.abs(Math.abs(a)-o)<=h)n=a>0?-1:1,r=this.al/this.bl*Math.log(Math.tan(f+n*this.gamma0*.5)),t=-1*n*o*this.al/this.bl;else{var l=j(this.e,a,Math.sin(a)),u=this.el/Math.pow(l,this.bl),c=.5*(u-1/u),d=.5*(u+1/u),p=Math.sin(this.bl*s),m=(c*Math.sin(this.gamma0)-p*Math.cos(this.gamma0))/d;r=Math.abs(Math.abs(m)-1)<=h?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-m)/(1+m))/this.bl,t=Math.abs(Math.cos(this.bl*s))<=h?this.al*this.bl*s:this.al*Math.atan2(c*Math.cos(this.gamma0)+p*Math.sin(this.gamma0),Math.cos(this.bl*s))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+r):(t-=this.uc,e.x=this.x0+r*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-r*Math.sin(this.alpha)),e},inverse:function(e){var t,r;this.no_rot?(r=e.y-this.y0,t=e.x-this.x0):(r=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var n=Math.exp(-1*this.bl*r/this.al),i=.5*(n-1/n),a=.5*(n+1/n),s=Math.sin(this.bl*t/this.al),l=(s*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/a,u=Math.pow(this.el/Math.sqrt((1+l)/(1-l)),1/this.bl);return Math.abs(l-1)<h?(e.x=this.long0,e.y=o):Math.abs(l+1)<h?(e.x=this.long0,e.y=-1*o):(e.y=V(this.e,u),e.x=G(this.long0-Math.atan2(i*Math.cos(this.gamma0)-s*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},Je={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<h)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),n=B(this.e,t,r),i=j(this.e,this.lat1,t),a=Math.sin(this.lat2),o=Math.cos(this.lat2),s=B(this.e,a,o),l=j(this.e,this.lat2,a),u=j(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>h?this.ns=Math.log(n/s)/Math.log(i/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,r=e.y;Math.abs(2*Math.abs(r)-Math.PI)<=h&&(r=z(r)*(o-2*h));var n,i,a=Math.abs(Math.abs(r)-o);if(a>h)n=j(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((a=r*this.ns)<=0)return null;i=0}var s=this.ns*G(t-this.long0);return e.x=this.k0*(i*Math.sin(s))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(s))+this.y0,e},inverse:function(e){var t,r,n,i,a,s=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(s*s+l*l),r=1):(t=-Math.sqrt(s*s+l*l),r=-1);var u=0;if(0!==t&&(u=Math.atan2(r*s,r*l)),0!==t||this.ns>0){if(r=1/this.ns,n=Math.pow(t/(this.a*this.f0),r),-9999===(i=V(this.e,n)))return null}else i=-o;return a=G(u/this.ns+this.long0),e.x=a,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},Ke={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,r,n,i,a,o,s,l=e.x,u=e.y,h=G(l-this.long0);return t=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/t)-this.s45),n=-h*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),a=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),o=this.n*a,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=s*Math.cos(o)/1,e.x=s*Math.sin(o)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,r,n,i,a,o,s,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),a=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),e.x=this.long0-r/this.alfa,o=t,s=0;var u=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(s=1),o=e.y,u+=1}while(0===s&&u<15);return u>=15?null:e},names:["Krovak","krovak"]},Qe=function(e,t,r,n,i){return e*i-t*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)},$e=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},et=function(e){return.375*e*(1+.25*e*(1+.46875*e))},tt=function(e){return.05859375*e*e*(1+.75*e)},rt=function(e){return e*e*e*(35/3072)},nt=function(e,t,r){var n=t*r;return e/Math.sqrt(1-n*n)},it=function(e){return Math.abs(e)<o?e:e-z(e)*Math.PI},at=function(e,t,r,n,i){var a,o;a=e/t;for(var s=0;s<15;s++)if(a+=o=(e-(t*a-r*Math.sin(2*a)+n*Math.sin(4*a)-i*Math.sin(6*a)))/(t-2*r*Math.cos(2*a)+4*n*Math.cos(4*a)-6*i*Math.cos(6*a)),Math.abs(o)<=1e-10)return a;return NaN},ot={init:function(){this.sphere||(this.e0=$e(this.es),this.e1=et(this.es),this.e2=tt(this.es),this.e3=rt(this.es),this.ml0=this.a*Qe(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,r,n=e.x,i=e.y;if(n=G(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var a=Math.sin(i),o=Math.cos(i),s=nt(this.a,this.e,a),l=Math.tan(i)*Math.tan(i),u=n*Math.cos(i),h=u*u,c=this.es*o*o/(1-this.es);t=s*u*(1-h*l*(1/6-(8-l+8*c)*h/120)),r=this.a*Qe(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*a/o*h*(.5+(5-l+6*c)*h/24)}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){var a=i+this.lat0;t=Math.asin(Math.sin(a)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(a))}else{var s=this.ml0/this.a+i,l=at(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-o)<=h)return e.x=this.long0,e.y=o,i<0&&(e.y*=-1),e;var u=nt(this.a,this.e,Math.sin(l)),c=u*u*u/this.a/this.a*(1-this.es),d=Math.pow(Math.tan(l),2),f=n*this.a/u,p=f*f;t=l-u*Math.tan(l)/c*f*f*(.5-(1+3*d)*f*f/24),r=f*(1-p*(d/3+(1+3*d)*d*p/15))/Math.cos(l)}return e.x=G(r+this.long0),e.y=it(t),e},names:["Cassini","Cassini_Soldner","cass"]},st=function(e,t){var r;return e>1e-7?(1-e*e)*(t/(1-(r=e*t)*r)-.5/e*Math.log((1-r)/(1+r))):2*t},lt={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-o)<h?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<h?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=st(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,r=[];return r[0]=.3333333333333333*e,t=e*e,r[0]+=.17222222222222222*t,r[1]=.06388888888888888*t,t*=e,r[0]+=.10257936507936508*t,r[1]+=.0664021164021164*t,r[2]=.016415012942191543*t,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=st(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,r,n,i,a,s,l,u,c,d,p=e.x,m=e.y;if(p=G(p-this.long0),this.sphere){if(a=Math.sin(m),d=Math.cos(m),n=Math.cos(p),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+d*n:1+this.sinph0*a+this.cosph0*d*n)<=h)return null;t=(r=Math.sqrt(2/r))*d*Math.sin(p),r*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*d*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(m+this.phi0)<h)return null;r=f-.5*m,t=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(p),r*=n}}else{switch(l=0,u=0,c=0,n=Math.cos(p),i=Math.sin(p),a=Math.sin(m),s=st(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(l=s/this.qp,u=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:c=1+this.sinb1*l+this.cosb1*u*n;break;case this.EQUIT:c=1+u*n;break;case this.N_POLE:c=o+m,s=this.qp-s;break;case this.S_POLE:c=m-o,s=this.qp+s}if(Math.abs(c)<h)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),r=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*l-this.sinb1*u*n):(c=Math.sqrt(2/(1+u*n)))*l*this.ymf,t=this.xmf*c*u*i;break;case this.N_POLE:case this.S_POLE:s>=0?(t=(c=Math.sqrt(s))*i,r=n*(this.mode===this.S_POLE?c:-c)):t=r=0}}return e.x=this.a*t+this.x0,e.y=this.a*r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n,i,a,s,l,u,c,d,f=e.x/this.a,p=e.y/this.a;if(this.sphere){var m,v=0,g=0;if((r=.5*(m=Math.sqrt(f*f+p*p)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(r),v=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(m)<=h?0:Math.asin(p*g/m),f*=g,p=v*m;break;case this.OBLIQ:r=Math.abs(m)<=h?this.phi0:Math.asin(v*this.sinph0+p*g*this.cosph0/m),f*=g*this.cosph0,p=(v-Math.sin(r)*this.sinph0)*m;break;case this.N_POLE:p=-p,r=o-r;break;case this.S_POLE:r-=o}t=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(f,p):0}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(f/=this.dd,p*=this.dd,(s=Math.sqrt(f*f+p*p))<h)return e.x=0,e.y=this.phi0,e;i=2*Math.asin(.5*s/this.rq),n=Math.cos(i),f*=i=Math.sin(i),this.mode===this.OBLIQ?(l=n*this.sinb1+p*i*this.cosb1/s,a=this.qp*l,p=s*this.cosb1*n-p*this.sinb1*i):(l=p*i/s,a=this.qp*l,p=s*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(a=f*f+p*p))return e.x=0,e.y=this.phi0,e;l=1-a/this.qp,this.mode===this.S_POLE&&(l=-l)}t=Math.atan2(f,p),d=(u=Math.asin(l))+u,r=u+(c=this.apa)[0]*Math.sin(d)+c[1]*Math.sin(d+d)+c[2]*Math.sin(d+d+d)}return e.x=G(this.long0+t),e.y=r,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},ut=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},ht={init:function(){Math.abs(this.lat1+this.lat2)<h||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=B(this.e3,this.sin_po,this.cos_po),this.qs1=st(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=B(this.e3,this.sin_po,this.cos_po),this.qs2=st(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=st(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>h?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=st(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*G(t-this.long0),o=i*Math.sin(a)+this.x0,s=this.rh-i*Math.cos(a)+this.y0;return e.x=o,e.y=s,e},inverse:function(e){var t,r,n,i,a,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),i=0,0!==t&&(i=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,r)),a=G(i/this.ns0+this.long0),e.x=a,e.y=o,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var r,n,i,a,o=ut(.5*t);if(e<h)return o;for(var s=e*e,l=1;l<=25;l++)if(o+=a=.5*(i=1-(n=e*(r=Math.sin(o)))*n)*i/Math.cos(o)*(t/(1-s)-r/i+.5/e*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return o;return null}},ct={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,r,n,i,a,o,s,l=e.x,u=e.y;return n=G(l-this.long0),t=Math.sin(u),r=Math.cos(u),i=Math.cos(n),(a=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(a)<=h?(o=this.x0+1*this.a*r*Math.sin(n)/a,s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)/a):(o=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*i)),e.x=o,e.y=s,e},inverse:function(e){var t,r,n,i,a,o;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),r=Math.sin(i),n=Math.cos(i),o=ut(n*this.sin_p14+e.y*r*this.cos_p14/t),a=Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r),a=G(this.long0+a)):(o=this.phic0,a=0),e.x=a,e.y=o,e},names:["gnom"]},dt={init:function(){this.sphere||(this.k0=B(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,r,n=e.x,i=e.y,a=G(n-this.long0);if(this.sphere)t=this.x0+this.a*a*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var o=st(this.e,Math.sin(i));t=this.x0+this.a*this.k0*a,r=this.y0+this.a*o*.5/this.k0}return e.x=t,e.y=r,e},inverse:function(e){var t,r;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=G(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(r=function(e,t){var r=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-r)<1e-6)return t<0?-1*o:o;for(var n,i,a,s,l=Math.asin(.5*t),u=0;u<30;u++)if(i=Math.sin(l),a=Math.cos(l),s=e*i,l+=n=Math.pow(1-s*s,2)/(2*a)*(t/(1-e*e)-i/(1-s*s)+.5/e*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return l;return NaN}(this.e,2*e.y*this.k0/this.a),t=G(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=r,e},names:["cea"]},ft={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,r=e.y,n=G(t-this.long0),i=it(r-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,r=e.y;return e.x=G(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=it(this.lat0+(r-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},pt={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=$e(this.es),this.e1=et(this.es),this.e2=tt(this.es),this.e3=rt(this.es),this.ml0=this.a*Qe(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i=e.x,a=e.y,o=G(i-this.long0);if(n=o*Math.sin(a),this.sphere)Math.abs(a)<=h?(t=this.a*o,r=-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(a),r=this.a*(it(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=h)t=this.a*o,r=-1*this.ml0;else{var s=nt(this.a,this.e,Math.sin(a))/Math.tan(a);t=s*Math.sin(n),r=this.a*Qe(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+s*(1-Math.cos(n))}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){var t,r,n,i,a,o,s,l,u;if(n=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=h)t=G(n/this.a+this.long0),r=0;else{var c;for(o=this.lat0+i/this.a,s=n*n/this.a/this.a+o*o,l=o,a=20;a;--a)if(l+=u=-1*(o*(l*(c=Math.tan(l))+1)-l-.5*(l*l+s)*c)/((l-o)/c-1),Math.abs(u)<=h){r=l;break}t=G(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=h)r=0,t=G(this.long0+n/this.a);else{var d,f,p,m,v;for(o=(this.ml0+i)/this.a,s=n*n/this.a/this.a+o*o,l=o,a=20;a;--a)if(v=this.e*Math.sin(l),d=Math.sqrt(1-v*v)*Math.tan(l),f=this.a*Qe(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=u=(o*(d*(m=f/this.a)+1)-m-.5*d*(m*m+s))/(this.es*Math.sin(2*l)*(m*m+s-2*o*m)/(4*d)+(o-m)*(d*p-2/Math.sin(2*l))-p),Math.abs(u)<=h){r=l;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),t=G(this.long0+Math.asin(n*d/this.a)/Math.sin(r))}return e.x=t,e.y=r,e},names:["Polyconic","poly"]},mt={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,r=e.x,n=e.y-this.lat0,i=r-this.long0,o=n/a*1e-5,s=i,l=1,u=0;for(t=1;t<=10;t++)l*=o,u+=this.A[t]*l;var h,c=u,d=s,f=1,p=0,m=0,v=0;for(t=1;t<=6;t++)h=p*c+f*d,f=f*c-p*d,p=h,m=m+this.B_re[t]*f-this.B_im[t]*p,v=v+this.B_im[t]*f+this.B_re[t]*p;return e.x=v*this.a+this.x0,e.y=m*this.a+this.y0,e},inverse:function(e){var t,r,n=e.x,i=e.y,o=n-this.x0,s=(i-this.y0)/this.a,l=o/this.a,u=1,h=0,c=0,d=0;for(t=1;t<=6;t++)r=h*s+u*l,u=u*s-h*l,h=r,c=c+this.C_re[t]*u-this.C_im[t]*h,d=d+this.C_im[t]*u+this.C_re[t]*h;for(var f=0;f<this.iterations;f++){var p,m=c,v=d,g=s,y=l;for(t=2;t<=6;t++)p=v*c+m*d,m=m*c-v*d,v=p,g+=(t-1)*(this.B_re[t]*m-this.B_im[t]*v),y+=(t-1)*(this.B_im[t]*m+this.B_re[t]*v);m=1,v=0;var x=this.B_re[1],b=this.B_im[1];for(t=2;t<=6;t++)p=v*c+m*d,m=m*c-v*d,v=p,x+=t*(this.B_re[t]*m-this.B_im[t]*v),b+=t*(this.B_im[t]*m+this.B_re[t]*v);var w=x*x+b*b;c=(g*x+y*b)/w,d=(y*x-g*b)/w}var _=c,M=d,E=1,S=0;for(t=1;t<=9;t++)E*=_,S+=this.D[t]*E;var T=this.lat0+S*a*1e5,A=this.long0+M;return e.x=A,e.y=T,e},names:["New_Zealand_Map_Grid","nzmg"]},vt={init:function(){},forward:function(e){var t=e.x,r=e.y,n=G(t-this.long0),i=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return e.x=i,e.y=a,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=G(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=r,e},names:["Miller_Cylindrical","mill"]},gt={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Ie(this.es)},forward:function(e){var t,r,n=e.x,i=e.y;if(n=G(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(i),o=20;o;--o){var s=(this.m*i+Math.sin(i)-a)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<h)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var l=Math.sin(i),u=Math.cos(i);r=this.a*Ne(i,l,u,this.en),t=this.a*n*u/Math.sqrt(1-this.es*l*l)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i;return e.x-=this.x0,n=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,n/=this.C_x*(this.m+Math.cos(t)),this.m?t=ut((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=ut(Math.sin(t)/this.n)),n=G(n+this.long0),t=it(t)):(t=Fe(e.y/this.a,this.es,this.en),(i=Math.abs(t))<o?(i=Math.sin(t),r=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),n=G(r)):i-h<o&&(n=this.long0)),e.x=n,e.y=t,e},names:["Sinusoidal","sinu"]},yt={init:function(){},forward:function(e){for(var t=e.x,r=e.y,n=G(t-this.long0),i=r,a=Math.PI*Math.sin(r);;){var o=-(i+Math.sin(i)-a)/(1+Math.cos(i));if(i+=o,Math.abs(o)<h)break}i/=2,Math.PI/2-Math.abs(r)<h&&(n=0);var s=.900316316158*this.a*n*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=s,e.y=l,e},inverse:function(e){var t,r;e.x-=this.x0,e.y-=this.y0,r=e.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),t=Math.asin(r);var n=G(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*t+Math.sin(2*t))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return e.x=n,e.y=i,e},names:["Mollweide","moll"]},xt={init:function(){Math.abs(this.lat1+this.lat2)<h||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=$e(this.es),this.e1=et(this.es),this.e2=tt(this.es),this.e3=rt(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=B(this.e,this.sinphi,this.cosphi),this.ml1=Qe(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<h?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=B(this.e,this.sinphi,this.cosphi),this.ml2=Qe(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Qe(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,r=e.x,n=e.y;if(this.sphere)t=this.a*(this.g-n);else{var i=Qe(this.e0,this.e1,this.e2,this.e3,n);t=this.a*(this.g-i)}var a=this.ns*G(r-this.long0),o=this.x0+t*Math.sin(a),s=this.y0+this.rh-t*Math.cos(a);return e.x=o,e.y=s,e},inverse:function(e){var t,r,n,i;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var a=0;if(0!==r&&(a=Math.atan2(t*e.x,t*e.y)),this.sphere)return i=G(this.long0+a/this.ns),n=it(this.g-r/this.a),e.x=i,e.y=n,e;var o=this.g-r/this.a;return n=at(o,this.e0,this.e1,this.e2,this.e3),i=G(this.long0+a/this.ns),e.x=i,e.y=n,e},names:["Equidistant_Conic","eqdc"]},bt={init:function(){this.R=this.a},forward:function(e){var t,r,n=e.x,i=e.y,a=G(n-this.long0);Math.abs(i)<=h&&(t=this.x0+this.R*a,r=this.y0);var s=ut(2*Math.abs(i/Math.PI));(Math.abs(a)<=h||Math.abs(Math.abs(i)-o)<=h)&&(t=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*s):this.y0+Math.PI*this.R*-Math.tan(.5*s));var l=.5*Math.abs(Math.PI/a-a/Math.PI),u=l*l,c=Math.sin(s),d=Math.cos(s),f=d/(c+d-1),p=f*f,m=f*(2/c-1),v=m*m,g=Math.PI*this.R*(l*(f-v)+Math.sqrt(u*(f-v)*(f-v)-(v+u)*(p-v)))/(v+u);a<0&&(g=-g),t=this.x0+g;var y=u+f;return g=Math.PI*this.R*(m*y-l*Math.sqrt((v+u)*(u+1)-y*y))/(v+u),r=i>=0?this.y0+g:this.y0-g,e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i,a,o,s,l,u,c,d,f;return e.x-=this.x0,e.y-=this.y0,d=Math.PI*this.R,a=(n=e.x/d)*n+(i=e.y/d)*i,d=3*(i*i/(l=-2*(o=-Math.abs(i)*(1+a))+1+2*i*i+a*a)+(2*(s=o-2*i*i+n*n)*s*s/l/l/l-9*o*s/l/l)/27)/(u=(o-s*s/3/l)/l)/(c=2*Math.sqrt(-u/3)),Math.abs(d)>1&&(d=d>=0?1:-1),f=Math.acos(d)/3,r=e.y>=0?(-c*Math.cos(f+Math.PI/3)-s/3/l)*Math.PI:-(-c*Math.cos(f+Math.PI/3)-s/3/l)*Math.PI,t=Math.abs(n)<h?this.long0:G(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-i*i)+a*a))/2/n),e.x=t,e.y=r,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},wt={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,a,s,l,u,c,d,f,p,m,v,g,y,x,b,w,_,M,E,S=e.x,T=e.y,A=Math.sin(e.y),L=Math.cos(e.y),P=G(S-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=h?(e.x=this.x0+this.a*(o-T)*Math.sin(P),e.y=this.y0-this.a*(o-T)*Math.cos(P),e):Math.abs(this.sin_p12+1)<=h?(e.x=this.x0+this.a*(o+T)*Math.sin(P),e.y=this.y0+this.a*(o+T)*Math.cos(P),e):(b=this.sin_p12*A+this.cos_p12*L*Math.cos(P),x=(y=Math.acos(b))/Math.sin(y),e.x=this.x0+this.a*x*L*Math.sin(P),e.y=this.y0+this.a*x*(this.cos_p12*A-this.sin_p12*L*Math.cos(P)),e):(t=$e(this.es),r=et(this.es),n=tt(this.es),i=rt(this.es),Math.abs(this.sin_p12-1)<=h?(a=this.a*Qe(t,r,n,i,o),s=this.a*Qe(t,r,n,i,T),e.x=this.x0+(a-s)*Math.sin(P),e.y=this.y0-(a-s)*Math.cos(P),e):Math.abs(this.sin_p12+1)<=h?(a=this.a*Qe(t,r,n,i,o),s=this.a*Qe(t,r,n,i,T),e.x=this.x0+(a+s)*Math.sin(P),e.y=this.y0+(a+s)*Math.cos(P),e):(l=A/L,u=nt(this.a,this.e,this.sin_p12),c=nt(this.a,this.e,A),d=Math.atan((1-this.es)*l+this.es*u*this.sin_p12/(c*L)),w=0===(f=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(d)-this.sin_p12*Math.cos(P)))?Math.asin(this.cos_p12*Math.sin(d)-this.sin_p12*Math.cos(d)):Math.abs(Math.abs(f)-Math.PI)<=h?-Math.asin(this.cos_p12*Math.sin(d)-this.sin_p12*Math.cos(d)):Math.asin(Math.sin(P)*Math.cos(d)/Math.sin(f)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),y=u*w*(1-(_=w*w)*(g=(m=this.e*this.cos_p12*Math.cos(f)/Math.sqrt(1-this.es))*m)*(1-g)/6+(M=_*w)/8*(v=p*m)*(1-2*g)+(E=M*w)/120*(g*(4-7*g)-3*p*p*(1-7*g))-E*w/48*v),e.x=this.x0+y*Math.sin(f),e.y=this.y0+y*Math.cos(f),e))},inverse:function(e){var t,r,n,i,a,s,l,u,c,d,f,p,m,v,g,y,x,b,w,_,M,E;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*o*this.a)return;return r=t/this.a,n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(t)<=h?s=this.lat0:(s=ut(i*this.sin_p12+e.y*n*this.cos_p12/t),l=Math.abs(this.lat0)-o,a=Math.abs(l)<=h?this.lat0>=0?G(this.long0+Math.atan2(e.x,-e.y)):G(this.long0-Math.atan2(-e.x,e.y)):G(this.long0+Math.atan2(e.x*n,t*this.cos_p12*i-e.y*this.sin_p12*n))),e.x=a,e.y=s,e}return u=$e(this.es),c=et(this.es),d=tt(this.es),f=rt(this.es),Math.abs(this.sin_p12-1)<=h?(p=this.a*Qe(u,c,d,f,o),t=Math.sqrt(e.x*e.x+e.y*e.y),s=at((p-t)/this.a,u,c,d,f),a=G(this.long0+Math.atan2(e.x,-1*e.y)),e.x=a,e.y=s,e):Math.abs(this.sin_p12+1)<=h?(p=this.a*Qe(u,c,d,f,o),t=Math.sqrt(e.x*e.x+e.y*e.y),s=at((t-p)/this.a,u,c,d,f),a=G(this.long0+Math.atan2(e.x,e.y)),e.x=a,e.y=s,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),g=Math.atan2(e.x,e.y),m=nt(this.a,this.e,this.sin_p12),y=Math.cos(g),b=-(x=this.e*this.cos_p12*y)*x/(1-this.es),w=3*this.es*(1-b)*this.sin_p12*this.cos_p12*y/(1-this.es),E=1-b*(M=(_=t/m)-b*(1+b)*Math.pow(_,3)/6-w*(1+3*b)*Math.pow(_,4)/24)*M/2-_*M*M*M/6,v=Math.asin(this.sin_p12*Math.cos(M)+this.cos_p12*Math.sin(M)*y),a=G(this.long0+Math.asin(Math.sin(g)*Math.sin(M)/Math.cos(v))),s=Math.atan((1-this.es*E*this.sin_p12/Math.sin(v))*Math.tan(v)/(1-this.es)),e.x=a,e.y=s,e)},names:["Azimuthal_Equidistant","aeqd"]},_t={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,a,o,s,l=e.x,u=e.y;return n=G(l-this.long0),t=Math.sin(u),r=Math.cos(u),i=Math.cos(n),((a=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(a)<=h)&&(o=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)),e.x=o,e.y=s,e},inverse:function(e){var t,r,n,i,a,s,l;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),r=ut(t/this.a),n=Math.sin(r),i=Math.cos(r),s=this.long0,Math.abs(t)<=h?(l=this.lat0,e.x=s,e.y=l,e):(l=ut(i*this.sin_p14+e.y*n*this.cos_p14/t),a=Math.abs(this.lat0)-o,Math.abs(a)<=h?(s=this.lat0>=0?G(this.long0+Math.atan2(e.x,-e.y)):G(this.long0-Math.atan2(-e.x,e.y)),e.x=s,e.y=l,e):(s=G(this.long0+Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n)),e.x=s,e.y=l,e))},names:["ortho"]},Mt=1,Et=2,St=3,Tt=4,At=5,Lt=6,Pt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Ct(e,t,r,n){var i;return e<h?(n.value=Pt.AREA_0,i=0):(i=Math.atan2(t,r),Math.abs(i)<=f?n.value=Pt.AREA_0:i>f&&i<=o+f?(n.value=Pt.AREA_1,i-=o):i>o+f||i<=-(o+f)?(n.value=Pt.AREA_2,i=i>=0?i-m:i+m):(n.value=Pt.AREA_3,i+=o)),i}function Rt(e,t){var r=e+t;return r<-m?r+=p:r>+m&&(r-=p),r}var Ot,Dt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=o-f/2?this.face=At:this.lat0<=-(o-f/2)?this.face=Lt:Math.abs(this.long0)<=f?this.face=Mt:Math.abs(this.long0)<=o+f?this.face=this.long0>0?Et:Tt:this.face=St,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,r,n,i,a,s,l={x:0,y:0},u={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,this.face===At)i=o-t,r>=f&&r<=o+f?(u.value=Pt.AREA_0,n=r-o):r>o+f||r<=-(o+f)?(u.value=Pt.AREA_1,n=r>0?r-m:r+m):r>-(o+f)&&r<=-f?(u.value=Pt.AREA_2,n=r+o):(u.value=Pt.AREA_3,n=r);else if(this.face===Lt)i=o+t,r>=f&&r<=o+f?(u.value=Pt.AREA_0,n=-r+o):r<f&&r>=-f?(u.value=Pt.AREA_1,n=-r):r<-f&&r>=-(o+f)?(u.value=Pt.AREA_2,n=-r-o):(u.value=Pt.AREA_3,n=r>0?-r+m:-r-m);else{var h,c,d,p,v,g;this.face===Et?r=Rt(r,+o):this.face===St?r=Rt(r,+m):this.face===Tt&&(r=Rt(r,-o)),p=Math.sin(t),v=Math.cos(t),g=Math.sin(r),h=v*Math.cos(r),c=v*g,d=p,this.face===Mt?n=Ct(i=Math.acos(h),d,c,u):this.face===Et?n=Ct(i=Math.acos(c),d,-h,u):this.face===St?n=Ct(i=Math.acos(-h),d,-c,u):this.face===Tt?n=Ct(i=Math.acos(-c),d,h,u):(i=n=0,u.value=Pt.AREA_0)}return s=Math.atan(12/m*(n+Math.acos(Math.sin(n)*Math.cos(f))-o)),a=Math.sqrt((1-Math.cos(i))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),u.value===Pt.AREA_1?s+=o:u.value===Pt.AREA_2?s+=m:u.value===Pt.AREA_3&&(s+=1.5*m),l.x=a*Math.cos(s),l.y=a*Math.sin(s),l.x=l.x*this.a+this.x0,l.y=l.y*this.a+this.y0,e.x=l.x,e.y=l.y,e},inverse:function(e){var t,r,n,i,a,s,l,u,h,c,d,f,p={lam:0,phi:0},v={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?v.value=Pt.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(v.value=Pt.AREA_1,t-=o):e.x<0&&-e.x>=Math.abs(e.y)?(v.value=Pt.AREA_2,t=t<0?t+m:t-m):(v.value=Pt.AREA_3,t+=o),h=m/12*Math.tan(t),a=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),s=Math.atan(a),(l=1-(n=Math.cos(t))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?l=-1:l>1&&(l=1),this.face===At)u=Math.acos(l),p.phi=o-u,v.value===Pt.AREA_0?p.lam=s+o:v.value===Pt.AREA_1?p.lam=s<0?s+m:s-m:v.value===Pt.AREA_2?p.lam=s-o:p.lam=s;else if(this.face===Lt)u=Math.acos(l),p.phi=u-o,v.value===Pt.AREA_0?p.lam=-s+o:v.value===Pt.AREA_1?p.lam=-s:v.value===Pt.AREA_2?p.lam=-s-o:p.lam=s<0?-s-m:-s+m;else{var g,y,x;h=(g=l)*g,y=(h+=(x=h>=1?0:Math.sqrt(1-h)*Math.sin(s))*x)>=1?0:Math.sqrt(1-h),v.value===Pt.AREA_1?(h=y,y=-x,x=h):v.value===Pt.AREA_2?(y=-y,x=-x):v.value===Pt.AREA_3&&(h=y,y=x,x=-h),this.face===Et?(h=g,g=-y,y=h):this.face===St?(g=-g,y=-y):this.face===Tt&&(h=g,g=y,y=-h),p.phi=Math.acos(-x)-o,p.lam=Math.atan2(y,g),this.face===Et?p.lam=Rt(p.lam,-o):this.face===St?p.lam=Rt(p.lam,-m):this.face===Tt&&(p.lam=Rt(p.lam,+o))}return 0!==this.es&&(c=p.phi<0?1:0,d=Math.tan(p.phi),f=this.b/Math.sqrt(d*d+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),c&&(p.phi=-p.phi)),p.lam+=this.long0,e.x=p.lam,e.y=p.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},It=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Nt=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ft=d/5,Ut=1/Ft,kt=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},Bt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=G(e.x-this.long0),r=Math.abs(e.y),n=Math.floor(r*Ft);n<0?n=0:n>=18&&(n=17);var i={x:kt(It[n],r=d*(r-Ut*n))*t,y:kt(Nt[n],r)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*.8487+this.x0,i.y=i.y*this.a*1.3523+this.y0,i},inverse:function(e){var t={x:(e.x-this.x0)/(.8487*this.a),y:Math.abs(e.y-this.y0)/(1.3523*this.a)};if(t.y>=1)t.x/=It[18][0],t.y=e.y<0?-o:o;else{var r=Math.floor(18*t.y);for(r<0?r=0:r>=18&&(r=17);;)if(Nt[r][0]>t.y)--r;else{if(!(Nt[r+1][0]<=t.y))break;++r}var n=Nt[r],i=5*(t.y-n[0])/(Nt[r+1][0]-n[0]);i=function(e,t,r,n){for(var i=t;n;--n){var a=e(i);if(i-=a,Math.abs(a)<r)break}return i}(function(e){return(kt(n,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(n,e)},i,h,100),t.x/=kt(It[r],i),t.y=(5*r+i)*c,e.y<0&&(t.y=-t.y)}return t.x=G(t.x+this.long0),t},names:["Robinson","robin"]};de.defaultDatum="WGS84",de.Proj=te,de.WGS84=new de.Proj("WGS84"),de.Point=Re,de.toPoint=ae,de.defs=I,de.transform=le,de.mgrs=we,de.version=Oe.a,(Ot=de).Proj.projections.add(Ue),Ot.Proj.projections.add(je),Ot.Proj.projections.add(Ve),Ot.Proj.projections.add(qe),Ot.Proj.projections.add(Xe),Ot.Proj.projections.add(Ye),Ot.Proj.projections.add(Ze),Ot.Proj.projections.add(Je),Ot.Proj.projections.add(Ke),Ot.Proj.projections.add(ot),Ot.Proj.projections.add(lt),Ot.Proj.projections.add(ht),Ot.Proj.projections.add(ct),Ot.Proj.projections.add(dt),Ot.Proj.projections.add(ft),Ot.Proj.projections.add(pt),Ot.Proj.projections.add(mt),Ot.Proj.projections.add(vt),Ot.Proj.projections.add(gt),Ot.Proj.projections.add(yt),Ot.Proj.projections.add(xt),Ot.Proj.projections.add(bt),Ot.Proj.projections.add(wt),Ot.Proj.projections.add(_t),Ot.Proj.projections.add(Dt),Ot.Proj.projections.add(Bt),t.default=de},function(e,t,r){"use strict";r.r(t);var n=r(10),i=r(0),a=r(75),o=r.n(a);function s(e,t){var r=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),a=Math.round(e.b),o=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===r||"SIX_CHAR_HEX"===r){for(var h=e.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return"CSS_RGB"===r?"rgb("+n+","+i+","+a+")":"CSS_RGBA"===r?"rgba("+n+","+i+","+a+","+o+")":"HEX"===r?"0x"+e.hex.toString(16):"RGB_ARRAY"===r?"["+n+","+i+","+a+"]":"RGBA_ARRAY"===r?"["+n+","+i+","+a+","+o+"]":"RGB_OBJ"===r?"{r:"+n+",g:"+i+",b:"+a+"}":"RGBA_OBJ"===r?"{r:"+n+",g:"+i+",b:"+a+",a:"+o+"}":"HSV_OBJ"===r?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===r?"{h:"+s+",s:"+l+",v:"+u+",a:"+o+"}":"unknown format"}var l=Array.prototype.forEach,u=Array.prototype.slice,h={BREAK:{},extend:function(e){return this.each(u.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(t[r])||(e[r]=t[r])}.bind(this))},this),e},defaults:function(e){return this.each(u.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(e[r])&&(e[r]=t[r])}.bind(this))},this),e},compose:function(){var e=u.call(arguments);return function(){for(var t=u.call(arguments),r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},each:function(e,t,r){if(e)if(l&&e.forEach&&e.forEach===l)e.forEach(t,r);else if(e.length===e.length+0){var n,i=void 0;for(i=0,n=e.length;i<n;i++)if(i in e&&t.call(r,e[i],i)===this.BREAK)return}else for(var a in e)if(t.call(r,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,r){var n=void 0;return function(){var i=this,a=arguments,o=r||!n;clearTimeout(n),n=setTimeout(function(){n=null,r||e.apply(i,a)},t),o&&e.apply(i,a)}},toArray:function(e){return e.toArray?e.toArray():u.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},c=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:s},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:s},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:s},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:s}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],d=void 0,f=void 0,p=function(){f=!1;var e=arguments.length>1?h.toArray(arguments):arguments[0];return h.each(c,function(t){if(t.litmus(e))return h.each(t.conversions,function(t,r){if(d=t.read(e),!1===f&&!1!==d)return f=d,d.conversionName=r,d.conversion=t,h.BREAK}),h.BREAK}),f},m=void 0,v={hsv_to_rgb:function(e,t,r){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),a=r*(1-t),o=r*(1-i*t),s=r*(1-(1-i)*t),l=[[r,s,a],[o,r,a],[a,r,s],[a,o,r],[s,a,r],[r,a,o]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,r){var n=Math.min(e,t,r),i=Math.max(e,t,r),a=i-n,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-r)/a:t===i?2+(r-e)/a:4+(e-t)/a,(o/=6)<0&&(o+=1),{h:360*o,s:a/i,v:i/255})},rgb_to_hex:function(e,t,r){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),this.hex_with_component(n,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(m=8*t)|e&~(255<<m)}},g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},x=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),b=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0},w=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},M=function(){function e(){if(y(this,e),this.__state=p.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return x(e,[{key:"toString",value:function(){return s(this)}},{key:"toHexString",value:function(){return s(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function E(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(M.recalculateRGB(this,t,r),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(M.recalculateRGB(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function S(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(M.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(M.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}M.recalculateRGB=function(e,t,r){if("HEX"===e.__state.space)e.__state[t]=v.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");h.extend(e.__state,v.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},M.recalculateHSV=function(e){var t=v.rgb_to_hsv(e.r,e.g,e.b);h.extend(e.__state,{s:t.s,v:t.v}),h.isNaN(t.h)?h.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},M.COMPONENTS=["r","g","b","h","s","v","hex","a"],E(M.prototype,"r",2),E(M.prototype,"g",1),E(M.prototype,"b",0),S(M.prototype,"h"),S(M.prototype,"s"),S(M.prototype,"v"),Object.defineProperty(M.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(M.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=v.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var T=function(){function e(t,r){y(this,e),this.initialValue=t[r],this.domElement=document.createElement("div"),this.object=t,this.property=r,this.__onChange=void 0,this.__onFinishChange=void 0}return x(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),A={};h.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){h.each(e,function(e){A[e]=t})});var L=/(\d+(\.\d+)?)px/;function P(e){if("0"===e||h.isUndefined(e))return 0;var t=e.match(L);return h.isNull(t)?0:parseFloat(t[1])}var C={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,r){var n=r,i=t;h.isUndefined(i)&&(i=!0),h.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,r,n){var i=r||{},a=A[t];if(!a)throw new Error("Event type "+t+" not supported.");var o=document.createEvent(a);switch(a){case"MouseEvents":var s=i.x||i.clientX||0,l=i.y||i.clientY||0;o.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=o.initKeyboardEvent||o.initKeyEvent;h.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:o.initEvent(t,i.bubbles||!1,i.cancelable||!0)}h.defaults(o,n),e.dispatchEvent(o)},bind:function(e,t,r,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,r,i):e.attachEvent&&e.attachEvent("on"+t,r),C},unbind:function(e,t,r,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,r,i):e.detachEvent&&e.detachEvent("on"+t,r),C},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var r=e.className.split(/ +/);-1===r.indexOf(t)&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return C},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),n=r.indexOf(t);-1!==n&&(r.splice(n,1),e.className=r.join(" "))}else e.className=void 0;return C},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return P(t["border-left-width"])+P(t["border-right-width"])+P(t["padding-left"])+P(t["padding-right"])+P(t.width)},getHeight:function(e){var t=getComputedStyle(e);return P(t["border-top-width"])+P(t["border-bottom-width"])+P(t["padding-top"])+P(t["padding-bottom"])+P(t.height)},getOffset:function(e){var t=e,r={left:0,top:0};if(t.offsetParent)do{r.left+=t.offsetLeft,r.top+=t.offsetTop,t=t.offsetParent}while(t);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},R=function(e){function t(e,r){y(this,t);var n=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),i=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),C.bind(n.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return w(t,T),x(t,[{key:"setValue",value:function(e){var r=b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),O=function(e){function t(e,r,n){y(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=n,o=i;if(i.__select=document.createElement("select"),h.isArray(a)){var s={};h.each(a,function(e){s[e]=e}),a=s}return h.each(a,function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),o.__select.appendChild(r)}),i.updateDisplay(),C.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)}),i.domElement.appendChild(i.__select),i}return w(t,T),x(t,[{key:"setValue",value:function(e){var r=b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return C.isActive(this.__select)?this:(this.__select.value=this.getValue(),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),D=function(e){function t(e,r){y(this,t);var n=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),i=n;function a(){i.setValue(i.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),C.bind(n.__input,"keyup",a),C.bind(n.__input,"change",a),C.bind(n.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),C.bind(n.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return w(t,T),x(t,[{key:"updateDisplay",value:function(){return C.isActive(this.__input)||(this.__input.value=this.getValue()),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function I(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var N=function(e){function t(e,r,n){y(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=n||{};return i.__min=a.min,i.__max=a.max,i.__step=a.step,h.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=I(i.__impliedStep),i}return w(t,T),x(t,[{key:"setValue",value:function(e){var r=e;return void 0!==this.__min&&r<this.__min?r=this.__min:void 0!==this.__max&&r>this.__max&&(r=this.__max),void 0!==this.__step&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=I(e),this}}]),t}(),F=function(e){function t(e,r,n){y(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n));i.__truncationSuspended=!1;var a=i,o=void 0;function s(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(e){var t=o-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),o=e.clientY}function u(){C.unbind(window,"mousemove",l),C.unbind(window,"mouseup",u),s()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),C.bind(i.__input,"change",function(){var e=parseFloat(a.__input.value);h.isNaN(e)||a.setValue(e)}),C.bind(i.__input,"blur",function(){s()}),C.bind(i.__input,"mousedown",function(e){C.bind(window,"mousemove",l),C.bind(window,"mouseup",u),o=e.clientY}),C.bind(i.__input,"keydown",function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,s())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return w(t,N),x(t,[{key:"updateDisplay",value:function(){var e,r,n;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),r=this.__precision,n=Math.pow(10,r),Math.round(e*n)/n),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function U(e,t,r,n,i){return n+(e-t)/(r-t)*(i-n)}var k=function(e){function t(e,r,n,i,a){y(this,t);var o=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,{min:n,max:i,step:a})),s=o;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(U(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){C.unbind(window,"mousemove",l),C.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function h(e){var t=e.touches[0].clientX,r=s.__background.getBoundingClientRect();s.setValue(U(t,r.left,r.right,s.__min,s.__max))}function c(){C.unbind(window,"touchmove",h),C.unbind(window,"touchend",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),C.bind(o.__background,"mousedown",function(e){document.activeElement.blur(),C.bind(window,"mousemove",l),C.bind(window,"mouseup",u),l(e)}),C.bind(o.__background,"touchstart",function(e){1===e.touches.length&&(C.bind(window,"touchmove",h),C.bind(window,"touchend",c),h(e))}),C.addClass(o.__background,"slider"),C.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return w(t,N),x(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),B=function(e){function t(e,r,n){y(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===n?"Fire":n,C.bind(i.__button,"click",function(e){return e.preventDefault(),a.fire(),!1}),C.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return w(t,T),x(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),z=function(e){function t(e,r){y(this,t);var n=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));n.__color=new M(n.getValue()),n.__temp=new M(0);var i=n;n.domElement=document.createElement("div"),C.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",C.bind(n.__input,"keydown",function(e){13===e.keyCode&&d.call(this)}),C.bind(n.__input,"blur",d),C.bind(n.__selector,"mousedown",function(){C.addClass(this,"drag").bind(window,"mouseup",function(){C.removeClass(i.__selector,"drag")})}),C.bind(n.__selector,"touchstart",function(){C.addClass(this,"drag").bind(window,"touchend",function(){C.removeClass(i.__selector,"drag")})});var a,o=document.createElement("div");function s(e){m(e),C.bind(window,"mousemove",m),C.bind(window,"touchmove",m),C.bind(window,"mouseup",u),C.bind(window,"touchend",u)}function l(e){v(e),C.bind(window,"mousemove",v),C.bind(window,"touchmove",v),C.bind(window,"mouseup",c),C.bind(window,"touchend",c)}function u(){C.unbind(window,"mousemove",m),C.unbind(window,"touchmove",m),C.unbind(window,"mouseup",u),C.unbind(window,"touchend",u),f()}function c(){C.unbind(window,"mousemove",v),C.unbind(window,"touchmove",v),C.unbind(window,"mouseup",c),C.unbind(window,"touchend",c),f()}function d(){var e=p(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function f(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),r=e.touches&&e.touches[0]||e,n=r.clientX,a=r.clientY,o=(n-t.left)/(t.right-t.left),s=1-(a-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),o>1?o=1:o<0&&(o=0),i.__color.v=s,i.__color.s=o,i.setValue(i.__color.toOriginal()),!1}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),r=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return r>1?r=1:r<0&&(r=0),i.__color.h=360*r,i.setValue(i.__color.toOriginal()),!1}return h.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),h.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),h.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),h.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),h.extend(o.style,{width:"100%",height:"100%",background:"none"}),j(o,"top","rgba(0,0,0,0)","#000"),h.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=n.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",h.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),C.bind(n.__saturation_field,"mousedown",s),C.bind(n.__saturation_field,"touchstart",s),C.bind(n.__field_knob,"mousedown",s),C.bind(n.__field_knob,"touchstart",s),C.bind(n.__hue_field,"mousedown",l),C.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(o),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return w(t,T),x(t,[{key:"updateDisplay",value:function(){var e=p(this.getValue());if(!1!==e){var t=!1;h.each(M.COMPONENTS,function(r){if(!h.isUndefined(e[r])&&!h.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r])return t=!0,{}},this),t&&h.extend(this.__color.__state,e)}h.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,n=255-r;h.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,j(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),h.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),t}(),G=["-moz-","-o-","-webkit-","-ms-",""];function j(e,t,r,n){e.style.background="",h.each(G,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+r+" 0%, "+n+" 100%); "})}var V=function(e,t){var r=e[t];return h.isArray(arguments[2])||h.isObject(arguments[2])?new O(e,t,arguments[2]):h.isNumber(r)?h.isNumber(arguments[2])&&h.isNumber(arguments[3])?h.isNumber(arguments[4])?new k(e,t,arguments[2],arguments[3],arguments[4]):new k(e,t,arguments[2],arguments[3]):h.isNumber(arguments[4])?new F(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new F(e,t,{min:arguments[2],max:arguments[3]}):h.isString(r)?new D(e,t):h.isFunction(r)?new B(e,t,""):h.isBoolean(r)?new R(e,t):null},H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},W=function(){function e(){y(this,e),this.backgroundElement=document.createElement("div"),h.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),C.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),h.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;C.bind(this.backgroundElement,"click",function(){t.hide()})}return x(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),h.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",C.unbind(e.domElement,"webkitTransitionEnd",t),C.unbind(e.domElement,"transitionend",t),C.unbind(e.domElement,"oTransitionEnd",t)};C.bind(this.domElement,"webkitTransitionEnd",t),C.bind(this.domElement,"transitionend",t),C.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-C.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-C.getHeight(this.domElement)/2+"px"}}]),e}();!function(e,t){var r=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=r.getElementsByTagName("head")[0];try{i.appendChild(n)}catch(e){}}(function(e){if("undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var q="Default",X=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),Y=void 0,Z=!0,J=void 0,K=!1,Q=[],$=function e(t){var r=this,n=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),C.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=h.defaults(n,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),n=h.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),h.isUndefined(n.load)?n.load={preset:q}:n.preset&&(n.load.preset=n.preset),h.isUndefined(n.parent)&&n.hideable&&Q.push(this),n.resizable=h.isUndefined(n.parent)&&n.resizable,n.autoPlace&&h.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,a=X&&"true"===localStorage.getItem(ae(this,"isLocal")),o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:n.load.preset},set:function(e){r.parent?r.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),r.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,le(r,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,titleRowName&&(titleRowName.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(t){n.closed=t,n.closed?C.addClass(r.__ul,e.CLASS_CLOSED):C.removeClass(r.__ul,e.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return a},set:function(e){X&&(a=e,e?C.bind(window,"unload",o):C.unbind(window,"unload",o),localStorage.setItem(ae(r,"isLocal"),e))}}}),h.isUndefined(n.parent)){if(n.closed=!1,C.addClass(this.domElement,e.CLASS_MAIN),C.makeSelectable(this.domElement,!1),X&&a){r.useLocalStorage=!0;var s=localStorage.getItem(ae(this,"gui"));s&&(n.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,C.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),n.closeOnTop?(C.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(C.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),C.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{void 0===n.closed&&(n.closed=!0);var l=document.createTextNode(n.name);C.addClass(l,"controller-name");var u=ee(r,l);C.addClass(this.__ul,e.CLASS_CLOSED),C.addClass(u,"title"),C.bind(u,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),n.closed||(this.closed=!1)}n.autoPlace&&(h.isUndefined(n.parent)&&(Z&&(J=document.createElement("div"),C.addClass(J,"dg"),C.addClass(J,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(J),Z=!1),J.appendChild(this.domElement),C.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||le(r,n.width)),this.__resizeHandler=function(){r.onResizeDebounced()},C.bind(window,"resize",this.__resizeHandler),C.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),C.bind(this.__ul,"transitionend",this.__resizeHandler),C.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&function(e){var t=void 0;function r(r){return r.preventDefault(),e.width+=t-r.clientX,e.onResize(),t=r.clientX,!1}function n(){C.removeClass(e.__closeButton,$.CLASS_DRAG),C.unbind(window,"mousemove",r),C.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),t=i.clientX,C.addClass(e.__closeButton,$.CLASS_DRAG),C.bind(window,"mousemove",r),C.bind(window,"mouseup",n),!1}e.__resize_handle=document.createElement("div"),h.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),C.bind(e.__resize_handle,"mousedown",i),C.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}(this),o=function(){X&&"true"===localStorage.getItem(ae(r,"isLocal"))&&localStorage.setItem(ae(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=o,n.parent||((i=r.getRoot()).width+=1,h.defer(function(){i.width-=1}))};function ee(e,t,r){var n=document.createElement("li");return t&&n.appendChild(t),r?e.__ul.insertBefore(n,r):e.__ul.appendChild(n),e.onResize(),n}function te(e){C.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&C.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function re(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];r.innerHTML=t?r.value+"*":r.value}function ne(e,t){var r=e.getRoot(),n=r.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=r.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},r.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,r.load&&r.load.remembered){var a=r.load.remembered,o=void 0;if(a[e.preset])o=a[e.preset];else{if(!a[q])return;o=a[q]}if(o[n]&&void 0!==o[n][t.property]){var s=o[n][t.property];t.initialValue=s,t.setValue(s)}}}}function ie(e,t,r,n){if(void 0===t[r])throw new Error('Object "'+t+'" has no property "'+r+'"');var i=void 0;if(n.color)i=new z(t,r);else{var a=[t,r].concat(n.factoryArgs);i=V.apply(e,a)}n.before instanceof T&&(n.before=n.before.__li),ne(e,i),C.addClass(i.domElement,"c");var o=document.createElement("span");C.addClass(o,"property-name"),o.innerHTML=i.property;var s=document.createElement("div");s.appendChild(o),s.appendChild(i.domElement);var l=ee(e,s,n.before);return C.addClass(l,$.CLASS_CONTROLLER_ROW),i instanceof z?C.addClass(l,"color"):C.addClass(l,g(i.getValue())),function(e,t,r){if(r.__li=t,r.__gui=e,h.extend(r,{options:function(t){if(arguments.length>1){var n=r.__li.nextElementSibling;return r.remove(),ie(e,r.object,r.property,{before:n,factoryArgs:[h.toArray(arguments)]})}if(h.isArray(t)||h.isObject(t)){var i=r.__li.nextElementSibling;return r.remove(),ie(e,r.object,r.property,{before:i,factoryArgs:[t]})}},name:function(e){return r.__li.firstElementChild.firstElementChild.innerHTML=e,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof k){var n=new F(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});h.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=r[e],i=n[e];r[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(n,e),t.apply(r,e)}}),C.addClass(t,"has-slider"),r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof F){var i=function(t){if(h.isNumber(r.__min)&&h.isNumber(r.__max)){var n=r.__li.firstElementChild.firstElementChild.innerHTML,i=r.__gui.__listening.indexOf(r)>-1;r.remove();var a=ie(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]});return a.name(n),i&&a.listen(),a}return t};r.min=h.compose(i,r.min),r.max=h.compose(i,r.max)}else r instanceof R?(C.bind(t,"click",function(){C.fakeEvent(r.__checkbox,"click")}),C.bind(r.__checkbox,"click",function(e){e.stopPropagation()})):r instanceof B?(C.bind(t,"click",function(){C.fakeEvent(r.__button,"click")}),C.bind(t,"mouseover",function(){C.addClass(r.__button,"hover")}),C.bind(t,"mouseout",function(){C.removeClass(r.__button,"hover")})):r instanceof z&&(C.addClass(t,"color"),r.updateDisplay=h.compose(function(e){return t.style.borderLeftColor=r.__color.toString(),e},r.updateDisplay),r.updateDisplay());r.setValue=h.compose(function(t){return e.getRoot().__preset_select&&r.isModified()&&re(e.getRoot(),!0),t},r.setValue)}(e,l,i),e.__controllers.push(i),i}function ae(e,t){return document.location.href+"."+t}function oe(e,t,r){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function se(e,t){t.style.display=e.useLocalStorage?"block":"none"}function le(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ue(e,t){var r={};return h.each(e.__rememberedObjects,function(n,i){var a={},o=e.__rememberedObjectIndecesToControllers[i];h.each(o,function(e,r){a[r]=t?e.initialValue:e.getValue()}),r[i]=a}),r}$.toggleHide=function(){K=!K,h.each(Q,function(e){e.domElement.style.display=K?"none":""})},$.CLASS_AUTO_PLACE="a",$.CLASS_AUTO_PLACE_CONTAINER="ac",$.CLASS_MAIN="main",$.CLASS_CONTROLLER_ROW="cr",$.CLASS_TOO_TALL="taller-than-window",$.CLASS_CLOSED="closed",$.CLASS_CLOSE_BUTTON="close-button",$.CLASS_CLOSE_TOP="close-top",$.CLASS_CLOSE_BOTTOM="close-bottom",$.CLASS_DRAG="drag",$.DEFAULT_WIDTH=245,$.TEXT_CLOSED="Close Controls",$.TEXT_OPEN="Open Controls",$._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||$.toggleHide()},C.bind(window,"keydown",$._keydownHandler,!1),h.extend($.prototype,{add:function(e,t){return ie(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return ie(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;h.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&J.removeChild(this.domElement);var e=this;h.each(this.__folders,function(t){e.removeFolder(t)}),C.unbind(window,"keydown",$._keydownHandler,!1),te(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var r=new $(t);this.__folders[e]=r;var n=ee(this,r.domElement);return C.addClass(n,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],te(e);var t=this;h.each(e.__folders,function(t){e.removeFolder(t)}),h.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=C.getOffset(e.__ul).top,r=0;h.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(r+=C.getHeight(t))}),window.innerHeight-t-20<r?(C.addClass(e.domElement,$.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(C.removeClass(e.domElement,$.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&h.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:h.debounce(function(){this.onResize()},50),remember:function(){if(h.isUndefined(Y)&&((Y=new W).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;h.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");C.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),C.addClass(t,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",C.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save",C.addClass(n,"button"),C.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",C.addClass(i,"button"),C.addClass(i,"save-as");var a=document.createElement("span");a.innerHTML="Revert",C.addClass(a,"button"),C.addClass(a,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?h.each(e.load.remembered,function(t,r){oe(e,r,r===e.preset)}):oe(e,q,!1),C.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(a),X){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ae(0,"isLocal"))&&l.setAttribute("checked","checked"),se(e,s),C.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,se(e,s)})}var u=document.getElementById("dg-new-constructor");C.bind(u,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Y.hide()}),C.bind(r,"click",function(){u.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Y.show(),u.focus(),u.select()}),C.bind(n,"click",function(){e.save()}),C.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),C.bind(a,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&le(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ue(this)),e.folders={},h.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ue(this),re(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[q]=ue(this,!0)),this.load.remembered[e]=ue(this),this.preset=e,oe(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){h.each(this.__controllers,function(t){this.getRoot().load.remembered?ne(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),h.each(this.__folders,function(e){e.revert(e)}),e||re(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&H.call(window,function(){e(t)}),h.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){h.each(this.__controllers,function(e){e.updateDisplay()}),h.each(this.__folders,function(e){e.updateDisplay()})}});var he={color:{Color:M,math:v,interpret:p},controllers:{Controller:T,BooleanController:R,OptionController:O,StringController:D,NumberController:N,NumberControllerBox:F,NumberControllerSlider:k,FunctionController:B,ColorController:z},dom:{dom:C},gui:{GUI:$},GUI:$};function ce(e,t,r,n){var i=n||245;this.gui=new he.GUI({autoPlace:!1,width:i}),this.gui.domElement.id=t,e.appendChild(this.gui.domElement),this.colorGui=this.gui.addFolder("Color Layers"),this.elevationGui=this.gui.addFolder("Elevation Layers"),r&&r.addEventListener("layers-order-changed",function(){var e,t=r.getLayers(function(e){return"color"===e.type});for(e=0;e<t.length;e++)this.removeLayersGUI(t[e].id);this.addImageryLayersGUI(t)}.bind(this))}he.GUI.prototype.removeFolder=function(e){var t=this.__folders[e];t&&(t.close(),this.__ul.removeChild(t.domElement.parentNode),delete this.__folders[e],this.onResize())},he.GUI.prototype.hideFolder=function(e,t){var r=this.__folders[e];r&&(r.__ul.hidden=t)},ce.prototype.addImageryLayerGUI=function(e){var t=this.colorGui.addFolder(e.id);t.add({visible:e.visible},"visible").onChange(function(t){e.visible=t,this.view.notifyChange(!0)}.bind(this)),t.add({opacity:e.opacity},"opacity").min(0).max(1).onChange(function(t){e.opacity=t,this.view.notifyChange(!0)}.bind(this)),t.add({frozen:e.frozen},"frozen").onChange(function(t){e.frozen=t,this.view.notifyChange(!0)}.bind(this))},ce.prototype.addElevationLayerGUI=function(e){this.elevationGui.addFolder(e.id).add({frozen:e.frozen},"frozen").onChange(function(t){e.frozen=t})},ce.prototype.addImageryLayersGUI=function(e){var t,r=n.ImageryLayers.getColorLayersIdOrderedBySequence(e),i=e.sort(function(e,t){return r.indexOf(e.id)<r.indexOf(t.id)});for(t=0;t<i.length;t++)this.addImageryLayerGUI(i[t])},ce.prototype.addElevationLayersGUI=function(e){var t;for(t=0;t<e.length;t++)this.addElevationLayerGUI(e[t])},ce.prototype.removeLayersGUI=function(e){this.colorGui.removeFolder(e)},ce.prototype.addGUI=function(e,t,r){this[e]=t,this.gui.add(this,e).onChange(r)},ce.prototype.hideFolder=function(e,t){this.colorGui.hideFolder(e,t)};var de=ce,fe=(n.UTILS,document.getElementById("viewerDiv")),pe=new n.GlobeView(fe,{longitude:2.116329,latitude:48.806937,altitude:100}),me=[],ve=new de(fe,"menuDiv");ve.view=pe;var ge=[],ye=[],xe=0,be=[],we=document.getElementById("mly");we.style.visibility="visible";var _e,Me=new Mapillary.Viewer("mly","VTRaYjFvTUZ4THpELTQ1ODFQaV9QUTo2NmI1YTM3MjlmNjM4NDFk",null);function Ee(e){return pe.addLayer(e)}function Se(e,t,r,i){let a=[];o.a.all("https://a.mapillary.com/v3/images/?bbox="+e+","+t+","+r+","+i+"&client_id=VTRaYjFvTUZ4THpELTQ1ODFQaV9QUTo2NmI1YTM3MjlmNjM4NDFk").then(e=>{for(let t=0;t<e.length;t++)a.push(e[t].json())}).then(()=>{Promise.all(a).then(e=>{e.length>0&&e.forEach(e=>{!function(e){var t=pe.wgs84TileLayer;let r,i,a,o;if(e.features.length>0)for(let s=0;s<e.features.length;s++)Te(i=e.features[s].geometry.coordinates[0],a=e.features[s].geometry.coordinates[1],r=(o=n.DEMUtils.getElevationValueAt(t,new n.Coordinates("EPSG:4326",e.features[s].geometry.coordinates[0],e.features[s].geometry.coordinates[1])))?o.z:0,16711680,.1,e.features[s].properties.key)}(e)})})})}function Te(e,t,r,a,o,s){var l,u,h=new i.PlaneGeometry(10,10);let c=new n.Coordinates("EPSG:4326",e,t,r+5).as("EPSG:4978").xyz();(new i.TextureLoader).load("https://d1cuyjsrcm0gby.cloudfront.net/"+s+"/thumb-320.jpg",function(e){e.minFilter=i.LinearFilter,l=new i.MeshBasicMaterial({side:i.DoubleSide,map:e}),(u=new i.Mesh(h,l)).position.copy(c),u.lookAt(new i.Vector3(1,0,0)),u.rotateX(-Math.PI/2),u.quaternion.copy(pe.camera.camera3D.quaternion),u.updateMatrixWorld(),pe.scene.add(u),be.push(u),function(){if(be.length>300)for(;be.length>300;)pe.scene.remove(be.shift())}()},void 0,function(e){console.error("An error happened.")}),pe.mesh=u}function Ae(e){if(e.visible)if(e.children.length>1)for(let t=1;t<e.children.length;t++)Ae(e.children[t]);else e.level>xe?(ge=[],xe=e.level,ge.push(e)):e.level==xe&&ge.push(e)}function Le(){for(xe=0,ge=[];ye.length>0;){var e=ye.pop();pe.scene.remove(e)}for(let e=0;e<pe.wgs84TileLayer.level0Nodes.length;e++)Ae(pe.wgs84TileLayer.level0Nodes[e]);ge.forEach(e=>{var t;e.geometry.center,t=e.wmtsCoords.WGS84G[0].zoom<10?new i.CylinderGeometry(20,20,1e4,8):new i.CylinderGeometry(20,20,1e3,8);var r=new i.MeshBasicMaterial({color:16711680}),n=new i.Mesh(t,r);n.position.copy(new i.Vector3(e.matrixWorld.elements[12],e.matrixWorld.elements[13],e.matrixWorld.elements[14])),ye.push(n)})}Me.moveCloseTo(48.806937,2.116329).then(function(e){console.log(e.key)},function(e){console.error(e)}),me.push(n.Fetcher.json("./layers/Ortho.json").then(Ee)),me.push(n.Fetcher.json("./layers/WORLD_DTM.json").then(Ee)),me.push(n.Fetcher.json("./layers/IGN_MNT_HIGHRES.json").then(Ee)),me.push(n.Fetcher.json("./layers/Mapillary.json").then(Ee).then(function(e){_e=e})),pe.addEventListener(n.GLOBE_VIEW_EVENTS.GLOBE_INITIALIZED,function(){console.info("Globe initialized"),Promise.all(me).then(function(){ve.addImageryLayersGUI(pe.getLayers(function(e){return"color"===e.type})),ve.addElevationLayersGUI(pe.getLayers(function(e){return"elevation"===e.type})),pe.controls.setTilt(60,!0)})}),window.addEventListener("click",function(e){if(Le(),ye.length>0){var t=ye[0].position,r=ye[ye.length-1].position,i=new n.Coordinates("EPSG:4978",t).as("EPSG:4326"),a=new n.Coordinates("EPSG:4978",r).as("EPSG:4326");if(console.log(pe.controls.getZoom()),pe.controls.getZoom()>=17){Se(i._values[0],i._values[1],a._values[0],a._values[1]),_e.opacity=0;for(var o=0;o<be.length;o++)be[o].quaternion.copy(pe.camera.camera3D.quaternion),be[o].updateMatrixWorld();pe.notifyChange(!0),we.style.visibility="visible"}else _e.opacity=1,pe.notifyChange(!0),we.style.visibility="hidden"}Me.moveCloseTo((i._values[1]+a._values[1])/2,(i._values[0]+a._values[0])/2).then(function(e){return 0},function(e){console.warn(e)})},!1),ve.addGUI("log_globeView",function(){console.log(pe)}),ve.addGUI("launch_node_research",Le)},function(e,t,r){"use strict";r.r(t);class n{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=this.ids.length=this.values.length=0}push(e,t){this.ids.push(e),this.values.push(t);let r=this.length++;for(;r>0;){const e=r-1>>1,n=this.values[e];if(t>=n)break;this.ids[r]=this.ids[e],this.values[r]=n,r=e}this.ids[r]=e,this.values[r]=t}pop(){if(0===this.length)return;const e=this.ids[0];if(this.length--,this.length>0){const e=this.ids[0]=this.ids[this.length],t=this.values[0]=this.values[this.length],r=this.length>>1;let n=0;for(;n<r;){let e=1+(n<<1);const r=e+1;let i=this.ids[e],a=this.values[e];const o=this.values[r];if(r<this.length&&o<a&&(e=r,i=this.ids[r],a=o),a>=t)break;this.ids[n]=i,this.values[n]=a,n=e}this.ids[n]=e,this.values[n]=t}return this.ids.pop(),this.values.pop(),e}peek(){return this.ids[0]}peekValue(){return this.values[0]}}r.d(t,"default",function(){return o});const i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],a=3;class o{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(251!==t)throw new Error("Data does not appear to be in a Flatbush format.");if(r>>4!==a)throw new Error(`Got v${r>>4} data when expected v${a}.`);const[n]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new o(s,n,i[15&r],e)}constructor(e,t=16,r=Float64Array,o){if(void 0===e)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535);let s=e,l=s;this._levelBounds=[4*s];do{l+=s=Math.ceil(s/this.nodeSize),this._levelBounds.push(4*l)}while(1!==s);this.ArrayType=r||Float64Array,this.IndexArrayType=l<16384?Uint16Array:Uint32Array;const u=i.indexOf(this.ArrayType),h=4*l*this.ArrayType.BYTES_PER_ELEMENT;if(u<0)throw new Error(`Unexpected typed array class: ${r}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,4*l),this._indices=new this.IndexArrayType(this.data,8+h,l),this._pos=4*l,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+h+l*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*l),this._indices=new this.IndexArrayType(this.data,8+h,l),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(a<<4)+u]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e),this._queue=new n}add(e,t,r,n){const i=this._pos>>2;this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=t,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,e<this.minX&&(this.minX=e),t<this.minY&&(this.minY=t),r>this.maxX&&(this.maxX=r),n>this.maxY&&(this.maxY=n)}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const e=this.maxX-this.minX,t=this.maxY-this.minY,r=new Uint32Array(this.numItems);for(let n=0;n<this.numItems;n++){let i=4*n;const a=this._boxes[i++],o=this._boxes[i++],s=this._boxes[i++],l=this._boxes[i++],u=Math.floor(65535*((a+s)/2-this.minX)/e),c=Math.floor(65535*((o+l)/2-this.minY)/t);r[n]=h(u,c)}!function e(t,r,n,i,a){if(i>=a)return;const o=t[i+a>>1];let s=i-1,l=a+1;for(;;){do{s++}while(t[s]<o);do{l--}while(t[l]>o);if(s>=l)break;u(t,r,n,s,l)}e(t,r,n,i,l),e(t,r,n,l+1,a)}(r,this._boxes,this._indices,0,this.numItems-1);for(let e=0,t=0;e<this._levelBounds.length-1;e++){const r=this._levelBounds[e];for(;t<r;){let e=1/0,n=1/0,i=-1/0,a=-1/0;const o=t;for(let o=0;o<this.nodeSize&&t<r;o++){const r=this._boxes[t++],o=this._boxes[t++],s=this._boxes[t++],l=this._boxes[t++];r<e&&(e=r),o<n&&(n=o),s>i&&(i=s),l>a&&(a=l)}this._indices[this._pos>>2]=o,this._boxes[this._pos++]=e,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,this._boxes[this._pos++]=a}}}search(e,t,r,n,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4,o=this._levelBounds.length-1;const s=[],l=[];for(;void 0!==a;){const u=Math.min(a+4*this.nodeSize,this._levelBounds[o]);for(let h=a;h<u;h+=4){const u=0|this._indices[h>>2];r<this._boxes[h]||n<this._boxes[h+1]||e>this._boxes[h+2]||t>this._boxes[h+3]||(a<4*this.numItems?(void 0===i||i(u))&&l.push(u):(s.push(u),s.push(o-1)))}o=s.pop(),a=s.pop()}return l}neighbors(e,t,r=1/0,n=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const o=this._queue,u=[],h=n*n;for(;void 0!==a;){const n=Math.min(a+4*this.nodeSize,l(a,this._levelBounds));for(let r=a;r<n;r+=4){const n=0|this._indices[r>>2],l=s(e,this._boxes[r],this._boxes[r+2]),u=s(t,this._boxes[r+1],this._boxes[r+3]),h=l*l+u*u;a<4*this.numItems?(void 0===i||i(n))&&o.push(-n-1,h):o.push(n,h)}for(;o.length&&o.peek()<0;){if(o.peekValue()>h)return o.clear(),u;if(u.push(-o.pop()-1),u.length===r)return o.clear(),u}a=o.pop()}return o.clear(),u}}function s(e,t,r){return e<t?t-e:e<=r?0:e-r}function l(e,t){let r=0,n=t.length-1;for(;r<n;){const i=r+n>>1;t[i]>e?n=i:r=i+1}return t[r]}function u(e,t,r,n,i){const a=e[n];e[n]=e[i],e[i]=a;const o=4*n,s=4*i,l=t[o],u=t[o+1],h=t[o+2],c=t[o+3];t[o]=t[s],t[o+1]=t[s+1],t[o+2]=t[s+2],t[o+3]=t[s+3],t[s]=l,t[s+1]=u,t[s+2]=h,t[s+3]=c;const d=r[n];r[n]=r[i],r[i]=d}function h(e,t){let r=e^t,n=65535^r,i=65535^(e|t),a=e&(65535^t),o=r|n>>1,s=r>>1^r,l=i>>1^n&a>>1^i,u=r&i>>1^a>>1^a;s=(r=o)&(n=s)>>2^n&(r^n)>>2,l^=r&(i=l)>>2^n&(a=u)>>2,u^=n&i>>2^(r^n)&a>>2,s=(r=o=r&r>>2^n&n>>2)&(n=s)>>4^n&(r^n)>>4,l^=r&(i=l)>>4^n&(a=u)>>4,u^=n&i>>4^(r^n)&a>>4,l^=(r=o=r&r>>4^n&n>>4)&(i=l)>>8^(n=s)&(a=u)>>8;let h=e^t,c=(n=(u^=n&i>>8^(r^n)&a>>8)^u>>1)|65535^(h|(r=l^l>>1));return((c=1431655765&((c=858993459&((c=252645135&((c=16711935&(c|c<<8))|c<<4))|c<<2))|c<<1))<<1|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&(h|h<<8))|h<<4))|h<<2))|h<<1)))>>>0}}])});